<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 22&nbsp; Dimension Reduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./26_unsupervised-ml-cluster-analysis.html" rel="next">
<link href="./23_regularization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25_dimension-reduction.html">Unsupervised Machine Learning</a></li><li class="breadcrumb-item"><a href="./25_dimension-reduction.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_data-imputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Missing Data and Data Imputation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_dimension-reduction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_unsupervised-ml-cluster-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial-sf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#dimension-reduction-1" id="toc-dimension-reduction-1" class="nav-link active" data-scroll-target="#dimension-reduction-1"><span class="header-section-number">22.1</span> Dimension Reduction</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">22.1.1</span> Background</a></li>
  <li><a href="#principal-component-analysis-pca" id="toc-principal-component-analysis-pca" class="nav-link" data-scroll-target="#principal-component-analysis-pca"><span class="header-section-number">22.1.2</span> Principal Component Analysis (PCA)</a></li>
  <li><a href="#variance-explained" id="toc-variance-explained" class="nav-link" data-scroll-target="#variance-explained"><span class="header-section-number">22.1.3</span> Variance Explained</a></li>
  <li><a href="#nd-interpretation" id="toc-nd-interpretation" class="nav-link" data-scroll-target="#nd-interpretation"><span class="header-section-number">22.1.4</span> 2nd Interpretation</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">22.1.5</span> Implementation</a></li>
  <li><a href="#tutorial-1-continuous-variables" id="toc-tutorial-1-continuous-variables" class="nav-link" data-scroll-target="#tutorial-1-continuous-variables"><span class="header-section-number">22.1.6</span> Tutorial 1 (continuous variables)</a></li>
  <li><a href="#tutorial-2-categorical-variables" id="toc-tutorial-2-categorical-variables" class="nav-link" data-scroll-target="#tutorial-2-categorical-variables"><span class="header-section-number">22.1.7</span> Tutorial 2 (categorical variables)</a></li>
  <li><a href="#how-many-principal-components-should-you-use" id="toc-how-many-principal-components-should-you-use" class="nav-link" data-scroll-target="#how-many-principal-components-should-you-use"><span class="header-section-number">22.1.8</span> How many principal components should you use?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25_dimension-reduction.html">Unsupervised Machine Learning</a></li><li class="breadcrumb-item"><a href="./25_dimension-reduction.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Unsupervised Learning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Unsupervised Learning:</strong> A process of summarizing data without a “target,” “response,” or “outcome” variable.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dimension reduction
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Dimension reduction:</strong> Reducing the number of variables in a data set while maintaining the statistical properties of the data.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clustering
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Clustering:</strong> Grouping observations into homogeneous groups.</p>
</div>
</div>
<section id="dimension-reduction-1" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="dimension-reduction-1"><span class="header-section-number">22.1</span> Dimension Reduction</h2>
<section id="background" class="level3" data-number="22.1.1">
<h3 data-number="22.1.1" class="anchored" data-anchor-id="background"><span class="header-section-number">22.1.1</span> Background</h3>
<p>Problems:</p>
<ol type="1">
<li>We want to generally understand large data sets with many variables</li>
<li>We want to visualize the relationships between more than two or three variables</li>
<li>We want to estimate a model but we have many correlated predictors</li>
</ol>
<p>Solution:</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dimension reduction
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Dimension reduction:</strong> Reducing the number of variables in a data set while maintaining the statistical properties of the data.</p>
<ol type="1">
<li><strong>Variable/Predictor/Feature selection:</strong> Process of selecting a subset of variables/predictors/features that contribute the most to a model, statistic, or data visualization</li>
<li><strong>Variable/Predictor/Feature extraction:</strong> Process of combining variables/predictors/features into a reduced subset of <em>new</em> informative and non-redundant variables/predictors/features</li>
</ol>
</div>
</div>
<p>What does it mean for a variable to be informative and non-redundant?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sample variance:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Sample variance:</strong> A measure of data dispersion. Average of squared deviations from the mean.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sample covariance:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Sample covariance:</strong> A measure of the strength and direction of a linear relationship between two variables.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Covariance matrix:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Covariance matrix (variance-covariance matrix):</strong> A <span class="math inline">\(p*p\)</span> symmetric matrix with variances on the main diagonal and covariances off of the main diagonal:</p>
</div>
</div>
<p><span class="math display">\[\begin{bmatrix}
s_1^2 &amp; s_{12} &amp; s_{13} \\
s_{21} &amp; s_2^2 &amp; s_{23} \\
s_{31} &amp; s_{32} &amp; s_3^2
\end{bmatrix}\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Total sample variance
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Total sample variance:</strong> The total amount of dispersion within a data set. The sum of the diagonal terms in the covariance matrix. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Orthogonal:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Orthogonal:</strong> Perpendicular. Orthogonal variables are linearly uncorrelated.</p>
</div>
</div>
<p>We can think of a data set as having a total amount of variance. If variables are identical or highly correlated, then it is easy to capture all or most of the total variance with a subset or linear combination of the variables. We want these new variables to be orthogonal.</p>
</section>
<section id="principal-component-analysis-pca" class="level3" data-number="22.1.2">
<h3 data-number="22.1.2" class="anchored" data-anchor-id="principal-component-analysis-pca"><span class="header-section-number">22.1.2</span> Principal Component Analysis (PCA)</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Principal Component Analysis:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Principal Component Analysis:</strong> A process that transforms many possibly linearly correlated variables into a set of linearly uncorrelated variables called principal components. The components are ordered such that the first component explains the most variance in the original data, the second explains the second most variance in the original data, and so on. A subset of principal components can often be used to represent the original data with limited information loss.</p>
</div>
</div>
<section id="sec-vis" class="level4">
<h4 class="anchored" data-anchor-id="sec-vis">Visual Explanation</h4>
<p>Assume there are two variables <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>. <span class="math inline">\(x_1\)</span> has mean zero and <span class="math inline">\(x_2\)</span> has mean zero.</p>
<p><span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are highly correlated. In fact, the data are mostly dispersed in one direction, from southwest to northeast because the data are so highly correlated.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>Imagine adding a new axis through the main pattern in the data. This axis should minimize the sum of squared perpendicular distances from each point to the line.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>If we project the data onto the main diagonal, then we can dramatically simplify the data without losing much of the variation. In this case, that means moving the points in 2-D to their closest points on the diagonal and then putting them into 1-D.</p>
<p>This plot represents the first principal component, and it captures most of the variation in the data.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>Imagine adding a new axis, that is orthogonal to the first PC, through the second pattern in the data. This axis should minimize the sum of squared perpendicular distances from each point to the line.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>If we project the data onto the second diagonal, then we can further simplify the data–though less than with the first project. Again, this means moving the points in 2-D to their closest points on the diagonal and then putting them into 1-D.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="144"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mathematical-explanation" class="level4">
<h4 class="anchored" data-anchor-id="mathematical-explanation">Mathematical Explanation</h4>
<p>Principal components are weighted combinations of variables in the original data set.</p>
<p><span class="math display">\[PC_1 = \phi_{11} x_1 + \phi_{21}x_2 \text{ where } \phi_{11}^2 + \phi_{21}^2 = 1\]</span></p>
<p><span class="math inline">\(\phi_{11}\)</span> and <span class="math inline">\(\phi_{21}\)</span> are called loadings, and they come from the dominant eigenvector from an eigenvector decomposition of the covariance matrix of the original data set. The eigenvectors specify the orientation of the principal components relative to the original variables. Each eigenvector has an eigenvalue, or the variance explained by the corresponding principal component. The eigenvalues must decrease from the first principal component (corresponding to the dominant eigenvector) to the last.</p>
<p><span class="math display">\[PC_2 = \phi_{12} x_1 + \phi_{22}x_2 \text{ where } \phi_{12}^2 + \phi_{22}^2 = 1\]</span></p>
<p><span class="math inline">\(\phi_{12}\)</span> and <span class="math inline">\(\phi_{22}\)</span> are called loadings and they come from the second dominant eigenvector from an eigenvector decomposition of the covariance matrix of the original data set.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>A more thorough introduction of PCA requires the use of linear algebra which is not assumed for this coursework. If you want to learn more about PCA, you can start with <a href="https://alexhwilliams.info/itsneuronalblog/2016/03/27/pca/">this blog</a> which gives a linear algebraic approach while also provides intuitive graphics.</p>
</div>
</div>
<p>Take a simple example with 10 observations of <code>body_weight</code> and <code>height</code>. All observations are centered and scaled.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">body_weight</th>
<th style="text-align: right;">height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1.34</td>
<td style="text-align: right;">-1.49</td>
</tr>
<tr class="even">
<td style="text-align: right;">-1.16</td>
<td style="text-align: right;">-1.02</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.77</td>
<td style="text-align: right;">-0.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.51</td>
<td style="text-align: right;">0.37</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.22</td>
<td style="text-align: right;">-0.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-0.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.37</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">1.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">-0.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">1.77</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We want to generate weights to combine <code>body_weight</code> and <code>height</code> into an entirely new variable called <code>PC1</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>cov_bmi_ex <span class="ot">&lt;-</span> <span class="fu">cov</span>(bmi_ex)</span>
<span id="cb1-2"><a href="#cb1-2"></a>cov_bmi_ex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            body_weight   height
body_weight    1.000000 0.805714
height         0.805714 1.000000</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>eigen_bmi_ex <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov_bmi_ex)</span>
<span id="cb3-2"><a href="#cb3-2"></a>eigen_bmi_ex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 1.805714 0.194286

$vectors
           [,1]       [,2]
[1,] -0.7071068  0.7071068
[2,] -0.7071068 -0.7071068</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>pca_bmi_ex <span class="ot">&lt;-</span> bmi_ex <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">mutate</span>(<span class="at">PC1 =</span> body_weight <span class="sc">*</span> <span class="fl">0.7071068</span> <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>           height <span class="sc">*</span> <span class="fl">0.7071068</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">mutate</span>(<span class="at">PC2 =</span> body_weight <span class="sc">*</span> <span class="sc">-</span><span class="fl">0.7071068</span> <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5"></a>           height <span class="sc">*</span> <span class="fl">0.7071068</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pca_bmi_ex, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">body_weight</th>
<th style="text-align: right;">height</th>
<th style="text-align: right;">PC1</th>
<th style="text-align: right;">PC2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1.34</td>
<td style="text-align: right;">-1.49</td>
<td style="text-align: right;">-2.00</td>
<td style="text-align: right;">-0.10</td>
</tr>
<tr class="even">
<td style="text-align: right;">-1.16</td>
<td style="text-align: right;">-1.02</td>
<td style="text-align: right;">-1.54</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.77</td>
<td style="text-align: right;">-0.56</td>
<td style="text-align: right;">-0.94</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.51</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-0.22</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">-0.22</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-0.56</td>
<td style="text-align: right;">-0.38</td>
<td style="text-align: right;">-0.41</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">1.30</td>
<td style="text-align: right;">1.49</td>
<td style="text-align: right;">0.36</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.32</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">-1.00</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.58</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">2.37</td>
<td style="text-align: right;">0.13</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The principal components aren’t necessarily interpretable, but they capture all of the variance in the data and are orthogonal (linearly uncorrelated). However, in this example, <code>PC1</code> is essentially the “latent” variable “size” and <code>PC2</code> is essentially body-mass index.</p>
</section>
</section>
<section id="variance-explained" class="level3" data-number="22.1.3">
<h3 data-number="22.1.3" class="anchored" data-anchor-id="variance-explained"><span class="header-section-number">22.1.3</span> Variance Explained</h3>
<p>So how much variance does a principal component explain? How much variance do the first three principal components explain?</p>
<p>It depends on the nature of the data. If variables in the data set have strong linear relationships, then the first few principal components can explain much of the variation.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Proportion of variance explained:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Proportion of variance explained (PVE):</strong> The proportion of variation captured by the <span class="math inline">\(k^{th}\)</span> principal component</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cumulative variance explained:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Cumulative variance explained (PVE):</strong> The proportion of variation captured by the <span class="math inline">\(1^{st}\)</span> through <span class="math inline">\(k^{th}\)</span> principal components</p>
</div>
</div>
<p>Take the body weight and height example from above. <code>PC1</code> captures more than 90 percent of variation in the original data. This is excellent. We took a two variable data set and captured 90 percent of its variation with one variable!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">summary</span>(<span class="fu">prcomp</span>(bmi_ex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1     PC2
Standard deviation     1.3438 0.44078
Proportion of Variance 0.9029 0.09714
Cumulative Proportion  0.9029 1.00000</code></pre>
</div>
</div>
</section>
<section id="nd-interpretation" class="level3" data-number="22.1.4">
<h3 data-number="22.1.4" class="anchored" data-anchor-id="nd-interpretation"><span class="header-section-number">22.1.4</span> 2nd Interpretation</h3>
<p>The principal components create the p-dimensional space that is closest to the observations in the data.</p>
<p>The line in <a href="#sec-vis" class="quarto-xref"><span>Section 22.1.2.1</span></a> above is the line that is closest to all of the data. Two principal components in a data set with 50 variables create a plane that is closest to all observations in the data in 50 dimensions.</p>
</section>
<section id="implementation" class="level3" data-number="22.1.5">
<h3 data-number="22.1.5" class="anchored" data-anchor-id="implementation"><span class="header-section-number">22.1.5</span> Implementation</h3>
<p>PCA is implemented in R with <code>prcomp()</code>. However, we will use <code>library(recipes)</code> from the tidymodels framework.</p>
<p>PCA requires numeric data. Categorical variables need to be recoded with techniques like dummy variable encoding. Use <code>step_dummy()</code> to create dummy variables. Mixing continuous variables and dummy variables in the same PCA is possible but can complicate interpretation.</p>
<p>The scale of variables matters. If one variable has a range of <span class="math inline">\([0, 1000000]\)</span> and another has a range of <span class="math inline">\([0, 0.1]\)</span>, then the first variable will dominate the second variable. Sometimes this makes sense if the units are the same or the ranges matter. Other times it does not make sense.</p>
<p>PCA always mean centers data. In many cases, variables are standardized by dividing by their standard deviations or are min-max scaled. <code>step_normalize()</code> centers and scales a variable. <code>step_range()</code> converts variables to a scaled numeric range (e.g.&nbsp;0 to 1).</p>
</section>
<section id="tutorial-1-continuous-variables" class="level3" data-number="22.1.6">
<h3 data-number="22.1.6" class="anchored" data-anchor-id="tutorial-1-continuous-variables"><span class="header-section-number">22.1.6</span> Tutorial 1 (continuous variables)</h3>
<p><code>state_data</code> includes numeric variables about state household population (<code>hhpop</code>), state home ownership rate (<code>horate</code>), and state median household income (<code>medhhincome</code>). The objective is to plot the three variables in two dimensions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># load statedata from library(urbnmapr)</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>state_data <span class="ot">&lt;-</span> urbnmapr<span class="sc">::</span>statedata</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(state_data), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">state_fips</th>
<th style="text-align: left;">state_name</th>
<th style="text-align: right;">hhpop</th>
<th style="text-align: right;">horate</th>
<th style="text-align: right;">medhhincome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">01</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">1846380</td>
<td style="text-align: right;">0.681</td>
<td style="text-align: right;">44700</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">02</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">250183</td>
<td style="text-align: right;">0.631</td>
<td style="text-align: right;">70600</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">04</td>
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">2463012</td>
<td style="text-align: right;">0.621</td>
<td style="text-align: right;">51000</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">05</td>
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">1144657</td>
<td style="text-align: right;">0.655</td>
<td style="text-align: right;">42000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">06</td>
<td style="text-align: left;">California</td>
<td style="text-align: right;">12895471</td>
<td style="text-align: right;">0.537</td>
<td style="text-align: right;">64600</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: left;">08</td>
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">2074517</td>
<td style="text-align: right;">0.639</td>
<td style="text-align: right;">63500</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># load needed packages</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(recipes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'recipes'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stringr':

    fixed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    step</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># normalize numeric variables</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>recipe1 <span class="ot">&lt;-</span> state_data <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">recipe</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">step_normalize</span>(hhpop, horate, medhhincome) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">prep</span>()</span>
<span id="cb13-8"><a href="#cb13-8"></a>  </span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co"># apply estimated mean and sd to original data</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>state_numeric_data <span class="ot">&lt;-</span> recipe1 <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> state_data) </span>
<span id="cb13-12"><a href="#cb13-12"></a></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co"># look at the correlation matrix</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>state_numeric_data <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15"></a>  <span class="fu">select</span>(hhpop, horate, medhhincome) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  hhpop     horate medhhincome
hhpop        1.00000000 -0.2926963  0.01883672
horate      -0.29269634  1.0000000 -0.37477714
medhhincome  0.01883672 -0.3747771  1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># estimate the loadings</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>recipe2 <span class="ot">&lt;-</span> state_numeric_data <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">recipe</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">step_pca</span>(hhpop, horate, medhhincome) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">prep</span>(<span class="at">data =</span> state_numeric_data)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># apply loadings to original data</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>state_pca <span class="ot">&lt;-</span> recipe2 <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> state_numeric_data)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co"># visualize!</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb15-14"><a href="#cb15-14"></a>    <span class="at">data =</span> state_pca, </span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="fu">aes</span>(PC1, PC2),</span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb15-17"><a href="#cb15-17"></a>  ) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb15-19"><a href="#cb15-19"></a>    <span class="at">data =</span> <span class="fu">filter</span>(state_pca, state_fips <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"06"</span>, <span class="st">"22"</span>, <span class="st">"24"</span>)),</span>
<span id="cb15-20"><a href="#cb15-20"></a>    <span class="fu">aes</span>(PC1, PC2, <span class="at">label =</span> state_name)</span>
<span id="cb15-21"><a href="#cb15-21"></a>  ) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PC1 and PC2 for State Data"</span>) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">tidy</span>(recipe2, <span class="at">number =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"variance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   terms                         value component id       
   &lt;chr&gt;                         &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;    
 1 variance                      1.48          1 pca_vPMZE
 2 variance                      0.982         2 pca_vPMZE
 3 variance                      0.533         3 pca_vPMZE
 4 cumulative variance           1.48          1 pca_vPMZE
 5 cumulative variance           2.47          2 pca_vPMZE
 6 cumulative variance           3             3 pca_vPMZE
 7 percent variance             49.5           1 pca_vPMZE
 8 percent variance             32.7           2 pca_vPMZE
 9 percent variance             17.8           3 pca_vPMZE
10 cumulative percent variance  49.5           1 pca_vPMZE
11 cumulative percent variance  82.2           2 pca_vPMZE
12 cumulative percent variance 100             3 pca_vPMZE</code></pre>
</div>
</div>
<p>We can look at the loadings (<span class="math inline">\(\phi_{ij}\)</span>s) to determine how much each variable contributes to each principal component. Large loadings (positive or negative) indicate that the variable has a strong relationship to the principal component. The sign of the loading indicates the direction of the relationship. Here, <code>horate</code> contributes the most the <code>PC1</code> and <code>hhpop</code> contributes the most to <code>PC2</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">tidy</span>(recipe2, <span class="at">number =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"coef"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  terms          value component id       
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;    
1 hhpop        0.445   PC1       pca_vPMZE
2 horate      -0.700   PC1       pca_vPMZE
3 medhhincome  0.559   PC1       pca_vPMZE
4 hhpop       -0.788   PC2       pca_vPMZE
5 horate      -0.00963 PC2       pca_vPMZE
6 medhhincome  0.615   PC2       pca_vPMZE
7 hhpop        0.425   PC3       pca_vPMZE
8 horate       0.714   PC3       pca_vPMZE
9 medhhincome  0.556   PC3       pca_vPMZE</code></pre>
</div>
</div>
</section>
<section id="tutorial-2-categorical-variables" class="level3" data-number="22.1.7">
<h3 data-number="22.1.7" class="anchored" data-anchor-id="tutorial-2-categorical-variables"><span class="header-section-number">22.1.7</span> Tutorial 2 (categorical variables)</h3>
<p>Here we have a data set with 493 votes from two years of the 114th Senate (2015-2017). The data set has 100 rows and 495 variables. An affirmative vote is <code>1</code>, a negative vote is <code>-1</code>, and an abstention is <code>0</code>. The data are from <a href="https://data.world/bradrobinson/us-senate-voting-records">Bradley Robinson</a> and this example is based on an earlier analysis by Professor Sivan Leviyang.</p>
<p>Understanding the data or visualizing the data would be a time consuming task. Here are the first few columns and rows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>votes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, </span>
<span id="cb20-2"><a href="#cb20-2"></a>                             <span class="st">"votes.csv"</span>))</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>votes[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  name               party    v1    v2    v3    v4
  &lt;chr&gt;              &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Lamar Alexander    R         1    -1    -1     1
2 Kelly Ayotte       R        -1    -1     1     1
3 Tammy Baldwin      D        -1     1    -1    -1
4 John Barrasso      R         1    -1     1     1
5 Michael Bennet     D        -1     1    -1    -1
6 Richard Blumenthal D        -1     1    -1    -1</code></pre>
</div>
</div>
<p>Let’s use PCA to create principal components of the 493 votes variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># estimate the loadings</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>votes_rec <span class="ot">&lt;-</span> votes <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">recipe</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">step_pca</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">prep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first principal component explains about 45 percent of the variation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">tidy</span>(votes_rec, <span class="at">number =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">filter</span>(terms <span class="sc">==</span> <span class="st">"cumulative percent variance"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">slice_min</span>(value, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  terms                       value component id       
  &lt;chr&gt;                       &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;    
1 cumulative percent variance  45.0         1 pca_U8dzV
2 cumulative percent variance  74.4         2 pca_U8dzV
3 cumulative percent variance  77.0         3 pca_U8dzV
4 cumulative percent variance  78.4         4 pca_U8dzV
5 cumulative percent variance  79.6         5 pca_U8dzV</code></pre>
</div>
</div>
<p>At this point, we’ve estimated the loadings. Let’s apply the loadings to the original data with <code>bake()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># apply estimated loadings to original data</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>votes_pcs <span class="ot">&lt;-</span> votes_rec <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> votes) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s visualize the first two components and label a few key observations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Bernie Sanders"</span>, <span class="st">"Ted Cruz"</span>, <span class="st">"Joe Manchin"</span>, <span class="st">"Susan Collins"</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="at">data =</span> votes_pcs, </span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> party),</span>
<span id="cb26-7"><a href="#cb26-7"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb26-8"><a href="#cb26-8"></a>  ) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="at">data =</span> <span class="fu">filter</span>(votes_pcs, name <span class="sc">%in%</span> names), </span>
<span id="cb26-11"><a href="#cb26-11"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">label =</span> name)</span>
<span id="cb26-12"><a href="#cb26-12"></a>  ) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb26-14"><a href="#cb26-14"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">D</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">`</span><span class="at">I</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"#228B22"</span>, <span class="st">`</span><span class="at">R</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"red"</span>)</span>
<span id="cb26-15"><a href="#cb26-15"></a>  ) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PC1 and PC2 of 114th Senate Votes"</span>) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>  <span class="fu">guides</span>(<span class="at">text =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="25_dimension-reduction_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-many-principal-components-should-you-use" class="level3" data-number="22.1.8">
<h3 data-number="22.1.8" class="anchored" data-anchor-id="how-many-principal-components-should-you-use"><span class="header-section-number">22.1.8</span> How many principal components should you use?</h3>
<p>By default, conducting PCA with <code>library(recipes)</code> will return as many principal components as there are variables. Because because our goal is dimensionality reduction, we need a way to determine how many principal components to keep for analysis. Several different criteria have been suggested:</p>
<ul>
<li>Ignore principal components at the point at which the next principal component offers little increase in the total explained variation.</li>
<li>Include all principal components up to a predetermined total percent explained variation, such as 90%.</li>
<li>Ignore components whose explained variation is less than the average variation explained, with the idea being that such a principal component offers less than one variable’s worth of information.</li>
<li>Ignore the last principal components whose explained variation are all roughly equal.</li>
</ul>
<p><strong>Source:</strong> <span class="citation" data-cites="holland">Holland (<a href="references.html#ref-holland" role="doc-biblioref">n.d.</a>)</span></p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-holland" class="csl-entry" role="listitem">
Holland, Steven. n.d. <span>“Principal Component Analysis.”</span> <a href="http://stratigrafia.org/8370/lecturenotes/principalComponents.html">http://stratigrafia.org/8370/lecturenotes/principalComponents.html</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>In linear algebra, the <strong>trace</strong> is the sum of the elements on the main diagonal of a matrix. The total sample variance is the trace of the variance-covariance matrix.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./23_regularization.html" class="pagination-link" aria-label="Regularization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./26_unsupervised-ml-cluster-analysis.html" class="pagination-link" aria-label="Cluster Analysis">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>