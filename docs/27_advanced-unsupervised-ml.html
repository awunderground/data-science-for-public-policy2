<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 22&nbsp; Mixture Distributions and Mixture Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./28_geospatial.html" rel="next">
<link href="./23_regularization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./27_advanced-unsupervised-ml.html">Unsupervised Machine Learning</a></li><li class="breadcrumb-item"><a href="./27_advanced-unsupervised-ml.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-review6a" id="toc-sec-review6a" class="nav-link active" data-scroll-target="#sec-review6a"><span class="header-section-number">22.1</span> Review 1</a></li>
  <li><a href="#a-new-type-of-random-variable" id="toc-a-new-type-of-random-variable" class="nav-link" data-scroll-target="#a-new-type-of-random-variable"><span class="header-section-number">22.2</span> A New Type of Random Variable</a></li>
  <li><a href="#mixture-distributions" id="toc-mixture-distributions" class="nav-link" data-scroll-target="#mixture-distributions"><span class="header-section-number">22.3</span> Mixture Distributions</a>
  <ul class="collapse">
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">22.3.1</span> Example 1</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="header-section-number">22.3.2</span> Example 2</a></li>
  </ul></li>
  <li><a href="#sec-review6b" id="toc-sec-review6b" class="nav-link" data-scroll-target="#sec-review6b"><span class="header-section-number">22.4</span> Review #2</a>
  <ul class="collapse">
  <li><a href="#multivariate-normal-distribution" id="toc-multivariate-normal-distribution" class="nav-link" data-scroll-target="#multivariate-normal-distribution"><span class="header-section-number">22.4.1</span> Multivariate Normal Distribution</a></li>
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering"><span class="header-section-number">22.4.2</span> K-Means Clustering</a></li>
  </ul></li>
  <li><a href="#mixture-modelingmodel-based-clustering" id="toc-mixture-modelingmodel-based-clustering" class="nav-link" data-scroll-target="#mixture-modelingmodel-based-clustering"><span class="header-section-number">22.5</span> Mixture Modeling/Model-Based Clustering</a></li>
  <li><a href="#gaussian-mixture-modeling-gmm" id="toc-gaussian-mixture-modeling-gmm" class="nav-link" data-scroll-target="#gaussian-mixture-modeling-gmm"><span class="header-section-number">22.6</span> Gaussian Mixture Modeling (GMM)</a>
  <ul class="collapse">
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3"><span class="header-section-number">22.6.1</span> Example 3</a></li>
  <li><a href="#mclust" id="toc-mclust" class="nav-link" data-scroll-target="#mclust"><span class="header-section-number">22.6.2</span> mclust</a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">22.6.3</span> Estimation</a></li>
  <li><a href="#example-4" id="toc-example-4" class="nav-link" data-scroll-target="#example-4"><span class="header-section-number">22.6.4</span> Example 4</a></li>
  <li><a href="#bic" id="toc-bic" class="nav-link" data-scroll-target="#bic"><span class="header-section-number">22.6.5</span> BIC</a></li>
  <li><a href="#example-5" id="toc-example-5" class="nav-link" data-scroll-target="#example-5"><span class="header-section-number">22.6.6</span> Example 5</a></li>
  </ul></li>
  <li><a href="#bernoulli-mixture-modeling-bmm" id="toc-bernoulli-mixture-modeling-bmm" class="nav-link" data-scroll-target="#bernoulli-mixture-modeling-bmm"><span class="header-section-number">22.7</span> Bernoulli Mixture Modeling (BMM)</a>
  <ul class="collapse">
  <li><a href="#two-digit-example" id="toc-two-digit-example" class="nav-link" data-scroll-target="#two-digit-example"><span class="header-section-number">22.7.1</span> Two Digit Example</a></li>
  <li><a href="#ten-digit-example" id="toc-ten-digit-example" class="nav-link" data-scroll-target="#ten-digit-example"><span class="header-section-number">22.7.2</span> Ten Digit Example</a></li>
  </ul></li>
  <li><a href="#considerations" id="toc-considerations" class="nav-link" data-scroll-target="#considerations"><span class="header-section-number">22.8</span> Considerations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./27_advanced-unsupervised-ml.html">Unsupervised Machine Learning</a></li><li class="breadcrumb-item"><a href="./27_advanced-unsupervised-ml.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    This chapter introduces mixture distributions and mixture modeling. This tools use simple probability distributions to model and understand complex empirical distributions.
  </div>
</div>


</header>


<dl>
<dt><img src="images/header-images/Temee.jpg" class="img-fluid"></dt>
<dd>
<p>Image by <a href="https://en.wikipedia.org/wiki/Bactrian_camel#/media/File:Temee.jpg">Yaan</a></p>
</dd>
</dl>
<section id="sec-review6a" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="sec-review6a"><span class="header-section-number">22.1</span> Review 1</h2>
<p>We’ll start with a review of multivariate normal distributions. In particular, this exercise demonstrates the impact of the variance-covariance matrix on the shape of multivariate normal distributions.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Load <code>library(mvtnorm)</code>.</li>
<li>Copy and paste the following code. This code will not obviously not run as is. We will add tibbles to <code>independent</code>, <code>sigma1</code> and <code>sigma2</code> in the steps below.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="at">independent =</span> ,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="at">var_covar1 =</span> ,</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="at">var_covar2 =</span> ,</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="at">.id =</span> <span class="st">"source"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Create a tibble with <code>V1</code> and <code>V2</code>. For both variables, use <code>rnorm()</code> to sample 1,000 observations from a standard normal distribution. Add the results to <code>independent</code>.</li>
<li>Using the following variance-covariance matrix, sample 1,000 observations from a multivariate-normal distribution. Add the results for <code>sigma1</code> and use <code>as_tibble()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Using the following variance-covariance matrix, sample 1,000 observations from a multivariate-normal distribution. Add the results for <code>sigma2</code> and use <code>as_tibble()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="fl">0.8</span>, <span class="dv">1</span>), </span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Create a scatter plot with <code>V1</code> on the x-axis and <code>V2</code> on the y-axis. Facet based on <code>source</code>.</li>
</ol>
</div>
</div>
<div class="cell" data-fold="true">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>)</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>    <span class="fl">0.8</span>, <span class="dv">1</span>), </span>
<span id="cb4-12"><a href="#cb4-12"></a>  <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>)</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="fu">bind_rows</span>(</span>
<span id="cb4-16"><a href="#cb4-16"></a>  <span class="at">independent =</span> <span class="fu">tibble</span>(</span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="at">V1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>),</span>
<span id="cb4-18"><a href="#cb4-18"></a>    <span class="at">V2 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb4-19"><a href="#cb4-19"></a>  ),</span>
<span id="cb4-20"><a href="#cb4-20"></a>  <span class="at">sigma1 =</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb4-21"><a href="#cb4-21"></a>    <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="at">sigma =</span> sigma1</span>
<span id="cb4-23"><a href="#cb4-23"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="fu">as_tibble</span>(),</span>
<span id="cb4-25"><a href="#cb4-25"></a>  <span class="at">sigma2 =</span> <span class="fu">rmvnorm</span>(</span>
<span id="cb4-26"><a href="#cb4-26"></a>    <span class="at">n =</span> <span class="dv">1000</span>, </span>
<span id="cb4-27"><a href="#cb4-27"></a>    <span class="at">sigma =</span> sigma2</span>
<span id="cb4-28"><a href="#cb4-28"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="fu">as_tibble</span>(),</span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="at">.id =</span> <span class="st">"source"</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>) <span class="sc">|&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(V1, V2)) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="a-new-type-of-random-variable" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="a-new-type-of-random-variable"><span class="header-section-number">22.2</span> A New Type of Random Variable</h2>
<p>We learned about common univariate and multivariate distributions. For each of the distributions, there are well-defined and straightforward ways to sample values from the distribution. We can also manipulate these distributions to calculate probabilities.</p>
<p>The real world is complicated, and we will quickly come across data where we struggle to find a common probability distributions.</p>
<p>Figure <a href="#fig-geyser-eruptions" class="quarto-xref">Figure&nbsp;<span>22.1</span></a> shows a relative frequency histogram for the duration of eruptions at Old Faithful in Yellowstone National Park.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># faithful is a data set built into R</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>faithful <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(eruptions, <span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-geyser-eruptions" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-geyser-eruptions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-geyser-eruptions-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-geyser-eruptions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.1: Distribution of waiting times between eruptions at the Old Faithful geyser in Yellowstone National Park.
</figcaption>
</figure>
</div>
</div>
</div>
<p>This distribution looks very complicated. But what if we break this distribution into pieces? In this case, what if we think of the distribution as a combination of two normal distributions?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># show geyser as two normal distribution</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">library</span>(mclust)</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>gmm_geyser <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="at">data =</span> dplyr<span class="sc">::</span><span class="fu">select</span>(faithful, eruptions), </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="at">G =</span> <span class="dv">2</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="fu">bind_cols</span>(</span>
<span id="cb7-11"><a href="#cb7-11"></a>  faithful,</span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="at">cluster =</span> gmm_geyser<span class="sc">$</span>classification</span>
<span id="cb7-13"><a href="#cb7-13"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(eruptions, <span class="at">y =</span> <span class="fu">after_stat</span>(density), </span>
<span id="cb7-15"><a href="#cb7-15"></a>             <span class="at">fill =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Latent Variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>latent variable</strong> is a variable that isn’t directly observed but can be inferred through other variables and modeling. Sometimes the latent variable is meaningful but unobserved. Sometimes it isn’t meaningful.</p>
<p><strong>Latent variables</strong> are sometimes called hidden variables.</p>
</div>
</div>
<p>Breaking complex problems into smaller pieces is good. These latent variables will allow us to do some cools things:</p>
<ol type="1">
<li>Simply express complicated probability distributions</li>
<li>Make inferences about complex populations</li>
<li>Cluster data</li>
</ol>
<p>In this set of notes, we’ll use latent variables to</p>
<ol type="1">
<li>Construct mixture distributions</li>
<li>Cluster data</li>
</ol>
<p>Let’s consider a “data generation story” different than anything we considered in Chapter 5. Instead of sampling directly from one known probability distribution, we will sample in two stages <span class="citation" data-cites="hastie2009">(<a href="references.html#ref-hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009</a>)</span>.</p>
<ol type="1">
<li>Sample from a discrete probability distribution with <span class="math inline">\(k\)</span> unique values (i.e.&nbsp;Bernoulli distribution when <span class="math inline">\(k = 2\)</span> and categorical distribution when <span class="math inline">\(k &gt; 2\)</span>).</li>
<li>Sample from one of <span class="math inline">\(k\)</span> different distributions conditional on the outcome of step 1.</li>
</ol>
<p>This new sampling procedure aligns closely with the idea of hierarchical sampling and hierarchical models. It is also sometimes called ancestral sampling <span class="citation" data-cites="bishop2006">(<a href="references.html#ref-bishop2006" role="doc-biblioref">Bishop 2006, 430</a>)</span>.</p>
<p>This two-step approach dramatically increases the types of distributions at our disposal because we are no longer limited to individual common univariate distributions like a single normal distribution or a single uniform distribution. The two-step approach is also the foundation of two related tools:</p>
<ol type="1">
<li><strong>Mixture distributions:</strong> Distributions expressed as the linear combination of other distributions. Mixture distributions can be very complicated distributions expressed in terms of simple distributions with known properties.</li>
<li><strong>Mixture modeling:</strong> Statistical inference about sub-populations made only with pooled data without labels for the sub populations.</li>
</ol>
<p>With mixture distributions, we care about the overall distribution and don’t care about the latent variables.</p>
<p>With mixture modeling, we use the overall distribution to learn about the latent variables/sub populations/clusters in the data.</p>
</section>
<section id="mixture-distributions" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="mixture-distributions"><span class="header-section-number">22.3</span> Mixture Distributions</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mixture Distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>mixture distribution</strong> is a probabilistic model that is a linear combination of common probability distributions.</p>
<p>A discrete mixture distribution can be expressed as</p>
<p><span class="math display">\[
p_{mixture}(x) = \sum_{k = 1}^K \pi_kp(x)
\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the number of mixtures and <span class="math inline">\(\pi_k\)</span> is the weight of each PMF included in the mixture distribution.</p>
<p>A continuous mixture distribution can be expressed as</p>
<p><span class="math display">\[
p_{mixture}(x) = \sum_{k = 1}^K \pi_kf(x)
\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the number of mixtures and <span class="math inline">\(\pi_k\)</span> is the weight of each PDF included in the mixture distribution.</p>
</div>
</div>
<section id="example-1" class="level3" data-number="22.3.1">
<h3 data-number="22.3.1" class="anchored" data-anchor-id="example-1"><span class="header-section-number">22.3.1</span> Example 1</h3>
<p>Let’s consider a concrete example with a Bernoulli distribution and two normal distributions.</p>
<ol type="1">
<li>Sample <span class="math inline">\(X \sim Bern(p = 0.25)\)</span></li>
<li>Sample from <span class="math inline">\(Y \sim N(\mu = 0, \sigma = 2)\)</span> if <span class="math inline">\(X = 0\)</span> and <span class="math inline">\(Y \sim (\mu = 4, \sigma = 2)\)</span> if <span class="math inline">\(X = 1\)</span>.</li>
</ol>
<p>Now, let’s sample from a Bernoulli distribution and then sample from one of two normal distributions using R code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>  </span>
<span id="cb8-3"><a href="#cb8-3"></a>  step1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>))</span>
<span id="cb8-4"><a href="#cb8-4"></a>  </span>
<span id="cb8-5"><a href="#cb8-5"></a>  step1 <span class="ot">&lt;-</span> <span class="fu">sort</span>(step1)</span>
<span id="cb8-6"><a href="#cb8-6"></a>  </span>
<span id="cb8-7"><a href="#cb8-7"></a>  step2 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-8"><a href="#cb8-8"></a>    <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">sum</span>(step1 <span class="sc">==</span> <span class="dv">0</span>), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">sum</span>(step1 <span class="sc">==</span> <span class="dv">1</span>), <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>  )</span>
<span id="cb8-11"><a href="#cb8-11"></a>  </span>
<span id="cb8-12"><a href="#cb8-12"></a>  tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb8-13"><a href="#cb8-13"></a>    <span class="at">x =</span> step1,</span>
<span id="cb8-14"><a href="#cb8-14"></a>    <span class="at">y =</span> step2</span>
<span id="cb8-15"><a href="#cb8-15"></a>  )</span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>}</span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="fu">generate_data</span>(<span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This marginal distribution looks complex but the process of creating the marginal distribution is simple.</p>
<p>In fact, consider this quote from <span class="citation" data-cites="bishop2006">Bishop (<a href="references.html#ref-bishop2006" role="doc-biblioref">2006</a>)</span> (Page 111):</p>
<blockquote class="blockquote">
<p>By using a sufficient number of Gaussians, and by adjusting their means and covariances as well as the coefficients in the linear combination, almost any continuous density can be approximated to arbitrary accuracy.</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Component
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>component</strong> is each common probability distribution that is combined to create a mixture distribution. For example, a mixture of two Gaussian distributions has two components.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mixing Coefficient
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>mixing coefficient</strong> is the probability associated with a component with a component in a mixture distribution. Mixing coefficients must sum to 1.</p>
<p>We’ll use <span class="math inline">\(\pi_k\)</span> for population mixing coefficients and <span class="math inline">\(p_k\)</span> for sample mixing coefficients. Mixing coefficients are also called mixing weights and mixing probabilities.</p>
</div>
</div>
<p>Mixture distributions are often overparameterized, which means they have an excessive number of parameters. For a univariate mixture of normals with <span class="math inline">\(k\)</span> components, we have <span class="math inline">\(k\)</span> means, <span class="math inline">\(k\)</span> standard deviations, and <span class="math inline">\(k\)</span> mixing coefficients.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Sample 1,000 observations from a mixture of three normal distributions with the following parameters:</li>
</ol>
<ul>
<li><span class="math inline">\(p_1 = p_2 = p_3\)</span></li>
<li><span class="math inline">\(\mu_1 = -3\)</span>, <span class="math inline">\(\mu_2 = 0\)</span>, <span class="math inline">\(\mu_3 = 3\)</span></li>
<li><span class="math inline">\(\sigma_1 = \sigma_2 = \sigma_3 = 1\)</span></li>
</ul>
<ol start="2" type="1">
<li>Create a relative frequency histogram of the values.</li>
</ol>
</div>
</div>
</section>
<section id="example-2" class="level3" data-number="22.3.2">
<h3 data-number="22.3.2" class="anchored" data-anchor-id="example-2"><span class="header-section-number">22.3.2</span> Example 2</h3>
<p>Suppose we used statistical inference to infer some parameters for the geysers example above. We will describe how to estimate these paramaters later.</p>
<ul>
<li><span class="math inline">\(p_1 =\)</span> 0.3485696 and <span class="math inline">\(p_2 =\)</span> 0.6514304</li>
<li><span class="math inline">\(\bar{x_1} =\)</span> 2.0189927 and <span class="math inline">\(\bar{x_2} =\)</span> 4.2737083</li>
<li><span class="math inline">\(s_1 =\)</span> 0.2362355and <span class="math inline">\(s_2 =\)</span> 0.4365146</li>
</ul>
<p>The mixture density is</p>
<p><span id="eq-geyser-mixture"><span class="math display">\[
f_{mixture}(x) = p_1f(x|\mu = \bar{x_1}, \sigma = s_1) + p_2f(x|\mu = \bar{x_2},\sigma=s_2)
\tag{22.1}\]</span></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>geyser_density <span class="ot">&lt;-</span> <span class="cf">function</span>(x, model) {</span>
<span id="cb10-2"><a href="#cb10-2"></a>  </span>
<span id="cb10-3"><a href="#cb10-3"></a>  probs <span class="ot">&lt;-</span> model<span class="sc">$</span>parameters<span class="sc">$</span>pro</span>
<span id="cb10-4"><a href="#cb10-4"></a>  </span>
<span id="cb10-5"><a href="#cb10-5"></a>  d1 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>    x, </span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="at">mean =</span>  model<span class="sc">$</span>parameters<span class="sc">$</span>mean[<span class="dv">1</span>], </span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="at">sd =</span> <span class="fu">sqrt</span>(model<span class="sc">$</span>parameters<span class="sc">$</span>variance<span class="sc">$</span>sigmasq[<span class="dv">1</span>])</span>
<span id="cb10-9"><a href="#cb10-9"></a>  )</span>
<span id="cb10-10"><a href="#cb10-10"></a>  </span>
<span id="cb10-11"><a href="#cb10-11"></a>  d2 <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(</span>
<span id="cb10-12"><a href="#cb10-12"></a>    x, </span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="at">mean =</span>  model<span class="sc">$</span>parameters<span class="sc">$</span>mean[<span class="dv">2</span>], </span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="at">sd =</span> <span class="fu">sqrt</span>(model<span class="sc">$</span>parameters<span class="sc">$</span>variance<span class="sc">$</span>sigmasq[<span class="dv">2</span>])</span>
<span id="cb10-15"><a href="#cb10-15"></a>  )</span>
<span id="cb10-16"><a href="#cb10-16"></a>  </span>
<span id="cb10-17"><a href="#cb10-17"></a>  probs[<span class="dv">1</span>] <span class="sc">*</span> d1 <span class="sc">+</span> probs[<span class="dv">2</span>] <span class="sc">*</span> d2</span>
<span id="cb10-18"><a href="#cb10-18"></a>  </span>
<span id="cb10-19"><a href="#cb10-19"></a>}</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a>mm <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-22"><a href="#cb10-22"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="fl">0.01</span>),</span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="at">f_x =</span> <span class="fu">map_dbl</span>(x, geyser_density, <span class="at">model =</span> gmm_geyser)</span>
<span id="cb10-24"><a href="#cb10-24"></a>) </span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> faithful, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> eruptions, <span class="at">y =</span> <span class="fu">after_stat</span>(density))) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> mm, <span class="at">mapping =</span> <span class="fu">aes</span>(x, f_x), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb10-29"><a href="#cb10-29"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-30"><a href="#cb10-30"></a>    <span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb10-31"><a href="#cb10-31"></a>    <span class="at">subtitles =</span> <span class="st">"Observed data in black, inferred distribution in red"</span></span>
<span id="cb10-32"><a href="#cb10-32"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-review6b" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="sec-review6b"><span class="header-section-number">22.4</span> Review #2</h2>
<section id="multivariate-normal-distribution" class="level3" data-number="22.4.1">
<h3 data-number="22.4.1" class="anchored" data-anchor-id="multivariate-normal-distribution"><span class="header-section-number">22.4.1</span> Multivariate Normal Distribution</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Multivariate_normal_distribution">multivariate normal distribution</a> is a higher-dimensional version of the univariate normal distribution. The MVN distribution has a vector of means of length <span class="math inline">\(k\)</span> and a <span class="math inline">\(k\)</span>-by-<span class="math inline">\(k\)</span> variance-covariance matrix.</p>
<p>We show that a random vector is multivariate normally distributed with</p>
<p><span id="eq-multivariate-normal"><span class="math display">\[
\vec{X} \sim \mathcal{N}(\vec\mu, \boldsymbol\Sigma)
\tag{22.2}\]</span></span></p>
<p>The PDF of a multivariate normally distributed random variable is</p>
<p><span id="eq-multivariate-normal-pdf"><span class="math display">\[
f(x) = (2\pi)^{-k/2}det(\boldsymbol\Sigma)^{-1/2}\exp\left(-\frac{1}{2}(\vec{x} - \vec\mu)^T\boldsymbol\Sigma^{-1}(\vec{x} - \vec\mu)\right)
\tag{22.3}\]</span></span></p>
</section>
<section id="k-means-clustering" class="level3" data-number="22.4.2">
<h3 data-number="22.4.2" class="anchored" data-anchor-id="k-means-clustering"><span class="header-section-number">22.4.2</span> K-Means Clustering</h3>
<p>K-Means Clustering is a heuristic-based approach to finding latent groups in data. The algorithm assigns each observation to one and only one group through a two step iteration that minimizes the Euclidean distance between observations and centroids for each group.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Setup</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Step 1</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Step 2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Step 3</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Step 4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">Step 5</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Consider the following data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">8</span>),</span>
<span id="cb12-2"><a href="#cb12-2"></a>               <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p><strong>Step 1:</strong> Randomly place K centroids in your n-dimensional vector space</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb13-2"><a href="#cb13-2"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb13-3"><a href="#cb13-3"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p><strong>Step 2:</strong> Calculate the nearest centroid for each point using a distance measure</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>centroids <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb14-2"><a href="#cb14-2"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb14-3"><a href="#cb14-3"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>))</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span>  </span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p><strong>Step 3:</strong> Assign each point to the nearest centroid</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<p><strong>Step 4:</strong> Recalculate the position of the centroids based on the means of the assigned points</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>centroids2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">summarize</span>(<span class="at">x =</span> <span class="fu">mean</span>(x), <span class="at">y =</span> <span class="fu">mean</span>(y))</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids, <span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids2, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<p><strong>Step 5:</strong> Repeat steps 2-4 until no points change cluster assignments</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> centroids2, <span class="fu">aes</span>(x, y, <span class="at">color =</span> cluster), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  </span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use <code>library(tidyclust)</code> to cluster the <code>faithful</code> data into three clusters.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="mixture-modelingmodel-based-clustering" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="mixture-modelingmodel-based-clustering"><span class="header-section-number">22.5</span> Mixture Modeling/Model-Based Clustering</h2>
<p>Until now, we’ve assumed that we’ve known all parameters when working with mixture distributions. What if we want to learn these parameters/make inferences about these parameters?</p>
<p>The process of making inferences about latent groups is related to K-Means Clustering. While K-Means Clustering is heuristic based, mixture modeling formalize the process of making inferences about latent groups using probability models. Gaussian mixture models (GMM) are a popular mixture model.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mixture Modeling
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Mixture modeling</strong> is the process of making inferences about sub populations using data that contain sub population but no labels for the sub populations.</p>
</div>
</div>
</section>
<section id="gaussian-mixture-modeling-gmm" class="level2" data-number="22.6">
<h2 data-number="22.6" class="anchored" data-anchor-id="gaussian-mixture-modeling-gmm"><span class="header-section-number">22.6</span> Gaussian Mixture Modeling (GMM)</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Gaussian Mixture Modeling (GMM)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Gaussian mixture modeling (GMM)</strong> is mixture modeling that uses normal and multivariate normal distributions.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hard Assignment
</div>
</div>
<div class="callout-body-container callout-body">
<p>Hard assignment assigns an observation in a clustering model to one and only one group.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Soft Assignment
</div>
</div>
<div class="callout-body-container callout-body">
<p>Soft assignment assigns an observation in a clustering model to all groups with varying weights or probabilities.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Responsibilities
</div>
</div>
<div class="callout-body-container callout-body">
<p>Soft assignments are quantified with responsibilities. <strong>Responsibilities</strong> are the probability that a given observation belongs to a given group. The soft assignments for an observation sum to 1.</p>
<p>We quantified responsibilities with <span class="math inline">\(\pi_k\)</span> for mixture distributions. Responsibilities are parameters we will infer during mixture modeling.</p>
</div>
</div>
<p>There are two main differences between K-Means Clustering and GMM.</p>
<ol type="1">
<li>Instead of calculating Euclidean distance from each observation to each group centroid, we use multivariate normal distributions to calculate the probability that an observation belongs to each group.
<ul>
<li>Observations close to the means of a mixture will have a high relative probability of belonging to that mixture.</li>
<li>Observations far from the means of a mixture will have a low relative probability of belonging to that mixture.</li>
</ul></li>
<li>Instead of simply updating <span class="math inline">\(k\)</span> group centroids, we must update <span class="math inline">\(k\)</span> multivariate normal distributions. This requires calculating a vector of means and a variance-covariance matrix for each of the <span class="math inline">\(k\)</span> groups.</li>
</ol>
<section id="example-3" class="level3" data-number="22.6.1">
<h3 data-number="22.6.1" class="anchored" data-anchor-id="example-3"><span class="header-section-number">22.6.1</span> Example 3</h3>
<p>The parameters in example 2 were estimated using GMM. Let’s repeat a similar exercise with the <code>faithful</code> using <code>eruptions</code> and <code>waiting</code> instead of just <code>eruptions</code>. We’ll assume there are three groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># fit GMM</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>gmm2_geyser <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(faithful, <span class="at">G =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot the multivariate normal distributions. <a href="#fig-gmm-uncertainty" class="quarto-xref">Figure&nbsp;<span>22.2</span></a> shows the centroids (stars) and shapes (ellipses) of the distributions in black. The colors represent hard assignments to groups and the size of the points represent the uncertainty of the assignments with larger points having more uncertainty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># plot fitted model</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">plot</span>(gmm2_geyser, <span class="at">what =</span> <span class="st">"uncertainty"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-gmm-uncertainty" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-gmm-uncertainty-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-gmm-uncertainty-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gmm-uncertainty-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.2: Uncertainty plot from a GMM
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can also summarize the model with <code>library(broom)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="fu">augment</span>(gmm2_geyser)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 272 × 4
   eruptions waiting .class .uncertainty
       &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt;
 1      3.6       79 1          2.82e- 2
 2      1.8       54 2          8.60e-13
 3      3.33      74 1          3.26e- 3
 4      2.28      62 2          3.14e- 7
 5      4.53      85 3          1.17e- 2
 6      2.88      55 2          3.09e- 3
 7      4.7       88 3          2.99e- 3
 8      3.6       85 1          2.39e- 2
 9      1.95      51 2          5.23e-12
10      4.35      85 3          5.52e- 2
# ℹ 262 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">tidy</span>(gmm2_geyser)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  component  size proportion mean.eruptions mean.waiting
      &lt;int&gt; &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;
1         1    40      0.166           3.79         77.5
2         2    97      0.356           2.04         54.5
3         3   135      0.478           4.46         80.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">glance</span>(gmm2_geyser)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  model     G    BIC logLik    df hypvol  nobs
  &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 EEE       3 -2314. -1126.    11     NA   272</code></pre>
</div>
</div>
</section>
<section id="mclust" class="level3" data-number="22.6.2">
<h3 data-number="22.6.2" class="anchored" data-anchor-id="mclust"><span class="header-section-number">22.6.2</span> mclust</h3>
<p>The previous example uses <code>library(mclust)</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and <code>library(broom)</code>.</p>
<p><code>Mclust()</code> is the main function for fitting Gaussian Mixture Models. The function contains several different types of models for the variances of the multivariate normal distributions. The defaults are sensible. <code>G</code> is the number of groups. If <code>G</code> isn’t specified, then <code>Mclust()</code> will try <code>1:9</code> and pick the <code>G</code> with the lowest BIC (defined below).</p>
<p><code>plot()</code> with <code>what = "uncertainty"</code> creates a very useful data visualization for seeing the multivariate normal distributions and classifications for low-dimensional GMM.</p>
<p><code>glance()</code>, <code>tidy()</code>, and <code>augment()</code> from <code>library(broom)</code> return important information about the assignments, groups, and model diagnostics.</p>
</section>
<section id="estimation" class="level3" data-number="22.6.3">
<h3 data-number="22.6.3" class="anchored" data-anchor-id="estimation"><span class="header-section-number">22.6.3</span> Estimation</h3>
<p>Suppose we have <span class="math inline">\(n\)</span> observations, <span class="math inline">\(k\)</span> groups, and <span class="math inline">\(p\)</span> variables. A single GMM will have</p>
<ul>
<li>an <span class="math inline">\(n\)</span> by <span class="math inline">\(k\)</span> matrix of responsibilities</li>
<li><span class="math inline">\(k\)</span> vectors of means of length <span class="math inline">\(p\)</span></li>
<li><span class="math inline">\(k\)</span> <span class="math inline">\(p\)</span> by <span class="math inline">\(p\)</span> variance-covariance matrices</li>
</ul>
<p>We want the maximum likelihood estimates for all of the parameters in the model. For technical reasons, it is very difficult to get these estimates using popular methods like stochastic gradient descent.</p>
<p>Instead, we will use expectations maximization (EM) to find the parameters. We also used EM for K-Means clustering.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<ol type="1">
<li>Randomly initialize all of the parameters. Calculate the log-likelihood.</li>
<li>E-Step: Update the responsibilities assuming the means and variance-covariance matrices are known.</li>
<li>M-Step: Estimate new means and variance-covariance matrices assuming the responsibilities are known. The means and variance-covariance matrices are calculated using weighted MLE where the responsibilities are the weights.</li>
<li>Calculate the log-likelihood. Go back to step 2 if the log-likelihood improves by at least as much as the stopping threshold.</li>
</ol>
</div>
</div>
</div>
<p>This algorithm is computationally efficient, but it is possible for it to find a local maximum log-likelihood without finding the global maximum log-likelihood.</p>
<p>For a more mathematical description of this process, see Elements of Statistical Learning Section 6.8 <span class="citation" data-cites="hastie2009">(<a href="references.html#ref-hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009</a>)</span>. A highly descriptive comparison to kmeans (with Python code) can be seen <a href="https://jakevdp.github.io/PythonDataScienceHandbook/05.12-gaussian-mixtures.html">here</a>.</p>
</section>
<section id="example-4" class="level3" data-number="22.6.4">
<h3 data-number="22.6.4" class="anchored" data-anchor-id="example-4"><span class="header-section-number">22.6.4</span> Example 4</h3>
<p>Let’s consider a policy-relevant example using data from the <a href="https://www.census.gov/programs-surveys/sahie.html">Small Area Health Insurance Estimates (SAHIE) Program.</a></p>
<p>First, we pull the 2016 county-level estimates of the uninsured rate. We label a state as an expansion state if it expanded data before 2015-01-01. We use this date with 2016 data because of policy lags.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(censusapi)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a>sahie <span class="ot">&lt;-</span> <span class="fu">getCensus</span>(</span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="at">name =</span> <span class="st">"timeseries/healthins/sahie"</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="at">key =</span> <span class="fu">Sys.getenv</span>(<span class="st">"CENSUS_KEY"</span>),</span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"PCTUI_PT"</span>),</span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="at">region =</span> <span class="st">"county:*"</span>,</span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="at">time =</span> <span class="dv">2016</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we pull <a href="https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/">data</a> from the Kaiser Family Foundation about the expansion dates of Medicaid under the Patient Protection and Affordable Care Act.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>states <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>state_fips, <span class="sc">~</span>implementation_date,</span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"01"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"02"</span>, <span class="st">"2015-09-15"</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"04"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="st">"Arkansas"</span>, <span class="st">"05"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="st">"California"</span>, <span class="st">"06"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="st">"Colorado"</span>, <span class="st">"08"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="st">"Connecticut"</span>, <span class="st">"09"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="st">"Delaware"</span>, <span class="st">"10"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="st">"District of Columbia"</span>, <span class="st">"11"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="st">"Florida"</span>, <span class="st">"12"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-13"><a href="#cb27-13"></a>  <span class="st">"Georgia"</span>, <span class="st">"13"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-14"><a href="#cb27-14"></a>  <span class="st">"Hawaii"</span>, <span class="st">"15"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-15"><a href="#cb27-15"></a>  <span class="st">"Idaho"</span>, <span class="st">"16"</span>, <span class="st">"2020-01-01"</span>,</span>
<span id="cb27-16"><a href="#cb27-16"></a>  <span class="st">"Illinois"</span>, <span class="st">"17"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-17"><a href="#cb27-17"></a>  <span class="st">"Indiana"</span>, <span class="st">"18"</span>, <span class="st">"2015-02-01"</span>,</span>
<span id="cb27-18"><a href="#cb27-18"></a>  <span class="st">"Iowa"</span>, <span class="st">"19"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-19"><a href="#cb27-19"></a>  <span class="st">"Kansas"</span>, <span class="st">"20"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-20"><a href="#cb27-20"></a>  <span class="st">"Kentucky"</span>, <span class="st">"21"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-21"><a href="#cb27-21"></a>  <span class="st">"Louisiana"</span>, <span class="st">"22"</span>, <span class="st">"2016-07-01"</span>,</span>
<span id="cb27-22"><a href="#cb27-22"></a>  <span class="st">"Maine"</span>, <span class="st">"23"</span>, <span class="st">"2018-07-02"</span>,</span>
<span id="cb27-23"><a href="#cb27-23"></a>  <span class="st">"Maryland"</span>, <span class="st">"24"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-24"><a href="#cb27-24"></a>  <span class="st">"Massachusetts"</span>, <span class="st">"25"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-25"><a href="#cb27-25"></a>  <span class="st">"Michigan"</span>, <span class="st">"26"</span>, <span class="st">"2014-04-01"</span>,</span>
<span id="cb27-26"><a href="#cb27-26"></a>  <span class="st">"Minnesota"</span>, <span class="st">"27"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-27"><a href="#cb27-27"></a>  <span class="st">"Mississippi"</span>, <span class="st">"28"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-28"><a href="#cb27-28"></a>  <span class="st">"Missouri"</span>, <span class="st">"29"</span>, <span class="st">"2021-07-01"</span>,</span>
<span id="cb27-29"><a href="#cb27-29"></a>  <span class="st">"Montana"</span>, <span class="st">"30"</span>, <span class="st">"2016-01-01"</span>,</span>
<span id="cb27-30"><a href="#cb27-30"></a>  <span class="st">"Nebraska"</span>, <span class="st">"31"</span>, <span class="st">"2020-10-01"</span>,</span>
<span id="cb27-31"><a href="#cb27-31"></a>  <span class="st">"Nevada"</span>, <span class="st">"32"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-32"><a href="#cb27-32"></a>  <span class="st">"New Hampshire"</span>, <span class="st">"33"</span>, <span class="st">"2014-08-15"</span>,</span>
<span id="cb27-33"><a href="#cb27-33"></a>  <span class="st">"New Jersey"</span>, <span class="st">"34"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-34"><a href="#cb27-34"></a>  <span class="st">"New Mexico"</span>, <span class="st">"35"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-35"><a href="#cb27-35"></a>  <span class="st">"New York"</span>, <span class="st">"36"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-36"><a href="#cb27-36"></a>  <span class="st">"North Carolina"</span>, <span class="st">"37"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-37"><a href="#cb27-37"></a>  <span class="st">"North Dakota"</span>, <span class="st">"38"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-38"><a href="#cb27-38"></a>  <span class="st">"Ohio"</span>, <span class="st">"39"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-39"><a href="#cb27-39"></a>  <span class="st">"Oklahoma"</span>, <span class="st">"40"</span>, <span class="st">"2021-07-01"</span>, </span>
<span id="cb27-40"><a href="#cb27-40"></a>  <span class="st">"Oregon"</span>, <span class="st">"41"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-41"><a href="#cb27-41"></a>  <span class="st">"Pennsylvania"</span>, <span class="st">"42"</span>, <span class="st">"2015-01-01"</span>, </span>
<span id="cb27-42"><a href="#cb27-42"></a>  <span class="st">"Rhode Island"</span>, <span class="st">"44"</span>, <span class="st">"2014-01-01"</span>, </span>
<span id="cb27-43"><a href="#cb27-43"></a>  <span class="st">"South Carolina"</span>, <span class="st">"45"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-44"><a href="#cb27-44"></a>  <span class="st">"South Dakota"</span>, <span class="st">"46"</span>, <span class="st">"2023-07-01"</span>, </span>
<span id="cb27-45"><a href="#cb27-45"></a>  <span class="st">"Tennessee"</span>, <span class="st">"47"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-46"><a href="#cb27-46"></a>  <span class="st">"Texas"</span>, <span class="st">"48"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-47"><a href="#cb27-47"></a>  <span class="st">"Utah"</span>, <span class="st">"49"</span>, <span class="st">"2020-01-01"</span>,</span>
<span id="cb27-48"><a href="#cb27-48"></a>  <span class="st">"Vermont"</span>, <span class="st">"50"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-49"><a href="#cb27-49"></a>  <span class="st">"Virginia"</span>, <span class="st">"51"</span>, <span class="st">"2019-01-01"</span>, </span>
<span id="cb27-50"><a href="#cb27-50"></a>  <span class="st">"Washington"</span>, <span class="st">"53"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-51"><a href="#cb27-51"></a>  <span class="st">"West Virginia"</span>, <span class="st">"54"</span>, <span class="st">"2014-01-01"</span>,</span>
<span id="cb27-52"><a href="#cb27-52"></a>  <span class="st">"Wisconsin"</span>, <span class="st">"55"</span>, <span class="cn">NA</span>,</span>
<span id="cb27-53"><a href="#cb27-53"></a>  <span class="st">"Wyoming"</span>, <span class="st">"56"</span>, <span class="cn">NA</span></span>
<span id="cb27-54"><a href="#cb27-54"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb27-55"><a href="#cb27-55"></a>  <span class="fu">mutate</span>(<span class="at">implementation_date =</span> <span class="fu">ymd</span>(implementation_date))</span>
<span id="cb27-56"><a href="#cb27-56"></a></span>
<span id="cb27-57"><a href="#cb27-57"></a>sahie <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb27-58"><a href="#cb27-58"></a>  sahie, </span>
<span id="cb27-59"><a href="#cb27-59"></a>  states,</span>
<span id="cb27-60"><a href="#cb27-60"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"state_fips"</span>)</span>
<span id="cb27-61"><a href="#cb27-61"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-62"><a href="#cb27-62"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(PCTUI_PT)) <span class="sc">|&gt;</span> </span>
<span id="cb27-63"><a href="#cb27-63"></a>  <span class="fu">mutate</span>(<span class="at">expanded =</span> implementation_date <span class="sc">&lt;</span> <span class="st">"2015-01-01"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-64"><a href="#cb27-64"></a>  <span class="fu">mutate</span>(<span class="at">expanded =</span> <span class="fu">replace_na</span>(expanded, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use GMM to cluster the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>uni <span class="ot">&lt;-</span> <span class="fu">select</span>(sahie, PCTUI_PT)</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-4"><a href="#cb28-4"></a>uni_mc <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(uni, <span class="at">G =</span> <span class="dv">2</span>)</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="fu">glance</span>(uni_mc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  model     G     BIC logLik    df hypvol  nobs
  &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 V         2 -18542. -9251.     5     NA  3141</code></pre>
</div>
</div>
<p>When we compare <code>.class</code> to <code>expansion</code>, we see that the model does an good job of labeling counties’ expansion status without observing counties’ expansion status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  sahie,</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">augment</span>(uni_mc)</span>
<span id="cb30-4"><a href="#cb30-4"></a>) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">count</span>(expanded, .class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `PCTUI_PT` -&gt; `PCTUI_PT...5`
• `PCTUI_PT` -&gt; `PCTUI_PT...9`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  expanded .class     n
  &lt;lgl&gt;    &lt;fct&gt;  &lt;int&gt;
1 FALSE    1        465
2 FALSE    2       1486
3 TRUE     1       1042
4 TRUE     2        148</code></pre>
</div>
</div>
</section>
<section id="bic" class="level3" data-number="22.6.5">
<h3 data-number="22.6.5" class="anchored" data-anchor-id="bic"><span class="header-section-number">22.6.5</span> BIC</h3>
<p><strong>Likelihood</strong> quantifies how likely observed data are given a set of parameters. If <span class="math inline">\(\theta\)</span> is a vector of parameters, then <span class="math inline">\(L(\theta |x) = f(x |\theta)\)</span> is the likelihood function.</p>
<p>We often don’t know the exact number of latent groups in the data. We need a way to compare models with varying numbers of groups. Simply picking the model with the maximum likelihood will lead to models with too many groups.</p>
<p>The Bayesian information criterion (BIC) is an alternative to likelihoods that penalizes models for having many parameters. Let <span class="math inline">\(L\)</span> be the likelihood, <span class="math inline">\(m\)</span> the number of free parameters, and <span class="math inline">\(n\)</span> the number of observations.</p>
<p><span id="eq-bic"><span class="math display">\[
BIC = -2log(L) + mlog(n)
\tag{22.4}\]</span></span></p>
<p>We will choose models that minimize BIC. Ideally, we will use v-fold cross validation for this process.</p>
</section>
<section id="example-5" class="level3" data-number="22.6.6">
<h3 data-number="22.6.6" class="anchored" data-anchor-id="example-5"><span class="header-section-number">22.6.6</span> Example 5</h3>
<p>The <code>Mclust()</code> function will try <code>G = 1:9</code> when <code>G</code> isn’t specified. <code>Mclust()</code> will also try 14 different variance models for the mixture models.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>We want to minimize BIC but <code>library(mclust)</code> is missing a negative sign. So we want to maximize the BIC plotted by <code>library(mclust)</code>. You can read more <a href="https://stat.ethz.ch/pipermail/r-help//2009-April/387074.html">here</a>.</p>
</div>
</div>
<p>We can plot the BICs with <code>plot()</code> and view the optimal model with <code>glance()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>faithful_gmm <span class="ot">&lt;-</span> <span class="fu">Mclust</span>(faithful)</span>
<span id="cb33-2"><a href="#cb33-2"></a></span>
<span id="cb33-3"><a href="#cb33-3"></a><span class="fu">plot</span>(faithful_gmm, <span class="at">what =</span> <span class="st">"BIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="27_advanced-unsupervised-ml_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">glance</span>(faithful_gmm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  model     G    BIC logLik    df hypvol  nobs
  &lt;chr&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 EEE       3 -2314. -1126.    11     NA   272</code></pre>
</div>
</div>
</section>
</section>
<section id="bernoulli-mixture-modeling-bmm" class="level2" data-number="22.7">
<h2 data-number="22.7" class="anchored" data-anchor-id="bernoulli-mixture-modeling-bmm"><span class="header-section-number">22.7</span> Bernoulli Mixture Modeling (BMM)</h2>
<p>Let’s consider a data generation story based on the Bernoulli distribution. Now, each variable, <span class="math inline">\(X_1, X_2, ..., X_D\)</span>, is draw from a mixture of <span class="math inline">\(K\)</span> Bernoulli distributions.</p>
<p><span id="eq-bmm-process"><span class="math display">\[
X_d  = \begin{cases}
Bern(p_1) \text{ with probability }\pi_1 \\
Bern(p_2) \text{ with probability }\pi_2 \\
\vdots \\
Bern(p_K) \text{ with probability }\pi_K
\end{cases}
\tag{22.5}\]</span></span></p>
<p>Let <span class="math inline">\(i\)</span> be an index for each mixture that contributes to the random variable. The probability mass function of the random variable is written as</p>
<p><span id="eq-bmm-pmf"><span class="math display">\[
P(X_d) = \Pi_{i = 1}^Kp_i^{x_i} (1 - p_i)^{1 - x_i}
\tag{22.6}\]</span></span></p>
<p>Let’s consider a classic example from <span class="citation" data-cites="bishop2006">Bishop (<a href="references.html#ref-bishop2006" role="doc-biblioref">2006</a>)</span> and <span class="citation" data-cites="murphy2022">Murphy (<a href="references.html#ref-murphy2022" role="doc-biblioref">2022</a>)</span>. The example uses the <a href="https://en.wikipedia.org/wiki/MNIST_database">MNIST</a> database, which contains 70,000 handwritten digits. The digits are stored in 784 variables, from a 28 by 28 grid, with values ranging from 0 to 255, which indicate the darkness of the pixel.</p>
<p>To prepare the data, we divide each pixel by 255 and then turn the pixels into indicators with values under 0.5 as 0 and values over 0.5 as 1. Figure <a href="#fig-digits" class="quarto-xref">Figure&nbsp;<span>22.3</span></a> visualizes the first four digits after reading in the data and applying pre-processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"visualize_digit.R"</span>))</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>mnist <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"mnist_binary.csv"</span>))</span>
<span id="cb36-4"><a href="#cb36-4"></a></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="fu">glimpse</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(mnist, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 60,000
Columns: 10
$ label    &lt;dbl&gt; 5, 0, 4, 1, 9, 2, 1, 3, 1, 4, 3, 5, 3, 6, 1, 7, 2, 8, 6, 9, 4…
$ pix_28_1 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_2 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_3 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_4 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_5 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_6 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_7 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_8 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pix_28_9 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">visualize_digit</span>(mnist, <span class="dv">1</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="fu">visualize_digit</span>(mnist, <span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="fu">visualize_digit</span>(mnist, <span class="dv">3</span>)</span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="fu">visualize_digit</span>(mnist, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-digits" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-digits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-digits" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-digits-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-digits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-digits-1.png" class="img-fluid figure-img" data-ref-parent="fig-digits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-digits-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 5
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-digits" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-digits-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-digits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-digits-2.png" class="img-fluid figure-img" data-ref-parent="fig-digits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-digits-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 0
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-digits" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-digits-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-digits-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-digits-3.png" class="img-fluid figure-img" data-ref-parent="fig-digits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-digits-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) 4
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-digits" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-digits-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-digits-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-digits-4.png" class="img-fluid figure-img" data-ref-parent="fig-digits" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-digits-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) 1
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-digits-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.3: First Four Digits
</figcaption>
</figure>
</div>
<p>The digits are labelled in the MNIST data set but we will ignore the labels and use Bernoulli Mixture Modeling to learn the latent labels or groups. We will treat each pixel as its own Bernoulli distribution and cluster observations using mixtures of 784 Bernoulli distributions. This means each cluster will contain <span class="math inline">\(784\)</span> parameters.</p>
<section id="two-digit-example" class="level3" data-number="22.7.1">
<h3 data-number="22.7.1" class="anchored" data-anchor-id="two-digit-example"><span class="header-section-number">22.7.1</span> Two Digit Example</h3>
<p>Let’s start with a simple example using just the digits “1” and “8”. We’ll use <code>library(flexmix)</code> by <span class="citation" data-cites="leisch2004">Leisch (<a href="references.html#ref-leisch2004" role="doc-biblioref">2004</a>)</span>. <code>library(flexmix)</code> is powerful but uses different syntax than we are used to.</p>
<ol type="1">
<li>The function <code>flexmix()</code> expects a matrix.</li>
<li>The formula expects the entire matrix on the left side of the <code>~</code>.</li>
<li>We specify the distribution used during the maximization (M) step with <code>model = FLXMCmvbinary()</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">library</span>(flexmix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>mnist_18 <span class="ot">&lt;-</span> mnist <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">filter</span>(label <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"8"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>label) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">as.matrix</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The starting assignments are random, so we set a seed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">set.seed</span>(<span class="dv">20230612</span>)</span>
<span id="cb42-2"><a href="#cb42-2"></a>mnist_18_clust <span class="ot">&lt;-</span> <span class="fu">flexmix</span>(</span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="at">formula =</span> mnist_18 <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb42-5"><a href="#cb42-5"></a>  <span class="at">model =</span> <span class="fu">FLXMCmvbinary</span>(), </span>
<span id="cb42-6"><a href="#cb42-6"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter.max =</span> <span class="dv">100</span>)</span>
<span id="cb42-7"><a href="#cb42-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The MNIST data are already labelled, so we can compare our assignments to the labels if we convert the “soft assignments” to “hard assignments”. Note that most applications won’t have labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>mnist <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">filter</span>(label <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"8"</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">bind_cols</span>(<span class="at">cluster =</span> mnist_18_clust<span class="sc">@</span>cluster) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="fu">count</span>(label, cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  label cluster     n
  &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;
1     1       1   482
2     1       2  6260
3     8       1  5610
4     8       2   241</code></pre>
</div>
</div>
<p><a href="#fig-bmm2-parameters" class="quarto-xref">Figure&nbsp;<span>22.4</span></a> shows the estimated <span class="math inline">\(p_i\)</span> for each pixel for each cluster. The figure shows 784 <span class="math inline">\(p_i\)</span> for <span class="math inline">\(k = 1\)</span> and 784 <span class="math inline">\(p_i\)</span> for <span class="math inline">\(k = 2\)</span>. We see that the estimated parameters closely resemble the digits.</p>
<p>Of course, each digit can differ from these images because everyone writes differently. In some ways, these are average digits across many version of the digits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>means_18 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_18_clust, <span class="at">component =</span> <span class="dv">1</span>)),</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_18_clust, <span class="at">component =</span> <span class="dv">2</span>))</span>
<span id="cb45-4"><a href="#cb45-4"></a>) <span class="sc">|&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">visualize_digit</span>(means_18, <span class="dv">1</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">visualize_digit</span>(means_18, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-bmm2-parameters" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bmm2-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm2-parameters" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bmm2-parameters-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm2-parameters-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm2-parameters-1.png" class="img-fluid figure-img" data-ref-parent="fig-bmm2-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm2-parameters-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 8
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm2-parameters" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-bmm2-parameters-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm2-parameters-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm2-parameters-2.png" class="img-fluid figure-img" data-ref-parent="fig-bmm2-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm2-parameters-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 1
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bmm2-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.4: Estimated Parameters for Each Cluster
</figcaption>
</figure>
</div>
<p>The BMM does a good job of labeling the digits and recovering the average shape of the digits.</p>
</section>
<section id="ten-digit-example" class="level3" data-number="22.7.2">
<h3 data-number="22.7.2" class="anchored" data-anchor-id="ten-digit-example"><span class="header-section-number">22.7.2</span> Ten Digit Example</h3>
<p>Let’s now consider an example that uses all 10 digits.</p>
<p>In most applications, we won’t know the number of latent variables. First, we sample 1,000<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> digits and run the model with <span class="math inline">\(k = 2, 3, ..., 12\)</span>. We’ll calculate the BIC for each hyperparameter and pick the <span class="math inline">\(k\)</span> with lowest BIC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">set.seed</span>(<span class="dv">20230613</span>)</span>
<span id="cb47-2"><a href="#cb47-2"></a>mnist_sample <span class="ot">&lt;-</span> mnist <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>label) <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>steps <span class="ot">&lt;-</span> <span class="fu">stepFlexmix</span>(</span>
<span id="cb47-8"><a href="#cb47-8"></a>  <span class="at">formula =</span> mnist_sample <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb47-9"><a href="#cb47-9"></a>  <span class="at">model =</span> <span class="fu">FLXMCmvbinary</span>(), </span>
<span id="cb47-10"><a href="#cb47-10"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter.max =</span> <span class="dv">100</span>, <span class="at">minprior =</span> <span class="dv">0</span>),</span>
<span id="cb47-11"><a href="#cb47-11"></a>  <span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">12</span>, </span>
<span id="cb47-12"><a href="#cb47-12"></a>  <span class="at">nrep =</span> <span class="dv">1</span></span>
<span id="cb47-13"><a href="#cb47-13"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(k = 7\)</span> provides the lowest BIC. This is probably because digits like 3 and 8 are very similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>steps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
stepFlexmix(formula = mnist_sample ~ 1, model = FLXMCmvbinary(), 
    control = list(iter.max = 100, minprior = 0), k = 2:12, nrep = 1)

   iter converged  k k0    logLik      AIC      BIC      ICL
2    43      TRUE  2  2 -196191.7 395521.4 403221.6 403227.9
3    30      TRUE  3  3 -188722.8 382153.6 393706.4 393713.9
4    32      TRUE  4  4 -182949.0 372176.0 387581.4 387585.1
5    27      TRUE  5  5 -178955.2 365758.4 385016.4 385019.7
6    35      TRUE  6  6 -175448.7 360315.5 383426.1 383428.5
7    37      TRUE  7  7 -171697.0 354381.9 381345.1 381347.8
8    37      TRUE  8  8 -171282.5 355123.1 385938.8 385941.1
9    38      TRUE  9  9 -169213.3 352554.6 387223.0 387224.9
10   25      TRUE 10 10 -165521.6 346741.2 385262.2 385263.7
11   34      TRUE 11 11 -162919.3 343106.5 385480.1 385481.8
12   26      TRUE 12 12 -162253.5 343345.0 389571.1 389572.7</code></pre>
</div>
</div>
<p>Next, we run the BMM on the full data with <span class="math inline">\(k = 7\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>mnist_full <span class="ot">&lt;-</span> mnist <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>label) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb50-4"><a href="#cb50-4"></a></span>
<span id="cb50-5"><a href="#cb50-5"></a>mnist_clust <span class="ot">&lt;-</span> <span class="fu">flexmix</span>(</span>
<span id="cb50-6"><a href="#cb50-6"></a>  <span class="at">formula =</span> mnist_full <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb50-7"><a href="#cb50-7"></a>  <span class="at">k =</span> <span class="dv">7</span>, </span>
<span id="cb50-8"><a href="#cb50-8"></a>  <span class="at">model =</span> <span class="fu">FLXMCmvbinary</span>(), </span>
<span id="cb50-9"><a href="#cb50-9"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter.max =</span> <span class="dv">200</span>, <span class="at">minprior =</span> <span class="dv">0</span>)</span>
<span id="cb50-10"><a href="#cb50-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The MNIST data are already labelled, so we can compare our assignments to the labels if we convert the “soft assignments” to “hard assignments”. Note that most applications won’t have labels. The rows of the table are the digits. The columns of the table are the clusters. We can see, for example, that most of the 0’s are clustered in cluster 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>labels <span class="ot">&lt;-</span> mnist <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">bind_cols</span>(<span class="at">cluster =</span> mnist_clust<span class="sc">@</span>cluster)</span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="fu">table</span>(labels<span class="sc">$</span>label, labels<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
       1    2    3    4    5    6    7
  0    5  357  282  289 4875    1  114
  1   36  288   40   35    0 6319   24
  2  114  166  652   73   50  163 4740
  3  263  473 4786   80   41  260  228
  4 3384 1779    4  139    7   53  476
  5  325 2315 2367  173  109   59   73
  6    9   86   41 4365   42  128 1247
  7 3560 2395   21    0   25  234   30
  8  257 2582 2369   57   32  445  109
  9 3739 1797  109    5   26  136  137</code></pre>
</div>
</div>
<p><a href="#fig-bmm10-parameters" class="quarto-xref">Figure&nbsp;<span>22.5</span></a> shows the estimated <span class="math inline">\(p_i\)</span> for each pixel for each cluster. The following visualize the <span class="math inline">\(784K\)</span> parameters that we estimated. It shows 784 <span class="math inline">\(p_i\)</span> for <span class="math inline">\(k = 1, 2, ..., 7\)</span> clusters. We see that the estimated parameters closely resemble the digits.</p>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>means <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">1</span>)),</span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">2</span>)),</span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">3</span>)),</span>
<span id="cb53-5"><a href="#cb53-5"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">4</span>)),</span>
<span id="cb53-6"><a href="#cb53-6"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">5</span>)),</span>
<span id="cb53-7"><a href="#cb53-7"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">6</span>)),</span>
<span id="cb53-8"><a href="#cb53-8"></a>  <span class="fu">t</span>(<span class="fu">parameters</span>(mnist_clust, <span class="at">component =</span> <span class="dv">7</span>))</span>
<span id="cb53-9"><a href="#cb53-9"></a>) <span class="sc">|&gt;</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-11"><a href="#cb53-11"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="cn">NA</span>)</span>
<span id="cb53-12"><a href="#cb53-12"></a></span>
<span id="cb53-13"><a href="#cb53-13"></a><span class="fu">visualize_digit</span>(means, <span class="dv">1</span>)</span>
<span id="cb53-14"><a href="#cb53-14"></a><span class="fu">visualize_digit</span>(means, <span class="dv">2</span>)</span>
<span id="cb53-15"><a href="#cb53-15"></a><span class="fu">visualize_digit</span>(means, <span class="dv">3</span>)</span>
<span id="cb53-16"><a href="#cb53-16"></a><span class="fu">visualize_digit</span>(means, <span class="dv">4</span>)</span>
<span id="cb53-17"><a href="#cb53-17"></a><span class="fu">visualize_digit</span>(means, <span class="dv">5</span>)</span>
<span id="cb53-18"><a href="#cb53-18"></a><span class="fu">visualize_digit</span>(means, <span class="dv">6</span>)</span>
<span id="cb53-19"><a href="#cb53-19"></a><span class="fu">visualize_digit</span>(means, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-bmm10-parameters" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bmm10-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-1.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 3, 7, and 9
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-2.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 5, 7, and 8
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-3.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) 3
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-4.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) 6
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-5.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) 0
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-6.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) 1
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-bmm10-parameters" style="flex-basis: 25.0%;justify-content: flex-start;">
<div id="fig-bmm10-parameters-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-bmm10-parameters-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="27_advanced-unsupervised-ml_files/figure-html/fig-bmm10-parameters-7.png" class="img-fluid figure-img" data-ref-parent="fig-bmm10-parameters" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-bmm10-parameters-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) 2
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bmm10-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;22.5: Estimated Parameters for Each Cluster
</figcaption>
</figure>
</div>
<p>The example with all digits doesn’t result in 10 distinct mixtures but it does a fairly good job of structuring finding structure in the data. Without labels and considering the variety of messy handwriting, this is a useful model.</p>
</section>
</section>
<section id="considerations" class="level2" data-number="22.8">
<h2 data-number="22.8" class="anchored" data-anchor-id="considerations"><span class="header-section-number">22.8</span> Considerations</h2>
<p>Mixture modeling is difficult for a couple of reasons:</p>
<ol type="1">
<li>We need to assume a model. It can be difficult to assume a multivariate distribution that fits the data in all dimensions of interest.</li>
<li>The models are overparameterized and can take a very long time to fit.</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bishop2006" class="csl-entry" role="listitem">
Bishop, Christopher M. 2006. <em>Pattern Recognition and Machine Learning</em>. Information Science and Statistics. New York: Springer.
</div>
<div id="ref-hastie2009" class="csl-entry" role="listitem">
Hastie, Trevor, Robert Tibshirani, and J. H. Friedman. 2009. <em>The Elements of Statistical Learning: Data Mining, Inference, and Prediction</em>. 2nd ed. Springer Series in Statistics. New York, NY: Springer.
</div>
<div id="ref-leisch2004" class="csl-entry" role="listitem">
Leisch, Friedrich. 2004. <span>“FlexMix: A General Framework for Finite Mixture Models and Latent Class Regression in <span><em>R</em></span>.”</span> <em>Journal of Statistical Software</em> 11 (8). <a href="https://doi.org/10.18637/jss.v011.i08">https://doi.org/10.18637/jss.v011.i08</a>.
</div>
<div id="ref-murphy2022" class="csl-entry" role="listitem">
Murphy, Kevin P. 2022. <em>Probabilistic Machine Learning: An Introduction</em>. Adaptive Computation and Machine Learning Series. Cambridge, Massachusetts: The MIT Press.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><code>library(tidyclust)</code> currently doesn’t support mixture modeling. I hope this will change in the future.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This is solely to save computation time.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./23_regularization.html" class="pagination-link" aria-label="Regularization">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./28_geospatial.html" class="pagination-link" aria-label="Geospatial Analysis with sf">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>