<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 17&nbsp; Missing Data and Data Imputation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./19_predictive-modeling-motivation.html" rel="next">
<link href="./17_nonparametric-2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./14_simulation-and-sampling.html">Statistics</a></li><li class="breadcrumb-item"><a href="./18_data-imputation.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Missing Data and Data Imputation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_data-imputation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Missing Data and Data Imputation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_dimension-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_unsupervised-ml-cluster-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial-sf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#types-of-missingness" id="toc-types-of-missingness" class="nav-link active" data-scroll-target="#types-of-missingness"><span class="header-section-number">17.1</span> Types of missingness</a></li>
  <li><a href="#missingness-mechanisms" id="toc-missingness-mechanisms" class="nav-link" data-scroll-target="#missingness-mechanisms"><span class="header-section-number">17.2</span> Missingness mechanisms</a></li>
  <li><a href="#three-motivations" id="toc-three-motivations" class="nav-link" data-scroll-target="#three-motivations"><span class="header-section-number">17.3</span> Three motivations</a>
  <ul class="collapse">
  <li><a href="#missing-observations" id="toc-missing-observations" class="nav-link" data-scroll-target="#missing-observations"><span class="header-section-number">17.3.1</span> Missing observations</a></li>
  <li><a href="#augmenting-data" id="toc-augmenting-data" class="nav-link" data-scroll-target="#augmenting-data"><span class="header-section-number">17.3.2</span> Augmenting data</a></li>
  <li><a href="#statistical-disclosure-control" id="toc-statistical-disclosure-control" class="nav-link" data-scroll-target="#statistical-disclosure-control"><span class="header-section-number">17.3.3</span> Statistical disclosure control</a></li>
  </ul></li>
  <li><a href="#methods-for-missing-data" id="toc-methods-for-missing-data" class="nav-link" data-scroll-target="#methods-for-missing-data"><span class="header-section-number">17.4</span> Methods for missing data</a>
  <ul class="collapse">
  <li><a href="#complete-case-analysis" id="toc-complete-case-analysis" class="nav-link" data-scroll-target="#complete-case-analysis"><span class="header-section-number">17.4.1</span> Complete case analysis</a></li>
  <li><a href="#imputation-our-focus" id="toc-imputation-our-focus" class="nav-link" data-scroll-target="#imputation-our-focus"><span class="header-section-number">17.4.2</span> Imputation (our focus)</a></li>
  <li><a href="#analyze-incompleteness" id="toc-analyze-incompleteness" class="nav-link" data-scroll-target="#analyze-incompleteness"><span class="header-section-number">17.4.3</span> Analyze incompleteness</a></li>
  </ul></li>
  <li><a href="#strategies-to-avoidremediate-missing-data-by-roderick-little" id="toc-strategies-to-avoidremediate-missing-data-by-roderick-little" class="nav-link" data-scroll-target="#strategies-to-avoidremediate-missing-data-by-roderick-little"><span class="header-section-number">17.5</span> Strategies to avoid/remediate missing data (by Roderick Little)</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">17.6</span> Examples</a>
  <ul class="collapse">
  <li><a href="#application-1-bayesian-improved-surname-geocoding" id="toc-application-1-bayesian-improved-surname-geocoding" class="nav-link" data-scroll-target="#application-1-bayesian-improved-surname-geocoding"><span class="header-section-number">17.6.1</span> Application 1: Bayesian Improved Surname Geocoding</a></li>
  <li><a href="#application-2-librarytidysynthesis" id="toc-application-2-librarytidysynthesis" class="nav-link" data-scroll-target="#application-2-librarytidysynthesis"><span class="header-section-number">17.6.2</span> Application 2: <code>library(tidysynthesis)</code></a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">17.7</span> Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./14_simulation-and-sampling.html">Statistics</a></li><li class="breadcrumb-item"><a href="./18_data-imputation.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Missing Data and Data Imputation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Missing Data and Data Imputation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(grid)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="types-of-missingness" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="types-of-missingness"><span class="header-section-number">17.1</span> Types of missingness</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Unit missingness:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Unit missingness:</strong> When data are missing for an entire observation or row. For example, a researcher contacts a household but the household never responds to the questionnaire.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  id      age income
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 01       22  32000
2 02       32  48000
3 03       NA     NA
4 04       48 100000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Item missingness:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Item missingness:</strong> When data are missing for variables within an observation or row. For example, a household responds to a questionnaire but skips a question because they consider it too sensitive.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  id      age income
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 01       NA  32000
2 02       32  48000
3 03       16     NA
4 04       48 100000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Structural missingness:
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Structural missingness:</strong> Item missingness where the values are missing because of data or questionnaire structure. For example, age of first child could be <code>NA</code> for a family without children.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  id    number_of_children child_age1
  &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt;
1 01                     2          8
2 02                     1         10
3 03                     0         NA
4 04                     1          1</code></pre>
</div>
</div>
</section>
<section id="missingness-mechanisms" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="missingness-mechanisms"><span class="header-section-number">17.2</span> Missingness mechanisms</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing completely at random (MCAR)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Missing completely at random (MCAR):</strong> The missingness does not depend on observed or unobserved data. Ignoring special cases, this means the probability of missingness is the same for all observations.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing at random
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Missing at random (MAR):</strong> The probability of missingness depends only on the observed variables for an observation. For example, respondents don’t report high wealth but the missingness is correlated with high incomes that are reported.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Missing not at random
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Missing not at random (MNAR):</strong> The data are neither MCAR nor MAR. The probability of missingness depends on unobservables. For example, if households don’t report their incomes because they have high incomes and we can’t observe anything else related to the missingness.</p>
<p>There are tests to compare MCAR and MAR. There is no test to compare MAR and MNAR.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many data sets are simply of poor quality and can’t be fixed, even with the best methods. It is important to understand why data are missing before remediation.</p>
</div>
</div>
</section>
<section id="three-motivations" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="three-motivations"><span class="header-section-number">17.3</span> Three motivations</h2>
<section id="missing-observations" class="level3" data-number="17.3.1">
<h3 data-number="17.3.1" class="anchored" data-anchor-id="missing-observations"><span class="header-section-number">17.3.1</span> Missing observations</h3>
<p>Missing data are everywhere.</p>
<ul>
<li>Households don’t respond to surveys</li>
<li>Households skip questions in surveys</li>
<li>Administrative data sources don’t link for every observation because of administrative errors</li>
<li>Observations are censored (top and bottom coding) or suppressed for reasons of statistical disclosure control</li>
</ul>
<p>Techniques are needed to handle missing values for most statistical methods. For example, linear regression is not robust to missing values. One <code>NA</code> will break <code>lm()</code>.</p>
<p>Appropriate techniques are highly dependent on if the missing values are MCAR, MAR, or MNAR.</p>
</section>
<section id="augmenting-data" class="level3" data-number="17.3.2">
<h3 data-number="17.3.2" class="anchored" data-anchor-id="augmenting-data"><span class="header-section-number">17.3.2</span> Augmenting data</h3>
<p>As shown in earlier classes, we can use a small but wide data set to impute new variables on to a long but skinny data set.</p>
<p>One of the authors used Survey of Income and Program Participation, which has detailed wealth variables, to impute wealth on to the American Community Survey, which is large and representative at the city level <span class="citation" data-cites="williams2023">(<a href="references.html#ref-williams2023" role="doc-biblioref">Williams, Zhong, and Braga 2023</a>)</span>. In this case, everything is MCAR because all observations are missing.</p>
</section>
<section id="statistical-disclosure-control" class="level3" data-number="17.3.3">
<h3 data-number="17.3.3" class="anchored" data-anchor-id="statistical-disclosure-control"><span class="header-section-number">17.3.3</span> Statistical disclosure control</h3>
<p>Many surveys contain detailed information that could plausibly be used to identify respondents. Surveys like the Survey of Consumer Finances (SCF), which is created by the Federal Reserve Board, have variables that are deleted and imputed. These imputed values have the statistical properties of the confidential data but have far lower disclosure risks.</p>
<p>This process typically begins with a “gold standard” standard data set and so all observations are treated as MCAR.</p>
</section>
</section>
<section id="methods-for-missing-data" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="methods-for-missing-data"><span class="header-section-number">17.4</span> Methods for missing data</h2>
<section id="complete-case-analysis" class="level3" data-number="17.4.1">
<h3 data-number="17.4.1" class="anchored" data-anchor-id="complete-case-analysis"><span class="header-section-number">17.4.1</span> Complete case analysis</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lis-wise deletion
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>List-wise deletion:</strong> Analysis where any observation is dropped when it contains a missing value in <strong>any</strong> variable involved in the analysis. <code>na.rm</code> implements list-wise deletion.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pairwise deletion
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Pairwise deletion:</strong> Analysis where any observation is dropped when it contains a missing value in a variable immediately involved in the analysis. For example, if an observation is missing <span class="math inline">\(X_{i,1}\)</span> but has observed <span class="math inline">\(X_{i,2}\)</span> and <span class="math inline">\(X_{i,3}\)</span>, then <span class="math inline">\(X_{i,2}\)</span> and <span class="math inline">\(X_{i,3}\)</span> will be included in the covariance matrix for implementing linear regression but <span class="math inline">\(X_{i,1}\)</span> will be dropped.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reweighting
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Reweighting:</strong> Methods that adjust observation weights to compensate for missingness or measurement error. For example, many surveys are reweighted/benchmarked against the Decennial Census or American Community Survey to compensate for unit nonresponse.</p>
</div>
</div>
</section>
<section id="imputation-our-focus" class="level3" data-number="17.4.2">
<h3 data-number="17.4.2" class="anchored" data-anchor-id="imputation-our-focus"><span class="header-section-number">17.4.2</span> Imputation (our focus)</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Imputation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Imputation:</strong> The process of filling in missing data.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explicit imputation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Explicit imputation (full probability models):</strong> The predictive distribution used for imputation is based on a full statistical model with explicit assumptions.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Implicit imputation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Implicit imputation (algorithmic approach):</strong> The predictive distribution is based on algorithms with implicit assumptions.</p>
</div>
</div>
<section id="imputation-examples" class="level4">
<h4 class="anchored" data-anchor-id="imputation-examples">Imputation examples</h4>
<p>Consider the simulated data from the supervised machine learning notes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">set.seed</span>(<span class="dv">20201005</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>x1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>x2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">10</span>, <span class="at">max =</span> <span class="dv">20</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a>data2 <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="at">x1 =</span> x1,</span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="at">x2 =</span> x2,</span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="at">y =</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">sin</span>(x1) <span class="sc">+</span> x2 <span class="sc">+</span> <span class="dv">20</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(x1), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What if we make about 36 percent of the <code>y</code> values missing and make them missing based on the value of <code>x1</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>data2 <span class="ot">&lt;-</span> data2 <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="at">missing_prob =</span> </span>
<span id="cb6-4"><a href="#cb6-4"></a>      <span class="fu">case_when</span>(</span>
<span id="cb6-5"><a href="#cb6-5"></a>        x1 <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fl">0.05</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>        x1 <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="fl">0.8</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>        x1 <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="fl">0.05</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>        x1 <span class="sc">&lt;</span> <span class="dv">9</span> <span class="sc">~</span> <span class="fl">0.8</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">0.05</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>      )</span>
<span id="cb6-11"><a href="#cb6-11"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="fu">bind_cols</span>(<span class="at">cutoff =</span> <span class="fu">runif</span>(<span class="dv">1000</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="fu">mutate</span>(<span class="at">y_missing =</span> <span class="fu">ifelse</span>(cutoff <span class="sc">&lt;</span> missing_prob, <span class="cn">NA</span>, y))</span>
<span id="cb6-14"><a href="#cb6-14"></a></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="fu">mean</span>(<span class="fu">is.na</span>(data2<span class="sc">$</span>y_missing))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.359</code></pre>
</div>
</div>
</section>
<section id="mode-and-mean-imputation" class="level4">
<h4 class="anchored" data-anchor-id="mode-and-mean-imputation">Mode and mean imputation</h4>
<p>Let’s start with a mean imputation approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># calculate the mean of the non-missing values</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>mean_y <span class="ot">&lt;-</span> data2 <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(y_missing)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">summarize</span>(<span class="at">y_missing =</span> <span class="fu">mean</span>(y_missing)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">pull</span>(y_missing)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># if a value is missing, replace it with the mean from the non-missing values</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>mean_imputed <span class="ot">&lt;-</span> data2 <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="at">imputation =</span> <span class="fu">as.numeric</span>(<span class="fu">is.na</span>(y_missing)),</span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="at">y_imputed =</span> <span class="fu">if_else</span>(</span>
<span id="cb8-12"><a href="#cb8-12"></a>      <span class="at">condition =</span> <span class="fu">is.na</span>(y_missing), </span>
<span id="cb8-13"><a href="#cb8-13"></a>      <span class="at">true =</span> mean_y, </span>
<span id="cb8-14"><a href="#cb8-14"></a>      <span class="at">false =</span> y_missing</span>
<span id="cb8-15"><a href="#cb8-15"></a>    )</span>
<span id="cb8-16"><a href="#cb8-16"></a>  )</span>
<span id="cb8-17"><a href="#cb8-17"></a></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co"># visualize the imputation</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>mean_imputed <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x1, y_imputed, <span class="at">color =</span> <span class="fu">factor</span>(imputation))) <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mean imputation does a poor job"</span>) <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="18_data-imputation_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># compare the mean</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>mean_imputed <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(y), <span class="fu">mean</span>(y_imputed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `mean(y)` `mean(y_imputed)`
      &lt;dbl&gt;             &lt;dbl&gt;
1      36.7              33.7</code></pre>
</div>
</div>
<p>Mode imputation follows a similar procedure.</p>
</section>
<section id="linear-and-logistic-regression-imputation" class="level4">
<h4 class="anchored" data-anchor-id="linear-and-logistic-regression-imputation">Linear and logistic regression imputation</h4>
<p>Mean and mode imputation do not leverage the observed information for observations with missing values. Let’s use linear regression with higher-order terms to impute the missing values. Let’s start with a third-degree polynomial. That is the model:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i1}^2 + \beta_3x_{i1}^3 + \epsilon_i\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>data2_complete <span class="ot">&lt;-</span> <span class="fu">filter</span>(data2, <span class="sc">!</span><span class="fu">is.na</span>(y_missing))</span>
<span id="cb11-2"><a href="#cb11-2"></a>data2_missing <span class="ot">&lt;-</span> <span class="fu">filter</span>(data2, <span class="fu">is.na</span>(y_missing)) </span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>lm_y_3 <span class="ot">&lt;-</span> data2_complete <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> y_missing <span class="sc">~</span> <span class="fu">poly</span>(x1, <span class="at">degrees =</span> <span class="dv">3</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> .)</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a>lm_imputed3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mutate</span>(data2_complete, <span class="at">y_imputed =</span> y_missing),</span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">bind_cols</span>(</span>
<span id="cb11-10"><a href="#cb11-10"></a>    data2_missing,</span>
<span id="cb11-11"><a href="#cb11-11"></a>    <span class="at">y_imputed =</span> <span class="fu">predict</span>(lm_y_3, <span class="at">newdata =</span> data2_missing)</span>
<span id="cb11-12"><a href="#cb11-12"></a>  ),</span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="at">.id =</span> <span class="st">"imputation"</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>)</span>
<span id="cb11-15"><a href="#cb11-15"></a></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co"># visualize</span></span>
<span id="cb11-17"><a href="#cb11-17"></a>lm_imputed3 <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x1, y_imputed, <span class="at">color =</span> <span class="fu">factor</span>(imputation))) <span class="sc">+</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Regression imputation (with the wrong model) does a bad job"</span>) <span class="sc">+</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="18_data-imputation_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># compare means</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>lm_imputed3 <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(y), <span class="fu">mean</span>(y_imputed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `mean(y)` `mean(y_imputed)`
      &lt;dbl&gt;             &lt;dbl&gt;
1      36.7              33.7</code></pre>
</div>
</div>
<p>Unfortunately, the results are no better than mean imputation. Let’s try a fourth-degree polynomial. That is the model:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1x_{i1} + \beta_2x_{i1}^2 + \beta_3x_{i1}^3 + \beta_4x_{i1}^4 + \epsilon_i\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>lm_y_4 <span class="ot">&lt;-</span> data2_complete <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> y_missing <span class="sc">~</span> <span class="fu">poly</span>(x1, <span class="at">degrees =</span> <span class="dv">4</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> .)</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>lm_imputed4 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mutate</span>(data2_complete, <span class="at">y_imputed =</span> y_missing),</span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">bind_cols</span>(</span>
<span id="cb14-7"><a href="#cb14-7"></a>    data2_missing,</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="at">y_imputed =</span> <span class="fu">predict</span>(lm_y_4, <span class="at">newdata =</span> data2_missing)</span>
<span id="cb14-9"><a href="#cb14-9"></a>  ),</span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="at">.id =</span> <span class="st">"imputation"</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>)</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co"># visualize</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>lm_imputed4 <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x1, y_imputed, <span class="at">color =</span> <span class="fu">factor</span>(imputation))) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Regression imputation (with the right model) does a good job"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="18_data-imputation_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># compare means</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>lm_imputed4 <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(y), <span class="fu">mean</span>(y_imputed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `mean(y)` `mean(y_imputed)`
      &lt;dbl&gt;             &lt;dbl&gt;
1      36.7              36.2</code></pre>
</div>
</div>
<p>The results are much better. In general, explicit imputation is better when the model is correct because explicit models offer tools for making probabilistic statements about the imputations. However, getting the right model is always a challenging task.</p>
<p>Logistic regression imputation follows a similar procedure.</p>
</section>
<section id="other-supervised-machine-learning-imputation" class="level4">
<h4 class="anchored" data-anchor-id="other-supervised-machine-learning-imputation">Other supervised machine learning imputation</h4>
<p>As we will discuss in future chapters, linear and logistic regression are both supervised machine learning algorithms. However, there are many other algorithms too. What if we try a K Nearest Neighbors (KNN) algorithm with k = 13. You can learn more about KNN in <a href="20_predictive-modeling-concepts.html#sec-knn" class="quarto-xref"><span>Section 19.2.2</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>knn_recipe <span class="ot">&lt;-</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">recipe</span>(<span class="at">formula =</span> y <span class="sc">~</span> ., <span class="at">data =</span> data2_complete) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">step_normalize</span>(x1, x2)</span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># neighbors = 13 comes from the hyperparameter tuning in the supervised machine</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co"># learning notes</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>knn_mod <span class="ot">&lt;-</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"kknn"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">"regression"</span>)</span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a>knn_workflow <span class="ot">&lt;-</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>  <span class="fu">add_model</span>(<span class="at">spec =</span> knn_mod) <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="fu">add_recipe</span>(<span class="at">recipe =</span> knn_recipe)</span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a>knn_fit <span class="ot">&lt;-</span> knn_mod <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">fit</span>(<span class="at">formula =</span> y_missing <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data2_complete)</span>
<span id="cb17-21"><a href="#cb17-21"></a></span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co"># add the imputed values</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>knn_imputed <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb17-24"><a href="#cb17-24"></a>  <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mutate</span>(data2_complete, <span class="at">y_imputed =</span> y_missing),</span>
<span id="cb17-25"><a href="#cb17-25"></a>  <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">bind_cols</span>(</span>
<span id="cb17-26"><a href="#cb17-26"></a>    data2_missing,</span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="at">y_imputed =</span> <span class="fu">predict</span>(knn_fit, <span class="at">new_data =</span> data2_missing)<span class="sc">$</span>.pred</span>
<span id="cb17-28"><a href="#cb17-28"></a>  ),</span>
<span id="cb17-29"><a href="#cb17-29"></a>  <span class="at">.id =</span> <span class="st">"imputation"</span></span>
<span id="cb17-30"><a href="#cb17-30"></a>)</span>
<span id="cb17-31"><a href="#cb17-31"></a></span>
<span id="cb17-32"><a href="#cb17-32"></a><span class="co"># visualize</span></span>
<span id="cb17-33"><a href="#cb17-33"></a>knn_imputed <span class="sc">%&gt;%</span></span>
<span id="cb17-34"><a href="#cb17-34"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x1, y_imputed, <span class="at">color =</span> <span class="fu">factor</span>(imputation))) <span class="sc">+</span></span>
<span id="cb17-35"><a href="#cb17-35"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb17-36"><a href="#cb17-36"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"KNN imputation does a good job"</span>) <span class="sc">+</span></span>
<span id="cb17-37"><a href="#cb17-37"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="18_data-imputation_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># compare means</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>knn_imputed <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(y), <span class="fu">mean</span>(y_imputed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `mean(y)` `mean(y_imputed)`
      &lt;dbl&gt;             &lt;dbl&gt;
1      36.7              36.0</code></pre>
</div>
</div>
<p>The model is pretty good without much work!</p>
</section>
<section id="concept-impute-proportions" class="level4">
<h4 class="anchored" data-anchor-id="concept-impute-proportions">Concept: Impute proportions</h4>
<p>It is often desirable to impute proportions instead of 0/1 for categorical variables (<a href="https://onlinelibrary.wiley.com/doi/10.1111/j.1475-6773.2007.00810.x">McCaffey and Elliott, 2008</a>). Converting the probabilities to indicators throws out information and can bias results for small groups.</p>
<ul>
<li>Can sum probabilities to counts</li>
<li>Can average probabilities for proportions</li>
<li>Can use probabilities as predictors in models</li>
</ul>
</section>
<section id="concept-stochastic-imputation" class="level4">
<h4 class="anchored" data-anchor-id="concept-stochastic-imputation">Concept: Stochastic imputation</h4>
<p>Mean imputation and conditional mean imputation result in distorted sample variances and covariances, and too few values in the tails of distributions (Little and Rubin, 1990).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="18_data-imputation_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is desirable to draw from posterior predictive distributions (Bayesian) or comparable ideas from frequentist statistics or machine learning. For example, instead of imputing directly with linear regression, add normally distributed random noise to the predicted values from linear regression with mean zero and variance equal to the residual variance on complete cases.</p>
<p>We recommend sampling predicted values from all trees in a random forest model instead of imputing the mean or median of the trees.</p>
</section>
<section id="concept-multiple-imputation" class="level4">
<h4 class="anchored" data-anchor-id="concept-multiple-imputation">Concept: Multiple imputation</h4>
<p>Most single imputation methods do not account for imputation uncertainty. A common strategy to account for uncertainty is to repeat the imputation process many times. For example:</p>
<ol type="1">
<li>Impute 50 times.</li>
<li>Estimate the parameter of interest 50 times (for example, population means).</li>
<li>Average the 50 parameters and calculate a standard error that accounts for the variance of the individual estimates and the variance between the estimates. There are combination rules for these calculations.</li>
</ol>
<p>This results in valid standard errors for many estimators that account for the uncertainty of imputation.</p>
</section>
</section>
<section id="analyze-incompleteness" class="level3" data-number="17.4.3">
<h3 data-number="17.4.3" class="anchored" data-anchor-id="analyze-incompleteness"><span class="header-section-number">17.4.3</span> Analyze incompleteness</h3>
<ul>
<li>Explicitly model missingness mechanism</li>
<li>Expectation maximization (same algorithm as K-Means clustering)</li>
<li>Full information maximum likelihood</li>
<li>Gibbs’ sampler</li>
</ul>
</section>
</section>
<section id="strategies-to-avoidremediate-missing-data-by-roderick-little" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="strategies-to-avoidremediate-missing-data-by-roderick-little"><span class="header-section-number">17.5</span> Strategies to avoid/remediate missing data (by Roderick Little)</h2>
<ul>
<li><strong>Limit respondent burden -</strong> Limit the length or difficulty of questionnaires to limit the probability that a respondent will start, but not finish the questionnaire.</li>
<li><strong>Collect data to predict missing values -</strong> Collect basic demographic variables that can be used for reweighting and collect variables that are correlated with variables that will contain missingness.</li>
<li><strong>Follow up with a subsample of non-respondents -</strong> Information about non-respondents is gold for determining the missingness mechanism and imputing missing data.</li>
</ul>
</section>
<section id="examples" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="examples"><span class="header-section-number">17.6</span> Examples</h2>
<section id="application-1-bayesian-improved-surname-geocoding" class="level3" data-number="17.6.1">
<h3 data-number="17.6.1" class="anchored" data-anchor-id="application-1-bayesian-improved-surname-geocoding"><span class="header-section-number">17.6.1</span> Application 1: Bayesian Improved Surname Geocoding</h3>
<p>Self-reported race/ethnicity is the gold standard for the analysis of racial and ethnic disparities. Many important data sets do not contain race or ethnicity but have detailed information that could be used to impute race and ethnicity.</p>
<p><strong>The goal is to make group-level inferences instead of individual inferences.</strong></p>
<p><a href="https://www.rand.org/health-care/tools-methods/bisg.html">Bayesian Improved Surname Geocoding (BISG)</a> is an imputation method developed by RAND Corporation for estimating racial and ethnic disparities with imputations. It has been used in numerous applications like measuring racial/ethnic differences in voluntary disenrollment from Medicare plans and many fair lending models.</p>
<p>For each observation in a data set, two sets of probabilities for six race/ethnicity groups are generated:</p>
<ol type="1">
<li>Link residential address to Census Block Group information about race and ethnicity.</li>
<li>Link surname to Census surname list information about race and ethnicity.
<ul>
<li>150,000 surnames that show up 100+ times</li>
<li>Counts of 6 different race/ethnicity groups</li>
</ul></li>
</ol>
<p>Use Bayes’ theorem to combine residential and surname probabilities.</p>
<p>For each observation, this results in six probabilities for American Indian/Alaskan Native, Asian and Pacific Island, Black, Hispanic, Multiracial, and White. The model generates ROC AUC of 0.93 or greater for large groups like Black, Hispanic, and White but can perform worse for groups like Multiracial.</p>
</section>
<section id="application-2-librarytidysynthesis" class="level3" data-number="17.6.2">
<h3 data-number="17.6.2" class="anchored" data-anchor-id="application-2-librarytidysynthesis"><span class="header-section-number">17.6.2</span> Application 2: <code>library(tidysynthesis)</code></h3>
<p>Slides and .R script</p>
</section>
</section>
<section id="resources" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="resources"><span class="header-section-number">17.7</span> Resources</h2>
<ul>
<li><a href="https://bradleyboehmke.github.io/HOML/engineering.html#dealing-with-missingness">Dealing with missingness in Hands-On Machine Learning with R</a></li>
<li><a href="https://stefvanbuuren.name/fimd/">Flexible Imputation of Missing Data</a></li>
<li><a href="https://www.urban.org/research/publication/ethics-and-empathy-using-imputation-disaggregate-data-racial-equity-case-study-imputing-credit-bureau-data">Ethics and Empathy in Using Imputation to Disaggregate Data for Racial Equity, A Case Study Imputing Credit Bureau Data</a></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-williams2023" class="csl-entry" role="listitem">
Williams, Aaron R., Zhong Mingli, and Breno Braga. 2023. <span>“Using Machine Learning to Estimate Racially Disaggregated Wealth Data at the Local Level.”</span> <a href="https://www.urban.org/sites/default/files/2023-03/Using%20Machine%20Learning%20to%20Estimate%20Racially%20Disaggregated%20Wealth%20Data%20at%20the%20Local%20Level.pdf">https://www.urban.org/sites/default/files/2023-03/Using%20Machine%20Learning%20to%20Estimate%20Racially%20Disaggregated%20Wealth%20Data%20at%20the%20Local%20Level.pdf</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./17_nonparametric-2.html" class="pagination-link" aria-label="Nonparametric Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./19_predictive-modeling-motivation.html" class="pagination-link" aria-label="Predictive Modeling Motivation">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>