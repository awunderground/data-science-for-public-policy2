<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 2&nbsp; Introduction to the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_advanced-data-cleaning.html" rel="next">
<link href="./01_intro-r.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_intro-r.html">Basics</a></li><li class="breadcrumb-item"><a href="./02_tidyverse.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_dimension-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_unsupervised-ml-cluster-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#review" id="toc-review" class="nav-link active" data-scroll-target="#review"><span class="header-section-number">2.1</span> Review</a>
  <ul class="collapse">
  <li><a href="#assignment-operator" id="toc-assignment-operator" class="nav-link" data-scroll-target="#assignment-operator"><span class="header-section-number">2.1.1</span> Assignment operator</a></li>
  </ul></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions"><span class="header-section-number">2.2</span> Functions</a>
  <ul class="collapse">
  <li><a href="#vs." id="toc-vs." class="nav-link" data-scroll-target="#vs."><span class="header-section-number">2.2.1</span> <code>==</code> vs.&nbsp;<code>=</code></a></li>
  </ul></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data"><span class="header-section-number">2.3</span> Tidy data</a>
  <ul class="collapse">
  <li><a href="#tidyverse" id="toc-tidyverse" class="nav-link" data-scroll-target="#tidyverse"><span class="header-section-number">2.3.1</span> tidyverse</a></li>
  <li><a href="#opinionated-software" id="toc-opinionated-software" class="nav-link" data-scroll-target="#opinionated-software"><span class="header-section-number">2.3.2</span> Opinionated software</a></li>
  <li><a href="#tidy-data-1" id="toc-tidy-data-1" class="nav-link" data-scroll-target="#tidy-data-1"><span class="header-section-number">2.3.3</span> Tidy data</a></li>
  </ul></li>
  <li><a href="#dplyr" id="toc-dplyr" class="nav-link" data-scroll-target="#dplyr"><span class="header-section-number">2.4</span> dplyr</a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span class="header-section-number">2.4.1</span> <code>select()</code></a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename"><span class="header-section-number">2.4.2</span> <code>rename()</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="header-section-number">2.4.3</span> <code>filter()</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">2.4.4</span> <code>arrange()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">2.4.5</span> <code>mutate()</code></a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">2.4.6</span> <code>|&gt;</code></a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><span class="header-section-number">2.4.7</span> <code>summarize()</code></a></li>
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">2.4.8</span> <code>group_by()</code></a></li>
  <li><a href="#bonus-count" id="toc-bonus-count" class="nav-link" data-scroll-target="#bonus-count"><span class="header-section-number">2.4.9</span> BONUS: <code>count()</code></a></li>
  </ul></li>
  <li><a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins"><span class="header-section-number">2.5</span> Mutating Joins</a>
  <ul class="collapse">
  <li><a href="#left_join" id="toc-left_join" class="nav-link" data-scroll-target="#left_join"><span class="header-section-number">2.5.1</span> <code>left_join()</code></a></li>
  <li><a href="#inner_join" id="toc-inner_join" class="nav-link" data-scroll-target="#inner_join"><span class="header-section-number">2.5.2</span> <code>inner_join()</code></a></li>
  <li><a href="#full_join" id="toc-full_join" class="nav-link" data-scroll-target="#full_join"><span class="header-section-number">2.5.3</span> <code>full_join()</code></a></li>
  </ul></li>
  <li><a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins"><span class="header-section-number">2.6</span> Filtering Joins</a>
  <ul class="collapse">
  <li><a href="#anti_join" id="toc-anti_join" class="nav-link" data-scroll-target="#anti_join"><span class="header-section-number">2.6.1</span> <code>anti_join()</code></a></li>
  </ul></li>
  <li><a href="#readr" id="toc-readr" class="nav-link" data-scroll-target="#readr"><span class="header-section-number">2.7</span> readr</a></li>
  <li><a href="#readxl" id="toc-readxl" class="nav-link" data-scroll-target="#readxl"><span class="header-section-number">2.8</span> readxl</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">2.9</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#next-skills" id="toc-next-skills" class="nav-link" data-scroll-target="#next-skills"><span class="header-section-number">2.9.1</span> Next Skills</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    The tidyverse is a popular set of R packages for conducting reproducible data science. Packages in the tidyverse work well together and share the same design philosophy. This chapter introduces the tidyverse and, in particular, its data processing capabilities.
  </div>
</div>

</header>

<dl>
<dt><img src="images/header-images/Soviet_apartment.jpg" class="img-fluid"></dt>
<dd>
<p>A Soviet Apartment that looks like a data frame. Image by <a href="https://en.wikipedia.org/wiki/Brutalist_architecture#/media/File:Soviet_apartment.jpg">lafleur</a></p>
</dd>
</dl>
<section id="review" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="review"><span class="header-section-number">2.1</span> Review</h2>
<section id="assignment-operator" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="assignment-operator"><span class="header-section-number">2.1.1</span> Assignment operator</h3>
<p><code>&lt;-</code> is the assignment operator. An object created on the right side of an assignment operator is assigned to a name on the left side of an assignment operator. Assignment operators are important for saving the consequences of operations and functions. Without assignment, the result of a calculation is not saved for use in future calculations. Operations without assignment operators will typically be printed to the console but not saved for future use.</p>
</section>
</section>
<section id="functions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="functions"><span class="header-section-number">2.2</span> Functions</h2>
<p>Functions are collections of code that take inputs, perform operations, and return outputs. R functions are similar to mathematical functions.</p>
<p>R functions typically contain arguments. For example, <code>mean()</code> has <code>x</code>, <code>trim</code>, and <code>na.rm</code>. Many arguments have default values and don’t need to be included in function calls. Default values can be seen in the documentation. <code>trim = 0</code> and <code>na.rm = FALSE</code> are the defaults for <code>mean()</code>.</p>
<section id="vs." class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="vs."><span class="header-section-number">2.2.1</span> <code>==</code> vs.&nbsp;<code>=</code></h3>
<p><code>==</code> is a binary comparison operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="dv">1</span> <span class="sc">==</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="dv">1</span> <span class="sc">==</span> <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p><code>=</code> is an equals sign, it is most frequently used for passing arguments to functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">mean</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tidy-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="tidy-data"><span class="header-section-number">2.3</span> Tidy data</h2>
<section id="tidyverse" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="tidyverse"><span class="header-section-number">2.3.1</span> tidyverse</h3>
<blockquote class="blockquote">
<p>The <a href="https://www.tidyverse.org/">tidyverse</a> is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures. ~ tidyverse.org</p>
</blockquote>
<p><code>library(tidyverse)</code> contains:</p>
<ul>
<li><a href="https://ggplot2.tidyverse.org">ggplot2</a>, for data visualization.</li>
<li><a href="https://dplyr.tidyverse.org">dplyr</a>, for data manipulation.</li>
<li><a href="https://tidyr.tidyverse.org">tidyr</a>, for data tidying.</li>
<li><a href="https://readr.tidyverse.org">readr</a>, for data import.</li>
<li><a href="https://purrr.tidyverse.org">purrr</a>, for functional programming.</li>
<li><a href="https://tibble.tidyverse.org">tibble</a>, for tibbles, a modern re-imagining of data frames.</li>
<li><a href="https://github.com/tidyverse/stringr">stringr</a>, for strings.</li>
<li><a href="https://github.com/hadley/forcats">forcats</a>, for factors.</li>
</ul>
</section>
<section id="opinionated-software" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="opinionated-software"><span class="header-section-number">2.3.2</span> Opinionated software</h3>
<blockquote class="blockquote">
<p><em>Opinionated software</em> is a software product that believes a certain way of approaching a business process is inherently better and provides software crafted around that approach. ~ <a href="https://medium.com/@stueccles/the-rise-of-opinionated-software-ca1ba0140d5b">Stuart Eccles</a></p>
</blockquote>
</section>
<section id="tidy-data-1" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="tidy-data-1"><span class="header-section-number">2.3.3</span> Tidy data</h3>
<p>The defining opinion of the tidyverse is its wholehearted adoption of tidy data. Tidy data has three features:</p>
<ol type="1">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a dataframe.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/tidy-data.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Source: <a href="https://r4ds.hadley.nz/data-tidy">R4DS</a></figcaption>
</figure>
</div>
<p>Tidy data was formalized by Hadley <span class="citation" data-cites="Wickhamtidy">Wickham (<a href="references.html#ref-Wickhamtidy" role="doc-biblioref">2014</a>)</span> in the Journal of Statistical Software It is equivalent to Codd’s 3rd normal form (<a href="https://pdfs.semanticscholar.org/fed7/727e4864406ad69362f9500c93011dac7005.pdf">Codd, 1990</a>) for relational databases.</p>
<blockquote class="blockquote">
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way. ~ <a href="https://r4ds.hadley.nz/data-tidy.html">Hadley Wickham</a></p>
</blockquote>
<p>The tidy approach to data science is powerful because it breaks data work into two distinct parts.</p>
<ol type="1">
<li>Get the data into a tidy format.</li>
<li>Use tools optimized for tidy data.</li>
</ol>
<p>By standardizing the data structure for most community-created tools, the framework orients diffuse development and reduces the friction of data work.</p>
</section>
</section>
<section id="dplyr" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="dplyr"><span class="header-section-number">2.4</span> dplyr</h2>
<p><code>library(dplyr)</code> contains workhorse functions for manipulating and summarizing data once it is in a tidy format. <code>library(tidyr)</code> contains functions for getting data into a tidy format.</p>
<p>dplyr can be explicitly loaded with <code>library(dplyr)</code> or loaded with <code>library(tidyverse)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll focus on the key dplyr syntax using the March 2020 Annual Social and Economic Supplement (ASEC) to the <a href="https://cps.ipums.org/cps/about.shtml">Current Population Survey</a> (CPS). Run the following code to load the data.</p>
<div class="cell" data-messgae="false">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>asec <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">paste0</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="st">"https://raw.githubusercontent.com/awunderground/awunderground-data/"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>    <span class="st">"main/cps/cps-asec.csv"</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  )</span>
<span id="cb7-6"><a href="#cb7-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 157959 Columns: 17
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): month, ftype, offpov, offpovuniv
dbl (13): year, serial, cpsid, asecflag, asecwth, pernum, cpsidp, asecwt, ft...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>We can use <code>glimpse(asec)</code> to quickly view the data. We can also use <code>View(asec)</code> to open up <code>asec</code> in RStudio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">glimpse</span>(<span class="at">x =</span> asec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 157,959
Columns: 17
$ year       &lt;dbl&gt; 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020,…
$ serial     &lt;dbl&gt; 1, 1, 2, 2, 3, 4, 4, 5, 5, 5, 5, 7, 8, 9, 10, 10, 10, 12, 1…
$ month      &lt;chr&gt; "March", "March", "March", "March", "March", "March", "Marc…
$ cpsid      &lt;dbl&gt; 2.01903e+13, 2.01903e+13, 2.01812e+13, 2.01812e+13, 2.01902…
$ asecflag   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ asecwth    &lt;dbl&gt; 1552.90, 1552.90, 990.49, 990.49, 1505.27, 1430.70, 1430.70…
$ pernum     &lt;dbl&gt; 1, 2, 1, 2, 1, 1, 2, 1, 2, 3, 4, 1, 1, 1, 1, 2, 3, 1, 2, 3,…
$ cpsidp     &lt;dbl&gt; 2.01903e+13, 2.01903e+13, 2.01812e+13, 2.01812e+13, 2.01902…
$ asecwt     &lt;dbl&gt; 1552.90, 1552.90, 990.49, 990.49, 1505.27, 1430.70, 1196.57…
$ ftype      &lt;chr&gt; "Primary family", "Primary family", "Primary family", "Prim…
$ ftotval    &lt;dbl&gt; 127449, 127449, 64680, 64680, 40002, 8424, 8424, 59114, 591…
$ inctot     &lt;dbl&gt; 52500, 74949, 44000, 20680, 40002, 0, 8424, 610, 58001, 503…
$ incwage    &lt;dbl&gt; 52500, 56000, 34000, 0, 40000, 0, 8424, 0, 58000, 0, 0, 0, …
$ offpov     &lt;chr&gt; "Above Poverty Line", "Above Poverty Line", "Above Poverty …
$ offpovuniv &lt;chr&gt; "In Poverty Universe", "In Poverty Universe", "In Poverty U…
$ offtotval  &lt;dbl&gt; 127449, 127449, 64680, 64680, 40002, 8424, 8424, 59114, 591…
$ offcutoff  &lt;dbl&gt; 17120, 17120, 17120, 17120, 13300, 15453, 15453, 26370, 263…</code></pre>
</div>
</div>
<p>We’re going to learn seven functions and one new piece of syntax from <code>library(dplyr)</code> that will be our main tools for manipulating tidy frames. These functions and a few extensions outlined in the <a href="https://rstudio.com/resources/cheatsheets/">Data Transformation Cheat Sheet</a> are the core of data analysis in the Tidyverse.</p>
<section id="select" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="select"><span class="header-section-number">2.4.1</span> <code>select()</code></h3>
<p><code>select()</code> drops columns from a dataframe and/or reorders the columns in a dataframe. The arguments after the name of the dataframe should be the names of columns you wish to keep, without quotes. All other columns not listed are dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">select</span>(<span class="at">.data =</span> asec, year, month, serial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 3
    year month serial
   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
 1  2020 March      1
 2  2020 March      1
 3  2020 March      2
 4  2020 March      2
 5  2020 March      3
 6  2020 March      4
 7  2020 March      4
 8  2020 March      5
 9  2020 March      5
10  2020 March      5
# ℹ 157,949 more rows</code></pre>
</div>
</div>
<p>This works great until the goal is to select 99 of 100 variables. Fortunately, <code>-</code> can be used to remove variables. You can also select all but multiple variables by listing them with the <code>-</code> symbol separated by commas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">select</span>(<span class="at">.data =</span> asec, <span class="sc">-</span>asecflag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 16
    year serial month   cpsid asecwth pernum  cpsidp asecwt ftype ftotval inctot
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1  2020      1 March 2.02e13   1553.      1 2.02e13  1553. Prim…  127449  52500
 2  2020      1 March 2.02e13   1553.      2 2.02e13  1553. Prim…  127449  74949
 3  2020      2 March 2.02e13    990.      1 2.02e13   990. Prim…   64680  44000
 4  2020      2 March 2.02e13    990.      2 2.02e13   990. Prim…   64680  20680
 5  2020      3 March 2.02e13   1505.      1 2.02e13  1505. Nonf…   40002  40002
 6  2020      4 March 2.02e13   1431.      1 2.02e13  1431. Prim…    8424      0
 7  2020      4 March 2.02e13   1431.      2 2.02e13  1197. Prim…    8424   8424
 8  2020      5 March 2.02e13   1133.      1 2.02e13  1133. Prim…   59114    610
 9  2020      5 March 2.02e13   1133.      2 2.02e13  1133. Prim…   59114  58001
10  2020      5 March 2.02e13   1133.      3 2.02e13  1322. Prim…   59114    503
# ℹ 157,949 more rows
# ℹ 5 more variables: incwage &lt;dbl&gt;, offpov &lt;chr&gt;, offpovuniv &lt;chr&gt;,
#   offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;</code></pre>
</div>
</div>
<p><code>dplyr</code> contains powerful helper functions that can select variables based on patterns in column names:</p>
<ul>
<li><code>contains()</code>: Contains a given string</li>
<li><code>starts_with()</code>: Starts with a prefix</li>
<li><code>ends_with()</code>: Ends with a suffix</li>
<li><code>matches()</code>: Matches a regular expression</li>
<li><code>num_range()</code>: Matches a numerical range</li>
</ul>
<p>These are a subset of the <code>tidyselect</code> <a href="https://tidyselect.r-lib.org/reference/language.html">selection language and helpers</a> which enable users to apply <code>library(dplyr)</code> functions to select variables.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Select <code>pernum</code> and <code>inctot</code> from <code>asec</code>.</li>
<li><code>pull()</code> is related to <code>select()</code> but can only select one variable. What is the other difference with <code>pull()</code>?</li>
</ol>
</div>
</div>
</section>
<section id="rename" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="rename"><span class="header-section-number">2.4.2</span> <code>rename()</code></h3>
<p><code>rename()</code> renames columns in a data frame. The pattern is <code>new_name = old_name</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">rename</span>(<span class="at">.data =</span> asec, <span class="at">serial_number =</span> serial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 17
    year serial_number month   cpsid asecflag asecwth pernum  cpsidp asecwt
   &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1  2020             1 March 2.02e13        1   1553.      1 2.02e13  1553.
 2  2020             1 March 2.02e13        1   1553.      2 2.02e13  1553.
 3  2020             2 March 2.02e13        1    990.      1 2.02e13   990.
 4  2020             2 March 2.02e13        1    990.      2 2.02e13   990.
 5  2020             3 March 2.02e13        1   1505.      1 2.02e13  1505.
 6  2020             4 March 2.02e13        1   1431.      1 2.02e13  1431.
 7  2020             4 March 2.02e13        1   1431.      2 2.02e13  1197.
 8  2020             5 March 2.02e13        1   1133.      1 2.02e13  1133.
 9  2020             5 March 2.02e13        1   1133.      2 2.02e13  1133.
10  2020             5 March 2.02e13        1   1133.      3 2.02e13  1322.
# ℹ 157,949 more rows
# ℹ 8 more variables: ftype &lt;chr&gt;, ftotval &lt;dbl&gt;, inctot &lt;dbl&gt;, incwage &lt;dbl&gt;,
#   offpov &lt;chr&gt;, offpovuniv &lt;chr&gt;, offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;</code></pre>
</div>
</div>
<p>You can also rename a selection of variables using <code>rename_with()</code>. The <code>.cols</code> argument is used to select the columns to rename and takes a <code>tidyselect</code> statement like those we introduced above. Here, we’re using the <code>where()</code> selection helper which selects all columns where a given condition is <code>TRUE</code>. The default value for the <code>.cols</code> argument is <code>everything()</code> which selects all columns in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">rename_with</span>(<span class="at">.data =</span> asec, <span class="at">.fn =</span> toupper, <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 17
    YEAR SERIAL month   CPSID ASECFLAG ASECWTH PERNUM  CPSIDP ASECWT ftype      
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1  2020      1 March 2.02e13        1   1553.      1 2.02e13  1553. Primary fa…
 2  2020      1 March 2.02e13        1   1553.      2 2.02e13  1553. Primary fa…
 3  2020      2 March 2.02e13        1    990.      1 2.02e13   990. Primary fa…
 4  2020      2 March 2.02e13        1    990.      2 2.02e13   990. Primary fa…
 5  2020      3 March 2.02e13        1   1505.      1 2.02e13  1505. Nonfamily …
 6  2020      4 March 2.02e13        1   1431.      1 2.02e13  1431. Primary fa…
 7  2020      4 March 2.02e13        1   1431.      2 2.02e13  1197. Primary fa…
 8  2020      5 March 2.02e13        1   1133.      1 2.02e13  1133. Primary fa…
 9  2020      5 March 2.02e13        1   1133.      2 2.02e13  1133. Primary fa…
10  2020      5 March 2.02e13        1   1133.      3 2.02e13  1322. Primary fa…
# ℹ 157,949 more rows
# ℹ 7 more variables: FTOTVAL &lt;dbl&gt;, INCTOT &lt;dbl&gt;, INCWAGE &lt;dbl&gt;, offpov &lt;chr&gt;,
#   offpovuniv &lt;chr&gt;, OFFTOTVAL &lt;dbl&gt;, OFFCUTOFF &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Most <code>dplyr</code> functions can rename columns simply by prefacing the operation with <code>new_name =</code>. For example, this can be done with <code>select()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">select</span>(<span class="at">.data =</span> asec, year, month, <span class="at">serial_number =</span> serial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 3
    year month serial_number
   &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
 1  2020 March             1
 2  2020 March             1
 3  2020 March             2
 4  2020 March             2
 5  2020 March             3
 6  2020 March             4
 7  2020 March             4
 8  2020 March             5
 9  2020 March             5
10  2020 March             5
# ℹ 157,949 more rows</code></pre>
</div>
</div>
</section>
<section id="filter" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="filter"><span class="header-section-number">2.4.3</span> <code>filter()</code></h3>
<p><code>filter()</code> reduces the number of observations in a dataframe. Every column in a dataframe has a name. Rows do not necessarily have names in a dataframe, so rows need to be filtered based on logical conditions.</p>
<p><code>==</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code>, <code>%in%</code>, and <code>is.na()</code> are all operators that can be used for logical conditions. <code>!</code> can be used to negate a condition and <code>&amp;</code> and <code>|</code> can be used to combine conditions. <code>|</code> means or.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># return rows with pernum of 1 and incwage &gt; $100,000</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">filter</span>(<span class="at">.data =</span> asec, pernum <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> incwage <span class="sc">&gt;</span> <span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,551 × 17
    year serial month   cpsid asecflag asecwth pernum  cpsidp asecwt ftype      
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1  2020     28 March 2.02e13        1    678.      1 2.02e13   678. Primary fa…
 2  2020    134 March 0              1    923.      1 0         923. Primary fa…
 3  2020    136 March 2.02e13        1    906.      1 2.02e13   906. Primary fa…
 4  2020    137 March 2.02e13        1   1493.      1 2.02e13  1493. Nonfamily …
 5  2020    359 March 2.02e13        1    863.      1 2.02e13   863. Primary fa…
 6  2020    372 March 2.02e13        1   1338.      1 2.02e13  1338. Primary fa…
 7  2020    404 March 0              1    677.      1 0         677. Primary fa…
 8  2020    420 March 2.02e13        1    747.      1 2.02e13   747. Primary fa…
 9  2020    450 March 2.02e13        1   1309.      1 2.02e13  1309. Primary fa…
10  2020    491 March 0              1   1130.      1 0        1130. Primary fa…
# ℹ 5,541 more rows
# ℹ 7 more variables: ftotval &lt;dbl&gt;, inctot &lt;dbl&gt;, incwage &lt;dbl&gt;, offpov &lt;chr&gt;,
#   offpovuniv &lt;chr&gt;, offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;</code></pre>
</div>
</div>
<p><a href="https://cps.ipums.org/cps-action/variables/group">IPUMS CPS</a> contains full documentation with information about <code>pernum</code> and <code>incwage</code>.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Filter <code>asec</code> to rows with <code>month</code> equal to <code>"March"</code>.</li>
<li>Filter <code>asec</code> to rows with <code>inctot</code> less than <code>999999999</code>.</li>
<li>Filter <code>asec</code> to rows with <code>pernum</code> equal to <code>3</code> and <code>inctot</code> less than <code>999999999</code>.</li>
</ol>
</div>
</div>
</section>
<section id="arrange" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="arrange"><span class="header-section-number">2.4.4</span> <code>arrange()</code></h3>
<p><code>arrange()</code> sorts the rows of a data frame in alpha-numeric order based on the values of a variable or variables. The dataframe is sorted by the first variable first and each subsequent variable is used to break ties. <code>desc()</code> is used to reverse the sort order for a given variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># sort pernum is descending order because high pernums are interesting</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">arrange</span>(<span class="at">.data =</span> asec, <span class="fu">desc</span>(pernum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 17
    year serial month   cpsid asecflag asecwth pernum  cpsidp asecwt ftype      
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1  2020  91430 March 0              1    505.     16 0         604. Secondary …
 2  2020  91430 March 0              1    505.     15 0         465. Secondary …
 3  2020  91430 March 0              1    505.     14 0         416. Secondary …
 4  2020  15037 March 2.02e13        1   2272.     13 2.02e13  2633. Primary fa…
 5  2020  78495 March 0              1   1279.     13 0        1424. Related su…
 6  2020  91430 March 0              1    505.     13 0         465. Secondary …
 7  2020  15037 March 2.02e13        1   2272.     12 2.02e13  1689. Primary fa…
 8  2020  18102 March 0              1   2468.     12 0        2871. Primary fa…
 9  2020  22282 March 0              1   2801.     12 0        3879. Related su…
10  2020  30274 March 2.02e13        1    653.     12 2.02e13   858. Primary fa…
# ℹ 157,949 more rows
# ℹ 7 more variables: ftotval &lt;dbl&gt;, inctot &lt;dbl&gt;, incwage &lt;dbl&gt;, offpov &lt;chr&gt;,
#   offpovuniv &lt;chr&gt;, offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Sort <code>asec</code> in descending order by <code>pernum</code> and ascending order by <code>inctot</code>.</li>
</ol>
</div>
</div>
</section>
<section id="mutate" class="level3" data-number="2.4.5">
<h3 data-number="2.4.5" class="anchored" data-anchor-id="mutate"><span class="header-section-number">2.4.5</span> <code>mutate()</code></h3>
<p><code>mutate()</code> creates new variables or edits existing variables. We can use arithmetic arguments, such as <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, and <code>^</code>. We can also custom functions and functions from packages. For example, we can use <code>library(stringr)</code> for string manipulation and <code>library(lubridate)</code> for date manipulation.</p>
<p>Variables are created by adding a new column name, like <code>inctot_adjusted</code>, to the left of <code>=</code> in <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># adjust inctot for underreporting</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">mutate</span>(<span class="at">.data =</span> asec, <span class="at">inctot_adjusted =</span> inctot <span class="sc">*</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 18
    year serial month   cpsid asecflag asecwth pernum  cpsidp asecwt ftype      
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1  2020      1 March 2.02e13        1   1553.      1 2.02e13  1553. Primary fa…
 2  2020      1 March 2.02e13        1   1553.      2 2.02e13  1553. Primary fa…
 3  2020      2 March 2.02e13        1    990.      1 2.02e13   990. Primary fa…
 4  2020      2 March 2.02e13        1    990.      2 2.02e13   990. Primary fa…
 5  2020      3 March 2.02e13        1   1505.      1 2.02e13  1505. Nonfamily …
 6  2020      4 March 2.02e13        1   1431.      1 2.02e13  1431. Primary fa…
 7  2020      4 March 2.02e13        1   1431.      2 2.02e13  1197. Primary fa…
 8  2020      5 March 2.02e13        1   1133.      1 2.02e13  1133. Primary fa…
 9  2020      5 March 2.02e13        1   1133.      2 2.02e13  1133. Primary fa…
10  2020      5 March 2.02e13        1   1133.      3 2.02e13  1322. Primary fa…
# ℹ 157,949 more rows
# ℹ 8 more variables: ftotval &lt;dbl&gt;, inctot &lt;dbl&gt;, incwage &lt;dbl&gt;, offpov &lt;chr&gt;,
#   offpovuniv &lt;chr&gt;, offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;, inctot_adjusted &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Variables are edited by including an existing column name, like <code>inctot</code>, to the left of <code>=</code> in <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># adjust income because of underreporting</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">mutate</span>(<span class="at">.data =</span> asec, <span class="at">inctot =</span> inctot <span class="sc">*</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 157,959 × 17
    year serial month   cpsid asecflag asecwth pernum  cpsidp asecwt ftype      
   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
 1  2020      1 March 2.02e13        1   1553.      1 2.02e13  1553. Primary fa…
 2  2020      1 March 2.02e13        1   1553.      2 2.02e13  1553. Primary fa…
 3  2020      2 March 2.02e13        1    990.      1 2.02e13   990. Primary fa…
 4  2020      2 March 2.02e13        1    990.      2 2.02e13   990. Primary fa…
 5  2020      3 March 2.02e13        1   1505.      1 2.02e13  1505. Nonfamily …
 6  2020      4 March 2.02e13        1   1431.      1 2.02e13  1431. Primary fa…
 7  2020      4 March 2.02e13        1   1431.      2 2.02e13  1197. Primary fa…
 8  2020      5 March 2.02e13        1   1133.      1 2.02e13  1133. Primary fa…
 9  2020      5 March 2.02e13        1   1133.      2 2.02e13  1133. Primary fa…
10  2020      5 March 2.02e13        1   1133.      3 2.02e13  1322. Primary fa…
# ℹ 157,949 more rows
# ℹ 7 more variables: ftotval &lt;dbl&gt;, inctot &lt;dbl&gt;, incwage &lt;dbl&gt;, offpov &lt;chr&gt;,
#   offpovuniv &lt;chr&gt;, offtotval &lt;dbl&gt;, offcutoff &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Conditional logic inside of <code>mutate()</code> with functions like <code>if_else()</code> and <code>case_when()</code> is key to mastering data munging in R.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create a new variable called <code>in_poverty</code>. If <code>offtotval</code> is less than <code>offcutoff</code> then use <code>"Below Poverty Line"</code>. Otherwise, use <code>"Above Poverty Line"</code>. <em>Hint:</em> <code>if_else()</code> is useful and works like the IF command in Microsoft Excel.</li>
</ol>
</div>
</div>
</section>
<section id="section" class="level3" data-number="2.4.6">
<h3 data-number="2.4.6" class="anchored" data-anchor-id="section"><span class="header-section-number">2.4.6</span> <code>|&gt;</code></h3>
<p>Data munging is tiring when each operation needs to be assigned to a name with <code>&lt;-</code>. The pipe, <code>|&gt;</code>, allows lines of code to be chained together so the assignment operator only needs to be used once.</p>
<p><code>|&gt;</code> passes the output from function as the first argument in a subsequent function. For example, this line can be rewritten:</p>
<p>Legacy R code may use <code>%&gt;%</code>, the pipe from the <code>magrittr</code> package. It was (and remains) popular, particularly in the <code>tidyverse framework</code>. Due to this popularity, base R incorporated a similar concept in the base pipe. In many cases, these pipes work the same way, but there are some differences. Because <code>|&gt;</code> is new and continues to be developed, developers have increased <code>|&gt;</code>’s abilities over time. To see a list of key differences between <code>%&gt;%</code> and <code>|&gt;</code>, see <a href="https://www.tidyverse.org/blog/2023/04/base-vs-magrittr-pipe/">this blog</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># old way</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="fu">mutate</span>(<span class="at">.data =</span> asec, <span class="at">inctot_adjusted =</span> inctot <span class="sc">*</span> <span class="fl">1.1</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co"># new way</span></span>
<span id="cb29-5"><a href="#cb29-5"></a>asec <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>  <span class="fu">mutate</span>(<span class="at">inctot_adjusted =</span> inctot <span class="sc">*</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>See the power:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>new_asec <span class="ot">&lt;-</span> asec <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">filter</span>(pernum <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">select</span>(year, month, pernum, inctot) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">mutate</span>(<span class="at">inctot_adjusted =</span> inctot <span class="sc">*</span> <span class="fl">1.1</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">select</span>(<span class="sc">-</span>inctot)</span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a>new_asec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 60,460 × 4
    year month pernum inctot_adjusted
   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;           &lt;dbl&gt;
 1  2020 March      1          57750 
 2  2020 March      1          48400 
 3  2020 March      1          44002.
 4  2020 March      1              0 
 5  2020 March      1            671 
 6  2020 March      1          19279.
 7  2020 March      1          12349.
 8  2020 March      1          21589.
 9  2020 March      1          47306.
10  2020 March      1          10949.
# ℹ 60,450 more rows</code></pre>
</div>
</div>
</section>
<section id="summarize" class="level3" data-number="2.4.7">
<h3 data-number="2.4.7" class="anchored" data-anchor-id="summarize"><span class="header-section-number">2.4.7</span> <code>summarize()</code></h3>
<p><code>summarize()</code> collapses many rows in a dataframe into fewer rows with summary statistics of the many rows. <code>n()</code>, <code>mean()</code>, and <code>sum()</code> are common summary statistics. Renaming is useful with <code>summarize()</code>!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># summarize without renaming the statistics</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>asec <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">summarize</span>(<span class="fu">mean</span>(ftotval), <span class="fu">mean</span>(inctot))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `mean(ftotval)` `mean(inctot)`
            &lt;dbl&gt;          &lt;dbl&gt;
1         105254.     209921275.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># summarize and rename the statistics</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>asec <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">summarize</span>(<span class="at">mean_ftotval =</span> <span class="fu">mean</span>(ftotval), <span class="at">mean_inctot =</span> <span class="fu">mean</span>(inctot))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_ftotval mean_inctot
         &lt;dbl&gt;       &lt;dbl&gt;
1      105254.  209921275.</code></pre>
</div>
</div>
<p><code>summarize()</code> returns a data frame. This means all dplyr functions can be used on the output of <code>summarize()</code>. This is powerful! Manipulating summary statistics in Stata and SAS can be a chore. Here, it’s just another dataframe that can be manipulated with a tool set optimized for dataframes: dplyr.</p>
</section>
<section id="group_by" class="level3" data-number="2.4.8">
<h3 data-number="2.4.8" class="anchored" data-anchor-id="group_by"><span class="header-section-number">2.4.8</span> <code>group_by()</code></h3>
<p><code>group_by()</code> groups a dataframe based on specified variables. <code>summarize()</code> with grouped dataframes creates subgroup summary statistics. <code>mutate()</code> with <code>group_by()</code> calculates grouped summaries for each row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>asec <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">group_by</span>(pernum) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-4"><a href="#cb36-4"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb36-5"><a href="#cb36-5"></a>    <span class="at">mean_ftotval =</span> <span class="fu">mean</span>(ftotval), </span>
<span id="cb36-6"><a href="#cb36-6"></a>    <span class="at">mean_inctot =</span> <span class="fu">mean</span>(inctot)</span>
<span id="cb36-7"><a href="#cb36-7"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   pernum     n mean_ftotval mean_inctot
    &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1      1 60460       94094.      57508.
 2      2 45151      108700.   77497357.
 3      3 25650      117966.  473030618.
 4      4 15797      121815.  634999933.
 5      5  6752      108609.  691504650.
 6      6  2582       89448.  682810446.
 7      7   922       78889.  682218196.
 8      8   353       72284.  682725646.
 9      9   158       54599.  632917559.
10     10    73       58145.  657543632.
11     11    37       61847.  702708584 
12     12    18       50249.  777780725.
13     13     3       25152   666666666 
14     14     1       18000       18000 
15     15     1       25000       25000 
16     16     1       15000       15000 </code></pre>
</div>
</div>
<p>Dataframes can be grouped by multiple variables.</p>
<p>Grouped tibbles include metadata about groups. For example, <code>Groups:   pernum, offpov [40]</code>. One grouping is dropped each time <code>summarize()</code> is used. It is easy to forget if a dataframe is grouped, so it is safe to include <code>ungroup()</code> at the end of a section of functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>asec <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">group_by</span>(pernum, offpov) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="fu">summarize</span>(</span>
<span id="cb38-4"><a href="#cb38-4"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb38-5"><a href="#cb38-5"></a>    <span class="at">mean_ftotval =</span> <span class="fu">mean</span>(ftotval), </span>
<span id="cb38-6"><a href="#cb38-6"></a>    <span class="at">mean_inctot =</span> <span class="fu">mean</span>(inctot)</span>
<span id="cb38-7"><a href="#cb38-7"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8"></a>  <span class="fu">arrange</span>(offpov) <span class="sc">|&gt;</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'pernum'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 5
   pernum offpov                 n mean_ftotval mean_inctot
    &lt;dbl&gt; &lt;chr&gt;              &lt;int&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1      1 Above Poverty Line 53872      104451.      63642.
 2      2 Above Poverty Line 40978      118691.   59082162.
 3      3 Above Poverty Line 23052      129891.  463440562.
 4      4 Above Poverty Line 14076      135039.  631720097.
 5      5 Above Poverty Line  5805      123937.  688206447.
 6      6 Above Poverty Line  2118      105867.  683199297.
 7      7 Above Poverty Line   724       96817.  697520661.
 8      8 Above Poverty Line   269       90328.  672870019.
 9      9 Above Poverty Line   114       70438.  622815186.
10     10 Above Poverty Line    57       71483.  666678408.
# ℹ 30 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 5</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><code>filter()</code> to only include observations with <code>"In Poverty Universe"</code> in <code>offpovuniv</code>.</li>
<li><code>group_by()</code> <code>offpov</code>.</li>
<li>Use <code>summarize()</code> and <code>n()</code> to count the number of observations in poverty.</li>
</ol>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 6</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><code>filter()</code> to only include observations with <code>"In Poverty Universe"</code>.</li>
<li><code>group_by()</code> <code>cpsid</code>.</li>
<li>Use <code>mutate(family_size = n())</code> to calculate the family size for each observation in <code>asec</code>.</li>
<li><code>ungroup()</code></li>
<li>Create a new variable called <code>in_poverty</code>. If <code>offtotval</code> is less than <code>offcutoff</code> then use <code>"Below Poverty Line"</code>. Otherwise, use <code>"Above Poverty Line"</code>.</li>
<li><code>group_by()</code> <code>family_size</code>, <code>offpov</code>, and <code>in_poverty</code></li>
<li>Use <code>summarize()</code> and <code>n()</code> to see if you get the same result for <code>offpov</code> and <code>in_poverty</code>. You should only get two rows per family size if your poverty calculation is correct.</li>
</ol>
<ul>
<li><code>offcutoff</code> comes from <a href="https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-poverty-thresholds.html">Census Bureau poverty tables</a> with 48 unique thresholds based on family composition. Do not confuse the tables with HHS poverty tables.</li>
<li>These data come from IPUMS CPS. IPUMS has cleaned and pre-processed the data to include variables like <code>offcutoff</code>.</li>
</ul>
<p><strong>Are the estimates from the previous two exercises correct?</strong></p>
<p>Let’s look at a <a href="https://www.census.gov/library/publications/2020/demo/p60-270.html">Census Report</a> to see how many people were in poverty in 2019. We estimated about 16,500 people. The Census Bureau says 34.0 million people.</p>
<p>No! We did not account for sampling weights, so our estimates are incorrect. Assignment 3 will demonstrate how to incorporate sampling weights into an analysis.</p>
</div>
</div>
</section>
<section id="bonus-count" class="level3" data-number="2.4.9">
<h3 data-number="2.4.9" class="anchored" data-anchor-id="bonus-count"><span class="header-section-number">2.4.9</span> BONUS: <code>count()</code></h3>
<p><code>count()</code> is a shortcut to <code>df |&gt; group_by(var) |&gt; summarize(n())</code>. <code>count()</code> counts the number of observations with a level of a variable or levels of several variables. It is too useful to skip:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">count</span>(asec, pernum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   pernum     n
    &lt;dbl&gt; &lt;int&gt;
 1      1 60460
 2      2 45151
 3      3 25650
 4      4 15797
 5      5  6752
 6      6  2582
 7      7   922
 8      8   353
 9      9   158
10     10    73
11     11    37
12     12    18
13     13     3
14     14     1
15     15     1
16     16     1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">count</span>(<span class="at">x =</span> asec, pernum, offpov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   pernum offpov                 n
    &lt;dbl&gt; &lt;chr&gt;              &lt;int&gt;
 1      1 Above Poverty Line 53872
 2      1 Below Poverty Line  6588
 3      2 Above Poverty Line 40978
 4      2 Below Poverty Line  4156
 5      2 NIU                   17
 6      3 Above Poverty Line 23052
 7      3 Below Poverty Line  2527
 8      3 NIU                   71
 9      4 Above Poverty Line 14076
10      4 Below Poverty Line  1648
# ℹ 30 more rows</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="mutating-joins" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="mutating-joins"><span class="header-section-number">2.5</span> Mutating Joins</h2>
<p>Mutating joins join one dataframe to columns from another dataframe by matching values common in both dataframes. The syntax is derived from <em>Structured Query Language</em> (SQL).</p>
<p>Each function requires an <code>x</code> (or left) dataframe, a <code>y</code> (or right) data frame, and <code>by</code> variables that exist in both dataframes. Note that below we’re creating dataframes using the <code>tribble()</code> function, which creates a tibble using a row-wise layout.</p>
<p><a href="https://github.com/elbersb/tidylog"><code>library(tidylog)</code></a> is a useful function for monitoring the behavior of joins. It prints out summaries of the number of rows in each dataframe that successfully join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>math_scores <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="sc">~</span>name, <span class="sc">~</span>math_score,</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="st">"Alec"</span>, <span class="dv">95</span>,</span>
<span id="cb45-4"><a href="#cb45-4"></a>  <span class="st">"Bart"</span>, <span class="dv">97</span>,</span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="st">"Carrie"</span>, <span class="dv">100</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>)</span>
<span id="cb45-7"><a href="#cb45-7"></a></span>
<span id="cb45-8"><a href="#cb45-8"></a>reading_scores <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="sc">~</span>name, <span class="sc">~</span>reading_score,</span>
<span id="cb45-10"><a href="#cb45-10"></a>  <span class="st">"Alec"</span>, <span class="dv">88</span>,</span>
<span id="cb45-11"><a href="#cb45-11"></a>  <span class="st">"Bart"</span>, <span class="dv">67</span>,</span>
<span id="cb45-12"><a href="#cb45-12"></a>  <span class="st">"Carrie"</span>, <span class="dv">100</span>,</span>
<span id="cb45-13"><a href="#cb45-13"></a>  <span class="st">"Zeta"</span>, <span class="dv">100</span></span>
<span id="cb45-14"><a href="#cb45-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="left_join" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="left_join"><span class="header-section-number">2.5.1</span> <code>left_join()</code></h3>
<p><code>left_join()</code> matches observations from the <code>y</code> dataframe to the <code>x</code> dataframe. It only keeps observations from the <code>y</code> data frame that have a match in the <code>x</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">left_join</span>(<span class="at">x =</span> math_scores, <span class="at">y =</span> reading_scores, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  name   math_score reading_score
  &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 Alec           95            88
2 Bart           97            67
3 Carrie        100           100</code></pre>
</div>
</div>
<p>Observations that exist in the <code>x</code> (left) dataframe but not in the <code>y</code> (right) dataframe result in <code>NA</code>s.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">left_join</span>(<span class="at">x =</span> reading_scores, <span class="at">y =</span> math_scores, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name   reading_score math_score
  &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;
1 Alec              88         95
2 Bart              67         97
3 Carrie           100        100
4 Zeta             100         NA</code></pre>
</div>
</div>
</section>
<section id="inner_join" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="inner_join"><span class="header-section-number">2.5.2</span> <code>inner_join()</code></h3>
<p><code>inner_join()</code> matches observations from the <code>y</code> dataframe to the <code>x</code> dataframe. It only keeps observations from either data frame that have a match.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="fu">inner_join</span>(<span class="at">x =</span> reading_scores, <span class="at">y =</span> math_scores, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  name   reading_score math_score
  &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;
1 Alec              88         95
2 Bart              67         97
3 Carrie           100        100</code></pre>
</div>
</div>
</section>
<section id="full_join" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="full_join"><span class="header-section-number">2.5.3</span> <code>full_join()</code></h3>
<p><code>full_join()</code> matches observations from the <code>y</code> dataframe to the <code>x</code> dataframe. It keeps observations from both dataframes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">full_join</span>(<span class="at">x =</span> reading_scores, <span class="at">y =</span> math_scores, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  name   reading_score math_score
  &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;
1 Alec              88         95
2 Bart              67         97
3 Carrie           100        100
4 Zeta             100         NA</code></pre>
</div>
</div>
</section>
</section>
<section id="filtering-joins" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="filtering-joins"><span class="header-section-number">2.6</span> Filtering Joins</h2>
<p>Filtering joins drop observations based on the presence of their key (identifier) in another data frame. They use the same syntax as mutating joins with an <code>x</code> (or left) dataframe, a <code>y</code> (or right) data frame, and <code>by</code> variables that exist in both dataframes.</p>
<section id="anti_join" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="anti_join"><span class="header-section-number">2.6.1</span> <code>anti_join()</code></h3>
<p><code>anti_join()</code> returns all rows from <code>x</code> where there are not matching values in <code>y</code>. <code>anti_join()</code> complements <code>inner_join()</code>. Together, they should exhaust the <code>x</code> dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">anti_join</span>(<span class="at">x =</span> reading_scores, <span class="at">y =</span> math_scores, <span class="at">by =</span> <span class="st">"name"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  name  reading_score
  &lt;chr&gt;         &lt;dbl&gt;
1 Zeta            100</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Combine Tables column in the <a href="https://www.rstudio.com/resources/cheatsheets/">Data Transformation Cheat Sheet</a> is an invaluable resource for navigating joins. The “column matching for joins” section of that cheat sheet outlines how to join tables by matching on multiple columns or match on columns with different names in each table.</p>
<p><em>R for Data Science (2e)</em> also has an <a href="https://r4ds.hadley.nz/joins">excellent chapter</a> covering joins.</p>
</div>
</div>
</section>
</section>
<section id="readr" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="readr"><span class="header-section-number">2.7</span> readr</h2>
<p><code>readr</code> is a core tidyverse package for reading and parsing rectangular data from text files (.csv, .tsv, etc.). <code>read_csv()</code> reads <code>.csv</code> files and has a bevy of advantages versus <code>read.csv()</code>. We recommend never using <code>read.csv()</code>.</p>
<p>Many <code>.csv</code>s can be read without issue with simple syntax <code>read_csv(file = "relative/path/to/data")</code>.</p>
<p><code>readr</code> and <code>read_csv()</code> have powerful tools for resolving parsing issues. More can be learned in the <a href="https://r4ds.hadley.nz/data-import.html">data import section</a> in <em>R for Data Science (2e)</em>.</p>
</section>
<section id="readxl" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="readxl"><span class="header-section-number">2.8</span> readxl</h2>
<p><a href="https://readxl.tidyverse.org/">readxl</a> is a tidyverse package for reading data from Microsoft Excel files. It is not a core tidyverse package so it needs to be explicitly loaded in each R session.</p>
<p>We introduce the package more thoroughly in <a href="03_advanced-data-cleaning.html#sec-readxl"><span>Section&nbsp;3.2.2</span></a>. The <a href="https://readxl.tidyverse.org/">tidyverse website</a> has a good tutorial on readxl.</p>
</section>
<section id="conclusion" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">2.9</span> Conclusion</h2>
<p>This chapter introduced tidy data in which columns reflect a variable, observations reflect a row, and cells reflect an individual observation. It also introduced key functions from <code>dplyr</code>, a tidyverse package built to support data cleaning operations:</p>
<ul>
<li><code>select()</code> for removing columns</li>
<li><code>filter()</code> for removing rows</li>
<li><code>rename()</code> for renaming columns</li>
<li><code>arrange()</code> for reordering columns</li>
<li><code>mutate()</code> for creating new columns</li>
<li><code>|&gt;</code> (the pipe operator) for chaining together multiple functions (part of base, but extremely useful!)</li>
<li><code>summarize()</code> for collapsing many rows of a data frame into fewer rows</li>
<li><code>group_by()</code> to group a data frame by certain specified variables</li>
<li><code>count()</code> a shortcut for <code>group_by() |&gt; summarize(n())</code></li>
</ul>
<p>The chapter also introduced mutating joins (<code>left_join()</code>, <code>inner_join()</code>, and <code>full_join()</code>) which create new columns and filtering joins (<code>anti_join()</code>) which drop observations depending on the presence of their key in another data frame.</p>
<p>The chapter concluded by introducing the <code>readr</code> and <code>readxl</code> packages which are useful for reading data into R.</p>
<section id="next-skills" class="level3" data-number="2.9.1">
<h3 data-number="2.9.1" class="anchored" data-anchor-id="next-skills"><span class="header-section-number">2.9.1</span> Next Skills</h3>
<ul>
<li><code>across()</code> can be used with <code>library(dplyr)</code> functions such as <code>summarise()</code> and <code>mutate()</code> to apply the same transformations to multiple columns. For example, it can be used to calculate the mean of many columns with <code>summarize()</code>. <code>across()</code> uses the same <code>tidyselect</code> select language and helpers discussed earlier to select the columns to transform.</li>
<li><code>pivot_wider()</code> and <code>pivot_longer()</code> can be used to switch between wide and long formats of the data. This is important for tidying data and data visualization.</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Wickhamtidy" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This definition is from the tidy data paper, not R for Data Science, which uses a slightly different definition.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01_intro-r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_advanced-data-cleaning.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>