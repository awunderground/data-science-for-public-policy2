<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 23&nbsp; Cluster Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./27_advanced-unsupervised-ml.html" rel="next">
<link href="./25_dimension-reduction.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./25_dimension-reduction.html">Unsupervised Machine Learning</a></li><li class="breadcrumb-item"><a href="./26_unsupervised-ml-cluster-analysis.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_dimension-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_unsupervised-ml-cluster-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">23.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#intuitive-explanation" id="toc-intuitive-explanation" class="nav-link" data-scroll-target="#intuitive-explanation"><span class="header-section-number">23.1.1</span> Intuitive Explanation</a></li>
  <li><a href="#euclidean-distance" id="toc-euclidean-distance" class="nav-link" data-scroll-target="#euclidean-distance"><span class="header-section-number">23.1.2</span> Euclidean Distance</a></li>
  </ul></li>
  <li><a href="#clustering-process" id="toc-clustering-process" class="nav-link" data-scroll-target="#clustering-process"><span class="header-section-number">23.2</span> Clustering Process</a>
  <ul class="collapse">
  <li><a href="#librarytidyclust" id="toc-librarytidyclust" class="nav-link" data-scroll-target="#librarytidyclust"><span class="header-section-number">23.2.1</span> <code>library(tidyclust)</code></a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">23.2.2</span> Implementation</a></li>
  <li><a href="#picking-the-number-of-clusters" id="toc-picking-the-number-of-clusters" class="nav-link" data-scroll-target="#picking-the-number-of-clusters"><span class="header-section-number">23.2.3</span> Picking the number of clusters</a></li>
  <li><a href="#additional-considerations" id="toc-additional-considerations" class="nav-link" data-scroll-target="#additional-considerations"><span class="header-section-number">23.2.4</span> Additional Considerations</a></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><span class="header-section-number">23.2.5</span> Diagnostics</a></li>
  <li><a href="#visualizing-clusters-with-a-scatter-plot-matrix" id="toc-visualizing-clusters-with-a-scatter-plot-matrix" class="nav-link" data-scroll-target="#visualizing-clusters-with-a-scatter-plot-matrix"><span class="header-section-number">23.2.6</span> Visualizing clusters with a scatter plot matrix</a></li>
  <li><a href="#putting-it-all-together" id="toc-putting-it-all-together" class="nav-link" data-scroll-target="#putting-it-all-together"><span class="header-section-number">23.2.7</span> Putting it all together</a></li>
  </ul></li>
  <li><a href="#example-projects" id="toc-example-projects" class="nav-link" data-scroll-target="#example-projects"><span class="header-section-number">23.3</span> Example projects</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">23.4</span> Appendix</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">23.1</span> Introduction</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cluster analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Cluster analysis:</strong> The process of using algorithms to assign observations to groups by calculating similarity between the observations (rows) using their variables (columns). The goal is to minimize the similarity between groups and maximize the similarity within groups.</p>
<p>Cluster assignments are the arbitrary labels for the groups (i.e.&nbsp;cluster 1 and cluster 2). Cluster assignments can be used for data visualization and calculating group-wise summary statistics like cluster means.</p>
<p>In practice, clusters can be used to create typologies and to summarize rows in a complicated data set. At the Urban Institute, researchers have used cluster analysis to create neighborhood types <span class="citation" data-cites="change14real">(<a href="references.html#ref-change14real" role="doc-biblioref"><strong>change14real?</strong></a>)</span> and to categorize counties based on financial wellness indicators.</p>
</div>
</div>
<section id="intuitive-explanation" class="level3" data-number="23.1.1">
<h3 data-number="23.1.1" class="anchored" data-anchor-id="intuitive-explanation"><span class="header-section-number">23.1.1</span> Intuitive Explanation</h3>
<section id="example-1" class="level4">
<h4 class="anchored" data-anchor-id="example-1">Example 1</h4>
<p>Consider the following 10 observations. How might you meaningfully cluster the observations?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-2" class="level4">
<h4 class="anchored" data-anchor-id="example-2">Example 2</h4>
<p>Consider the following 10 observations. How might you meaningfully cluster the observations?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These two examples raise three important questions:</p>
<ol type="1">
<li>What is a formal method to calculate similarity between the observations?</li>
<li>How can we scale up this process to many observations and many variables?</li>
<li>How many groups should be created?</li>
</ol>
</section>
</section>
<section id="euclidean-distance" class="level3" data-number="23.1.2">
<h3 data-number="23.1.2" class="anchored" data-anchor-id="euclidean-distance"><span class="header-section-number">23.1.2</span> Euclidean Distance</h3>
<p>Euclidean distance is very popular for cluster analysis. It offers one formal method to calculate similarity between the observations.</p>
<p>One variable:</p>
<p><span class="math display">\[Dist_{ij} = \sqrt{(x_i - x_j)^2}\]</span></p>
<p>Multiple variables:</p>
<p><span class="math display">\[Distance_{ij} = \sqrt{\sum_{k = 1}^p(x_{ik} - x_{jk})^2}\]</span></p>
<p>Where <span class="math inline">\(i\)</span> is the first observation, <span class="math inline">\(j\)</span> is the second observation, <span class="math inline">\(k\)</span> is the <span class="math inline">\(k^{th}\)</span> variables, and <span class="math inline">\(p\)</span> is the number of variables.</p>
</section>
</section>
<section id="clustering-process" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="clustering-process"><span class="header-section-number">23.2</span> Clustering Process</h2>
<p>When the clusters are clear and there aren’t many variables, we can intuit reasonable groups (like above). But what if there are 30 variables? Or 500 observations?</p>
<p>Fortunately, there are numerous algorithms to address these issues and that answer the question “How can we scale up a process to many observations and many variables?”</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
K-means
</div>
</div>
<div class="callout-body-container callout-body">
<p>K-means clustering is a popular clustering algorithm. It is different than KNN but uses many of the same mathematical ideas. We walk through the K-means algorithm below.</p>
<p>Consider the following data set.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 1:</strong> Randomly place K centroids in your n-dimensional vector space</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 2:</strong> Calculate the nearest centroid for each point using a distance measure</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 3:</strong> Assign each point to the nearest centroid</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 4:</strong> Recalculate the position of the centroids based on the means of the assigned points</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p><strong>Step 5:</strong> Repeat steps 2-4 until no points change cluster assignments</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="624"></p>
</figure>
</div>
</div>
</div>
<p>Note:</p>
<ol type="1">
<li>The data typically need to be on the same scale.</li>
<li>K-means clustering is not robust to outliers.</li>
<li>The cluster assignments are not deterministic due to the random point placement in step 1.</li>
</ol>
</div>
</div>
<section id="librarytidyclust" class="level3" data-number="23.2.1">
<h3 data-number="23.2.1" class="anchored" data-anchor-id="librarytidyclust"><span class="header-section-number">23.2.1</span> <code>library(tidyclust)</code></h3>
<p>We will use <code>library(tidyclust)</code> for cluster analysis. The goal of tidyclust is to provide a tidy, unified interface to clustering models. The package is closely modeled after the <code>parsnip</code> package in <code>library(tidymodels)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># install.packages("tidyclust")</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyclust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="implementation" class="level3" data-number="23.2.2">
<h3 data-number="23.2.2" class="anchored" data-anchor-id="implementation"><span class="header-section-number">23.2.2</span> Implementation</h3>
<section id="example-1-1" class="level4">
<h4 class="anchored" data-anchor-id="example-1-1">Example 1</h4>
<p>Consider the state data from earlier.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">library</span>(broom)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># select numeric variables of interest</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>state_data <span class="ot">&lt;-</span> urbnmapr<span class="sc">::</span>statedata <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="fu">select</span>(hhpop, horate, medhhincome)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># create a recipe</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>state_kmeans_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="at">formula =</span> <span class="sc">~</span> ., </span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="at">data =</span> state_data</span>
<span id="cb2-12"><a href="#cb2-12"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>  <span class="fu">step_range</span>(<span class="fu">all_predictors</span>()) <span class="co">#scale between 0 and 1</span></span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a>state_data_numeric <span class="ot">&lt;-</span> state_kmeans_rec <span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="fu">prep</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> state_data)</span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># create a kmeans model object four clusters</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>state_kmeans_spec <span class="ot">&lt;-</span> <span class="fu">k_means</span>(</span>
<span id="cb2-21"><a href="#cb2-21"></a>  <span class="at">num_clusters =</span> <span class="dv">4</span> <span class="co"># number of clusters</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>) <span class="sc">|&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="fu">set_engine</span>(</span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="st">"stats"</span>, </span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="at">nstart =</span> <span class="dv">100</span> <span class="co"># number of random starts</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>  ) </span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co"># create a workflow</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>state_kmeans_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(</span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="at">preprocessor =</span> state_kmeans_rec, </span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="at">spec =</span> state_kmeans_spec</span>
<span id="cb2-32"><a href="#cb2-32"></a>)</span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co"># set a seed because the clusters are not deterministic</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="fu">set.seed</span>(<span class="dv">20200205</span>)</span>
<span id="cb2-36"><a href="#cb2-36"></a></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co"># fit the model</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>state_data_kmeans <span class="ot">&lt;-</span> state_kmeans_wflow <span class="sc">|&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>  <span class="fu">fit</span>(<span class="at">data =</span> state_data)</span>
<span id="cb2-40"><a href="#cb2-40"></a></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co"># view the model results</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="fu">tidy</span>(state_data_kmeans) <span class="sc">|&gt;</span></span>
<span id="cb2-43"><a href="#cb2-43"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">hhpop</th>
<th style="text-align: right;">horate</th>
<th style="text-align: right;">medhhincome</th>
<th style="text-align: right;">size</th>
<th style="text-align: right;">withinss</th>
<th style="text-align: left;">cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="example-2-1" class="level4">
<h4 class="anchored" data-anchor-id="example-2-1">Example 2</h4>
<p>Recall the votes data set from the previous tutorial.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>votes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, </span>
<span id="cb3-2"><a href="#cb3-2"></a>                             <span class="st">"votes.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 100 Columns: 495
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (2): name, party
dbl (493): v1, v2, v3, v4, v5, v6, v7, v8, v9, v10, v11, v12, v13, v14, v15,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>kmeans_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="at">formula =</span> <span class="sc">~</span> ., </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="at">data =</span> votes</span>
<span id="cb5-4"><a href="#cb5-4"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">step_select</span>(<span class="fu">all_numeric</span>()) </span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a>rec_pca <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="at">formula =</span> <span class="sc">~</span> ., </span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="at">data =</span> votes</span>
<span id="cb5-10"><a href="#cb5-10"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">step_pca</span>(<span class="fu">all_numeric</span>(), <span class="at">id =</span> <span class="st">"pca"</span>) </span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>votes_pca <span class="ot">&lt;-</span> rec_pca <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="fu">prep</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> votes)</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co"># calculate pct variance explained by components</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co"># the first two components explain 45% and 29% of the variance</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>rec_pca <span class="sc">|&gt;</span> </span>
<span id="cb5-20"><a href="#cb5-20"></a>  <span class="fu">prep</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-21"><a href="#cb5-21"></a>  <span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="fu">filter</span>(terms <span class="sc">==</span> <span class="st">"variance"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23"></a>  <span class="fu">mutate</span>(<span class="at">pct_var =</span> value<span class="sc">/</span><span class="fu">sum</span>(value)) <span class="sc">|&gt;</span></span>
<span id="cb5-24"><a href="#cb5-24"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  terms    value component id    pct_var
  &lt;chr&gt;    &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
1 variance  217.         1 pca     0.450
2 variance  142.         2 pca     0.294</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># create a kmeans model object with two clusters</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>kmeans_spec <span class="ot">&lt;-</span> <span class="fu">k_means</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="at">num_clusters =</span> <span class="dv">2</span> <span class="co"># number of clusters</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">set_engine</span>(</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="st">"stats"</span>, </span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="at">nstart =</span> <span class="dv">100</span> <span class="co"># number of random starts</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  ) </span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co"># create a workflow</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>kmeans_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(</span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="at">preprocessor =</span> kmeans_rec, </span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="at">spec =</span> kmeans_spec</span>
<span id="cb7-14"><a href="#cb7-14"></a>)</span>
<span id="cb7-15"><a href="#cb7-15"></a></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co"># fit the model</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>votes_kmeans_2 <span class="ot">&lt;-</span> kmeans_wflow <span class="sc">|&gt;</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="fu">fit</span>(<span class="at">data =</span> votes)</span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="fu">bind_cols</span>(</span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="fu">select</span>(votes, name, party),</span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="at">cluster =</span> votes_kmeans_2 <span class="sc">|&gt;</span> </span>
<span id="cb7-23"><a href="#cb7-23"></a>    <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="fu">pull</span>(.cluster)</span>
<span id="cb7-25"><a href="#cb7-25"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="fu">count</span>(party, cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  party cluster       n
  &lt;chr&gt; &lt;fct&gt;     &lt;int&gt;
1 D     Cluster_2    44
2 I     Cluster_2     2
3 R     Cluster_1    54</code></pre>
</div>
</div>
<p>We see that the estimated clusters fit the party variable even though it wasn’t included in the model.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Latent variable
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Latent variable (hidden variable):</strong> An unobserved variable inferred through statistical methods.</p>
</div>
</div>
<p>Suppose we didn’t known party. Then cluster analysis is the process of trying to discover a latent variable or latent groups in the data. In general, cluster analyses will be much tidier if there is a strong latent process driving the latent groups. For example, imagine latent groups for children, women, and men when looking at heights and weights without observing age or sex.</p>
<p>In addition to identifying data and variables that capture latent structure in our data, we also need to choose how many latent groups are in the data! Consider the above example with 3 groups:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># create a kmeans model object with three clusters</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>kmeans_spec <span class="ot">&lt;-</span> kmeans_spec <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">set_args</span>(<span class="at">num_clusters =</span> <span class="dv">3</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># create a workflow</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>kmeans_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(</span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="at">preprocessor =</span> kmeans_rec, </span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="at">spec =</span> kmeans_spec</span>
<span id="cb9-9"><a href="#cb9-9"></a>)</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co"># fit the model</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>votes_kmeans_3 <span class="ot">&lt;-</span> kmeans_wflow <span class="sc">|&gt;</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="fu">fit</span>(<span class="at">data =</span> votes)</span>
<span id="cb9-14"><a href="#cb9-14"></a></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="fu">bind_cols</span>(</span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="fu">select</span>(votes, name, party),</span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="at">cluster =</span> votes_kmeans_3 <span class="sc">|&gt;</span> </span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="fu">pull</span>(.cluster)</span>
<span id="cb9-20"><a href="#cb9-20"></a>) <span class="sc">|&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="fu">count</span>(party, cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  party cluster       n
  &lt;chr&gt; &lt;fct&gt;     &lt;int&gt;
1 D     Cluster_2    44
2 I     Cluster_2     2
3 R     Cluster_1    31
4 R     Cluster_3    23</code></pre>
</div>
</div>
</section>
</section>
<section id="picking-the-number-of-clusters" class="level3" data-number="23.2.3">
<h3 data-number="23.2.3" class="anchored" data-anchor-id="picking-the-number-of-clusters"><span class="header-section-number">23.2.3</span> Picking the number of clusters</h3>
<p>The main considerations when picking a number of clusters are theory and application. Is the objective to find three archetypal communities? Does the visualization need five groups?</p>
<p>Beyond theory and application, there are analytic measures that can help determine the optimal number of clusters. The best number of clusters usually can be picked with the “elbow method” by choosing the number where a kink occurs in the following plots. We can <code>tune()</code> the number of clusters in <code>library(tidyclust)</code> similar to the approach we learned to tune model hyperparameters in <code>library(tidymodels)</code>.</p>
<p>Consider the votes data where there are two clear clusters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># set up cross-validation</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>votes_cv <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(votes, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>kmeans_spec <span class="ot">&lt;-</span> <span class="fu">k_means</span>(</span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="at">num_clusters =</span> <span class="fu">tune</span>() <span class="co"># set hyperparameter tuning for number of clusters</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">set_engine</span>(</span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="st">"stats"</span>, </span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="at">nstart =</span> <span class="dv">100</span> <span class="co"># number of random starts</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  ) </span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co"># create a workflow</span></span>
<span id="cb11-13"><a href="#cb11-13"></a>kmeans_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(</span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="at">preprocessor =</span> kmeans_rec, </span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="at">spec =</span> kmeans_spec</span>
<span id="cb11-16"><a href="#cb11-16"></a>)</span>
<span id="cb11-17"><a href="#cb11-17"></a></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># create tuning grid</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>clust_num_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="fu">num_clusters</span>(), </span>
<span id="cb11-21"><a href="#cb11-21"></a>  <span class="at">levels =</span> <span class="dv">10</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>)</span>
<span id="cb11-23"><a href="#cb11-23"></a></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co"># see the tuning grid</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>clust_num_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
   num_clusters
          &lt;int&gt;
 1            1
 2            2
 3            3
 4            4
 5            5
 6            6
 7            7
 8            8
 9            9
10           10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># tune grid</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>res <span class="ot">&lt;-</span> <span class="fu">tune_cluster</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>  kmeans_wflow,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="at">resamples =</span> votes_cv,</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="at">grid =</span> clust_num_grid,</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">extract =</span> identity),</span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="at">metrics =</span> <span class="fu">cluster_metric_set</span>(sse_within_total, silhouette_avg)</span>
<span id="cb13-8"><a href="#cb13-8"></a>) </span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co"># collect metrics</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>res_metrics <span class="ot">&lt;-</span> res <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="total-within-sum-of-squares" class="level4">
<h4 class="anchored" data-anchor-id="total-within-sum-of-squares">Total within sum of squares</h4>
<p>The simplest measure is total within sum of squares. This is simply the sum of squared errors within groups, which should monotonically decrease as the number of clusters increases.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>res_metrics <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"sse_within_total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_clusters, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-8"><a href="#cb14-8"></a>    <span class="at">x =</span> <span class="st">"Number of clusters"</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a>    <span class="at">y =</span> <span class="st">"mean WSS over 5 folds"</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>  ) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="average-silhouette-width" class="level4">
<h4 class="anchored" data-anchor-id="average-silhouette-width">Average silhouette width</h4>
<p>The silhouette score is an observation-level measure of cohesion within an observation’s group and separation from the closest group. It ranges from -1 to +1, with higher numbers representing better clusters. Negative numbers suggest that an observation has been assigned to an incorrect cluster. 0 indicates that an observation is on the boundary.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>res_metrics <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"silhouette_avg"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_clusters, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="at">x =</span> <span class="st">"Number of clusters"</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">y =</span> <span class="st">"avg silhouette width over 5 folds"</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>  ) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gap-statistics" class="level4">
<h4 class="anchored" data-anchor-id="gap-statistics">Gap statistics</h4>
<p>The gap statistic <span class="citation" data-cites="gapstat">(<a href="references.html#ref-gapstat" role="doc-biblioref"><strong>gapstat?</strong></a>)</span> compares the change in within-cluster dispersion with a reference null distribution that represents data without clear clusters. Higher numbers are better. It takes the longest to calculate because it requires Monte Carlo simulations (bootstrapping) to calculate the null distribution. The gap statistic is not yet implemented within <code>library(tidyclust)</code>, so we use <code>library(factoextra)</code> to calculate the gap statistic. Note that this function fits the cluster model and calculates the metric.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>votes_numeric <span class="ot">&lt;-</span> kmeans_rec <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">prep</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> votes)</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">fviz_nbclust</span>(votes_numeric, <span class="at">FUN =</span> kmeans, <span class="at">method =</span> <span class="st">"gap_stat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>kmeans_spec <span class="ot">&lt;-</span> <span class="fu">k_means</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="at">num_clusters =</span> <span class="dv">5</span> <span class="co"># number of clusters</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">set_engine</span>(</span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="st">"stats"</span>, </span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="at">nstart =</span> <span class="dv">100</span> <span class="co"># number of random starts</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  ) </span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># create a workflow</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>kmeans_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(</span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="at">preprocessor =</span> kmeans_rec, </span>
<span id="cb17-12"><a href="#cb17-12"></a>  <span class="at">spec =</span> kmeans_spec</span>
<span id="cb17-13"><a href="#cb17-13"></a>)</span>
<span id="cb17-14"><a href="#cb17-14"></a></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="co"># fit the model</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>votes_kmeans_5 <span class="ot">&lt;-</span> kmeans_wflow <span class="sc">|&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="fu">fit</span>(<span class="at">data =</span> votes)</span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a>votes_clusters <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb17-20"><a href="#cb17-20"></a>  <span class="fu">select</span>(votes, name, party),</span>
<span id="cb17-21"><a href="#cb17-21"></a>  <span class="fu">select</span>(votes_pca, PC1, PC2),</span>
<span id="cb17-22"><a href="#cb17-22"></a>  <span class="at">cluster2 =</span> votes_kmeans_2 <span class="sc">|&gt;</span> </span>
<span id="cb17-23"><a href="#cb17-23"></a>    <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-24"><a href="#cb17-24"></a>    <span class="fu">pull</span>(.cluster),</span>
<span id="cb17-25"><a href="#cb17-25"></a>  <span class="at">cluster5 =</span> votes_kmeans_5 <span class="sc">|&gt;</span> </span>
<span id="cb17-26"><a href="#cb17-26"></a>    <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-27"><a href="#cb17-27"></a>    <span class="fu">pull</span>(.cluster)</span>
<span id="cb17-28"><a href="#cb17-28"></a>)</span>
<span id="cb17-29"><a href="#cb17-29"></a></span>
<span id="cb17-30"><a href="#cb17-30"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Bernie Sanders"</span>, <span class="st">"Ted Cruz"</span>, <span class="st">"Joe Manchin"</span>, <span class="st">"Susan Collins"</span>)</span>
<span id="cb17-31"><a href="#cb17-31"></a></span>
<span id="cb17-32"><a href="#cb17-32"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-33"><a href="#cb17-33"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb17-34"><a href="#cb17-34"></a>    <span class="at">data =</span> votes_clusters, </span>
<span id="cb17-35"><a href="#cb17-35"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> <span class="fu">factor</span>(cluster2)),</span>
<span id="cb17-36"><a href="#cb17-36"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb17-37"><a href="#cb17-37"></a>  ) <span class="sc">+</span></span>
<span id="cb17-38"><a href="#cb17-38"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb17-39"><a href="#cb17-39"></a>    <span class="at">data =</span> <span class="fu">filter</span>(votes_pca, name <span class="sc">%in%</span> names), </span>
<span id="cb17-40"><a href="#cb17-40"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">label =</span> name)</span>
<span id="cb17-41"><a href="#cb17-41"></a>  ) <span class="sc">+</span></span>
<span id="cb17-42"><a href="#cb17-42"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb17-43"><a href="#cb17-43"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-44"><a href="#cb17-44"></a>    <span class="at">title =</span> <span class="st">"K-Means with K=2 and PCA"</span>,</span>
<span id="cb17-45"><a href="#cb17-45"></a>    <span class="at">x =</span> <span class="st">"PC1 (0.45 of Variation)"</span>,</span>
<span id="cb17-46"><a href="#cb17-46"></a>    <span class="at">y =</span> <span class="st">"PC2 (0.29 of Variation)"</span></span>
<span id="cb17-47"><a href="#cb17-47"></a>  ) <span class="sc">+</span></span>
<span id="cb17-48"><a href="#cb17-48"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-49"><a href="#cb17-49"></a>  <span class="fu">guides</span>(<span class="at">text =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="at">data =</span> votes_clusters, </span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> <span class="fu">factor</span>(cluster5)),</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  ) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="at">data =</span> <span class="fu">filter</span>(votes_pca, name <span class="sc">%in%</span> names), </span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(PC1, PC2, <span class="at">label =</span> name)</span>
<span id="cb18-10"><a href="#cb18-10"></a>  ) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">title =</span> <span class="st">"K-Means with K=5 and PCA"</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="at">x =</span> <span class="st">"PC1 (0.45 of Variation)"</span>,</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="at">y =</span> <span class="st">"PC2 (0.29 of Variation)"</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  ) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="fu">guides</span>(<span class="at">text =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="additional-considerations" class="level3" data-number="23.2.4">
<h3 data-number="23.2.4" class="anchored" data-anchor-id="additional-considerations"><span class="header-section-number">23.2.4</span> Additional Considerations</h3>
<section id="picking-variables" class="level4">
<h4 class="anchored" data-anchor-id="picking-variables">Picking variables</h4>
<p>Start with a subset of numeric variables based on subject matter expertise. In general, clustering algorithms work well with all continuous variables or all recoded categorical variables. Mixing variable types is possible but requires extra care.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># load the tidyverse</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># load statedata from library(urbnmapr)</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>state_data <span class="ot">&lt;-</span> urbnmapr<span class="sc">::</span>statedata</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co"># select numeric variables other than year</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>state_data <span class="ot">&lt;-</span> state_data <span class="sc">|&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">select</span>(hhpop, horate, medhhincome) </span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(state_data), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">hhpop</th>
<th style="text-align: right;">horate</th>
<th style="text-align: right;">medhhincome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1846380</td>
<td style="text-align: right;">0.681</td>
<td style="text-align: right;">44700</td>
</tr>
<tr class="even">
<td style="text-align: right;">250183</td>
<td style="text-align: right;">0.631</td>
<td style="text-align: right;">70600</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2463012</td>
<td style="text-align: right;">0.621</td>
<td style="text-align: right;">51000</td>
</tr>
<tr class="even">
<td style="text-align: right;">1144657</td>
<td style="text-align: right;">0.655</td>
<td style="text-align: right;">42000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12895471</td>
<td style="text-align: right;">0.537</td>
<td style="text-align: right;">64600</td>
</tr>
<tr class="even">
<td style="text-align: right;">2074517</td>
<td style="text-align: right;">0.639</td>
<td style="text-align: right;">63500</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="scaling-variables" class="level4">
<h4 class="anchored" data-anchor-id="scaling-variables">Scaling variables</h4>
<p>The variable <code>hhpop</code> will swamp <code>horate</code> and <code>medhhincome</code> because of its scale. We need to put the variables on the same scale. The first option is to normalize variables by subtracting the mean and dividing by the standard deviation.</p>
<p><span class="math display">\[\tilde{x_i} = \frac{x_i - \bar{x}}{s_{x}}\]</span></p>
<p><code>step_normalize()</code> rescales variables to have mean of 0 and standard deviation of 1.</p>
<p>The second option is to min-max rescale the variable to a 0 to 1 or 0 to 100 scale.</p>
<p><span class="math display">\[\tilde{x_i} = \frac{x_i - x_{min}}{x_{max} - x_{min}}\]</span></p>
<p><code>step_range()</code> min-max rescales data to a [0, 1] range or a custom range.</p>
<p>Normalization and min-max rescaling remove units from variables and put variables on the same scale.</p>
</section>
<section id="finding-correlated-variables" class="level4">
<h4 class="anchored" data-anchor-id="finding-correlated-variables">Finding correlated variables</h4>
<p>Including highly correlated variables in a clustering algorithm will generally overweight the variability of the highly correlated variables. Use <code>cor()</code> to create a correlation matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">cor</span>(state_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  hhpop     horate medhhincome
hhpop        1.00000000 -0.2926963  0.01883672
horate      -0.29269634  1.0000000 -0.37477714
medhhincome  0.01883672 -0.3747771  1.00000000</code></pre>
</div>
</div>
<p>In the presence of highly-correlated variables, there are several options of recourse:</p>
<ol type="1">
<li>Drop all but one of the highly correlated variables.</li>
<li>Combine highly correlated variables.
<ul>
<li><code>sum()</code>, <code>mean()</code>, or principle components</li>
</ul></li>
<li>Re-weight the variables.
<ul>
<li>Duplicate all variables <code>n</code> times and add or subtract duplicates based on if the variable is correlated (i.e.&nbsp;Pearson’s correlation coefficient &gt; 0.6) or highly correlated (i.e.&nbsp;Pearson’s correlation coefficient &gt; 0.9).</li>
</ul></li>
<li>Use dimension reduction techniques like PCA.</li>
</ol>
</section>
</section>
<section id="diagnostics" class="level3" data-number="23.2.5">
<h3 data-number="23.2.5" class="anchored" data-anchor-id="diagnostics"><span class="header-section-number">23.2.5</span> Diagnostics</h3>
<p>Consider the k-means clusters from the states data.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">hhpop</th>
<th style="text-align: right;">horate</th>
<th style="text-align: right;">medhhincome</th>
<th style="text-align: right;">size</th>
<th style="text-align: right;">withinss</th>
<th style="text-align: left;">cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.91</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.71</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are several ways that we can evaluate the quality of the clusters after the fact.</p>
<section id="expert-check" class="level4">
<h4 class="anchored" data-anchor-id="expert-check">Expert check</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  state_data,</span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="at">cluster =</span> state_data_kmeans <span class="sc">|&gt;</span> <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(.cluster)</span>
<span id="cb22-4"><a href="#cb22-4"></a>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">summarize</span>(</span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="fu">mean</span>(hhpop),</span>
<span id="cb22-8"><a href="#cb22-8"></a>    <span class="fu">mean</span>(horate),</span>
<span id="cb22-9"><a href="#cb22-9"></a>    <span class="fu">mean</span>(medhhincome)</span>
<span id="cb22-10"><a href="#cb22-10"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">cluster</th>
<th style="text-align: right;">mean(hhpop)</th>
<th style="text-align: right;">mean(horate)</th>
<th style="text-align: right;">mean(medhhincome)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Cluster_1</td>
<td style="text-align: right;">1895957</td>
<td style="text-align: right;">0.665</td>
<td style="text-align: right;">49283.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cluster_2</td>
<td style="text-align: right;">1545705</td>
<td style="text-align: right;">0.653</td>
<td style="text-align: right;">65555.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cluster_3</td>
<td style="text-align: right;">9253386</td>
<td style="text-align: right;">0.579</td>
<td style="text-align: right;">57250.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cluster_4</td>
<td style="text-align: right;">281788</td>
<td style="text-align: right;">0.402</td>
<td style="text-align: right;">75000.00</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="stability-sensitivity-analysis" class="level4">
<h4 class="anchored" data-anchor-id="stability-sensitivity-analysis">Stability (sensitivity analysis)</h4>
<p>It is important to conduct a stability (sensitivity) analysis, in which the final specification of the cluster analysis is run <span class="math inline">\(p\)</span> times, where <span class="math inline">\(p\)</span> is the number of variables in the cluster analysis, each time removing one variable and checking how many observations remain in similar groups as a result.</p>
</section>
</section>
<section id="visualizing-clusters-with-a-scatter-plot-matrix" class="level3" data-number="23.2.6">
<h3 data-number="23.2.6" class="anchored" data-anchor-id="visualizing-clusters-with-a-scatter-plot-matrix"><span class="header-section-number">23.2.6</span> Visualizing clusters with a scatter plot matrix</h3>
<p>A scatter plot matrix allows for the pairwise comparison of all numeric variables. Adding cluster membership as colors shows the membership of each point in the scatter plots.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Scatter plot matrices become unwieldy with many variables or many observations. If there are too many observations or too many variables, visualize a representative subset.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every cluster need not differ by every variable for a meaningful multivariate grouping to exist.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co">#add cluster membership to the origin data</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="fu">bind_cols</span>(</span>
<span id="cb23-5"><a href="#cb23-5"></a>  state_data,</span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="at">cluster =</span> state_data_kmeans <span class="sc">|&gt;</span> <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(.cluster)</span>
<span id="cb23-7"><a href="#cb23-7"></a>) <span class="sc">|&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">filter</span>(cluster <span class="sc">!=</span> <span class="st">"Cluster_4"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="co"># create a scatter plot matrix</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb23-11"><a href="#cb23-11"></a>    <span class="at">columns =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb23-12"><a href="#cb23-12"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cluster)),</span>
<span id="cb23-13"><a href="#cb23-13"></a>    <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"densityDiag"</span>,</span>
<span id="cb23-14"><a href="#cb23-14"></a>                                  <span class="at">alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb23-15"><a href="#cb23-15"></a>                                  <span class="at">color =</span> <span class="cn">NA</span>))</span>
<span id="cb23-16"><a href="#cb23-16"></a>  ) <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="visualizing-clusters-with-pca" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-clusters-with-pca">Visualizing clusters with PCA</h4>
<p>A scatter plot matrix requires <span class="math inline">\(\frac{p(p - 1)}{2}\)</span> plots to show <span class="math inline">\(p\)</span> variables. This can quickly grow unwieldy.</p>
<p>We can use PCA to plot much of the variation in the data in two dimensions. The output shows that the first two components cumulatively explain more than 90% of variation in the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># run PCA</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>rec_pca <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="at">formula =</span> <span class="sc">~</span> ., </span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="at">data =</span> state_data_numeric</span>
<span id="cb24-5"><a href="#cb24-5"></a>) <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">step_pca</span>(<span class="fu">all_numeric</span>(), <span class="at">id =</span> <span class="st">"pca"</span>) </span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co"># calculate pct variance explained by components</span></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="co"># the first two components explain 88% and 8% of the variance</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>rec_pca <span class="sc">|&gt;</span> </span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">prep</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="fu">tidy</span>(<span class="at">id =</span> <span class="st">"pca"</span>, <span class="at">type =</span> <span class="st">"variance"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>  <span class="fu">filter</span>(terms <span class="sc">==</span> <span class="st">"variance"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>  <span class="fu">mutate</span>(<span class="at">pct_var =</span> value<span class="sc">/</span><span class="fu">sum</span>(value)) <span class="sc">|&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  terms     value component id    pct_var
  &lt;chr&gt;     &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
1 variance 0.860          1 pca    0.882 
2 variance 0.0750         2 pca    0.0769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>states_pca <span class="ot">&lt;-</span> rec_pca <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>   <span class="fu">prep</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>   <span class="fu">bake</span>(<span class="at">new_data =</span> state_data_numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># create and visualize the group membership of observations in the components</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">bind_cols</span>(</span>
<span id="cb27-3"><a href="#cb27-3"></a>  states_pca,</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="at">cluster =</span> state_data_kmeans <span class="sc">|&gt;</span> <span class="fu">extract_cluster_assignment</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(.cluster)</span>
<span id="cb27-5"><a href="#cb27-5"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"State Data Clusters and PCA"</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="putting-it-all-together" class="level3" data-number="23.2.7">
<h3 data-number="23.2.7" class="anchored" data-anchor-id="putting-it-all-together"><span class="header-section-number">23.2.7</span> Putting it all together</h3>
<ol type="1">
<li>Clearly define the question of interest</li>
<li>Pick the variables that will be considered
<ul>
<li>Recode categorical variables to dummy variables</li>
<li>Rescale variables</li>
</ul></li>
<li>Check the variables for high correlations
<ul>
<li>Apply reweighting or variable selection to create a mostly uncorrelated subset</li>
</ul></li>
<li>Pick an algorithm</li>
<li>Estimate the clusters and pick an optimal number of clusters</li>
<li>Diagnostics
<ul>
<li>Expert check</li>
<li>Stability analysis</li>
<li>Visualize with PCA</li>
</ul></li>
</ol>
</section>
</section>
<section id="example-projects" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="example-projects"><span class="header-section-number">23.3</span> Example projects</h2>
<ul>
<li>Disrupting Food Insecurity (<a href="https://apps.urban.org/features/disrupting-food-insecurity/">feature</a>, <a href="https://apps.urban.org/features/disrupting-food-insecurity/Disrupting%20Food%20Insecurity%20Technical%20Appendix.pdf">technical appendix</a>)
<ul>
<li>This is a good example of explaining the clusters after assigning cluster membership.</li>
</ul></li>
<li>Residential Mobility and Neighborhood Change: Real Neighborhoods Under the Microscope (<span class="citation" data-cites="change14real">(<a href="references.html#ref-change14real" role="doc-biblioref"><strong>change14real?</strong></a>)</span>)</li>
<li>Beyond Red vs.&nbsp;Blue: The Political Typology (<a href="https://www.people-press.org/2014/06/26/the-political-typology-beyond-red-vs-blue/">blog</a>)</li>
<li><a href="https://www.nber.org/system/files/working_papers/w27734/w27734.pdf">Who Profits from Amateurism? Rent Sharing in Modern College Sports</a> Page 52</li>
</ul>
<div style="page-break-after: always;"></div>
</section>
<section id="appendix" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="appendix"><span class="header-section-number">23.4</span> Appendix</h2>
<section id="partition-based-algorithms" class="level4">
<h4 class="anchored" data-anchor-id="partition-based-algorithms">Partition-based algorithms</h4>
<p><a href="https://uc-r.github.io/kmeans_clustering">This blog post</a> is a thorough background on K-means clustering.</p>
</section>
<section id="hierarchical-models" class="level4">
<h4 class="anchored" data-anchor-id="hierarchical-models">Hierarchical models</h4>
<p>Agglomerative hierarchical clustering: Each element starts as a single-element cluster and are combined into bigger clusters.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">library</span>(cluster)   </span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb28-3"><a href="#cb28-3"></a></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co"># specify hierarchical cluster model</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>state_hier_spec <span class="ot">&lt;-</span> <span class="fu">hier_clust</span>(</span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="at">num_clusters =</span> <span class="dv">4</span>,</span>
<span id="cb28-7"><a href="#cb28-7"></a>  <span class="at">linkage_method =</span> <span class="st">"average"</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="fu">set_engine</span>(<span class="st">"stats"</span>)</span>
<span id="cb28-10"><a href="#cb28-10"></a></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co"># fit the model</span></span>
<span id="cb28-12"><a href="#cb28-12"></a>hc_fit <span class="ot">&lt;-</span> state_hier_spec <span class="sc">|&gt;</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>  <span class="fu">fit</span>(<span class="sc">~</span> ., <span class="at">data =</span> state_data_numeric)</span>
<span id="cb28-14"><a href="#cb28-14"></a></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co"># add state labels</span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="fu">labels</span>(hc_fit<span class="sc">$</span>fit) <span class="ot">&lt;-</span> urbnmapr<span class="sc">::</span>statedata<span class="sc">$</span>state_name[hc_fit<span class="sc">$</span>fit<span class="sc">$</span>order]</span>
<span id="cb28-17"><a href="#cb28-17"></a></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="co"># create a dendrogram of the clusters</span></span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="fu">plot</span>(</span>
<span id="cb28-20"><a href="#cb28-20"></a>  hc_fit<span class="sc">$</span>fit,</span>
<span id="cb28-21"><a href="#cb28-21"></a>  <span class="at">cex =</span> <span class="fl">0.6</span>,</span>
<span id="cb28-22"><a href="#cb28-22"></a>  <span class="at">hang =</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb28-23"><a href="#cb28-23"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="26_unsupervised-ml-cluster-analysis_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Use <code>cutree()</code> to pick a height and assign group membership to observations based on the height. The height should be determined by the number of desired clusters.</p>
<p>Divisive hierarchical clustering begins with a single cluster and divides it into smaller clusters. Agglomerative hierarchical clusters is good at finding small groups. Divisive hierarchical clustering is good at finding large groups. Divisive hierarchical clustering is not currently implemented in <code>library(tidyclust)</code>. It can be run using the <code>diana()</code> (for Divisive Analysis) function in <code>library(cluster)</code>.</p>
<p><a href="https://uc-r.github.io/hc_clustering">This blog post</a> is a good deeper dive into hierarchical clustering.</p>
</section>
<section id="density-based-algorithms" class="level4">
<h4 class="anchored" data-anchor-id="density-based-algorithms">Density-based algorithms</h4>
<p>DBSCAN can be implemented with <code>library(dbscan)</code>.</p>
<p><a href="https://www.youtube.com/watch?v=h53WMIImUuc">Animation of DBScan</a></p>
</section>
<section id="model-based-algorithms" class="level4">
<h4 class="anchored" data-anchor-id="model-based-algorithms">Model-based algorithms</h4>
<p>Gaussian Mixture Modeling can be implemented with <code>library(mclust)</code>. <a href="https://towardsdatascience.com/mixture-modelling-from-scratch-in-r-5ab7bfc83eef">This blog</a> is a thorough introduction.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./25_dimension-reduction.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./27_advanced-unsupervised-ml.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>