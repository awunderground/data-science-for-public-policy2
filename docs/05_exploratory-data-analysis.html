<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 5&nbsp; Exploratory Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_reproducible-research-with-quarto.html" rel="next">
<link href="./04_data-viz.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_intro-r.html">Basics</a></li><li class="breadcrumb-item"><a href="./05_exploratory-data-analysis.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25_dimension-reduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Dimension Reduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_unsupervised-ml-cluster-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Cluster Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#reading-in-data" id="toc-reading-in-data" class="nav-link active" data-scroll-target="#reading-in-data"><span class="header-section-number">5.1</span> Reading in Data</a>
  <ul class="collapse">
  <li><a href="#excel-spreadsheets" id="toc-excel-spreadsheets" class="nav-link" data-scroll-target="#excel-spreadsheets"><span class="header-section-number">5.1.1</span> Excel Spreadsheets</a></li>
  <li><a href="#stata-sas-and-spss-files" id="toc-stata-sas-and-spss-files" class="nav-link" data-scroll-target="#stata-sas-and-spss-files"><span class="header-section-number">5.1.2</span> STATA, SAS, and SPSS files</a></li>
  <li><a href="#zip-files" id="toc-zip-files" class="nav-link" data-scroll-target="#zip-files"><span class="header-section-number">5.1.3</span> Zip Files</a></li>
  </ul></li>
  <li><a href="#column-names" id="toc-column-names" class="nav-link" data-scroll-target="#column-names"><span class="header-section-number">5.2</span> Column Names</a></li>
  <li><a href="#data-overview" id="toc-data-overview" class="nav-link" data-scroll-target="#data-overview"><span class="header-section-number">5.3</span> Data Overview</a></li>
  <li><a href="#are-my-columns-the-right-types" id="toc-are-my-columns-the-right-types" class="nav-link" data-scroll-target="#are-my-columns-the-right-types"><span class="header-section-number">5.4</span> Are my columns the right types?</a>
  <ul class="collapse">
  <li><a href="#string-manipulation-with-stringr" id="toc-string-manipulation-with-stringr" class="nav-link" data-scroll-target="#string-manipulation-with-stringr"><span class="header-section-number">5.4.1</span> String manipulation with <code>stringr</code></a></li>
  <li><a href="#date-manipulation-with-lubridate" id="toc-date-manipulation-with-lubridate" class="nav-link" data-scroll-target="#date-manipulation-with-lubridate"><span class="header-section-number">5.4.2</span> Date manipulation with <code>lubridate</code></a></li>
  <li><a href="#categorical-and-factor-variables" id="toc-categorical-and-factor-variables" class="nav-link" data-scroll-target="#categorical-and-factor-variables"><span class="header-section-number">5.4.3</span> Categorical and Factor Variables</a></li>
  </ul></li>
  <li><a href="#is-there-missing-data" id="toc-is-there-missing-data" class="nav-link" data-scroll-target="#is-there-missing-data"><span class="header-section-number">5.5</span> Is there missing data?</a></li>
  <li><a href="#do-i-have-outliers-or-unexpected-values" id="toc-do-i-have-outliers-or-unexpected-values" class="nav-link" data-scroll-target="#do-i-have-outliers-or-unexpected-values"><span class="header-section-number">5.6</span> Do I have outliers or unexpected values?</a>
  <ul class="collapse">
  <li><a href="#identifying-outliersunexpected-values" id="toc-identifying-outliersunexpected-values" class="nav-link" data-scroll-target="#identifying-outliersunexpected-values"><span class="header-section-number">5.6.1</span> Identifying Outliers/Unexpected Values</a></li>
  <li><a href="#unit-tests" id="toc-unit-tests" class="nav-link" data-scroll-target="#unit-tests"><span class="header-section-number">5.6.2</span> Unit Tests</a></li>
  <li><a href="#handling-outliersunexpected-values" id="toc-handling-outliersunexpected-values" class="nav-link" data-scroll-target="#handling-outliersunexpected-values"><span class="header-section-number">5.6.3</span> Handling Outliers/Unexpected Values</a></li>
  </ul></li>
  <li><a href="#data-quality-assurance" id="toc-data-quality-assurance" class="nav-link" data-scroll-target="#data-quality-assurance"><span class="header-section-number">5.7</span> Data Quality Assurance</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5.8</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    This chapter introduces exploratory data analysis (EDA), an essential process for data scientists and researchers to use to understand their data.
  </div>
</div>

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/header-images/Bruce_McCandless_II_during_EVA_in_1984.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Bruce McCandless II in space in 1984.</figcaption>
</figure>
</div>
<section id="reading-in-data" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="reading-in-data"><span class="header-section-number">5.1</span> Reading in Data</h2>
<p>We’ve already covered reading in csv files using the <code>read_csv()</code> function from the <code>readr</code> package, but you may also need to read in data that is stored in a number of other common file formats:</p>
<section id="excel-spreadsheets" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="excel-spreadsheets"><span class="header-section-number">5.1.1</span> Excel Spreadsheets</h3>
<p>We introduced <a href="https://readxl.tidyverse.org/">readxl</a> in <a href="03_advanced-data-cleaning.html#sec-readxl"><span>Section&nbsp;3.2.2</span></a>. As a reminder, it is not a core tidyverse package, so it needs to be explicitly loaded in each R session.</p>
<p>Many excel files can be read with the simple syntax <code>data &lt;- read_excel(path = "relative/file/path/to/data")</code>. In cases where the Excel spreadsheet contains multiple sheets, you can use the <code>sheet</code> argument to specify the sheet to read as a string (the name of the sheet) or an integer (the position of the sheet). You can also read only components of a sheet using Excel-style cell-ranges (ex: <code>A3:L44</code>).</p>
</section>
<section id="stata-sas-and-spss-files" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="stata-sas-and-spss-files"><span class="header-section-number">5.1.2</span> STATA, SAS, and SPSS files</h3>
<p><a href="https://haven.tidyverse.org/">haven</a> is a tidyverse package for reading data from SAS (<code>read_sas()</code>), STATA (<code>read_dta()</code>), and SPSS (<code>read_sav()</code>) files. Like the <code>readxl</code> package, it is not a core tidyverse package and also needs to be explicitly loaded in each R session.</p>
<p>Note that the haven package can only read and write STATA <code>.dta</code> files through version 15 of STATA. For files created in more recent versions of STATA, the <code>readstat13</code> package’s <code>read.dta13</code> file can be used.</p>
</section>
<section id="zip-files" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="zip-files"><span class="header-section-number">5.1.3</span> Zip Files</h3>
<p>You may also want to read in data that is saved in a zip file. In order to do this, you can use the <code>unzip()</code> function to unzip the files using the following syntax: <code>unzip(zipfile = "path/to/zip/file", exdir = "path/to/directory/for/unzipped/files")</code>.</p>
<p>Often times, you may want to read in a zip file from a website into R. In order to do this, you will need to first download the zip file to your computer using the <code>download.file()</code> function, unzip the file using <code>unzip()</code> and then read in the data using the appropriate function for the given file type.</p>
<p>To download the week 40 public use file data for the Census Household Pulse Survey, run the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/programs-surveys/demo/datasets/hhp/"</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>week_url <span class="ot">&lt;-</span> <span class="st">"2021/wk40/HPS_Week40_PUF_CSV.zip"</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>pulse_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, week_url)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># creates data directory in working directory</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># gives warning if directory already exists</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">dir.create</span>(<span class="st">"data"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># For Mac, *.nix systems:</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">download.file</span>(</span>
<span id="cb1-12"><a href="#cb1-12"></a>  pulse_url, </span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="at">destfile =</span> <span class="st">"data/pulse40.zip"</span></span>
<span id="cb1-14"><a href="#cb1-14"></a>)</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># For Windows systems, you need to add the mode = "wb" </span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co"># argument to prevent an invalid zip file </span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="fu">download.file</span>(</span>
<span id="cb1-19"><a href="#cb1-19"></a>  pulse_url, </span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="at">destfile =</span> <span class="st">"data/pulse40.zip"</span>, </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="at">mode =</span> <span class="st">"wb"</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Copy and paste the code chunk above and keep the appropriate <code>download.file</code> command for your computer.</li>
<li>Write code using the <code>unzip()</code> function to unzip the zip file downloaded. Set <code>zipfile</code> to be the same the <code>destfile</code> parameter you used in part 1. Set <code>exdir</code> to be the same directory where you just downloaded the zip file. Run both of these commands.</li>
<li>Examine the unzipped files and select the appropriate function to read in the <code>pulse2021_puf_40</code> file. Write code to read that file into R, assigning the output to the <code>pulse</code> object.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="column-names" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="column-names"><span class="header-section-number">5.2</span> Column Names</h2>
<p>As discussed earlier in the course, dataframe columns - like other objects - should be given names that are <a href="https://style.tidyverse.org/syntax.html#object-names">“concise and meaningful”</a>. Generally column names should be nouns and only use lowercase letters, numbers, and underscores <code>_</code> (this is referred to as snake case). Columns should not begin with numbers. You should not include white space in column names (e.g “Birth Month” = bad, “birth_month” = good). It is also best practice for column names to be singular (use “birth_month” instead of “birth_months”).</p>
<p>The <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html">janitor package</a> is a package that contains a number of useful functions to clean data in accordance with the tidyverse principles. One such function is the <code>clean_names()</code> function, which converts column names to snake case according to the tidyverse type guide (along with some other useful cleaning functions outlined in the link above). The <code>clean_names()</code> function works well with the <code>|&gt;</code> operator.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Take a look at the column names in the Pulse data file you read in for the exercise earlier.</li>
<li>Then edit the command in the R script that you wrote to read in the CSV file to pipe the results of that command to the <code>janitor::clean_names()</code> function. Note that you may have to install and import the janitor package first.</li>
<li>Now look at the column names again after running the modified command. How have they changed?</li>
</ol>
</div>
</div>
<p>As discussed in the introduction to the tidyverse, you can also directly rename columns using the <code>rename()</code> function from the <code>dplyr</code> package as follows: <code>rename(data, new_col = old_col)</code>.</p>
</section>
<section id="data-overview" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="data-overview"><span class="header-section-number">5.3</span> Data Overview</h2>
<p>Once you’ve imported your data, a common first step is to get a very high-level summary of your data.</p>
<p>As introduced in the introduction to the tidyverse, the <code>glimpse()</code> function provides a quick view of your data, printing the type and first several values of each column in the dataset to the console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">glimpse</span>(<span class="at">x =</span> storms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 19,537
Columns: 13
$ name                         &lt;chr&gt; "Amy", "Amy", "Amy", "Amy", "Amy", "Amy",…
$ year                         &lt;dbl&gt; 1975, 1975, 1975, 1975, 1975, 1975, 1975,…
$ month                        &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,…
$ day                          &lt;int&gt; 27, 27, 27, 27, 28, 28, 28, 28, 29, 29, 2…
$ hour                         &lt;dbl&gt; 0, 6, 12, 18, 0, 6, 12, 18, 0, 6, 12, 18,…
$ lat                          &lt;dbl&gt; 27.5, 28.5, 29.5, 30.5, 31.5, 32.4, 33.3,…
$ long                         &lt;dbl&gt; -79.0, -79.0, -79.0, -79.0, -78.8, -78.7,…
$ status                       &lt;fct&gt; tropical depression, tropical depression,…
$ category                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wind                         &lt;int&gt; 25, 25, 25, 25, 25, 25, 25, 30, 35, 40, 4…
$ pressure                     &lt;int&gt; 1013, 1013, 1013, 1013, 1012, 1012, 1011,…
$ tropicalstorm_force_diameter &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ hurricane_force_diameter     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
<p>The <code>summary()</code> function enables you to quickly understand the distribution of a numeric or categorical variable. For a numeric variable, summary() will return the minimum, first quartile, median, mean, third quartile, and max values. For a categorical (or factor) variable, summary() will return the number of observations in each category. If you pass a dataframe to summary() it will summarize every column in the dataframe. You can also call summary on a single variable as shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">summary</span>(storms<span class="sc">$</span>wind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  10.00   30.00   45.00   50.05   65.00  165.00 </code></pre>
</div>
</div>
<p>The <code>str()</code> function compactly displays the internal structure of any R object. If you pass a dataframe to <code>str</code> it will print the column type and first several values for each column in the dataframe, similar to the <code>glimpse()</code> function.</p>
<p>Getting a high-level overview of the data can help you identify what questions you need to ask of your data during the exploratory data analysis process. The rest of this lecture will outline several questions that you should always ask when exploring your data - though this list is not exhaustive and will be informed by your specific data and analysis!</p>
</section>
<section id="are-my-columns-the-right-types" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="are-my-columns-the-right-types"><span class="header-section-number">5.4</span> Are my columns the right types?</h2>
<p>We’ll read in the population-weighted centroids for the District of Columbia exported from the Missouri Census Data Center’s <a href="https://mcdc.missouri.edu/applications/geocorr2014.html">geocorr2014 tool</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>dc_centroids <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">paste0</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="st">"https://raw.githubusercontent.com/awunderground/awunderground-data/"</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="st">"main/geocorr/geocorr2014_dc.csv"</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  )</span>
<span id="cb6-6"><a href="#cb6-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 180 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (7): county, tract, cntyname, intptlon, intptlat, pop10, afact

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">glimpse</span>(dc_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 180
Columns: 7
$ county   &lt;chr&gt; "County code", "11001", "11001", "11001", "11001", "11001", "…
$ tract    &lt;chr&gt; "Tract", "0001.00", "0002.01", "0002.02", "0003.00", "0004.00…
$ cntyname &lt;chr&gt; "County name", "District of Columbia DC", "District of Columb…
$ intptlon &lt;chr&gt; "Wtd centroid W longitude, degrees", "-77.058857", "-77.07521…
$ intptlat &lt;chr&gt; "Wtd centroid latitude, degrees", "38.909434", "38.909223", "…
$ pop10    &lt;chr&gt; "Total population (2010)", "4890", "3916", "5425", "6233", "1…
$ afact    &lt;chr&gt; "tract to tract allocation factor", "1", "1", "1", "1", "1", …</code></pre>
</div>
</div>
<p>We see that all of the columns have been read in as character vectors because the second line of the csv file has a character description of each column. By default, <code>read_csv</code> uses the first 1,000 rows of data to infer the column types of a file. We can avoid this by skipping the first two lines of the csv file and manually setting the column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">#save the column names from the dataframe</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>col_names <span class="ot">&lt;-</span> dc_centroids <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a>dc_centroids <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="fu">paste0</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="st">"https://raw.githubusercontent.com/awunderground/awunderground-data/"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="st">"main/geocorr/geocorr2014_dc.csv"</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  ),</span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="at">col_names =</span> col_names,</span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="at">skip =</span> <span class="dv">2</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 179 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): tract, cntyname
dbl (5): county, intptlon, intptlat, pop10, afact

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">glimpse</span>(dc_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 179
Columns: 7
$ county   &lt;dbl&gt; 11001, 11001, 11001, 11001, 11001, 11001, 11001, 11001, 11001…
$ tract    &lt;chr&gt; "0001.00", "0002.01", "0002.02", "0003.00", "0004.00", "0005.…
$ cntyname &lt;chr&gt; "District of Columbia DC", "District of Columbia DC", "Distri…
$ intptlon &lt;dbl&gt; -77.05886, -77.07522, -77.06813, -77.07583, -77.06670, -77.05…
$ intptlat &lt;dbl&gt; 38.90943, 38.90922, 38.90803, 38.91848, 38.92316, 38.92551, 3…
$ pop10    &lt;dbl&gt; 4890, 3916, 5425, 6233, 1455, 3376, 3189, 4539, 4620, 3364, 6…
$ afact    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
</div>
</div>
<p>You can convert column types by using the <code>as.*</code> set of functions. For example, we could convert the <code>county</code> column to a character vector as follows: <code>mutate(dc_centroids, county = as.character(county))</code>. We can also set the column types when reading in the data with <code>read_csv()</code> using the <code>col_types</code> argument. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>dc_centroids <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">paste0</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="st">"https://raw.githubusercontent.com/awunderground/awunderground-data/"</span>,</span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="st">"main/geocorr/geocorr2014_dc.csv"</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  ),</span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="at">col_names =</span> col_names,</span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="at">skip =</span> <span class="dv">2</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"county"</span> <span class="ot">=</span> <span class="st">"character"</span>)</span>
<span id="cb14-9"><a href="#cb14-9"></a>)</span>
<span id="cb14-10"><a href="#cb14-10"></a></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="fu">glimpse</span>(dc_centroids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 179
Columns: 7
$ county   &lt;chr&gt; "11001", "11001", "11001", "11001", "11001", "11001", "11001"…
$ tract    &lt;chr&gt; "0001.00", "0002.01", "0002.02", "0003.00", "0004.00", "0005.…
$ cntyname &lt;chr&gt; "District of Columbia DC", "District of Columbia DC", "Distri…
$ intptlon &lt;dbl&gt; -77.05886, -77.07522, -77.06813, -77.07583, -77.06670, -77.05…
$ intptlat &lt;dbl&gt; 38.90943, 38.90922, 38.90803, 38.91848, 38.92316, 38.92551, 3…
$ pop10    &lt;dbl&gt; 4890, 3916, 5425, 6233, 1455, 3376, 3189, 4539, 4620, 3364, 6…
$ afact    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
</div>
</div>
<p>As you remember from week 1, a vector in R can only contain one data type. If R does not know how to convert a value in the vector to the given type, it may introduce NA values by coercion. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"20"</span>, <span class="st">"10"</span>, <span class="st">"10+"</span>, <span class="st">"25"</span>, <span class="st">"~8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20 10 NA 25 NA</code></pre>
</div>
</div>
<section id="string-manipulation-with-stringr" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="string-manipulation-with-stringr"><span class="header-section-number">5.4.1</span> String manipulation with <code>stringr</code></h3>
<p>Before converting column types, it is critical to clean the column values to ensure that NA values aren’t accidentally introduced by coercion. We can use the <code>stringr</code> package introduced in <a href="03_advanced-data-cleaning.html#sec-strings"><span>Section&nbsp;3.4.1</span></a> to clean character data. A few reminders:</p>
<ul>
<li>This package is part of the core tidyverse and is automatically loaded with <code>library(tidyverse)</code>.</li>
<li>The <a href="https://github.com/rstudio/cheatsheets/blob/main/strings.pdf">stringr cheat sheet</a> offers a great guide to the <code>stringr</code> functions.</li>
</ul>
<p>To demonstrate some of the <code>stringr</code> functions, let’s create a <code>state</code> column with the two digit state FIPS code for DC and a <code>geoid</code> column in the <code>dc_centroid</code> dataframe which contains the 11-digit census tract FIPS code, which can be useful for joining this dataframe with other dataframes that commonly use the FIPS code as a unique identifier. We will need to first remove the period from the <code>tract</code> column and then concatenate the <code>county</code> and <code>tract</code> columns into a <code>geoid</code> column. We can do that using <code>stringr</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>dc_centroids <span class="ot">&lt;-</span> dc_centroids <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="co">#replace first instance of pattern</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="at">tract =</span> <span class="fu">str_replace</span>(tract, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>), </span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="co">#join multiple strings into single string</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="at">geoid =</span> <span class="fu">str_c</span>(county, tract, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Copy the code above into an R script and edit it to add the creation of a variable called <code>state</code> that is equal to the first two characters of the <code>county</code> variable using the <code>str_sub()</code> function.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that the <code>str_replace()</code> function uses regular expressions to match the pattern that gets replaced. Regular expressions is a concise and flexible tool for describing patterns in strings - but it’s syntax can be complex and not particularly intuitive. <a href="https://cran.r-project.org/web/packages/stringr/vignettes/regular-expressions.html">This vignette</a> provides a useful introduction to regular expressions, and when in doubt - there are plentiful Stack Overflow posts to help when you search your specific case. ChatGPT is often effective at writing regular expressions, but recall our warnings about using ChatGPT in Chapter 1.</p>
</div>
</div>
</section>
<section id="date-manipulation-with-lubridate" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="date-manipulation-with-lubridate"><span class="header-section-number">5.4.2</span> Date manipulation with <code>lubridate</code></h3>
<p>The <code>lubridate</code> package, which we introduced in <a href="03_advanced-data-cleaning.html#sec-dates"><span>Section&nbsp;3.4.3</span></a>, makes it much easier to work with dates and times in R. As a reminder, <code>lubridate</code> is part of the tidyverse, but it is not a core tidyverse package. It must be explicitly loaded in each session with <code>library(lubridate)</code>.</p>
<p>We’ll use a dataset on political violence and protest events across the continent of Africa in 2022 from the <a href="https://acleddata.com/">Armed Conflict Location &amp; Event Data Project (ACLED)</a> to illustrate the power of <code>lubridate</code>. The <code>lubridate</code> package allows users to easily and quickly parse date-time variables in a range of different formats. For example, the <code>ymd()</code> function takes a date variable in year-month-day format (e.g.&nbsp;2022-01-31) and converts it to a date-time format. The different formats are outlined in the <a href="https://lubridate.tidyverse.org/">lubridate documentation</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-2"><a href="#cb20-2"></a>acled_2022 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">paste0</span>(</span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="st">"https://raw.githubusercontent.com/awunderground/awunderground-data/"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="st">"main/acled/acled_africa_2022.csv"</span>)</span>
<span id="cb20-6"><a href="#cb20-6"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">mutate</span>(<span class="at">event_date =</span> <span class="fu">ymd</span>(event_date)) <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">select</span>(event_date, region, country, event_type, sub_event_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 22101 Columns: 29
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (15): EVENT_ID_CNTY, EVENT_TYPE, SUB_EVENT_TYPE, ACTOR1, ASSOC_ACTOR_1,...
dbl  (12): ISO, EVENT_ID_NO_CNTY, YEAR, TIME_PRECISION, INTER1, INTER2, INTE...
lgl   (1): ADMIN3
dttm  (1): EVENT_DATE

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Creating datetime columns enables the use of a number of different operations, such as filtering based on date:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>acled_2022 <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">filter</span>(event_date <span class="sc">&gt;</span> <span class="st">"2022-06-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,859 × 5
   event_date region          country event_type             sub_event_type     
   &lt;date&gt;     &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;                  &lt;chr&gt;              
 1 2022-06-04 Northern Africa Algeria Protests               Peaceful protest   
 2 2022-06-05 Northern Africa Algeria Protests               Peaceful protest   
 3 2022-06-05 Northern Africa Algeria Protests               Peaceful protest   
 4 2022-06-08 Northern Africa Algeria Protests               Peaceful protest   
 5 2022-06-09 Northern Africa Algeria Protests               Peaceful protest   
 6 2022-06-09 Northern Africa Algeria Protests               Peaceful protest   
 7 2022-06-11 Northern Africa Algeria Protests               Peaceful protest   
 8 2022-06-15 Northern Africa Algeria Strategic developments Looting/property d…
 9 2022-06-18 Northern Africa Algeria Protests               Protest with inter…
10 2022-06-19 Northern Africa Algeria Protests               Peaceful protest   
# ℹ 6,849 more rows</code></pre>
</div>
</div>
<p>Or calculating durations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>acled_2022 <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="co">#number of days into 2022 event occurred</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">mutate</span>(<span class="at">days_into_2022 =</span> event_date <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"2022-01-01"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22,101 × 6
   event_date region          country event_type sub_event_type   days_into_2022
   &lt;date&gt;     &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;            &lt;drtn&gt;        
 1 2022-01-03 Northern Africa Algeria Protests   Peaceful protest 2 days        
 2 2022-01-03 Northern Africa Algeria Protests   Peaceful protest 2 days        
 3 2022-01-04 Northern Africa Algeria Protests   Peaceful protest 3 days        
 4 2022-01-05 Northern Africa Algeria Protests   Peaceful protest 4 days        
 5 2022-01-05 Northern Africa Algeria Protests   Peaceful protest 4 days        
 6 2022-01-05 Northern Africa Algeria Protests   Peaceful protest 4 days        
 7 2022-01-05 Northern Africa Algeria Protests   Peaceful protest 4 days        
 8 2022-01-05 Northern Africa Algeria Protests   Peaceful protest 4 days        
 9 2022-01-06 Northern Africa Algeria Protests   Peaceful protest 5 days        
10 2022-01-06 Northern Africa Algeria Protests   Peaceful protest 5 days        
# ℹ 22,091 more rows</code></pre>
</div>
</div>
<p>Or extracting components of dates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>acled_2022 <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">mutate</span>(<span class="at">event_month =</span> <span class="fu">month</span>(event_date)) <span class="co">#month event occurred</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22,101 × 6
   event_date region          country event_type sub_event_type   event_month
   &lt;date&gt;     &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;                  &lt;dbl&gt;
 1 2022-01-03 Northern Africa Algeria Protests   Peaceful protest           1
 2 2022-01-03 Northern Africa Algeria Protests   Peaceful protest           1
 3 2022-01-04 Northern Africa Algeria Protests   Peaceful protest           1
 4 2022-01-05 Northern Africa Algeria Protests   Peaceful protest           1
 5 2022-01-05 Northern Africa Algeria Protests   Peaceful protest           1
 6 2022-01-05 Northern Africa Algeria Protests   Peaceful protest           1
 7 2022-01-05 Northern Africa Algeria Protests   Peaceful protest           1
 8 2022-01-05 Northern Africa Algeria Protests   Peaceful protest           1
 9 2022-01-06 Northern Africa Algeria Protests   Peaceful protest           1
10 2022-01-06 Northern Africa Algeria Protests   Peaceful protest           1
# ℹ 22,091 more rows</code></pre>
</div>
</div>
<p>Datetimes can also much more easily be plotted using <code>ggplot2</code>. For example, it is easy to visualize the distribution of events across the year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>acled_2022 <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> event_date)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="co"># each bin is 1 day</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05_exploratory-data-analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For more information on lubridate, see the <a href="https://www.rstudio.com/resources/cheatsheets/">lubridate cheat sheet</a>.</p>
<p><a href="https://r4ds.had.co.nz/dates-and-times.html">Source: R for Data Science, Ch 16</a></p>
</section>
<section id="categorical-and-factor-variables" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="categorical-and-factor-variables"><span class="header-section-number">5.4.3</span> Categorical and Factor Variables</h3>
<p>Categorical variables can be stored as characters in R. The <code>case_when()</code> function makes it very easy to create categorical variables based on other columns. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>pulse <span class="ot">&lt;-</span> pulse <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="at">hisp_rrace =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-4"><a href="#cb29-4"></a>      rrace <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"White alone, not Hispanic"</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>      rrace <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Black alone, not Hispanic"</span>,</span>
<span id="cb29-6"><a href="#cb29-6"></a>      rrace <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Asian alone, not Hispanic"</span>,</span>
<span id="cb29-7"><a href="#cb29-7"></a>      rrace <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Two or more races + Other races, not Hispanic"</span>,</span>
<span id="cb29-8"><a href="#cb29-8"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>)</span>
<span id="cb29-9"><a href="#cb29-9"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Factors are a data type specifically made to work with categorical variables. The <code>forcats</code> library in the core tidyverse is made to work with factors. Factors are particularly valuable if the values have a ordering that is not alphanumeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dec"</span>, <span class="st">"Apr"</span>, <span class="st">"Jan"</span>, <span class="st">"Mar"</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>month_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>, </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>)</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a>y1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(x1, <span class="at">levels =</span> month_levels)</span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="fu">sort</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Apr" "Dec" "Jan" "Mar"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">sort</span>(y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Jan Mar Apr Dec
Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
</div>
</div>
<p>Factors are also valuable if you want to show all possible values of the categorical variable, even when they have no observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">table</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x1
Apr Dec Jan Mar 
  1   1   1   1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">table</span>(y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y1
Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec 
  1   0   1   1   0   0   0   0   0   0   0   1 </code></pre>
</div>
</div>
</section>
</section>
<section id="is-there-missing-data" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="is-there-missing-data"><span class="header-section-number">5.5</span> Is there missing data?</h2>
<p>Before you work with any dataset, you should understand how missing values are encoded. The best place to find this information is the data dictionary - which you should always read before working with any new dataset!</p>
<p>This is particularly important because while R automatically recognizes standard missing values as NA, it doesn’t recognize non-standard encodings like numbers representing missing values, “missing”, “na”, “N/A”, etc.</p>
<p>Non-standard missing values should be converted to NA before conducting analysis. One way of doing this is with <code>mutate</code> and the <code>if_else</code> or <code>case_when</code> functions.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Go to the folder where you unzipped the Pulse data from earlier and open the data dictionary file. How does this dataset represent missing values for the <code>RECVDVACC</code> variable?</li>
<li>Using <code>mutate</code> and <code>if_else</code> or <code>case_when</code>, replace the missing values in the <code>recvdvacc</code> column with NA.</li>
</ol>
</div>
</div>
<p>Once you have converted all missing value encodings to NA, the next question you need to ask is how you want to handle missing values in your analysis. The right approach will depend on what the missing value represents and the goals of your analysis.</p>
<ul>
<li><p><em>Leave as NA</em>: This can be the best choice when the missing value truly represents a case when the true value is unknown. You will need to handle NAs by setting <code>na.rm = TRUE</code> in functions or filtering using <code>is.na()</code>. One drawback of this approach is that if the values aren’t missing at random (e.g.&nbsp;smokers may be less likely to answer survey questions about smoking habits), your results may be biased. Additionally, this can cause you to lose observations and reduce power of analyses.</p></li>
<li><p><em>Replace with 0</em>: This can be the best choice if a missing value represents a count of zero for a given entity. For example, a dataset on the number of Housing Choice Voucher tenants by zip code and quarter may have a value of NA if there were no HCV tenants in the given zip code and quarter.</p></li>
<li><p><em>Impute missing data</em>: Another approach is imputing the missing data with a reasonable value. There are a number of different imputation approaches:</p>
<ul>
<li><em>Mean/median/mode imputation</em>: Fills the missing values with the column mean or median. This approach is very easy to implement, but can artifically reduce variance in your data and be sensitive to outliers in the case of mean imputation.</li>
<li><em>Predictive imputation</em>: Fills the missing values with a predicted value based on a model that has been fit to the data or calculated probabilities based on other columns in the data. This is a more complex approach but is likely more accurate (for example, it can take into account variable correlation).</li>
</ul></li>
</ul>
<p>These alternatives are discussed in more detail in a later chapter covering data imputation.</p>
<p>The <code>replace_na()</code> function in <code>dplyr</code> is very useful for replacing NA values in one or more columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="cn">NA</span>, <span class="st">"b"</span>))</span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co"># Using replace_na to replace one column</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">replace_na</span>(x, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      x y    
  &lt;dbl&gt; &lt;chr&gt;
1     1 a    
2     2 &lt;NA&gt; 
3     0 b    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Using replace_na to replace multiple columns with different values</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="st">"unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      x y      
  &lt;dbl&gt; &lt;chr&gt;  
1     1 a      
2     2 unknown
3     0 b      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Using if_else to perform mean imputation</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(x), <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
      x y    
  &lt;dbl&gt; &lt;chr&gt;
1   1   a    
2   2   &lt;NA&gt; 
3   1.5 b    </code></pre>
</div>
</div>
</section>
<section id="do-i-have-outliers-or-unexpected-values" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="do-i-have-outliers-or-unexpected-values"><span class="header-section-number">5.6</span> Do I have outliers or unexpected values?</h2>
<section id="identifying-outliersunexpected-values" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="identifying-outliersunexpected-values"><span class="header-section-number">5.6.1</span> Identifying Outliers/Unexpected Values</h3>
<p>Using R to examine the distribution of your data is one way to identify outliers or unexpected values. For example, we can examine the distribution of the <code>bodywt</code> variable in the <code>msleep</code> dataset both by examining the mathematical distribution using the <code>summary()</code> function and visually using <code>ggplot</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">summary</span>(msleep<span class="sc">$</span>bodywt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   0.005    0.174    1.670  166.136   41.750 6654.000 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>msleep <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(bodywt, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="05_exploratory-data-analysis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="unit-tests" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="unit-tests"><span class="header-section-number">5.6.2</span> Unit Tests</h3>
<p>Writing tests in R is a great way to test that your data does not have unexpected/incorrect values. These tests can also be used to catch mistakes that can be introduced by errors in the data cleaning process. There are a number of R packages that have tools for writing tests, including:</p>
<ul>
<li><a href="https://testthat.r-lib.org/index.html">testthat</a></li>
<li><a href="https://cran.r-project.org/web/packages/assertthat/readme/README.html">assertthat</a></li>
<li><a href="https://cran.r-project.org/web/packages/assertr/vignettes/assertr.html">assertr</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="fu">library</span>(assertr)</span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">150</span>, <span class="dv">47</span>, <span class="dv">88</span>),</span>
<span id="cb47-4"><a href="#cb47-4"></a>             <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">2</span>, <span class="dv">72</span>, <span class="dv">66</span>))</span>
<span id="cb47-5"><a href="#cb47-5"></a></span>
<span id="cb47-6"><a href="#cb47-6"></a>df <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>  assertr<span class="sc">::</span><span class="fu">verify</span>(age <span class="sc">&lt;</span> <span class="dv">120</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-8"><a href="#cb47-8"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>verification [age &lt; 120] failed! (1 failure)

    verb redux_fn predicate column index value
1 verify       NA age &lt; 120     NA     2    NA</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error: assertr stopped execution</code></pre>
</div>
</div>
<p>Critically, adding the test caused the code to return an error <strong>before</strong> calculating the mean of the age variable. This is a feature, not a bug! It can prevent you from introducing errors into your analyses. Moreover, by writing a set of tests in your analysis code, you can run the same checks every time you perform the analysis which can help you catch errors caused by changes in the input data.</p>
</section>
<section id="handling-outliersunexpected-values" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="handling-outliersunexpected-values"><span class="header-section-number">5.6.3</span> Handling Outliers/Unexpected Values</h3>
<p>When you identify outliers or unexpected values, you will have to decide how you want to handle those values in your data. The proper way to handle those values will depend on the reason for the outlier value and the objectives of your analysis.</p>
<ul>
<li>If the outlier is caused by data errors, such as an implausible age or population value, you can replace the outlier values with <code>NA</code> using <code>mutate</code> and <code>if_else</code> or <code>case_when</code> as described above.</li>
<li>If the outlier represents a different population than the one you are studying - e.g.&nbsp;the different consumption behaviors of individual consumers versus wholesale business orders - you can remove it from the data.</li>
<li>You can transform the data, such as taking the natural log to reduce the variation caused by outliers.</li>
<li>You can select a different analysis method that is less sensitive to outliers, such as using the median rather than the mean to measure central tendency.</li>
</ul>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Read the column descriptions in the <a href="&quot;https://raw.githubusercontent.com/awunderground/awunderground-data/main/geocorr/geocorr2014_dc.csv&quot;">csv file for the DC centroids</a>.</li>
<li>Use one of the methods above to identify whether the <code>pop10</code> column contains any outliers. According to the <a href="https://www.census.gov/programs-surveys/geography/about/glossary.html#par_textimage_13">Census Bureau</a>, tracts generally have a population between 1,200 and 8,000 people.</li>
<li>Calculate the mean of the <code>pop10</code> column in the <code>dc_centroids</code> dataframe, but first write one test using <code>assertr::verify()</code> to test for invalid values based on the column definition.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="data-quality-assurance" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="data-quality-assurance"><span class="header-section-number">5.7</span> Data Quality Assurance</h2>
<p>Data quality assurance is the foundation of high quality analysis. Four key questions that you should always ask when considering using a dataset for analysis are:</p>
<ol type="1">
<li>Does the data suit the research question? Examine the data quality (missingness, accuracy) of key columns, the number of observations in subgroups of interest, etc.</li>
<li>Does the data accurately represent the population of interest? Think about the data generation process (e.g.&nbsp;using 311 calls or Uber ride data to measure potholes) - are any populations likely to be over or underrepresented? Use tools like Urban’s <a href="https://apps.urban.org/features/equity-data-tool/">Spatial Equity Data Tool</a> to test data for unrepresentativeness.</li>
<li>Is the data gathering reproducible? Wherever possible, eliminate manual steps to gather or process the data. This includes using reproducible processes for data ingest such as APIs or reading data directly from the website rather than manually downloading files. All edits to the data should be made programmatically (e.g.&nbsp;skipping rows when reading data rather than deleting extraneous rows manually). Document the source of the data including the URL, the date of the access, and specific metadata about the vintage.</li>
<li>How can you verify that you are accessing and using the data correctly? This may include writing tests to ensure that raw and calculated data values are plausible, comparing summary statistics against those provided in the data documentation (if applicable), published tables/statistics from the data provider, or published tables/statistics from a trusted third party.</li>
</ol>
</section>
<section id="conclusion" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.8</span> Conclusion</h2>
<p>This chapter outlined EDA in great detail. Some key reminders are: - R and the tidyverse have great packages for reading in data (<code>readr</code> for csv files, <code>readxl</code> for Excel files, <code>haven</code> for STATA, SAS, and SPSS files).</p>
<ul>
<li><code>janitor::clean_names()</code> is a great way to get your column name structure to “snake case”.</li>
<li><code>glimpse()</code> is an easy way to get summary statistics on your columns.</li>
<li><code>stringr</code> and <code>lubridate</code> can help you handle string and date manipulation, respectively.</li>
<li>There a many good options for handling missing data. Be thoughtful!</li>
<li>Unit tests are a good way to ensure your data is in an expected format.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_data-viz.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_reproducible-research-with-quarto.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>