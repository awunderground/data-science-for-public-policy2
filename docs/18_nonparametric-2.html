<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-02-25">

<title>Data Science for Public Policy - 8&nbsp; Nonparametric Inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./20_predictive-modeling-review.html" rel="next">
<link href="./17_nonparametric-1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./15_simulation-and-sampling.html">Statistics</a></li><li class="breadcrumb-item"><a href="./18_nonparametric-2.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18_nonparametric-2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Predictive Modeling Review</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Other Topics</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-review9" id="toc-sec-review9" class="nav-link active" data-scroll-target="#sec-review9"><span class="header-section-number">8.1</span> Review</a>
  <ul class="collapse">
  <li><a href="#sec-example1" id="toc-sec-example1" class="nav-link" data-scroll-target="#sec-example1"><span class="header-section-number">8.1.1</span> Example 1</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="header-section-number">8.1.2</span> Example 2</a></li>
  </ul></li>
  <li><a href="#permutation-test" id="toc-permutation-test" class="nav-link" data-scroll-target="#permutation-test"><span class="header-section-number">8.2</span> Permutation Test</a>
  <ul class="collapse">
  <li><a href="#example-1-revisited" id="toc-example-1-revisited" class="nav-link" data-scroll-target="#example-1-revisited"><span class="header-section-number">8.2.1</span> Example 1 (Revisited)</a></li>
  <li><a href="#example-2-revisited" id="toc-example-2-revisited" class="nav-link" data-scroll-target="#example-2-revisited"><span class="header-section-number">8.2.2</span> Example 2 (Revisited)</a></li>
  <li><a href="#other-techniques" id="toc-other-techniques" class="nav-link" data-scroll-target="#other-techniques"><span class="header-section-number">8.2.3</span> Other techniques</a></li>
  </ul></li>
  <li><a href="#nonparametric-bootstrap" id="toc-nonparametric-bootstrap" class="nav-link" data-scroll-target="#nonparametric-bootstrap"><span class="header-section-number">8.3</span> Nonparametric Bootstrap</a>
  <ul class="collapse">
  <li><a href="#basic-bootstrap" id="toc-basic-bootstrap" class="nav-link" data-scroll-target="#basic-bootstrap"><span class="header-section-number">8.3.1</span> Basic Bootstrap</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">8.3.2</span> Example</a></li>
  <li><a href="#sec-bias" id="toc-sec-bias" class="nav-link" data-scroll-target="#sec-bias"><span class="header-section-number">8.3.3</span> Bias</a></li>
  <li><a href="#sec-standard-errors" id="toc-sec-standard-errors" class="nav-link" data-scroll-target="#sec-standard-errors"><span class="header-section-number">8.3.4</span> Standard errors</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">8.3.5</span> Example</a></li>
  <li><a href="#sec-confidence-intervals" id="toc-sec-confidence-intervals" class="nav-link" data-scroll-target="#sec-confidence-intervals"><span class="header-section-number">8.3.6</span> Confidence intervals</a></li>
  <li><a href="#example-3" id="toc-example-3" class="nav-link" data-scroll-target="#example-3"><span class="header-section-number">8.3.7</span> Example</a></li>
  </ul></li>
  <li><a href="#more-methods" id="toc-more-methods" class="nav-link" data-scroll-target="#more-methods"><span class="header-section-number">8.4</span> More Methods</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 25, 2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    This section extends nonparametric statistics to inference and hypothesis tests using a minimal number of assumptions.
  </div>
</div>

</header>

<section id="sec-review9" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-review9"><span class="header-section-number">8.1</span> Review</h2>
<p>Statistical inference is a procedure for making judgements about population parameters using <em>data</em> and <em>assumptions</em>.</p>
<p>We’ve learned about many types of tests for statistical inference. For example, consider the following tests:</p>
<ul>
<li>One-sample t-test to determine if a population mean is different from a key value like 0.</li>
<li>Two-sample t-test to determine if two population means are different from one another.</li>
<li>ANOVA to determine if multiple population means are different from other means.</li>
<li>Two-sample F-tests to determine if two population variances are different from one another.</li>
</ul>
<p>Different tests apply in different applied situations. For example, <span class="citation" data-cites="higgins2004a">Higgins (<a href="references.html#ref-higgins2004a" role="doc-biblioref">2004</a>)</span> identifies at least four approaches to testing hypotheses:</p>
<ol type="1">
<li><strong>Use normal-theory methods like t-tests.</strong> Unfortunately, the assumptions of these tests may not be met.</li>
<li><strong>Transform data and use normal-theory methods like t-tests.</strong> Unfortunately, the assumptions of these tests may still not be met.</li>
<li><strong>Use tests based on other common distributions like the exponential distribution.</strong> There may be insufficient data to determine the form or the data may come from a difficult distribution with unknown parameters or characteristics.</li>
<li><strong>Use nonparametric statistics.</strong></li>
</ol>
<p>We use <a href="https://infer.netlify.app/"><code>library(infer)</code></a> for statistical inference in R.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><code>library(infer)</code> has a more powerful workflow for other types of tests built around four verbs:</p>
<ul>
<li><code>specify()</code> is used to specify the variable or variables of interest.</li>
<li><code>hypothesize()</code> is used to declare a null hypothesis.</li>
<li><code>generate()</code> is used to generate data from the null hypothesis using parametric and nonparametric approaches.</li>
<li><code>calculate()</code> is used to calculate the distribution of statistics from data created by <code>generate()</code> to form the null hypothesis.</li>
</ul>
<p>The four verbs can be piped together as we will see in later examples. For now, let’s focus on <code>t_test()</code>, which is a short cut for running t-tests in R.</p>
<section id="sec-example1" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="sec-example1"><span class="header-section-number">8.1.1</span> Example 1</h3>
<p>We simulate some data with 8 observations from <span class="math inline">\(X \sim N(\mu = 0, \sigma = 1)\)</span> and 8 observations from <span class="math inline">\(X \sim N(\mu = 1, \sigma = 1)\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">set.seed</span>(<span class="dv">20230402</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="st">"1"</span>, <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">8</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)),</span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="st">"2"</span>, <span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">8</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sample-t-test" class="level4">
<h4 class="anchored" data-anchor-id="sample-t-test">1-Sample T-Test</h4>
<p>Let’s start with group 1 and test if <span class="math inline">\(\mu\)</span> is statistically significantly different than 0:</p>
<p><span class="math display">\[H_0: \mu = 0\]</span></p>
<p><span class="math display">\[H_a: \mu \ne 0\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>sim_data <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">t_test</span>(<span class="at">response =</span> x, <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  statistic  t_df p_value alternative estimate lower_ci upper_ci
      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     -1.21     7   0.264 two.sided     -0.421    -1.24    0.398</code></pre>
</div>
</div>
<p>Based on the p-value and t-statistic, we have insufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> level.</p>
<p><br></p>
<p>Now, let’s work with group 2 using the same hypotheses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>sim_data <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">filter</span>(group <span class="sc">==</span> <span class="st">"2"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">t_test</span>(<span class="at">response =</span> x, <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  statistic  t_df p_value alternative estimate lower_ci upper_ci
      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1      3.01     7  0.0196 two.sided      0.954    0.205     1.70</code></pre>
</div>
</div>
<p>Based on the p-value and t-statistic, there is sufficient evidence to reject the null hypothesis in favor of the alternative hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> significance level. It is likely that the population mean, <span class="math inline">\(\mu\)</span>, for group 2 is different than 0.</p>
</section>
<section id="sample-t-test-1" class="level4">
<h4 class="anchored" data-anchor-id="sample-t-test-1">2-Sample T-Test</h4>
<p>Next, let’s implement a two-sample t-test to test if the population means from group 1 and group 2 are different.</p>
<p><span class="math display">\[H_0: \mu_1 = \mu_2\]</span></p>
<p><span class="math display">\[H_a: \mu_1 \ne \mu_2\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>sim_data <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">t_test</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="at">formula =</span> x <span class="sc">~</span> group, </span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>),</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">alternative =</span> <span class="st">"two-sided"</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  statistic  t_df p_value alternative estimate lower_ci upper_ci
      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     -2.93  13.9  0.0111 two.sided      -1.37    -2.38   -0.367</code></pre>
</div>
</div>
<p>Based on the p-value and t-statistic, there is sufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> significance level. It is likely that the population means are different.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Important assumptions support the inferences in Example 1. We will unpack these assumptions later.</p>
</div>
</div>
</section>
</section>
<section id="example-2" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="example-2"><span class="header-section-number">8.1.2</span> Example 2</h3>
<p>Let’s consider a real example from <span class="citation" data-cites="ashraf2006">Ashraf, Karlan, and Yin (<a href="references.html#ref-ashraf2006" role="doc-biblioref">2006</a>)</span>. They created a commitment savings product for a Philippine bank called SEED (Save, Earn, Enjoy Deposits). They evaluated the effect of the commitment savings product on the level of household savings (among other outcomes) using a randomized control trial (RCT). The authors shared their data on the <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/27854">Harvard Dataverse</a>. <a href="https://www.povertyactionlab.org/evaluation/commitment-savings-products-philippines#:~:text=The%20SEED%20account%20provides%20individuals,until%20the%20goal%20is%20reached.">J-PAL offers a brief summary.</a></p>
<p><code>seed.csv</code> contains simplified data from their analysis data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>seed <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"seed.csv"</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">glimpse</span>(seed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,777
Columns: 5
$ group2    &lt;chr&gt; "treatment", "control", "treatment", "control", "control", "…
$ group3    &lt;chr&gt; "treatment", "marketing", "treatment", "marketing", "control…
$ totbal    &lt;dbl&gt; 121.32, 125.19, 529.39, 101.80, 118.04, 532.69, 598.41, 548.…
$ newtotbal &lt;dbl&gt; 4.62, 0.00, 4139.34, 105.94, 0.00, 362.74, 2323.50, 373.13, …
$ balchange &lt;dbl&gt; -116.70, -125.19, 3609.95, 4.14, -118.04, -169.95, 1725.09, …</code></pre>
</div>
</div>
<section id="sample-t-test-2" class="level4">
<h4 class="anchored" data-anchor-id="sample-t-test-2">1-Sample T-Test</h4>
<p>Let’s start with a simple 1-sample T-Test to see if the population mean for change in balance after one year of the SEED accounts is statistically significantly different than zero. Our null and alternative hypotheses are</p>
<p><span class="math display">\[H_0: \mu_{\text{balance change}} = 0\]</span></p>
<p><span class="math display">\[H_a: \mu_{\text{balance change}} \ne 0\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>seed <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">t_test</span>(<span class="at">response =</span> balchange, <span class="at">mu =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  statistic  t_df p_value alternative estimate lower_ci upper_ci
      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1      2.72  1776 0.00652 two.sided       293.     81.9     503.</code></pre>
</div>
</div>
<p>We reject the null hypothesis in favor of the alternative hypothesis. We conclude that the mean change in bank account balances is different than zero.</p>
<p>We make inferences with data and assumptions. Did our assumptions hold in this case? The assumptions for a 1-sample T-Test are</p>
<ol type="1">
<li><span class="math inline">\(x_1, x_2, ..., x_n\)</span> is an IID random sample from a population.</li>
<li>The population is normally distributed or the sample size is large enough for the Central Limit Theorem to apply.</li>
</ol>
<p>Both assumptions are reasonable. We can assume that the sample is identically distributed because the sample was drawn from one population: clients of the Green Bank of Caraga. It also seems reasonable to assume that a household that received the commitment savings product did not somehow influence a control household’s level of savings. Thus the IID assumption is reasonable.</p>
<p>The study assessed more than 1,000 households, suggesting that we need not be concerned with the distribution’s normality.</p>
<p>The average doesn’t represent the experience of the average person. Maybe we want to run a statistical test on the median. Unfortunately, normal-theory statistics doesn’t give us a tool for this. This could be a big challenge based on key percentiles for the change in account balance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>seed <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="at">q =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), </span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">balchange =</span> <span class="fu">quantile</span>(balchange, <span class="at">probs =</span> q)</span>
<span id="cb12-5"><a href="#cb12-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
       q balchange
   &lt;dbl&gt;     &lt;dbl&gt;
 1   0     -2169. 
 2   0.1    -526. 
 3   0.2    -280  
 4   0.3    -191. 
 5   0.4    -117. 
 6   0.5     -63.0
 7   0.6       0  
 8   0.7       0  
 9   0.8      20.9
10   0.9     323. 
11   1    114001. </code></pre>
</div>
</div>
</section>
<section id="sample-t-test-3" class="level4">
<h4 class="anchored" data-anchor-id="sample-t-test-3">2-Sample T-Test</h4>
<p>Next, let’s run a 2-sample t-test to compare the means from the control and treatment group.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><span class="math display">\[H_0: \mu_{control} = \mu_{treatment}\]</span></p>
<p><span class="math display">\[H_a: \mu_{control} \ne \mu_{treatment}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>seed <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">t_test</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="at">formula =</span> balchange <span class="sc">~</span> group2, </span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"treatment"</span>, <span class="st">"control"</span>),</span>
<span id="cb14-5"><a href="#cb14-5"></a>    <span class="at">alternative =</span> <span class="st">"two-sided"</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  statistic  t_df p_value alternative estimate lower_ci upper_ci
      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1      1.56 1064.   0.118 two.sided       350.    -89.0     788.</code></pre>
</div>
</div>
<p>There is insufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> significance level. The mean change in account balance is not statistically significantly different for the treatment and control groups.</p>
<p>We make inferences with data and assumptions. Did our assumptions hold in this case? The assumptions for a 2-sample T-Test are</p>
<ol type="1">
<li><span class="math inline">\(x_1, x_2, ..., x_n\)</span> is an IID random sample from population 1. <span class="math inline">\(y_1, y_2, ..., y_n\)</span> is an IID random sample from a population 2.</li>
<li>The populations are normally distributed or the sample size is large enough for the Central Limit Theorem to apply.</li>
<li>The populations have equal variances (possibly unknown).</li>
</ol>
<p>Assumptions 1 and 2 hold, but we don’t know if assumption 3 holds. There are statistical tests for the equivalence of two population variances. In this case, we don’t even need the tests. The two samples have dramatically different variances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>seed <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">group_by</span>(group2) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">summarize</span>(<span class="fu">var</span>(balchange))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  group2    `var(balchange)`
  &lt;chr&gt;                &lt;dbl&gt;
1 control           5514806.
2 treatment        37127545.</code></pre>
</div>
</div>
<p><em>Many</em> applications of 2-sample t-tests incorrectly ignore assumption 3 but situations where we want to make inferences about the difference in means when population variances differ is widespread. This is known as the <a href="https://en.wikipedia.org/wiki/Behrens%E2%80%93Fisher_problem">Behrens-Fisher problem</a>.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Simulate two-sample data with 8 observations each like in <a href="#sec-example1"><span>Section&nbsp;8.1.1</span></a> using the <a href="https://en.wikipedia.org/wiki/Log-normal_distribution">log-normal distribution</a> with <code>rlnorm()</code>.</li>
<li>First, run a 2-sample t-test where the simulated data have very similar means.</li>
<li>Second, run a 2-sample t-test where the simulated data have very different means.</li>
</ol>
</div>
</div>
</section>
</section>
</section>
<section id="permutation-test" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="permutation-test"><span class="header-section-number">8.2</span> Permutation Test</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Combination
</div>
</div>
<div class="callout-body-container callout-body">
<p>A combination is the exhaustive reshuffling of <span class="math inline">\(n\)</span> objects into two groups <em>without regard for order</em>.</p>
<p>Let <span class="math inline">\(k\)</span> be the number of objects in the first group. There are <span class="math inline">\(C(n, k) = {n \choose k} = \frac{n!}{(n - k)!k!}\)</span> combinations.</p>
<p>Consider the objects A, B, C, D. Suppose we want to combine them into two groups of equal size. There are <span class="math inline">\(C(4, 2) = {4 \choose 2} = 6\)</span> combinations.</p>
<table class="table">
<thead>
<tr class="header">
<th>Group 1</th>
<th>Group 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A, B</td>
<td>C, D</td>
</tr>
<tr class="even">
<td>A, C</td>
<td>B, D</td>
</tr>
<tr class="odd">
<td>A, D</td>
<td>B, C</td>
</tr>
<tr class="even">
<td>B, C</td>
<td>A, D</td>
</tr>
<tr class="odd">
<td>B, D</td>
<td>A, C</td>
</tr>
<tr class="even">
<td>C, D</td>
<td>A, B</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The permutation test is typically used to compare parameters from two or more populations. The algorithm for a permutation test is as follows:</p>
<ol type="1">
<li>Determine some parameter of interest for two or more populations (like the mean or median). The groups can be treatment and control groups.</li>
<li>Calculate the difference in statistics for each group. This is the <strong>test statistic</strong> or observed statistic.</li>
<li>Determine every possible combination of assignment of each observation to the groups (e.g.&nbsp;treatment and control group).</li>
<li>For each combination:
<ul>
<li>Calculate the difference in the determined statistic (e.g.&nbsp;mean or median) between the two groups.</li>
<li>Store that difference in a vector. This vector is called the <strong>permutation distribution</strong>.</li>
</ul></li>
<li>Determine the p-value by comparing the test statistic to the permutation distribution.</li>
</ol>
<p>For a gentle (and alpaca-themed) visualized introduction to this content, see <a href="https://www.jwilber.me/permutationtest/">this blog</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Permutation Distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>permutation distribution</strong> is a vector of statistics calculated on combinations<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> of the data.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Permutation principle
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>permutation principle</strong> states that the permutation distribution is an appropriate reference distribution and can be used to determine p-values and statistical significance. [<span class="citation" data-cites="higgins2004a">Higgins (<a href="references.html#ref-higgins2004a" role="doc-biblioref">2004</a>)</span>]<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the data used in a permutation test are selected randomly or come from a designed experiment, then we can make inferences about the population. Otherwise, we can only make inferences about the sample.</p>
</div>
</div>
<section id="example-1-revisited" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="example-1-revisited"><span class="header-section-number">8.2.1</span> Example 1 (Revisited)</h3>
<p>Let’s revisit Example 1 using permutation methods. In general we use <code>library(infer)</code> to implement permutations tests. Here we implement the method from scratch for demonstration.</p>
<section id="sample-difference-of-means" class="level4">
<h4 class="anchored" data-anchor-id="sample-difference-of-means">2-Sample Difference of Means</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co">#' Implement a permutation test for means</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co">#'</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">#' @param x A numeric vector</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#' @param group_size The group size of group 1</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#'</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#' @return A permutation distribution </span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#' </span></span>
<span id="cb18-8"><a href="#cb18-8"></a>permute_means <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">group_size =</span> <span class="dv">8</span>) {</span>
<span id="cb18-9"><a href="#cb18-9"></a>  </span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="co"># combn() returns a matrix with group_size rows</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="co"># and a column for every combination of integers associated with x</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  indices <span class="ot">&lt;-</span> <span class="fu">combn</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x), <span class="at">m =</span> group_size)</span>
<span id="cb18-13"><a href="#cb18-13"></a>  </span>
<span id="cb18-14"><a href="#cb18-14"></a>  index <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(indices)</span>
<span id="cb18-15"><a href="#cb18-15"></a></span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="co"># 1. extract a vector of indices stored as a column in the indices matrix</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="co"># 2. extract only the observations in x included in the vector of indices</span></span>
<span id="cb18-18"><a href="#cb18-18"></a>  <span class="co"># 3. take the mean of those observations</span></span>
<span id="cb18-19"><a href="#cb18-19"></a>  dist <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="cb18-20"><a href="#cb18-20"></a>    <span class="at">.x =</span> index, </span>
<span id="cb18-21"><a href="#cb18-21"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">mean</span>(x[indices[, .x]]) <span class="sc">-</span> <span class="fu">mean</span>(x[<span class="sc">-</span>indices[, .x]])</span>
<span id="cb18-22"><a href="#cb18-22"></a>  )</span>
<span id="cb18-23"><a href="#cb18-23"></a>  </span>
<span id="cb18-24"><a href="#cb18-24"></a>  <span class="fu">return</span>(dist)</span>
<span id="cb18-25"><a href="#cb18-25"></a>  </span>
<span id="cb18-26"><a href="#cb18-26"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>permute_means()</code> permutes the indices of the values in <code>x</code> to permute the values of <code>x</code>. In this case, with <code>group_size = 8</code> the first column has indices <code>1, 2, 3, 4, 5, 6, 7, 8</code> and the last column has indices <code>9, 10, 11, 12, 13, 14, 15, 16</code>. The remaining columns express every possible permutation of the values <code>1:16</code> into two groups of size 8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># create the permutation distribution</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>permutation_dist <span class="ot">&lt;-</span> <span class="fu">permute_means</span>(sim_data<span class="sc">$</span>x, <span class="dv">8</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co"># visualize the permutation distribution</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="fu">tibble</span>(<span class="at">x =</span> permutation_dist) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># calculate the test statistic</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>D <span class="ot">&lt;-</span> <span class="fu">mean</span>(sim_data[sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"1"</span>, ]<span class="sc">$</span>x) <span class="sc">-</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">mean</span>(sim_data[sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"2"</span>, ]<span class="sc">$</span>x)</span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># calculate a p-value</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="fu">mean</span>(D <span class="sc">&gt;</span> permutation_dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.006915307</code></pre>
</div>
</div>
<p>The p-value is very small. There is sufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> level. It is likely that the population means of the two samples are different.</p>
</section>
<section id="sample-difference-of-medians" class="level4">
<h4 class="anchored" data-anchor-id="sample-difference-of-medians">2-Sample Difference of Medians</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co">#' Implement a permutation test for medians</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="co">#'</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co">#' @param x A numeric vector</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">#' @param group_size The group size of group 1</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">#'</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">#' @return A permutation distribution </span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">#' </span></span>
<span id="cb23-8"><a href="#cb23-8"></a>permute_medians <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">group_size =</span> <span class="dv">8</span>) {</span>
<span id="cb23-9"><a href="#cb23-9"></a>  </span>
<span id="cb23-10"><a href="#cb23-10"></a>  indices <span class="ot">&lt;-</span> <span class="fu">combn</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x), group_size)</span>
<span id="cb23-11"><a href="#cb23-11"></a>  </span>
<span id="cb23-12"><a href="#cb23-12"></a>  index <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(indices)</span>
<span id="cb23-13"><a href="#cb23-13"></a></span>
<span id="cb23-14"><a href="#cb23-14"></a>  dist <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="cb23-15"><a href="#cb23-15"></a>    <span class="at">.x =</span> index, </span>
<span id="cb23-16"><a href="#cb23-16"></a>    <span class="at">.f =</span> <span class="sc">~</span> <span class="fu">median</span>(x[indices[, .x]]) <span class="sc">-</span> <span class="fu">median</span>(x[<span class="sc">-</span>indices[, .x]])</span>
<span id="cb23-17"><a href="#cb23-17"></a>  )</span>
<span id="cb23-18"><a href="#cb23-18"></a>  </span>
<span id="cb23-19"><a href="#cb23-19"></a>  <span class="fu">return</span>(dist)</span>
<span id="cb23-20"><a href="#cb23-20"></a>  </span>
<span id="cb23-21"><a href="#cb23-21"></a>}</span>
<span id="cb23-22"><a href="#cb23-22"></a></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="co"># calculate the permutation distribution</span></span>
<span id="cb23-24"><a href="#cb23-24"></a>permutation_dist <span class="ot">&lt;-</span> <span class="fu">permute_medians</span>(sim_data<span class="sc">$</span>x, <span class="dv">8</span>)</span>
<span id="cb23-25"><a href="#cb23-25"></a></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="co"># visualize the permutation distribution</span></span>
<span id="cb23-27"><a href="#cb23-27"></a><span class="fu">tibble</span>(<span class="at">x =</span> permutation_dist) <span class="sc">|&gt;</span></span>
<span id="cb23-28"><a href="#cb23-28"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># calculate the test statistic</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>D <span class="ot">&lt;-</span> <span class="fu">median</span>(sim_data[sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"1"</span>, ]<span class="sc">$</span>x) <span class="sc">-</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">median</span>(sim_data[sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">"2"</span>, ]<span class="sc">$</span>x)</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="co"># calculate the p-value</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="fu">mean</span>(D <span class="sc">&gt;</span> permutation_dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02206682</code></pre>
</div>
</div>
<p>The p-value is small. There is sufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> level. It is likely that the population medians (location parameters) of the two samples are different.</p>
</section>
</section>
<section id="example-2-revisited" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="example-2-revisited"><span class="header-section-number">8.2.2</span> Example 2 (Revisited)</h3>
<p>Let <span class="math inline">\(n\)</span> be the number of observations in the data and <span class="math inline">\(k\)</span> be the number of observations in the larger group. Then there are <span class="math inline">\({n \choose k} = \frac{n!}{k!(n - k)!}\)</span> combinations of the data. This can be computationally very expensive.</p>
<p>Consider the data from example 2, which contains 1,777 observations. That’s 935 observations in the control group and 842 observations in the treatment group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">choose</span>(<span class="fu">nrow</span>(seed), <span class="fu">sum</span>(seed<span class="sc">$</span>group2 <span class="sc">==</span> <span class="st">"control"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Inf</code></pre>
</div>
</div>
<p>Fortunately, sampling permutations can give a decent approximation of the full permutation test.</p>
<section id="sample-difference-in-means" class="level4">
<h4 class="anchored" data-anchor-id="sample-difference-in-means">2-Sample Difference in Means</h4>
<p>We will now use <a href="https://www.tidyverse.org/blog/2021/08/infer-1-0-0/"><code>library(infer)</code></a> to calculate the observed statistic, generate the null distribution, and calculate the p-value.</p>
<p>Recall our null and alternative hypotheses.</p>
<p><span class="math display">\[H_0: \mu_{control} = \mu_{treatment}\]</span></p>
<p><span class="math display">\[H_a: \mu_{control} \ne \mu_{treatment}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># calculate the test statistic</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>point_estimate <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">specify</span>(balchange <span class="sc">~</span> group2) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co"># generate the permutation distribution</span></span>
<span id="cb29-7"><a href="#cb29-7"></a>perm_dist <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8"></a>  <span class="fu">specify</span>(balchange <span class="sc">~</span> group2) <span class="sc">|&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb29-12"><a href="#cb29-12"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="co"># visualize the p-value</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>perm_dist <span class="sc">|&gt;</span></span>
<span id="cb29-15"><a href="#cb29-15"></a>  <span class="fu">visualize</span>() <span class="sc">+</span></span>
<span id="cb29-16"><a href="#cb29-16"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># calculate the p-value</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>perm_dist <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  p_value
    &lt;dbl&gt;
1   0.109</code></pre>
</div>
</div>
<p>Once again, there is insufficient evidence to reject the null hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> significance level. The mean change in account balance is not statistically significantly different for the treatment and control groups.</p>
</section>
<section id="sample-difference-in-medians" class="level4">
<h4 class="anchored" data-anchor-id="sample-difference-in-medians">2-Sample Difference in Medians</h4>
<p>Using normal-theory statistics, we don’t have clear strategies for statistical tests about the median. This is simple with nonparametric statistics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># calculate the test statistic</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>point_estimate <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">specify</span>(balchange <span class="sc">~</span> group2) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in medians"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co"># generate the permutation distribution</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>perm_dist <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  <span class="fu">specify</span>(balchange <span class="sc">~</span> group2) <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in medians"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"control"</span>, <span class="st">"treatment"</span>))</span>
<span id="cb32-12"><a href="#cb32-12"></a></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co"># visualize the p-value</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>perm_dist <span class="sc">|&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>  <span class="fu">visualize</span>() <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># calculate the p-value</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>perm_dist <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  p_value
    &lt;dbl&gt;
1  0.0012</code></pre>
</div>
</div>
<p>We have sufficient evidence to reject the null hypothesis in favor if the alternative hypothesis at the <span class="math inline">\(\alpha = 0.05\)</span> level. It is likely that the population median for group 1 is different than the population median for group 2.</p>
<p>Interestingly, the median change for the treatment group is slightly less negative than the control group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>seed <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">group_by</span>(group2) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(balchange))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  group2    median
  &lt;chr&gt;      &lt;dbl&gt;
1 control    -84.6
2 treatment  -38.1</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use the same log-normal data simulated in the earlier exercise.</li>
<li>First, run a 2-sample permutation test for the difference in means using very similar population means.</li>
<li>Second, run a 2-sample permutation test for the difference in means using very different population means.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="other-techniques" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="other-techniques"><span class="header-section-number">8.2.3</span> Other techniques</h3>
<p>Statistical tests are often selected because of their coverage probabilities and power.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Coverage probability
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Coverage probability</strong> is how close the stated level of confidence is to the actual level of confidence.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>For example, a given statistical test, sampling procedure, and population may generate confidence intervals that contain the true parameter of interest 93% of the time for a 95% confidence interval.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Power
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Power</strong> is the probability of rejecting <span class="math inline">\(H_0\)</span> if it is false.</p>
</div>
</div>
<p>We want tests with correct coverage probabilities and high statistical power. If the assumptions are met then parametric tests often have more power than nonparametric tests. The power advantage can often flip when assumptions start failing.</p>
<p>Some nonparametric tests, which are often variations on the permutation test, have more power than the permutation test. Often, the <a href="https://data.library.virginia.edu/the-wilcoxon-rank-sum-test/">Wilcoxon Rank Sum test</a>, which is uses ranks instead of values, has higher power. Another test to explore is the Kruskal-Wallis test.</p>
</section>
</section>
<section id="nonparametric-bootstrap" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="nonparametric-bootstrap"><span class="header-section-number">8.3</span> Nonparametric Bootstrap</h2>
<p>We will investigate one more technique for density estimation focused on estimating sampling distributions.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nonparametric Bootstrap Sample
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>nonparametric bootstrap sample</strong> is a random sample with replacement.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sampling Distribution
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>sampling distribution</strong> of a statistic is the distribution we would observe if a statistic was calculated on many different samples from the same population distribution.</p>
</div>
</div>
<p>Sampling distributions are fundamental to statistics. We frequently use the normal distribution or Student’s t distribution to make inferences about population means and population regression coefficients.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Confidence interval
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given a sampling procedure and a population, the target parameter is in the confidence interval X% of the time over many random samples.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
</div>
</div>
<p>The idea of <strong>repeated sampling</strong> is fundamental to sampling distributions, confidence intervals, and statistical inference in frequentist statistics. The nonparametric bootstrap leverages the idea of repeated sampling to allow for statistical inference under a <em>minimal number of assumptions</em>. This makes it possible to perform inference:</p>
<ol type="1">
<li>When a known sampling distribution for a statistic isn’t available</li>
<li>When the sample is too small to apply the central limit theorem</li>
</ol>
<section id="basic-bootstrap" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="basic-bootstrap"><span class="header-section-number">8.3.1</span> Basic Bootstrap</h3>
<p>Suppose we are interested in an unknown parameter <span class="math inline">\(\theta\)</span>.</p>
<ol type="1">
<li>Compute <span class="math inline">\(\hat\theta\)</span> from the original data.</li>
<li>Take <span class="math inline">\(B\)</span> bootstrap samples of size <span class="math inline">\(n\)</span> from the original data.</li>
<li>Calculate <span class="math inline">\(\hat\theta_{b,i}\)</span> on each bootstrap sample.</li>
</ol>
<p>The vector <span class="math inline">\(\hat{\vec\theta_b}\)</span> is the bootstrap distribution and it has multiple uses. Importantly, it is a nonparametric estimate of the sampling distribution of <span class="math inline">\(\hat\theta\)</span>.</p>
</section>
<section id="example" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="example"><span class="header-section-number">8.3.2</span> Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>B <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>b <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> B)</span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(b)) {</span>
<span id="cb37-5"><a href="#cb37-5"></a>  </span>
<span id="cb37-6"><a href="#cb37-6"></a>  x_boot <span class="ot">&lt;-</span> <span class="fu">sample</span>(seed<span class="sc">$</span>balchange, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-7"><a href="#cb37-7"></a>  </span>
<span id="cb37-8"><a href="#cb37-8"></a>  b[i] <span class="ot">&lt;-</span> <span class="fu">median</span>(x_boot)</span>
<span id="cb37-9"><a href="#cb37-9"></a>  </span>
<span id="cb37-10"><a href="#cb37-10"></a>}</span>
<span id="cb37-11"><a href="#cb37-11"></a></span>
<span id="cb37-12"><a href="#cb37-12"></a><span class="fu">tibble</span>(b) <span class="sc">|&gt;</span></span>
<span id="cb37-13"><a href="#cb37-13"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(b)) <span class="sc">+</span></span>
<span id="cb37-14"><a href="#cb37-14"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can use this permutation distribution to calculate bias (<a href="#sec-bias"><span>Section&nbsp;8.3.3</span></a>), standard errors (<a href="#sec-standard-errors"><span>Section&nbsp;8.3.4</span></a>), and confidence intervals (<a href="#sec-confidence-intervals"><span>Section&nbsp;8.3.6</span></a>).</p>
</section>
<section id="sec-bias" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="sec-bias"><span class="header-section-number">8.3.3</span> Bias</h3>
<p>Sometimes estimators of population parameters are biased.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> Bootstrapping can be used to estimate the bias in an estimator.</p>
<p>Let <span class="math inline">\(\theta\)</span> be the parameter of interest and <span class="math inline">\(\hat\theta\)</span> be an estimator. <span class="math inline">\(\hat\theta\)</span> is unbiased if <span class="math inline">\(E[\hat\theta] = \theta\)</span>.</p>
<p>Accordingly, <span class="math inline">\(bias(\hat\theta) = E[\hat\theta] - \theta\)</span>.</p>
<p><span class="math inline">\(E[\hat\theta]\)</span> is just the sample mean of the sampling distribution.</p>
<p><span class="math display">\[
\hat{bias}(\hat\theta) = \bar{\hat{\theta^*}} - \hat\theta
\]</span></p>
<p>where <span class="math inline">\(\bar{\hat\theta^*} = \frac{1}{b} \sum_{b = 1}^B \hat\theta_b\)</span>.</p>
<p>Basically, to estimate bias we subtract our estimate from the mean of the sampling distribution, which is our bootstrap distribution. This estimate of bias can be used to correct for bias.</p>
<p>If <span class="math inline">\(\frac{|bias|}{se} \le 0.25\)</span>, then it is likely unnecessary to correct for bias <span class="citation" data-cites="rizzo2008">(<a href="references.html#ref-rizzo2008" role="doc-biblioref">Rizzo 2008</a>)</span>. We will next see how to estimate <span class="math inline">\(se\)</span>.</p>
</section>
<section id="sec-standard-errors" class="level3" data-number="8.3.4">
<h3 data-number="8.3.4" class="anchored" data-anchor-id="sec-standard-errors"><span class="header-section-number">8.3.4</span> Standard errors</h3>
<p>Suppose we want to estimate the standard error of an estimator <span class="math inline">\(\hat\theta\)</span>. To do this, simply take the standard deviation of the bootstrap replicates.</p>
<p><span class="math display">\[
\hat{se}(\hat\theta^*) = \sqrt{\frac{1}{B-1} \sum_{b = 1}^B \left(\hat\theta_b - \bar{\hat\theta^*}\right)^2}
\]</span></p>
<p>where <span class="math inline">\(\bar{\hat\theta^*} = \frac{1}{b} \sum_{b = 1}^B \hat\theta_b\)</span>.</p>
<p>Historically, the bootstrap was used to estimate the standard errors of estimates. The jackknife, another resampling method, can be used to estimate bias and standard errors. We won’t focus on this. Instead, we will estimate confidence intervals <span class="citation" data-cites="chernick2011">(<a href="references.html#ref-chernick2011" role="doc-biblioref">Chernick and LaBudde 2011</a>)</span>.</p>
</section>
<section id="example-1" class="level3" data-number="8.3.5">
<h3 data-number="8.3.5" class="anchored" data-anchor-id="example-1"><span class="header-section-number">8.3.5</span> Example</h3>
<p>First, let’s repeat the SEED example from above using the <code>boot()</code> function. <code>boot()</code> expects a custom function with the argument <code>x</code> for the data and the argument <code>i</code> for the index for statistics. We use<code>R = 5000</code> for <code>B &lt;- 5000</code> in the earlier example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a>seed_bootstrap <span class="ot">&lt;-</span> <span class="fu">boot</span>(</span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="at">data =</span> seed<span class="sc">$</span>balchange, </span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="at">statistic =</span> <span class="cf">function</span>(x, i) <span class="fu">median</span>(x[i]), </span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="at">R =</span> <span class="dv">5000</span></span>
<span id="cb39-7"><a href="#cb39-7"></a>)</span>
<span id="cb39-8"><a href="#cb39-8"></a></span>
<span id="cb39-9"><a href="#cb39-9"></a>seed_bootstrap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
ORDINARY NONPARAMETRIC BOOTSTRAP


Call:
boot(data = seed$balchange, statistic = function(x, i) median(x[i]), 
    R = 5000)


Bootstrap Statistics :
    original     bias    std. error
t1*   -63.04 -0.9602388    7.817336</code></pre>
</div>
</div>
<p><code>library(boot)</code> and <code>boot()</code> are useful when we want to see bias. They are also useful when we are interested in statistics not included in <code>library(infer)</code>. Otherwise, we will use <code>library(infer)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>bootstrap_distribution <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">specify</span>(<span class="at">response =</span> balchange) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"point"</span>, <span class="at">med =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"median"</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a>bootstrap_distribution <span class="sc">|&gt;</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="fu">visualize</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="sec-confidence-intervals" class="level3" data-number="8.3.6">
<h3 data-number="8.3.6" class="anchored" data-anchor-id="sec-confidence-intervals"><span class="header-section-number">8.3.6</span> Confidence intervals</h3>
<p>Under certain assumptions it is simple to construct confidence intervals for parameters like the population mean.</p>
<p>There are several ways to calculate confidence intervals using bootstrapping:</p>
<ol type="1">
<li>Percentile method</li>
<li>BCA</li>
<li>t-pivot</li>
</ol>
<p>Approach three doesn’t always work but probably has the most desirable properties. Approach two is a suitable backup. Approach one often has the worst properties, but is simple and will be sufficient in many applications.</p>
<section id="percentile-method" class="level4">
<h4 class="anchored" data-anchor-id="percentile-method">Percentile Method</h4>
<p>For each bootstrap sample indexed by <span class="math inline">\(b = 1, ..., B\)</span>,</p>
<ol type="1">
<li>Compute <span class="math inline">\(\hat\theta\)</span> from the original data.</li>
<li>Take <span class="math inline">\(B\)</span> bootstrap samples of size <span class="math inline">\(n\)</span> from the data.</li>
<li>Compute <span class="math inline">\(\hat\theta_b\)</span> for each bootstrap sample.</li>
<li>For <span class="math inline">\(\alpha = 0.05\)</span>, find the 2.5th and 97.th percentiles of <span class="math inline">\(\hat{\vec\theta}\)</span>.</li>
</ol>
</section>
</section>
<section id="example-3" class="level3" data-number="8.3.7">
<h3 data-number="8.3.7" class="anchored" data-anchor-id="example-3"><span class="header-section-number">8.3.7</span> Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>point_estimate <span class="ot">&lt;-</span> seed <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="fu">specify</span>(<span class="at">response =</span> balchange) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"median"</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a></span>
<span id="cb42-5"><a href="#cb42-5"></a>bootstrap_distribution <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6"></a>  <span class="fu">visualize</span>() <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="18_nonparametric-2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>bootstrap_distribution <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> point_estimate, <span class="at">direction =</span> <span class="st">"two-sided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Please be cautious in reporting a p-value of 0. This result is an
approximation based on the number of `reps` chosen in the `generate()` step.
See `?get_p_value()` for more information.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  p_value
    &lt;dbl&gt;
1       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>bootstrap_distribution <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="fu">get_confidence_interval</span>(</span>
<span id="cb46-3"><a href="#cb46-3"></a>    <span class="at">point_estimate =</span> point_estimate,</span>
<span id="cb46-4"><a href="#cb46-4"></a>    <span class="at">level =</span> <span class="fl">0.95</span>,</span>
<span id="cb46-5"><a href="#cb46-5"></a>    <span class="at">type =</span> <span class="st">"se"</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  lower_ci upper_ci
     &lt;dbl&gt;    &lt;dbl&gt;
1    -78.2    -47.8</code></pre>
</div>
</div>
<p>The confidence intervals are comparable. We’re good to go.</p>
<p>Students can take multiple statistics classes and never learn how to calculate a 95% confidence interval for a median. It’s simple with bootstrapping.</p>
<p>In this case, it’s striking that the balance for the median SEED account declined over the period and there is sufficient evidence that the median is statistically significantly different than $0. In fact, it’s negative!</p>
</section>
</section>
<section id="more-methods" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="more-methods"><span class="header-section-number">8.4</span> More Methods</h2>
<p>M-Estimation and quantile regression are two nonparametric techniques that we will not discuss that are common public policy analysis.</p>
<p>M-Estimation is useful for estimating conditional means in the presence of outliers. Quantile regression is useful for estimating conditional quantiles like the conditional median.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Start with the <code>seed</code> data. Drop observations where <code>group3 == "marketing"</code>.</li>
<li>Use <code>library(infer)</code> and bootstrapping to test if the median is statistically significantly different than zero.</li>
</ol>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>library(infer)</code> allows for tests about the median but not other percentiles.</p>
<ol type="1">
<li>Start with the full <code>seed</code> data.</li>
<li>Use <code>boot()</code> and <code>boot.ci()</code> to test if the 75th percentile for balchange is different than 0.</li>
</ol>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-ashraf2006" class="csl-entry" role="listitem">
Ashraf, N., D. Karlan, and W. Yin. 2006. <span>“Tying Odysseus to the Mast: Evidence From a Commitment Savings Product in the Philippines.”</span> <em>The Quarterly Journal of Economics</em> 121 (2): 635–72. <a href="https://doi.org/10.1162/qjec.2006.121.2.635">https://doi.org/10.1162/qjec.2006.121.2.635</a>.
</div>
<div id="ref-brown2001" class="csl-entry" role="listitem">
Brown, Lawrence D., T. Tony Cai, and Anirban DasGupta. 2001. <span>“Interval Estimation for a Binomial Proportion.”</span> <em>Statistical Science</em> 16 (2). <a href="https://doi.org/10.1214/ss/1009213286">https://doi.org/10.1214/ss/1009213286</a>.
</div>
<div id="ref-chernick2011" class="csl-entry" role="listitem">
Chernick, Michael R., and Robert A. LaBudde. 2011. <em>An Introduction to Bootstrap Methods with Applications to r</em>. Hoboken, N.J: Wiley.
</div>
<div id="ref-higgins2004a" class="csl-entry" role="listitem">
Higgins, James J. 2004. <em>An Introduction to Modern Nonparametric Statistics</em>. Pacific Grove, CA: Brooks/Cole.
</div>
<div id="ref-rizzo2008" class="csl-entry" role="listitem">
Rizzo, Maria L. 2008. <em>Statistical Computing with r</em>. Chapman &amp; Hall/CRC Computer Science and Data Analysis Series. Boca Raton: Chapman &amp; Hall/CRC.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Base R has excellent tools for statistical inference. <code>library(infer)</code> is useful because it plays well with <code>library(tidyverse)</code>. We can just use <code>t_test()</code> for a one-sample t-test.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The RCT actually contains a treatment group, a control group that received marketing materials, and a proper control group. In this case, I’ve lumped the marketing group in with the treatment group.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>A permutation is the exhaustive reshuffling of <span class="math inline">\(n\)</span> objects into <span class="math inline">\(m\)</span> groups <em>with regard for order</em>. We should probably call the permutation test the combination test. Combinations are the exhaustive reshuffling of <span class="math inline">\(n\)</span> objects into <span class="math inline">\(m\)</span> groups <em>without regard for order</em>. Using permutations generates the same results as combinations but takes much longer because many of the configurations are duplicated.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The permutation test is considered an exact test because the null model will <em>never</em> test more as significant more than the <span class="math inline">\(\alpha\)</span> level of the test.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><span class="citation" data-cites="brown2001">Brown, Cai, and DasGupta (<a href="references.html#ref-brown2001" role="doc-biblioref">2001</a>)</span> explores the coverage probabilities of different techniques for interval estimation for a binomial proportion. Reading this paper made me question everything I knew about confidence intervals.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Confidence intervals are about a process. There is a distinct difference between confidence and probabilities. It is incorrect to say, “the true parameter is in the interval X% of the time.” This is what a credible interval is and we will learn more about credible intervals when we learn Bayesian statistics.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Recall that <span class="math inline">\(\bar{X}\)</span> is an unbiased estimator of the population mean <span class="math inline">\(\mu\)</span>. On the other hand, <span class="math inline">\(\hat\sigma^2\)</span> is a biased estimator of variance <span class="math inline">\(\sigma^2\)</span>.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./17_nonparametric-1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./20_predictive-modeling-review.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Predictive Modeling Review</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>