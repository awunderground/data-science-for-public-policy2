<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 10&nbsp; Advanced R Programming</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./12_apis.html" rel="next">
<link href="./09_advanced-git.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_functions.html">Programming</a></li><li class="breadcrumb-item"><a href="./10_functions.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Other Topics</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-review3" id="toc-sec-review3" class="nav-link active" data-scroll-target="#sec-review3"><span class="header-section-number">10.1</span> Review</a>
  <ul class="collapse">
  <li><a href="#relational-data" id="toc-relational-data" class="nav-link" data-scroll-target="#relational-data"><span class="header-section-number">10.1.1</span> Relational Data</a></li>
  </ul></li>
  <li><a href="#programming" id="toc-programming" class="nav-link" data-scroll-target="#programming"><span class="header-section-number">10.2</span> Programming</a>
  <ul class="collapse">
  <li><a href="#selecting-data" id="toc-selecting-data" class="nav-link" data-scroll-target="#selecting-data"><span class="header-section-number">10.2.1</span> Selecting Data</a></li>
  <li><a href="#control-flow" id="toc-control-flow" class="nav-link" data-scroll-target="#control-flow"><span class="header-section-number">10.2.2</span> Control Flow</a></li>
  </ul></li>
  <li><a href="#custom-functions" id="toc-custom-functions" class="nav-link" data-scroll-target="#custom-functions"><span class="header-section-number">10.3</span> Custom Functions</a>
  <ul class="collapse">
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation"><span class="header-section-number">10.3.1</span> Motivation</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples"><span class="header-section-number">10.3.2</span> Examples</a></li>
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics"><span class="header-section-number">10.3.3</span> Basics</a></li>
  <li><a href="#functions-with-multiple-outputs" id="toc-functions-with-multiple-outputs" class="nav-link" data-scroll-target="#functions-with-multiple-outputs"><span class="header-section-number">10.3.4</span> Functions with Multiple Outputs</a></li>
  <li><a href="#referential-transparency" id="toc-referential-transparency" class="nav-link" data-scroll-target="#referential-transparency"><span class="header-section-number">10.3.5</span> Referential Transparency</a></li>
  </ul></li>
  <li><a href="#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging"><span class="header-section-number">10.4</span> Debugging</a></li>
  <li><a href="#benchmarking" id="toc-benchmarking" class="nav-link" data-scroll-target="#benchmarking"><span class="header-section-number">10.5</span> Benchmarking</a></li>
  <li><a href="#sec-organizing-an-analysis" id="toc-sec-organizing-an-analysis" class="nav-link" data-scroll-target="#sec-organizing-an-analysis"><span class="header-section-number">10.6</span> Organizing an Analysis</a></li>
  <li><a href="#sec-purrr" id="toc-sec-purrr" class="nav-link" data-scroll-target="#sec-purrr"><span class="header-section-number">10.7</span> Iteration with <code>library(purrr)</code></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">10.8</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    We’ve mostly focused on the tidyverse and data analysis. This section will dive into advanced R programming topics like custom functions, debugging, and iteration.
  </div>
</div>

</header>

<section id="sec-review3" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="sec-review3"><span class="header-section-number">10.1</span> Review</h2>
<section id="relational-data" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="relational-data"><span class="header-section-number">10.1.1</span> Relational Data</h3>
<p>We’ve almost exclusively used data frames up to this point. We leveraged relations within our data to pick subsets of the data with functions like <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>msleep <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"Cow"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 11
  name  genus vore  order   conservation sleep_total sleep_rem sleep_cycle awake
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 Cow   Bos   herbi Artiod… domesticated           4       0.7       0.667    20
# ℹ 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Importantly, we almost never used indices or selected data by position, which can lead to errors if the underlying data change. An example of using indices and selecting data by position would be to pick data from row number 5 and column number 4. This idea of using the relations in data reduces the chances of making mistakes and leads to clearer code.</p>
</section>
</section>
<section id="programming" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="programming"><span class="header-section-number">10.2</span> Programming</h2>
<section id="selecting-data" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="selecting-data"><span class="header-section-number">10.2.1</span> Selecting Data</h3>
<p>There are other ways to subset data, which are important when working with objects other than data frames. We will focus on <code>[]</code>, <code>[[]]</code>, and <code>$</code>.</p>
<section id="atomic-vectors" class="level4">
<h4 class="anchored" data-anchor-id="atomic-vectors">Atomic Vectors</h4>
<p>Much of our work focuses on four of the six types of <a href="https://r4ds.had.co.nz/vectors.html#important-types-of-atomic-vector">atomic vectors</a>: logical, integer, double, and character. <code>[]</code> is useful for subsetting atomic vectors. Consider a vector with the first six letters of the alphabet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>letters_short <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use <strong>positive integers</strong> to subset to the first and fifth letters of the alphabet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>letters_short[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
</div>
<p>We can use <strong>negative integers</strong> to subset to the everything but the first and fifth letters of the alphabet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>letters_short[<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b" "c" "d" "f"</code></pre>
</div>
</div>
<p>We can use <strong>Booleans</strong> (trues and falses) to subset to the first and fifth letters of the alphabet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>letters_short[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
</div>
<p>This may seem silly, but we have many ways to create Booleans that we can then use to subset a vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>booleans <span class="ot">&lt;-</span> letters_short <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"e"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>booleans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE FALSE FALSE  TRUE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>letters_short[booleans]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
</div>
<p>We can use a <strong>character vector</strong> to subset a named vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>named_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>named_vector</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a b c 
1 2 3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>named_vector[<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"c"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a c 
1 3 </code></pre>
</div>
</div>
<p>We are able to select more than one element with <code>[]</code>, which will not be true of <code>[[]]</code> and <code>$</code>. One thing to look out for is vector recycling. Let’s go back to <code>letters_short</code>, which is length six, but consider some indices of varying lengths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>letters_short[<span class="cn">TRUE</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "b" "c" "d" "e" "f"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>letters_short[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "c" "e"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>letters_short[<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "c" "d" "f"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wow, R recycles the Booleans. Six is divisible by 1, 2, and 3, so there are many ways to recycle the index to subset <code>letters_short</code>. This is dangerous and can quietly cause analtyic errors.</p>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create <code>letters_short</code>.</li>
<li>Try subsetting the vectors with indices with length four or five. What happens?</li>
</ol>
</div>
</div>
</section>
<section id="lists" class="level4">
<h4 class="anchored" data-anchor-id="lists">Lists</h4>
<p><code>[[]]</code> and <code>$</code> are useful for subsetting lists. Both can be used to subset data frames, but I recommending avoiding this.</p>
<p>Unlike <code>[]</code>, which returns multiple elements, <code>[[]]</code> and <code>$</code> can only return a single element and <code>[[]]</code> and <code>$</code> simplify objects by removing a layer of hierarchy.</p>
<p><code>[[]]</code> can select an element by position or name, while <code>$</code> can only select an element by name. Consider a list with the first six letters of the alphabet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>alphabet <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="at">vowels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"e"</span>),</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="at">consonants =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"f"</span>)</span>
<span id="cb24-4"><a href="#cb24-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use <code>[]</code> to select the first or second element. In both cases, we get back a smaller list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>alphabet[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$vowels
[1] "a" "e"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">class</span>(alphabet[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>alphabet[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$consonants
[1] "b" "c" "d" "f"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">class</span>(alphabet[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p>We can use <code>[[]]</code> to select the first or second element. Now, we get back a vector instead of a list. <code>[[]]</code> simplified the object by removing a level of hierarchy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>alphabet[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">class</span>(alphabet[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>We can also use <code>[[]]</code> to select an object by name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>alphabet[[<span class="st">"vowels"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">class</span>(alphabet[[<span class="st">"vowels"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>We can use <code>$</code> to select either vector by name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>alphabet<span class="sc">$</span>vowels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">class</span>(alphabet<span class="sc">$</span>vowels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Referring to objects by name should make for code that is more robust to changing data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Before</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">After</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>alphabet1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb45-2"><a href="#cb45-2"></a>  <span class="at">vowels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"e"</span>),</span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="at">consonants =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"f"</span>)</span>
<span id="cb45-4"><a href="#cb45-4"></a>)</span>
<span id="cb45-5"><a href="#cb45-5"></a></span>
<span id="cb45-6"><a href="#cb45-6"></a>alphabet1[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b" "c" "d" "f"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>alphabet1[[<span class="st">"consonants"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b" "c" "d" "f"</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>alphabet2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb49-2"><a href="#cb49-2"></a>  <span class="at">vowels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"e"</span>),</span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="at">confusing =</span> <span class="st">"y"</span>,</span>
<span id="cb49-4"><a href="#cb49-4"></a>  <span class="at">consonants =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"f"</span>)</span>
<span id="cb49-5"><a href="#cb49-5"></a>)</span>
<span id="cb49-6"><a href="#cb49-6"></a></span>
<span id="cb49-7"><a href="#cb49-7"></a>alphabet2[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "y"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>alphabet2[[<span class="st">"consonants"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b" "c" "d" "f"</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Subsetting lists can be difficult. Fortunately, RStudio has a tool than can help. Click on a list in your global environment. Navigate to the far right and click the list button with a green arrow. This will generate code and add it to the Console.</p>
<p><img src="images/lists.png" class="img-fluid"></p>
<p>Interestingly, this tool avoids <code>$</code> and uses <code>[[]]</code> to pick the vector by name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>alphabet[[<span class="st">"vowels"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a" "e"</code></pre>
</div>
</div>
</section>
</section>
<section id="control-flow" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="control-flow"><span class="header-section-number">10.2.2</span> Control Flow</h3>
<p>Loops are a fundamental programming tool for iteration; however, they are less common in R than in other programming languages. We encourage the map-reduce framework in the tidyverse’s purrr library which we introduce in <a href="#sec-purrr"><span>Section&nbsp;10.7</span></a>. Even so, understanding the for loop and while loop is important because you will likely see them in other programmers’ R code, and they are extremely common in other programming languages.</p>
<section id="for-loops" class="level4">
<h4 class="anchored" data-anchor-id="for-loops">For Loops</h4>
<p>For loops have two main pieces: 1. a header and 2. a body. Headers define the number of iterations and potential inputs to the iteration. Bodies are iterated once per iteration. Here is a very simple example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb55-2"><a href="#cb55-2"></a>  </span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="fu">print</span>(i)</span>
<span id="cb55-4"><a href="#cb55-4"></a>  </span>
<span id="cb55-5"><a href="#cb55-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
[1] 7
[1] 8
[1] 9
[1] 10</code></pre>
</div>
</div>
<p>We can use headers several different ways. Like above, we may just want to repeat the values in the index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>fruit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cantelope"</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="cf">for</span> (b <span class="cf">in</span> fruit) {</span>
<span id="cb57-3"><a href="#cb57-3"></a>  </span>
<span id="cb57-4"><a href="#cb57-4"></a>  <span class="fu">print</span>(b)</span>
<span id="cb57-5"><a href="#cb57-5"></a>  </span>
<span id="cb57-6"><a href="#cb57-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"
[1] "banana"
[1] "cantelope"</code></pre>
</div>
</div>
<p>We can use the header as an index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>fruit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cantelope"</span>)</span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb59-3"><a href="#cb59-3"></a>  </span>
<span id="cb59-4"><a href="#cb59-4"></a>  <span class="fu">print</span>(fruit[i])</span>
<span id="cb59-5"><a href="#cb59-5"></a>  </span>
<span id="cb59-6"><a href="#cb59-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"
[1] "banana"
[1] "cantelope"</code></pre>
</div>
</div>
<p>We can leverage the index to use results from previous iterations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>result <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>) </span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb61-3"><a href="#cb61-3"></a>  </span>
<span id="cb61-4"><a href="#cb61-4"></a>  result[i] <span class="ot">&lt;-</span> result[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>  </span>
<span id="cb61-6"><a href="#cb61-6"></a>}</span>
<span id="cb61-7"><a href="#cb61-7"></a></span>
<span id="cb61-8"><a href="#cb61-8"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 4 8</code></pre>
</div>
</div>
<p>We’ve now seen three different ways to use the header.</p>
<ol type="1">
<li>Simply repeat the elements in the header (e.g.&nbsp;print <code>i</code>).</li>
<li>Use the elements in the header as an index (e.g.&nbsp;select the <span class="math inline">\(i^{th}\)</span> element).</li>
<li>Use the header to reference past iterations (e.g.&nbsp;<code>i - 1</code>)</li>
</ol>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Don’t grow vectors!
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is tempting to initialize a vector and then grow the vector with a for loop and <code>c()</code>. It is also tempting to initialize a data frame and then grow the data frame with <code>bind_rows()</code>. Because of R’s design, this is computationally very inefficient.</p>
<p>This is slow!:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb63-2"><a href="#cb63-2"></a></span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb63-4"><a href="#cb63-4"></a>  </span>
<span id="cb63-5"><a href="#cb63-5"></a>  vec <span class="ot">&lt;-</span> <span class="fu">c</span>(vec, i)</span>
<span id="cb63-6"><a href="#cb63-6"></a>  </span>
<span id="cb63-7"><a href="#cb63-7"></a>  </span>
<span id="cb63-8"><a href="#cb63-8"></a>}</span>
<span id="cb63-9"><a href="#cb63-9"></a></span>
<span id="cb63-10"><a href="#cb63-10"></a>vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
</div>
</div>
</div>
<p>It is essential to pre-allocate vectors and then fill them in. It is also easy to make mistakes when creating indices (e.g.&nbsp;<code>1:length(x)</code> may end up as <code>c(1, 0)</code>). <code>seq_along()</code> is a helpful alternative to <code>:</code>. The following pre-allocates a vector and then uses the length of the vector to create an index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>numbers <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="dv">5</span>)</span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a>numbers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(numbers)) {</span>
<span id="cb67-2"><a href="#cb67-2"></a>  </span>
<span id="cb67-3"><a href="#cb67-3"></a>  numbers[i] <span class="ot">&lt;-</span> i</span>
<span id="cb67-4"><a href="#cb67-4"></a>  </span>
<span id="cb67-5"><a href="#cb67-5"></a>}</span>
<span id="cb67-6"><a href="#cb67-6"></a></span>
<span id="cb67-7"><a href="#cb67-7"></a>numbers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>Let’s consider a simple random walk with 100 steps. In this case, the person starts at location zero and random takes one step forward or one step back.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>position <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"numeric"</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="fu">set.seed</span>(<span class="dv">20230530</span>)</span>
<span id="cb69-4"><a href="#cb69-4"></a><span class="cf">for</span> (iter <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(position)) {</span>
<span id="cb69-5"><a href="#cb69-5"></a>  </span>
<span id="cb69-6"><a href="#cb69-6"></a>  position[iter] <span class="ot">&lt;-</span> position[iter <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb69-7"><a href="#cb69-7"></a>  </span>
<span id="cb69-8"><a href="#cb69-8"></a>  </span>
<span id="cb69-9"><a href="#cb69-9"></a>}</span>
<span id="cb69-10"><a href="#cb69-10"></a></span>
<span id="cb69-11"><a href="#cb69-11"></a>position</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  0 -1  0  1  2  1  0  1  0  1  2  1  0  1  2  1  2  1  2  1  2  1  2  1  2
 [26]  3  4  5  4  3  2  3  4  3  4  3  2  3  2  3  2  3  2  3  2  3  2  1  2  3
 [51]  2  3  4  3  4  5  6  5  6  5  6  7  6  5  6  7  8  9 10 11 12 13 12 13 12
 [76] 11 10  9 10  9  8  9 10 11 12 13 12 11 12 11 12 13 12 13 14 15 14 15 14 15</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create the following list:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a>alphabet <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb71-2"><a href="#cb71-2"></a>  <span class="at">vowels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"e"</span>),</span>
<span id="cb71-3"><a href="#cb71-3"></a>  <span class="at">confusing =</span> <span class="st">"y"</span>,</span>
<span id="cb71-4"><a href="#cb71-4"></a>  <span class="at">consonants =</span> <span class="fu">c</span>(<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"f"</span>)</span>
<span id="cb71-5"><a href="#cb71-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Write a for loop and use <code>str_to_upper()</code> to transform all letters to upper case.</li>
</ol>
</div>
</div>
</section>
<section id="while-loops" class="level4">
<h4 class="anchored" data-anchor-id="while-loops">While Loops</h4>
<p>While loops are similar to for loops; however, instead of predetermining the number of iterations in the header, while loops determine a condition in the header and run until that condition is met. This makes them useful for iterating for an unknown number of iterations. Though while loops are less common than for loops, one policy-relevant domain where while loops could be useful is simulation. A while loop could be useful to run a simulation indefinitely until certain conditions are met. Alternatively, both for and while loops could be used to run a simulation a specified number of times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>iteration <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb72-3"><a href="#cb72-3"></a></span>
<span id="cb72-4"><a href="#cb72-4"></a><span class="cf">while</span> (x <span class="sc">&lt;</span> <span class="dv">1000</span>) {</span>
<span id="cb72-5"><a href="#cb72-5"></a>  </span>
<span id="cb72-6"><a href="#cb72-6"></a>  iteration <span class="ot">&lt;-</span> iteration <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb72-7"><a href="#cb72-7"></a>  x <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb72-8"><a href="#cb72-8"></a>  </span>
<span id="cb72-9"><a href="#cb72-9"></a>}</span>
<span id="cb72-10"><a href="#cb72-10"></a></span>
<span id="cb72-11"><a href="#cb72-11"></a>x </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1024</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>iteration</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Write the random walk from the for loop above as a while loop. Stop the while loop when <code>position &lt; -10</code> or <code>position &gt; 10</code>. How many iterations did it take?</li>
</ol>
</div>
</div>
</section>
<section id="if-else-and-else-if" class="level4">
<h4 class="anchored" data-anchor-id="if-else-and-else-if"><code>if</code>, <code>else</code>, and <code>else if</code></h4>
<p><code>if_else()</code> and <code>case_when()</code> apply conditional logic to a vector. We most frequently use those functions inside of <code>mutate()</code> to create a new variable or manipulate an existing variable.</p>
<p>R also has <code>if</code>, <code>else</code>, and <code>else if</code>, which are used to select sections of code to run. This is incredibly useful when programming outside of data manipulation. For example, we can use <code>if</code> to download a file only if it doesn’t already exist.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data.csv"</span>)) {</span>
<span id="cb76-2"><a href="#cb76-2"></a></span>
<span id="cb76-3"><a href="#cb76-3"></a>  <span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"web-url.csv"</span>, <span class="at">destfile =</span> <span class="st">"data.csv"</span>)</span>
<span id="cb76-4"><a href="#cb76-4"></a></span>
<span id="cb76-5"><a href="#cb76-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Selection</strong> control flow has two important pieces. First, there is a conditional statement inside <code>()</code>. If the condition is <code>TRUE</code>, then evaluate. If it is <code>FALSE</code>, then don’t evaluate. Second, there is a body contained in <code>{}</code>. Note the formatting in the above example.</p>
<p>The conditional statement must be a single <code>TRUE</code> or <code>FALSE</code>. If your statement involves more than one Boolean, then consider using <code>all()</code>, which evaluates to <code>TRUE</code> if everything is <code>TRUE</code> and <code>any()</code>, which evaluates to <code>TRUE</code> if anay element is <code>TRUE</code>.</p>
<p>Let’s consider a more sophisticated example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="cf">if</span> (distribution <span class="sc">==</span> <span class="st">"normal"</span>) {</span>
<span id="cb77-2"><a href="#cb77-2"></a>  </span>
<span id="cb77-3"><a href="#cb77-3"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb77-4"><a href="#cb77-4"></a>  </span>
<span id="cb77-5"><a href="#cb77-5"></a>} <span class="cf">else</span> <span class="cf">if</span> (distribution <span class="sc">==</span> <span class="st">"poisson"</span>) {</span>
<span id="cb77-6"><a href="#cb77-6"></a>  </span>
<span id="cb77-7"><a href="#cb77-7"></a>  x <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">lambda =</span> <span class="dv">8</span>)</span>
<span id="cb77-8"><a href="#cb77-8"></a>  </span>
<span id="cb77-9"><a href="#cb77-9"></a>} <span class="cf">else</span> {</span>
<span id="cb77-10"><a href="#cb77-10"></a>  </span>
<span id="cb77-11"><a href="#cb77-11"></a>  <span class="fu">stop</span>(<span class="st">"distribution mast be normal or poissoin"</span>)</span>
<span id="cb77-12"><a href="#cb77-12"></a>  </span>
<span id="cb77-13"><a href="#cb77-13"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This style of using <code>if</code>, <code>else if</code>, and <code>else</code> is fundamental for including options in custom functions.</p>
</section>
</section>
</section>
<section id="custom-functions" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="custom-functions"><span class="header-section-number">10.3</span> Custom Functions</h2>
<section id="motivation" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">10.3.1</span> Motivation</h3>
<p>Custom functions are an essential building block for good analyses. Custom functions are useful for abiding by the DRY (don’t repeat yourself) principle. Under our conception of DRY, we should create a function any time we do something three times.</p>
<p>Copying-and-pasting is typically bad because it is easy to make mistakes and we typically want a single source source of truth in a script. Custom functions also promote modular code design and testing.</p>
<p>The bottom line: we want to write clear functions that do one and only one thing that are sufficiently tested so we are confident in their correctness.</p>
</section>
<section id="examples" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="examples"><span class="header-section-number">10.3.2</span> Examples</h3>
<p>Let’s consider a couple of examples from <span class="citation" data-cites="barrientos2021">(<a href="references.html#ref-barrientos2021" role="doc-biblioref">Barrientos et al. 2021</a>)</span>. This paper is a large-scale simulation of formally private mechanisms, which relates to several future chapters of this book.</p>
<p>Division by zero, which returns <code>NaN</code>, can be a real pain when comparing confidential and noisy results when the confidential value is <code>zero</code>. This function simply returns <code>0</code> when the denominator is <code>0</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">#' Safely divide number. When zero is in the denominator, return 0. </span></span>
<span id="cb78-2"><a href="#cb78-2"></a><span class="co">#'</span></span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="co">#' @param numerator A numeric value for the numerator</span></span>
<span id="cb78-4"><a href="#cb78-4"></a><span class="co">#' @param denominator A numeric value for the denominator</span></span>
<span id="cb78-5"><a href="#cb78-5"></a><span class="co">#'</span></span>
<span id="cb78-6"><a href="#cb78-6"></a><span class="co">#' @return A numeric ratio</span></span>
<span id="cb78-7"><a href="#cb78-7"></a><span class="co">#'</span></span>
<span id="cb78-8"><a href="#cb78-8"></a>safe_divide <span class="ot">&lt;-</span> <span class="cf">function</span>(numerator, denominator) {</span>
<span id="cb78-9"><a href="#cb78-9"></a>  </span>
<span id="cb78-10"><a href="#cb78-10"></a>  <span class="cf">if</span> (denominator <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb78-11"><a href="#cb78-11"></a>    </span>
<span id="cb78-12"><a href="#cb78-12"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb78-13"><a href="#cb78-13"></a>    </span>
<span id="cb78-14"><a href="#cb78-14"></a>  } <span class="cf">else</span> {</span>
<span id="cb78-15"><a href="#cb78-15"></a>    </span>
<span id="cb78-16"><a href="#cb78-16"></a>    <span class="fu">return</span>(numerator <span class="sc">/</span> denominator)</span>
<span id="cb78-17"><a href="#cb78-17"></a>    </span>
<span id="cb78-18"><a href="#cb78-18"></a>  }</span>
<span id="cb78-19"><a href="#cb78-19"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function</p>
<ol type="1">
<li>Implements the laplace or double exponential distribution, which isn’t included in base R.</li>
<li>Applies a technique called the laplace mechanism.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="co">#' Apply the laplace mechanism</span></span>
<span id="cb79-2"><a href="#cb79-2"></a><span class="co">#'</span></span>
<span id="cb79-3"><a href="#cb79-3"></a><span class="co">#' @param eps Numeric epsilon privacy parameter</span></span>
<span id="cb79-4"><a href="#cb79-4"></a><span class="co">#' @param gs Numeric global sensitivity for the statistics of interest</span></span>
<span id="cb79-5"><a href="#cb79-5"></a><span class="co">#'</span></span>
<span id="cb79-6"><a href="#cb79-6"></a><span class="co">#' @return</span></span>
<span id="cb79-7"><a href="#cb79-7"></a><span class="co">#' </span></span>
<span id="cb79-8"><a href="#cb79-8"></a>lap_mech <span class="ot">&lt;-</span> <span class="cf">function</span>(eps, gs) {</span>
<span id="cb79-9"><a href="#cb79-9"></a>  </span>
<span id="cb79-10"><a href="#cb79-10"></a>  <span class="co"># Checking for proper values</span></span>
<span id="cb79-11"><a href="#cb79-11"></a>  <span class="cf">if</span> (<span class="fu">any</span>(eps <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb79-12"><a href="#cb79-12"></a>    <span class="fu">stop</span>(<span class="st">"The eps must be positive."</span>)</span>
<span id="cb79-13"><a href="#cb79-13"></a>  }</span>
<span id="cb79-14"><a href="#cb79-14"></a>  <span class="cf">if</span> (<span class="fu">any</span>(gs <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb79-15"><a href="#cb79-15"></a>    <span class="fu">stop</span>(<span class="st">"The GS must be positive."</span>)</span>
<span id="cb79-16"><a href="#cb79-16"></a>  }</span>
<span id="cb79-17"><a href="#cb79-17"></a>  </span>
<span id="cb79-18"><a href="#cb79-18"></a>  <span class="co"># Calculating the scale</span></span>
<span id="cb79-19"><a href="#cb79-19"></a>  scale <span class="ot">&lt;-</span> gs <span class="sc">/</span> eps</span>
<span id="cb79-20"><a href="#cb79-20"></a></span>
<span id="cb79-21"><a href="#cb79-21"></a>  r <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb79-22"><a href="#cb79-22"></a></span>
<span id="cb79-23"><a href="#cb79-23"></a>  <span class="cf">if</span>(r <span class="sc">&gt;</span> <span class="fl">0.5</span>) {</span>
<span id="cb79-24"><a href="#cb79-24"></a>    r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> r</span>
<span id="cb79-25"><a href="#cb79-25"></a>    x <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">-</span> <span class="fu">sign</span>(r <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> scale <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> r2)</span>
<span id="cb79-26"><a href="#cb79-26"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-27"><a href="#cb79-27"></a>    x <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="sc">-</span> <span class="fu">sign</span>(r <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">*</span> scale <span class="sc">*</span> <span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> r)</span>
<span id="cb79-28"><a href="#cb79-28"></a>  }</span>
<span id="cb79-29"><a href="#cb79-29"></a>  </span>
<span id="cb79-30"><a href="#cb79-30"></a>  <span class="fu">return</span>(x)</span>
<span id="cb79-31"><a href="#cb79-31"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="basics" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="basics"><span class="header-section-number">10.3.3</span> Basics</h3>
<p>R has a robust system for creating custom functions. To create a custom function, use <code>function()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb80-2"><a href="#cb80-2"></a>  </span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="st">"hello"</span></span>
<span id="cb80-4"><a href="#cb80-4"></a>   </span>
<span id="cb80-5"><a href="#cb80-5"></a>}</span>
<span id="cb80-6"><a href="#cb80-6"></a></span>
<span id="cb80-7"><a href="#cb80-7"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello"</code></pre>
</div>
</div>
<p>Oftentimes, we want to pass parameters/arguments to our functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(name) {</span>
<span id="cb82-2"><a href="#cb82-2"></a>  </span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb82-4"><a href="#cb82-4"></a>   </span>
<span id="cb82-5"><a href="#cb82-5"></a>}</span>
<span id="cb82-6"><a href="#cb82-6"></a></span>
<span id="cb82-7"><a href="#cb82-7"></a><span class="fu">say_hello</span>(<span class="at">name =</span> <span class="st">"aaron"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
</div>
<p>We can also specify default values for parameters/arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">name =</span> <span class="st">"aaron"</span>) {</span>
<span id="cb84-2"><a href="#cb84-2"></a>  </span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb84-4"><a href="#cb84-4"></a>   </span>
<span id="cb84-5"><a href="#cb84-5"></a>}</span>
<span id="cb84-6"><a href="#cb84-6"></a></span>
<span id="cb84-7"><a href="#cb84-7"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">say_hello</span>(<span class="at">name =</span> <span class="st">"alex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, alex"</code></pre>
</div>
</div>
<p><code>say_hello()</code> just prints something to the console. More often, we want to perform a bunch of operations and the then return some object like a vector or a data frame. By default, R will return the last unassigned object in a custom function. It isn’t required, but it is good practice to wrap the object to return in <code>return()</code>.</p>
<p>It’s also good practice to document functions. With your cursor inside of a function, go Insert &gt; Insert Roxygen Skeleton:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co">#' Say hello</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="co">#'</span></span>
<span id="cb88-3"><a href="#cb88-3"></a><span class="co">#' @param name A character vector with names</span></span>
<span id="cb88-4"><a href="#cb88-4"></a><span class="co">#'</span></span>
<span id="cb88-5"><a href="#cb88-5"></a><span class="co">#' @return A character vector with greetings to name</span></span>
<span id="cb88-6"><a href="#cb88-6"></a><span class="co">#' </span></span>
<span id="cb88-7"><a href="#cb88-7"></a>say_hello <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">name =</span> <span class="st">"aaron"</span>) {</span>
<span id="cb88-8"><a href="#cb88-8"></a>  </span>
<span id="cb88-9"><a href="#cb88-9"></a>  greeting <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"hello,"</span>, name)</span>
<span id="cb88-10"><a href="#cb88-10"></a>  </span>
<span id="cb88-11"><a href="#cb88-11"></a>  <span class="fu">return</span>(greeting)</span>
<span id="cb88-12"><a href="#cb88-12"></a>  </span>
<span id="cb88-13"><a href="#cb88-13"></a>}</span>
<span id="cb88-14"><a href="#cb88-14"></a></span>
<span id="cb88-15"><a href="#cb88-15"></a><span class="fu">say_hello</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron"</code></pre>
</div>
</div>
<p>As you can see from the <a href="https://jozef.io/r102-addin-roxytags/">Roxygen Skeleton</a> template above, function documentation should contain the following:</p>
<ul>
<li>A description of what the function does</li>
<li>A description of each function argument, including the class of the argument (e.g.&nbsp;string, integer, dataframe)</li>
<li>A description of what the function returns, including the class of the object</li>
</ul>
<p>Tips for writing functions:</p>
<ul>
<li>Function names should be short but effectively describe what the function does. Function names should generally be verbs while function arguments should be nouns. See the <a href="https://style.tidyverse.org/functions.html">Tidyverse style guide</a> for more details on function naming and style.</li>
<li>As a general principle, functions should each do only one task. This makes it much easier to debug your code and reuse functions!</li>
<li>Use <code>::</code> (e.g.&nbsp;<code>dplyr::filter()</code> instead of <code>filter()</code>) when writing custom functions. This will create stabler code and make it easier to develop R packages.</li>
</ul>
</section>
<section id="functions-with-multiple-outputs" class="level3" data-number="10.3.4">
<h3 data-number="10.3.4" class="anchored" data-anchor-id="functions-with-multiple-outputs"><span class="header-section-number">10.3.4</span> Functions with Multiple Outputs</h3>
<p>When <code>return()</code> is reached in a function, <code>return()</code> is evaluated, evaluation ends and R leaves the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>sow_return <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb90-2"><a href="#cb90-2"></a>  </span>
<span id="cb90-3"><a href="#cb90-3"></a>  <span class="fu">return</span>(<span class="st">"The function stops!"</span>)</span>
<span id="cb90-4"><a href="#cb90-4"></a>  </span>
<span id="cb90-5"><a href="#cb90-5"></a>  <span class="fu">return</span>(<span class="st">"This never happens!"</span>)</span>
<span id="cb90-6"><a href="#cb90-6"></a>  </span>
<span id="cb90-7"><a href="#cb90-7"></a>}</span>
<span id="cb90-8"><a href="#cb90-8"></a></span>
<span id="cb90-9"><a href="#cb90-9"></a><span class="fu">sow_return</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The function stops!"</code></pre>
</div>
</div>
<p>If the end of a function is reached without calling <code>return()</code>, the value from the last evaluated expression is returned.</p>
<p>We prefer to include <code>return()</code> at the end of functions for clarity even though <code>return()</code> doesn’t change the behavior of the function.</p>
<p>Sometimes we want to return more than one vector or data frame. <code>list()</code> is very helpful in these situations because it allows us technically to return a single object (the list) while actually passing out multiple objects (the components of the list).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>summarize_results <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb92-2"><a href="#cb92-2"></a>  </span>
<span id="cb92-3"><a href="#cb92-3"></a>  mean_x <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb92-4"><a href="#cb92-4"></a>  </span>
<span id="cb92-5"><a href="#cb92-5"></a>  median_x <span class="ot">&lt;-</span> <span class="fu">median</span>(x)</span>
<span id="cb92-6"><a href="#cb92-6"></a>  </span>
<span id="cb92-7"><a href="#cb92-7"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb92-8"><a href="#cb92-8"></a>    <span class="at">mean =</span> mean_x,</span>
<span id="cb92-9"><a href="#cb92-9"></a>    <span class="at">median =</span> median_x</span>
<span id="cb92-10"><a href="#cb92-10"></a>  )</span>
<span id="cb92-11"><a href="#cb92-11"></a>  </span>
<span id="cb92-12"><a href="#cb92-12"></a>  <span class="fu">return</span>(results)</span>
<span id="cb92-13"><a href="#cb92-13"></a>  </span>
<span id="cb92-14"><a href="#cb92-14"></a>}</span>
<span id="cb92-15"><a href="#cb92-15"></a></span>
<span id="cb92-16"><a href="#cb92-16"></a><span class="fu">summarize_results</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mean
[1] 5.5

$median
[1] 5.5</code></pre>
</div>
</div>
</section>
<section id="referential-transparency" class="level3" data-number="10.3.5">
<h3 data-number="10.3.5" class="anchored" data-anchor-id="referential-transparency"><span class="header-section-number">10.3.5</span> Referential Transparency</h3>
<p>R functions, like mathematical functions, should always return the exact same output for a given set of inputs.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> This is called referential transparency. R will not enforce this idea, so you must write good code.</p>
<section id="bad" class="level4">
<h4 class="anchored" data-anchor-id="bad">Bad!</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>bad_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb94-2"><a href="#cb94-2"></a>  </span>
<span id="cb94-3"><a href="#cb94-3"></a>  x <span class="sc">*</span> y</span>
<span id="cb94-4"><a href="#cb94-4"></a>  </span>
<span id="cb94-5"><a href="#cb94-5"></a>}</span>
<span id="cb94-6"><a href="#cb94-6"></a></span>
<span id="cb94-7"><a href="#cb94-7"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb94-8"><a href="#cb94-8"></a><span class="fu">bad_function</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb96-2"><a href="#cb96-2"></a><span class="fu">bad_function</span>(<span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</section>
<section id="good" class="level4">
<h4 class="anchored" data-anchor-id="good">Good!</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>good_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb98-2"><a href="#cb98-2"></a>  </span>
<span id="cb98-3"><a href="#cb98-3"></a>  x <span class="sc">*</span> y</span>
<span id="cb98-4"><a href="#cb98-4"></a>  </span>
<span id="cb98-5"><a href="#cb98-5"></a>}</span>
<span id="cb98-6"><a href="#cb98-6"></a>  </span>
<span id="cb98-7"><a href="#cb98-7"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb98-8"><a href="#cb98-8"></a><span class="fu">good_function</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb100-2"><a href="#cb100-2"></a><span class="fu">good_function</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>Bruno Rodriguez has a <a href="http://modern-rstats.eu/functional-programming.html#properties-of-functions">book</a> and a <a href="https://www.brodrigues.co/blog/2022-05-26-safer_programs/">blog</a> that explore this idea further.</p>
</section>
</section>
</section>
<section id="debugging" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="debugging"><span class="header-section-number">10.4</span> Debugging</h2>
<p>R code inside of custom functions can be tougher to troubleshoot than R code outside of custom functions. Fortunately, R has a powerful debugging tool.</p>
<p>The debugger requires putting custom functions in their own scripts. This is covered in <a href="#sec-organizing-an-analysis"><span>Section&nbsp;10.6</span></a>.</p>
<p>To set up the debugger, simply select the red dot to the left of a line of code in a custom function and then source the custom function. After, there should be a red dot next to the defined function in the global environment.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div id="fig-debuggera" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-debugger1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/debugger1.png" class="img-fluid figure-img" data-ref-parent="fig-debuggera"></p>
<figcaption class="figure-caption">(a)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-debugger2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/debugger2.png" class="img-fluid figure-img" data-ref-parent="fig-debuggera"></p>
<figcaption class="figure-caption">(b)</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;10.1: Setting up the debugger</figcaption><p></p>
</figure>
</div>
<p>Now, when the function is called it will stop at the red dot (the stop point). Importantly, the environment should reflect the environment inside of the function instead of the global environment.</p>
<div id="fig-debuggerb" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-debugger3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/debugger3.png" class="img-fluid figure-img" data-ref-parent="fig-debuggerb"></p>
<figcaption class="figure-caption">(a)</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-debugger4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/debugger4.png" class="img-fluid figure-img" data-ref-parent="fig-debuggerb"></p>
<figcaption class="figure-caption">(b)</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;10.2: Using the debugger</figcaption><p></p>
</figure>
</div>
<p>Finally, RStudio gives several controls for the debugger. There is a button to Continue to the end of the function. There is a button to Stop execution.</p>
<p>There is also a button with two brackets and a green arrow. This steps the debugger into another function. This is incredibly useful when functions are nested inside of functions.</p>
<p><img src="images/debugger5.png" class="img-fluid"></p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create a custom function with at least three different pieces of R code.</li>
<li>Save the function in a .R script with the same name as the function.</li>
<li>Click the little red dot to the left of first line of code in the .R script.</li>
<li>Source the function with the source button at the top right.</li>
<li>Call the function. You should enter the debugger.</li>
</ol>
</div>
</div>
</section>
<section id="benchmarking" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="benchmarking"><span class="header-section-number">10.5</span> Benchmarking</h2>
<p>Benchmarking is the process of estimating the run time of code. Oftentimes, benchmarking is used to compare multiple pieces of code to pick the more performant code. This raises a couple of issues:</p>
<ol type="1">
<li>Computing environments differ. My MacBook Pro with Apple M1 chips typically outperforms my work computer.</li>
<li>Other software can slow performance. When I open up Spotify my R processes typically slow down.</li>
</ol>
<p>We can’t solve problem 1 with an R package, but we can solve problem 2 by running tests multiple times. <a href="https://cran.r-project.org/web/packages/microbenchmark/index.html"><code>library(microbenchmark)</code></a> makes this very easy.</p>
<p>Suppose we are interested in the median of a vector of 1 million numbers. We can easily calculate this with <code>median()</code> or <code>quantile()</code>. Suppose we are concerned about computation speed, so lets test the code performance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb102-2"><a href="#cb102-2"></a></span>
<span id="cb102-3"><a href="#cb102-3"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span></span>
<span id="cb102-4"><a href="#cb102-4"></a></span>
<span id="cb102-5"><a href="#cb102-5"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(</span>
<span id="cb102-6"><a href="#cb102-6"></a>  <span class="fu">median</span>(x),</span>
<span id="cb102-7"><a href="#cb102-7"></a>  <span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fl">0.5</span>)</span>
<span id="cb102-8"><a href="#cb102-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in microbenchmark::microbenchmark(median(x), quantile(x, probs = 0.5)):
less accurate nanosecond times to avoid potential integer overflows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
                     expr      min       lq     mean   median       uq
                median(x) 6.588331 6.940254 7.985821 7.012476 8.594338
 quantile(x, probs = 0.5) 3.855927 3.942929 4.562112 4.043174 4.757127
       max neval
 44.384878   100
  7.720464   100</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 5</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s compare <code>%&gt;%</code> and <code>|&gt;</code> to see if they have comparable computation times. Consider <a href="https://stackoverflow.com/a/67683626/7109685">this example</a> from Stack Overflow, which shows <code>|&gt;</code> is clearly better.</p>
<ol type="1">
<li>Load <code>library(microbenchmark)</code> and add the <code>microbenchmark()</code> function.</li>
<li>Create <code>x1 &lt;- 1:1000000</code>, <code>x2 &lt;- 1:1000000</code>, and <code>x3 &lt;- 1:1000000</code></li>
<li>Test <code>median(x1)</code>, <code>x2 |&gt; median()</code>, and <code>x3 %&gt;% median()</code>.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ol>
</div>
</div>
</section>
<section id="sec-organizing-an-analysis" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="sec-organizing-an-analysis"><span class="header-section-number">10.6</span> Organizing an Analysis</h2>
<p>We recommend writing functions for data analysis. We need a plan for how to add custom functions to our workflow built on RStudio projects and Quarto.</p>
<p>We typically recommending adding a directory called <code>R</code> or <code>src</code> in a project directory and then sourcing scripts in to Quarto documents. Keeping functions in separate scripts makes the functions easier to use in multiple documents and simplifies the debugging process outlined above.</p>
<p>We typically only add one function to an R script in the <code>R/</code> directory and name the script after the function (without parentheses). Next, we source function scripts at the top of Quarto documents after loading packages with the <code>source()</code>. <a href="https://here.r-lib.org/"><code>library(here)</code></a> is essential if when sourcing from a Quarto document that is in a subdirectory of the project.</p>
</section>
<section id="sec-purrr" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="sec-purrr"><span class="header-section-number">10.7</span> Iteration with <code>library(purrr)</code></h2>
<p>Most functions in <code>R</code> are vectorized. That means a function operates on every element in a vector by default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1"></a>teacher_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"aaron"</span>, <span class="st">"alex"</span>, <span class="st">"alena"</span>)</span>
<span id="cb105-2"><a href="#cb105-2"></a></span>
<span id="cb105-3"><a href="#cb105-3"></a><span class="fu">say_hello</span>(<span class="at">name =</span> teacher_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron" "hello, alex"  "hello, alena"</code></pre>
</div>
</div>
<p><code>say_hello()</code> is vectorized. It works without iteration, but let’s just use it as an example to learn about iteration. Let’s start with a simple for loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># the vector over which to iterate</span></span>
<span id="cb107-2"><a href="#cb107-2"></a>teacher_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"aaron"</span>, <span class="st">"alex"</span>, <span class="st">"alena"</span>)</span>
<span id="cb107-3"><a href="#cb107-3"></a></span>
<span id="cb107-4"><a href="#cb107-4"></a><span class="co"># preallocate the output vector</span></span>
<span id="cb107-5"><a href="#cb107-5"></a>greetings <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"character"</span>, </span>
<span id="cb107-6"><a href="#cb107-6"></a>                    <span class="at">length =</span> <span class="fu">length</span>(teacher_names)</span>
<span id="cb107-7"><a href="#cb107-7"></a>                    )</span>
<span id="cb107-8"><a href="#cb107-8"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(teacher_names)) {</span>
<span id="cb107-9"><a href="#cb107-9"></a>  </span>
<span id="cb107-10"><a href="#cb107-10"></a>  greetings[i] <span class="ot">&lt;-</span> <span class="fu">say_hello</span>(teacher_names[i])</span>
<span id="cb107-11"><a href="#cb107-11"></a>  </span>
<span id="cb107-12"><a href="#cb107-12"></a>}</span>
<span id="cb107-13"><a href="#cb107-13"></a></span>
<span id="cb107-14"><a href="#cb107-14"></a><span class="co"># print the result</span></span>
<span id="cb107-15"><a href="#cb107-15"></a>greetings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron" "hello, alex"  "hello, alena"</code></pre>
</div>
</div>
<p>That’s a lot of typing. It is much more common in R to use <code>library(purrr)</code>, which replaces apply functions.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> <code>map()</code> iterates over each element of a data structure called <code>.x</code>, applies a function called <code>.f</code> to each element, and then returns a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb109-2"><a href="#cb109-2"></a></span>
<span id="cb109-3"><a href="#cb109-3"></a>teacher_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"aaron"</span>, <span class="st">"alex"</span>, <span class="st">"alena"</span>)</span>
<span id="cb109-4"><a href="#cb109-4"></a><span class="fu">map</span>(<span class="at">.x =</span> teacher_names, <span class="at">.f =</span> say_hello)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "hello, aaron"

[[2]]
[1] "hello, alex"

[[3]]
[1] "hello, alena"</code></pre>
</div>
</div>
<p><code>map()</code> always returns a list. Sometimes we want to do something called map reduce. Functions like <code>map_chr()</code>, <code>map_dbl()</code>, and <code>map_df()</code> will map reduce. In this case, <code>map_chr()</code> returns a character vector instead of a list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1"></a><span class="fu">map_chr</span>(<span class="at">.x =</span> teacher_names, <span class="at">.f =</span> say_hello)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hello, aaron" "hello, alex"  "hello, alena"</code></pre>
</div>
</div>
<p>We can quickly add anonymous functions in <code>map()</code> and its relatives with <code>~</code>. A tibble is just a list of columns. This function iterates over each column, counts the number of missing values, and then returns a named vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1"></a><span class="fu">map_dbl</span>(<span class="at">.x =</span> msleep, <span class="at">.f =</span> <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        name        genus         vore        order conservation  sleep_total 
           0            0            7            0           29            0 
   sleep_rem  sleep_cycle        awake      brainwt       bodywt 
          22           51            0           27            0 </code></pre>
</div>
</div>
<p>The purrr library also has functions that can iterate over multiple inputs simultaneously. To figure out which purrr function to use ask the following:</p>
<ul>
<li>How many inputs do I have? Is it one (<code>map</code>), two (<code>map2</code>), or 3+ (<code>pmap</code>)?</li>
<li>What do I want back? A numeric vector (<code>dbl</code>), character vector (<code>chr</code>), dataframe created by column-binding (<code>dfc</code>), dataframe created by row-binding (<code>dfr</code>), etc?</li>
</ul>
<p>The <a href="https://github.com/rstudio/cheatsheets/blob/main/purrr.pdf">purrr cheatsheet</a> is a great place to go for help using purrr and outlines the different function options. You can also see the <a href="https://purrr.tidyverse.org/reference/index.html">purrr documentation</a> for more details.</p>
</section>
<section id="conclusion" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">10.8</span> Conclusion</h2>
<p>R has many useful built-in functions, and you can easily install other extremely useful functions by loading in R packages. However, in many cases, it is useful to write your own custom functions. This section illustrated how to write custom R functions with the <code>function() {}</code> syntax. When writing R functions, R’s debugger is extremely helpful to implement “break points” which can help identify errors. Custom functions can be especially powerful when combined with iteration, and the tidyverse’s <code>purrr</code> package offers an elegant way to apply this concept. Lastly, this section covers other programming fundamentals like <code>if</code> <code>else</code> statements, <code>for</code> loops and <code>while</code> loops.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-barrientos2021" class="csl-entry" role="listitem">
Barrientos, Andrés F., Aaron R. Williams, Joshua Snoke, and Claire McKay Bowen. 2021. <span>“A Feasibility Study of Differentially Private Summary Statistics and Regression Analyses with Evaluations on Administrative and Survey Data.”</span> <a href="https://doi.org/10.48550/ARXIV.2110.12055">https://doi.org/10.48550/ARXIV.2110.12055</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This rule won’t exactly hold if the function contains random or stochastic code. In those cases, the function should return the same output every time if the seed is set with <code>set.seed()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>According to Hadley Wickham, “You can think of an environment as a bag of names. Each name points to an object stored elsewhere in memory.” For more details, see the <a href="http://adv-r.had.co.nz/Environments.html#env-basics">Environments chapter</a> of Advanced R.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Don’t be surprised when <code>microbenchmark::microbenchmark()</code> returns a row with expr <code>median(x2)</code> instead of <code>x2 |&gt; median()</code>. This is expected behavior because the base pipe is implemented as a syntax transformation. You can read more about this in <a href="https://www.r-bloggers.com/2021/05/the-new-r-pipe/">this blog</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>“Apply functions” refers to a family of base R functions like <code>lapply()</code>. The <code>map()</code> family is similar, but it has more helper functions. You can read more in <a href="https://adv-r.hadley.nz/functionals.html"><em>Advanced R</em></a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09_advanced-git.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12_apis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>