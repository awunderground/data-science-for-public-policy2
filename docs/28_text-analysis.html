<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 24&nbsp; Text Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./29_text-modeling.html" rel="next">
<link href="./30_geospatial.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./30_geospatial.html">Other Topics</a></li><li class="breadcrumb-item"><a href="./28_text-analysis.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Text Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">24.1</span> Motivation</a>
  <ul class="collapse">
  <li><a href="#document-summarization" id="toc-document-summarization" class="nav-link" data-scroll-target="#document-summarization"><span class="header-section-number">24.1.1</span> 1. Document Summarization</a></li>
  <li><a href="#text-classification-supervised" id="toc-text-classification-supervised" class="nav-link" data-scroll-target="#text-classification-supervised"><span class="header-section-number">24.1.2</span> 2. Text Classification (supervised)</a></li>
  <li><a href="#document-grouping-unsupervised" id="toc-document-grouping-unsupervised" class="nav-link" data-scroll-target="#document-grouping-unsupervised"><span class="header-section-number">24.1.3</span> 3. Document Grouping (unsupervised)</a></li>
  <li><a href="#text-extraction" id="toc-text-extraction" class="nav-link" data-scroll-target="#text-extraction"><span class="header-section-number">24.1.4</span> 4. Text Extraction</a></li>
  <li><a href="#other" id="toc-other" class="nav-link" data-scroll-target="#other"><span class="header-section-number">24.1.5</span> Other</a></li>
  </ul></li>
  <li><a href="#tools" id="toc-tools" class="nav-link" data-scroll-target="#tools"><span class="header-section-number">24.2</span> Tools</a>
  <ul class="collapse">
  <li><a href="#frequency" id="toc-frequency" class="nav-link" data-scroll-target="#frequency"><span class="header-section-number">24.2.1</span> Frequency</a></li>
  <li><a href="#collocation" id="toc-collocation" class="nav-link" data-scroll-target="#collocation"><span class="header-section-number">24.2.2</span> Collocation</a></li>
  </ul></li>
  <li><a href="#topic-modeling" id="toc-topic-modeling" class="nav-link" data-scroll-target="#topic-modeling"><span class="header-section-number">24.3</span> Topic Modeling</a></li>
  <li><a href="#natural-language-processing" id="toc-natural-language-processing" class="nav-link" data-scroll-target="#natural-language-processing"><span class="header-section-number">24.4</span> Natural Language Processing</a>
  <ul class="collapse">
  <li><a href="#key-challenge" id="toc-key-challenge" class="nav-link" data-scroll-target="#key-challenge"><span class="header-section-number">24.4.1</span> Key Challenge</a></li>
  </ul></li>
  <li><a href="#vocabulary-tidy-data" id="toc-vocabulary-tidy-data" class="nav-link" data-scroll-target="#vocabulary-tidy-data"><span class="header-section-number">24.5</span> Vocabulary &amp; Tidy Data</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">24.6</span> Example 1</a>
  <ul class="collapse">
  <li><a href="#approach-1" id="toc-approach-1" class="nav-link" data-scroll-target="#approach-1"><span class="header-section-number">24.6.1</span> Approach 1</a></li>
  <li><a href="#approach-2" id="toc-approach-2" class="nav-link" data-scroll-target="#approach-2"><span class="header-section-number">24.6.2</span> Approach 2</a></li>
  <li><a href="#approach-3" id="toc-approach-3" class="nav-link" data-scroll-target="#approach-3"><span class="header-section-number">24.6.3</span> Approach 3</a></li>
  </ul></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="header-section-number">24.7</span> Example 2</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">24.8</span> Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./30_geospatial.html">Other Topics</a></li><li class="breadcrumb-item"><a href="./28_text-analysis.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Text Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Text Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    In this chapter, we introduce fundamental ideas for text analysis.
  </div>
</div>


</header>


<p><img src=".png" class="img-fluid"></p>
<section id="motivation" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">24.1</span> Motivation</h2>
<p>Before providing motivation, let’s define two key terms.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Text Corpus
</div>
</div>
<div class="callout-body-container callout-body">
<p>A set of text. A corpus generally has theme such as “The Federalist Papers” or Jane Austin novels.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Text analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process of deriving information from text using algorithms and statistical analysis.</p>
</div>
</div>
<p>Text analysis has broad applications that extend well beyond policy analysis. We will briefly focus on four applications that are related to policy analysis.</p>
<section id="document-summarization" class="level3" data-number="24.1.1">
<h3 data-number="24.1.1" class="anchored" data-anchor-id="document-summarization"><span class="header-section-number">24.1.1</span> 1. Document Summarization</h3>
<p>The process of condensing the amount of information in a document into a useful subset of information. Techniques range from counting words to using complex machine learning algorithms.</p>
<p><strong>Example:</strong> Frederick Mosteller and David Wallace used Bayesian statistics and the frequency of certain words to identify the authorship of the twelve unclaimed Federalist papers. (<a href="https://priceonomics.com/how-statistics-solved-a-175-year-old-mystery-about/">blog</a>) Before estimating any models, they spent months cutting out each word of the Federalist Papers and the counting the frequency of words.</p>
</section>
<section id="text-classification-supervised" class="level3" data-number="24.1.2">
<h3 data-number="24.1.2" class="anchored" data-anchor-id="text-classification-supervised"><span class="header-section-number">24.1.2</span> 2. Text Classification (supervised)</h3>
<p>The process of labeling documents with a predetermined set of labels.</p>
<p><strong>Example:</strong> Researchers in the Justice Policy Center at the Urban Institute classified millions of tweets with the word “cop” or “police” as “positive”, “negative”, “neutral”, or “not applicable” for sentiment and “crime or incident information”, “department or event information”, “traffic or weather updates”, “person identification”, or “other” for topic. The researchers created content and metadata features, manually labeled a few thousand tweets for training data, and used gradient boosting for supervised machine learning for the task. (<a href="https://medium.com/@urban_institute/how-to-categorize-large-amounts-of-text-data-71e1fd590e2a">blog</a>)</p>
<p><strong>Example:</strong> Frederick Mosteller and David Wallace used Bayesian statistics and the frequency of certain words to identify the authorship of the twelve unclaimed Federalist papers. (<a href="https://priceonomics.com/how-statistics-solved-a-175-year-old-mystery-about/">blog</a>)</p>
</section>
<section id="document-grouping-unsupervised" class="level3" data-number="24.1.3">
<h3 data-number="24.1.3" class="anchored" data-anchor-id="document-grouping-unsupervised"><span class="header-section-number">24.1.3</span> 3. Document Grouping (unsupervised)</h3>
<p>The algorithmic grouping or clustering of documents using features extracted from the documents. This includes unsupervised classification of documents into meaningful groups. Techniques like topic modeling result in lists of important words that can be used to summarize and label the documents while techniques like K-means clustering result in arbitrary cluster labels.</p>
<p><strong>Example:</strong> Pew Research used <em>unsupervised</em> and <em>semi-supervised</em> methods to create topic models of open-ended text responses about where Americans find meaning in their lives. (<a href="https://medium.com/pew-research-center-decoded/overcoming-the-limitations-of-topic-models-with-a-semi-supervised-approach-b947374e0455">blog</a>)</p>
</section>
<section id="text-extraction" class="level3" data-number="24.1.4">
<h3 data-number="24.1.4" class="anchored" data-anchor-id="text-extraction"><span class="header-section-number">24.1.4</span> 4. Text Extraction</h3>
<p>Text often contains important unstructured information that would be useful to have in a structured format like a table. Text extraction is the process of searching and identifying key entities or concepts from unstructured text and then placing them in a structured format.</p>
<p><strong>Example:</strong> Researchers from Cornell counted sources of misinformation from 38 million articles. <a href="https://www.nytimes.com/2020/09/30/us/politics/trump-coronavirus-misinformation.html?referringSource=articleShare">NYTimes</a>. <a href="https://int.nyt.com/data/documenttools/evanega-et-al-coronavirus-misinformation-submitted-07-23-20-1/080839ac0c22bca8/full.pdf">Methodology</a>.</p>
</section>
<section id="other" class="level3" data-number="24.1.5">
<h3 data-number="24.1.5" class="anchored" data-anchor-id="other"><span class="header-section-number">24.1.5</span> Other</h3>
<p>Speech recognition, machine translation, question answering, and text autocompletion are other forms of text analysis and language processing that are common but not implemented with R packages.</p>
</section>
</section>
<section id="tools" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="tools"><span class="header-section-number">24.2</span> Tools</h2>
<section id="frequency" class="level3" data-number="24.2.1">
<h3 data-number="24.2.1" class="anchored" data-anchor-id="frequency"><span class="header-section-number">24.2.1</span> Frequency</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Term Frequency
</div>
</div>
<div class="callout-body-container callout-body">
<p>A count or relative frequency of the most common words in a document or documents.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Term Frequency-Inverse Document Frequency (TF-IDF)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some words are naturally more common than other words. TF-IDF quantifies the importance of words/terms in one document relative to other documents in a corpus.</p>
<p><span class="math display">\[TF-IDF = TF(t, d) \cdot IDF(t)\]</span></p>
<p>where <span class="math inline">\(TF(t, d)\)</span> is the relative frequency of term <span class="math inline">\(t\)</span> in document <span class="math inline">\(d\)</span> and <span class="math inline">\(IDF(t)\)</span> is the inverse frequency of the number of document where the term appears.</p>
<p><span class="math display">\[TF-IDF = \frac{f_{t, d}}{\sum_{t' \in d} f_{t', d}} \cdot \left(\log\left(\frac{1 + n}{1 + df(d, f)}\right) + 1\right)\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Word cloud
</div>
</div>
<div class="callout-body-container callout-body">
<p>A method of visualizing word frequency where the frequency of a given word is encoded as the size of the word.</p>
</div>
</div>
<p>Word clouds are overused and are tough to interpret. <a href="https://news.gallup.com/poll/195596/email-dominates-americans-heard-clinton.aspx">This 2016 election word cloud</a> by Gallup is an exceptional word cloud.</p>
</section>
<section id="collocation" class="level3" data-number="24.2.2">
<h3 data-number="24.2.2" class="anchored" data-anchor-id="collocation"><span class="header-section-number">24.2.2</span> Collocation</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
N-gram
</div>
</div>
<div class="callout-body-container callout-body">
<p>A consecutive sequence of <em>n</em> words. Unigrams are words, bigrams are pairs of words, and trigrams are groups of three words.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
N-gram frequency
</div>
</div>
<div class="callout-body-container callout-body">
<p>A count or relative frequency of n-grams in a document or documents.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TF-IDF of N-grams
</div>
</div>
<div class="callout-body-container callout-body">
<p>TF-IDF with n-grams instead of words.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bigram graph
</div>
</div>
<div class="callout-body-container callout-body">
<p>A directed or undirected graph with individual words as nodes and bigrams as edges. <a href="https://www.tidytextmining.com/ngrams.html">Example</a></p>
</div>
</div>
</section>
</section>
<section id="topic-modeling" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="topic-modeling"><span class="header-section-number">24.3</span> Topic Modeling</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Topic modeling
</div>
</div>
<div class="callout-body-container callout-body">
<p>Unsupervised and semi-supervised methods for grouping documents. <a href="https://medium.com/pew-research-center-decoded/overcoming-the-limitations-of-topic-models-with-a-semi-supervised-approach-b947374e0455">Example</a></p>
<p>Popular methods include:</p>
<ul>
<li>Latent Dirichlet Allocation (LDA)</li>
<li>Non-Negative Matrix Factorization</li>
<li>CorEx (Correlation Explanation)</li>
</ul>
</div>
</div>
</section>
<section id="natural-language-processing" class="level2" data-number="24.4">
<h2 data-number="24.4" class="anchored" data-anchor-id="natural-language-processing"><span class="header-section-number">24.4</span> Natural Language Processing</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Natural language processing
</div>
</div>
<div class="callout-body-container callout-body">
<p>The algorithmic analysis of text in a way that is rooted in linguistics. <a href="https://stanfordnlp.github.io/CoreNLP/">Stanford CoreNLP</a> is an important tool for natural language processing.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sentiment analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process of labeling words or sentences as positive, neutral, or negative.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Named entity recognition
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process of identifying names, places, organizations, and more in text.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parts of speech tagging
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process of identifying the part of speech of each word (noun, verb, etc.).</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lemmatization
</div>
</div>
<div class="callout-body-container callout-body">
<p>The process of shortening words to a base grammar.</p>
</div>
</div>
<section id="key-challenge" class="level3" data-number="24.4.1">
<h3 data-number="24.4.1" class="anchored" data-anchor-id="key-challenge"><span class="header-section-number">24.4.1</span> Key Challenge</h3>
<p><code>R</code> and <code>Python</code> have powerful tools for text analysis.</p>
<p><strong>Key challenge:</strong> text contains a lot of useful information but its structure does not match how we have done data analysis up to this point.</p>
</section>
</section>
<section id="vocabulary-tidy-data" class="level2" data-number="24.5">
<h2 data-number="24.5" class="anchored" data-anchor-id="vocabulary-tidy-data"><span class="header-section-number">24.5</span> Vocabulary &amp; Tidy Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>fed_papers <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="at">gutenberg_id =</span> <span class="dv">1404</span>, </span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="at">mirror =</span> <span class="st">"http://mirror.csclub.uwaterloo.ca/gutenberg"</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>fed_papers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58,077 × 2
   gutenberg_id text                                                
          &lt;int&gt; &lt;chr&gt;                                               
 1         1404 "THE FEDERALIST PAPERS"                             
 2         1404 "THE FEDERALIST PAPERS"                             
 3         1404 "THE FEDERALIST PAPERS"                             
 4         1404 ""                                                  
 5         1404 ""                                                  
 6         1404 ""                                                  
 7         1404 "By Alexander Hamilton, John Jay, and James Madison"
 8         1404 "By Alexander Hamilton, John Jay, and James Madison"
 9         1404 "By Alexander Hamilton, John Jay, and James Madison"
10         1404 ""                                                  
# ℹ 58,067 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>fed_paper1 <span class="ot">&lt;-</span> fed_papers <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">&amp;</span> <span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">165</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Token
</div>
</div>
<div class="callout-body-container callout-body">
<p>A meaningful unit of text. Tokens include works, phrases, and sentences.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tokenization
</div>
</div>
<div class="callout-body-container callout-body">
<p>Process of splitting a larger unit of text into tokens. For example, “data science is useful” can be “data”, “science”, “is”, “useful”.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># tidytext can tokenize text with unnest_tokens()</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>tidy_fed_paper1 <span class="ot">&lt;-</span> fed_paper1 <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> text)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>tidy_fed_paper1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,297 × 2
   gutenberg_id word     
          &lt;int&gt; &lt;chr&gt;    
 1         1404 by       
 2         1404 alexander
 3         1404 hamilton 
 4         1404 john     
 5         1404 jay      
 6         1404 and      
 7         1404 james    
 8         1404 madison  
 9         1404 by       
10         1404 alexander
# ℹ 1,287 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stemming
</div>
</div>
<div class="callout-body-container callout-body">
<p>A method of removing the end, and keeping only the root, of a word. Stemming is unaware of the context or use of the word. <a href="https://smltar.com/stemming.html#how-to-stem-text-in-r">Example</a></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># SnowballC has a stemmer that works well with tidytext</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a>tidy_fed_paper1 <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">mutate</span>(<span class="at">stem =</span> <span class="fu">wordStem</span>(word)) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">filter</span>(word <span class="sc">!=</span> stem)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 471 × 3
   gutenberg_id word         stem     
          &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;    
 1         1404 alexander    alexand  
 2         1404 jay          jai      
 3         1404 james        jame     
 4         1404 alexander    alexand  
 5         1404 jay          jai      
 6         1404 james        jame     
 7         1404 general      gener    
 8         1404 introduction introduct
 9         1404 general      gener    
10         1404 introduction introduct
# ℹ 461 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lemmatizing
</div>
</div>
<div class="callout-body-container callout-body">
<p>A method of returning the base of a word. Lemmatization considers the context of a word. <a href="https://smltar.com/stemming.html#lemmatization">Example</a> Lemmatizing requires natural language processing, so this requires Stanford CoreNLP or the Python package spaCy, which can be accessed in R via <code>library(spacyr)</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop words
</div>
</div>
<div class="callout-body-container callout-body">
<p>Extremely common words that are often not useful for text analysis. <code>library(tidytext)</code> contains stop words from the <code>onix</code>, <code>SMART</code>, and <code>snowball</code> lexicons.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>stop_words</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,149 × 2
   word        lexicon
   &lt;chr&gt;       &lt;chr&gt;  
 1 a           SMART  
 2 a's         SMART  
 3 able        SMART  
 4 about       SMART  
 5 above       SMART  
 6 according   SMART  
 7 accordingly SMART  
 8 across      SMART  
 9 actually    SMART  
10 after       SMART  
# ℹ 1,139 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tidy text
</div>
</div>
<div class="callout-body-container callout-body">
<p>A table with one token per row.” ~ <a href="https://www.tidytextmining.com/">Text Mining with R</a></p>
</div>
</div>
<p>Text can also be stored as a string, a corpus, and a document-term matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># tidy text format</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>tidy_fed_paper1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,297 × 2
   gutenberg_id word     
          &lt;int&gt; &lt;chr&gt;    
 1         1404 by       
 2         1404 alexander
 3         1404 hamilton 
 4         1404 john     
 5         1404 jay      
 6         1404 and      
 7         1404 james    
 8         1404 madison  
 9         1404 by       
10         1404 alexander
# ℹ 1,287 more rows</code></pre>
</div>
</div>
</section>
<section id="example-1" class="level2" data-number="24.6">
<h2 data-number="24.6" class="anchored" data-anchor-id="example-1"><span class="header-section-number">24.6</span> Example 1</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># load necessary packages</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="fu">library</span>(SnowballC)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co"># download the Federalist Papers from Project Gutenberg</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>fed_papers <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(</span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="at">gutenberg_id =</span> <span class="dv">1404</span>, </span>
<span id="cb12-10"><a href="#cb12-10"></a>  <span class="at">mirror =</span> <span class="st">"http://mirror.csclub.uwaterloo.ca/gutenberg"</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>)</span>
<span id="cb12-12"><a href="#cb12-12"></a></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co"># this data cleaning comes from Emil Hvitfeldt</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co"># https://www.hvitfeldt.me/blog/predicting-authorship-in-the-</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co"># federalist-papers-with-tidytext/</span></span>
<span id="cb12-16"><a href="#cb12-16"></a>hamilton <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">21</span><span class="sc">:</span><span class="dv">36</span>, <span class="dv">59</span><span class="sc">:</span><span class="dv">61</span>, <span class="dv">65</span><span class="sc">:</span><span class="dv">85</span>)</span>
<span id="cb12-17"><a href="#cb12-17"></a>madison <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">14</span>, <span class="dv">18</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">37</span><span class="sc">:</span><span class="dv">48</span>)</span>
<span id="cb12-18"><a href="#cb12-18"></a>jay <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">64</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a>unknown <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">49</span><span class="sc">:</span><span class="dv">58</span>, <span class="dv">62</span><span class="sc">:</span><span class="dv">63</span>)</span>
<span id="cb12-20"><a href="#cb12-20"></a></span>
<span id="cb12-21"><a href="#cb12-21"></a>fed_papers <span class="ot">&lt;-</span> <span class="fu">pull</span>(fed_papers, text) <span class="sc">|&gt;</span></span>
<span id="cb12-22"><a href="#cb12-22"></a>  <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>  <span class="fu">str_split</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">?|</span><span class="sc">\\</span><span class="st">!"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-24"><a href="#cb12-24"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>  <span class="fu">tibble</span>(<span class="at">text =</span> .) <span class="sc">|&gt;</span></span>
<span id="cb12-26"><a href="#cb12-26"></a>  <span class="fu">mutate</span>(<span class="at">sentence =</span> <span class="fu">row_number</span>())</span>
<span id="cb12-27"><a href="#cb12-27"></a></span>
<span id="cb12-28"><a href="#cb12-28"></a>tidy_fed_papers <span class="ot">&lt;-</span> fed_papers <span class="sc">|&gt;</span></span>
<span id="cb12-29"><a href="#cb12-29"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-30"><a href="#cb12-30"></a>    <span class="at">paper_number =</span> <span class="fu">cumsum</span>(</span>
<span id="cb12-31"><a href="#cb12-31"></a>      <span class="fu">str_detect</span>(</span>
<span id="cb12-32"><a href="#cb12-32"></a>        text, </span>
<span id="cb12-33"><a href="#cb12-33"></a>        <span class="fu">regex</span>(<span class="st">"FEDERALIST No"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb12-34"><a href="#cb12-34"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-35"><a href="#cb12-35"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">|&gt;</span></span>
<span id="cb12-36"><a href="#cb12-36"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-37"><a href="#cb12-37"></a>    <span class="at">author =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-38"><a href="#cb12-38"></a>      paper_number <span class="sc">%in%</span> hamilton <span class="sc">~</span> <span class="st">"hamilton"</span>,</span>
<span id="cb12-39"><a href="#cb12-39"></a>      paper_number <span class="sc">%in%</span> madison <span class="sc">~</span> <span class="st">"madison"</span>,</span>
<span id="cb12-40"><a href="#cb12-40"></a>      paper_number <span class="sc">%in%</span> jay <span class="sc">~</span> <span class="st">"jay"</span>,</span>
<span id="cb12-41"><a href="#cb12-41"></a>      paper_number <span class="sc">%in%</span> unknown <span class="sc">~</span> <span class="st">"unknown"</span></span>
<span id="cb12-42"><a href="#cb12-42"></a>    )</span>
<span id="cb12-43"><a href="#cb12-43"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="approach-1" class="level3" data-number="24.6.1">
<h3 data-number="24.6.1" class="anchored" data-anchor-id="approach-1"><span class="header-section-number">24.6.1</span> Approach 1</h3>
<p>Here we’ll calculate term frequency without stop words and with stemming.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># filter to main authors</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>tidy_fed_papers1 <span class="ot">&lt;-</span> tidy_fed_papers <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">filter</span>(author <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"hamilton"</span>, <span class="st">"madison"</span>))</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co"># remove stop words and stem the words</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>tidy_fed_papers1 <span class="ot">&lt;-</span> tidy_fed_papers1 <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">wordStem</span>(word))</span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co"># count Hamilton's most-frequent words</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>tidy_fed_papers1 <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">filter</span>(author <span class="sc">==</span> <span class="st">"hamilton"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,728 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 govern        648
 2 nation        510
 3 peopl         363
 4 power         360
 5 union         315
 6 time          234
 7 author        198
 8 danger        192
 9 confederaci   186
10 countri       183
# ℹ 2,718 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># count Madison's most-frequent words</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>tidy_fed_papers1 <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">filter</span>(author <span class="sc">==</span> <span class="st">"madison"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,592 × 2
   word            n
   &lt;chr&gt;       &lt;int&gt;
 1 govern        174
 2 nation        153
 3 union         108
 4 power          96
 5 war            81
 6 confederaci    69
 7 peopl          69
 8 form           63
 9 object         63
10 time           63
# ℹ 1,582 more rows</code></pre>
</div>
</div>
</section>
<section id="approach-2" class="level3" data-number="24.6.2">
<h3 data-number="24.6.2" class="anchored" data-anchor-id="approach-2"><span class="header-section-number">24.6.2</span> Approach 2</h3>
<p>Here we’ll perform TF-IDF.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># calculate tf-idf</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>tf_idf <span class="ot">&lt;-</span> tidy_fed_papers <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">count</span>(author, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">bind_tf_idf</span>(<span class="at">term =</span> word, <span class="at">document =</span> author, <span class="at">n =</span> n) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: A value for tf_idf is negative:
 Input should have exactly one row per document-term combination.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># plot</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>tf_idf <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">filter</span>(author <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"hamilton"</span>, <span class="st">"madison"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">group_by</span>(author) <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="fu">top_n</span>(<span class="dv">15</span>, tf_idf) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, tf_idf)) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(tf_idf, word, <span class="at">fill =</span> author)) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>author, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="28_text-analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="approach-3" class="level3" data-number="24.6.3">
<h3 data-number="24.6.3" class="anchored" data-anchor-id="approach-3"><span class="header-section-number">24.6.3</span> Approach 3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>tidy_fed_papers <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">count</span>(author, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">filter</span>(word <span class="sc">==</span> <span class="st">"upon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  author   word      n
  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;
1 &lt;NA&gt;     upon    813
2 hamilton upon    225
3 madison  upon     66
4 unknown  upon     39
5 jay      upon     18</code></pre>
</div>
</div>
</section>
</section>
<section id="example-2" class="level2" data-number="24.7">
<h2 data-number="24.7" class="anchored" data-anchor-id="example-2"><span class="header-section-number">24.7</span> Example 2</h2>
<p>Let’s consider ten of Shakespeare’s plays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="dv">2265</span>, <span class="co"># Hamlet </span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="dv">1795</span>, <span class="co"># Macbeth </span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="dv">1522</span>, <span class="co"># Julius Caesar </span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="dv">2235</span>, <span class="co"># The Tempest </span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="dv">1780</span>, <span class="co"># 1 Henry IV </span></span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="dv">1532</span>, <span class="co"># King Lear</span></span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="dv">1513</span>, <span class="co"># Romeo and Juliet </span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="dv">1110</span>, <span class="co"># King John</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="dv">1519</span>, <span class="co"># Much Ado About Nothing</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="dv">1539</span>  <span class="co"># The Winter's Tale</span></span>
<span id="cb22-12"><a href="#cb22-12"></a>)</span>
<span id="cb22-13"><a href="#cb22-13"></a></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="co"># download corpus</span></span>
<span id="cb22-15"><a href="#cb22-15"></a>shakespeare <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(</span>
<span id="cb22-16"><a href="#cb22-16"></a>  <span class="at">gutenberg_id =</span> ids,</span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="at">meta_fields =</span> <span class="st">"title"</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Determining mirror for Project Gutenberg from
https://www.gutenberg.org/robot/harvest.
Using mirror http://aleph.gutenberg.org.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># create tokens and drop character cues</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>shakespeare_clean <span class="ot">&lt;-</span> shakespeare <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">unnest_tokens</span>(word, text, <span class="at">to_lower =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">filter</span>(word <span class="sc">!=</span> <span class="fu">str_to_upper</span>(word)) </span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co"># calculate TF-IDF</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>shakespeare_tf_idf <span class="ot">&lt;-</span> shakespeare_clean <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>  <span class="fu">count</span>(title, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">bind_tf_idf</span>(<span class="at">term =</span> word, <span class="at">document =</span> title, <span class="at">n =</span> n)</span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="co"># plot</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>shakespeare_tf_idf <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13"></a>  <span class="fu">group_by</span>(title) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>  <span class="fu">top_n</span>(<span class="dv">8</span>, tf_idf) <span class="sc">|&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder</span>(word, tf_idf)) <span class="sc">|&gt;</span></span>
<span id="cb24-16"><a href="#cb24-16"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(tf_idf, word, <span class="at">fill =</span> title)) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>title, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="28_text-analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resources" class="level2" data-number="24.8">
<h2 data-number="24.8" class="anchored" data-anchor-id="resources"><span class="header-section-number">24.8</span> Resources</h2>
<ul>
<li><a href="https://www.nber.org/digest-202012/corporate-reporting-era-artificial-intelligence">Corporate Reporting in the Era of Artificial Intelligence</a></li>
<li><a href="https://www.tidytextmining.com/">Text Mining with R</a> by Julia Silge and David Robinson</li>
<li><a href="https://smltar.com/">Supervised Machine Learning for Text Analysis in R</a> by Emil Hvitfledt and Julia Silge</li>
<li><a href="http://corpustext.com/index.html">Corpus</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./30_geospatial.html" class="pagination-link" aria-label="Geospatial Analysis with sf">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./29_text-modeling.html" class="pagination-link" aria-label="Text Modeling">
        <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Text Modeling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>