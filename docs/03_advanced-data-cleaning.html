<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 1&nbsp; Advanced Data Cleaning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07_advanced-quarto.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_advanced-data-cleaning.html">Basics</a></li><li class="breadcrumb-item"><a href="./03_advanced-data-cleaning.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Predictive Modeling Review</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Other Topics</span></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-review2" id="toc-sec-review2" class="nav-link active" data-scroll-target="#sec-review2"><span class="header-section-number">1.1</span> Review</a></li>
  <li><a href="#sec-import" id="toc-sec-import" class="nav-link" data-scroll-target="#sec-import"><span class="header-section-number">1.2</span> Import</a>
  <ul class="collapse">
  <li><a href="#libraryhere" id="toc-libraryhere" class="nav-link" data-scroll-target="#libraryhere"><span class="header-section-number">1.2.1</span> <code>library(here)</code></a></li>
  <li><a href="#libraryreadxl" id="toc-libraryreadxl" class="nav-link" data-scroll-target="#libraryreadxl"><span class="header-section-number">1.2.2</span> <code>library(readxl)</code></a></li>
  </ul></li>
  <li><a href="#sec-tidy" id="toc-sec-tidy" class="nav-link" data-scroll-target="#sec-tidy"><span class="header-section-number">1.3</span> Tidy</a></li>
  <li><a href="#sec-transform" id="toc-sec-transform" class="nav-link" data-scroll-target="#sec-transform"><span class="header-section-number">1.4</span> Transform</a>
  <ul class="collapse">
  <li><a href="#strings" id="toc-strings" class="nav-link" data-scroll-target="#strings"><span class="header-section-number">1.4.1</span> Strings</a></li>
  <li><a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"><span class="header-section-number">1.4.2</span> Factors</a></li>
  <li><a href="#dates-and-date-times" id="toc-dates-and-date-times" class="nav-link" data-scroll-target="#dates-and-date-times"><span class="header-section-number">1.4.3</span> Dates and Date-Times</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">1.4.4</span> Missing Data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    This section covers advanced techniques for cleaning and manipulating data.
  </div>
</div>

</header>

<section id="sec-review2" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-review2"><span class="header-section-number">1.1</span> Review</h2>
<p>R for Data Science (2e) <a href="https://r4ds.hadley.nz/intro.html#fig-ds-diagram">displays</a> the first steps of the data science process as “Import”, “Tidy”, and “Transform”. DSPP1 introduced important techniques for importing data like <code>read_csv()</code> and querying web APIs, for tidying data like <code>pivot_longer()</code>, and for transforming data like <code>mutate()</code>.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use <code>mutate()</code> and <code>case_when()</code> to add a new variable called <code>speed_cat</code> to <code>cars</code> where the values are <code>"slow"</code> when <code>speed &lt; 10</code>, <code>"moderate"</code> when <code>speed &lt; 20</code>, and <code>"fast"</code> otherwise.</li>
</ol>
</div>
</div>
</section>
<section id="sec-import" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-import"><span class="header-section-number">1.2</span> Import</h2>
<section id="libraryhere" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="libraryhere"><span class="header-section-number">1.2.1</span> <code>library(here)</code></h3>
<p>Developing Quarto documents in subdirectories is a pain. When interactively running code in the console, file paths are read as if the <code>.qmd</code> file is in the same folder as the <code>.Rproj</code>. When clicking render, paths are treated as if they are in the subdirectory where the <code>.qmd</code> file is.</p>
<p><a href="https://here.r-lib.org/"><code>library(here)</code></a> resolves headaches around file referencing in <a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/">project-oriented workflows</a>.</p>
<p>Loading <code>library(here)</code> will print your working directory.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/gabemorrison/Documents/Github/data-science-for-public-policy2</code></pre>
</div>
</div>
<p>After this, <code>here()</code> will use reasonable heuristics to find project files using relative file paths. When placing Quarto documents in a directory below the top-level directory, use <code>here()</code> and treat each folder and file as a different string.</p>
<p><strong>Before</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">read_csv</span>(<span class="st">"data/raw/important-data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>After</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"raw"</span>, <span class="st">"important-data.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="libraryreadxl" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="libraryreadxl"><span class="header-section-number">1.2.2</span> <code>library(readxl)</code></h3>
<p>We will focus on reading data from Excel workbooks. Excel is a bad tool with bad design that has led to many analytical errors. Unfortunately, it’s a dominant tool for storing data and often enters the data science workflow.</p>
<p><code>library(readxl)</code> is the premier package for reading data from <code>.xls</code> and <code>.xlsx</code> files. <code>read_excel()</code>, which works like <code>read_csv()</code>, loads data from <code>.xls</code> and <code>.xlsx</code> files. Consider data from the Urban Institute’s <a href="https://apps.urban.org/features/debt-interactive-map/?type=overall&amp;variable=totcoll">Debt in America</a> feature accessed through the <a href="https://datacatalog.urban.org/dataset/debt-america-2022">Urban Institute Data Catalog</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"state_dia_delinquency_ 7 Jun 2022.xlsx"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 × 28
   fips  state_name          state Share with Any Debt …¹ Share with Any Debt …²
   &lt;chr&gt; &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;                  &lt;chr&gt;                 
 1 01    Alabama             AL    .3372881               .5016544              
 2 02    Alaska              AK    .1672429               .221573               
 3 04    Arizona             AZ    .2666938               .3900013              
 4 05    Arkansas            AR    .3465793               .5426918              
 5 06    California          CA    .2087713               .2462195              
 6 08    Colorado            CO    .213803                .3554938              
 7 09    Connecticut         CT    .2194708               .3829038              
 8 10    Delaware            DE    .2866829               .469117               
 9 11    District of Columb… DC    .2232908               .3485817              
10 12    Florida             FL    .2893825               .3439322              
# ℹ 41 more rows
# ℹ abbreviated names: ¹​`Share with Any Debt in Collections, All`,
#   ²​`Share with Any Debt in Collections, Communities of Color`
# ℹ 23 more variables:
#   `Share with Any Debt in Collections, Majority White Communities` &lt;chr&gt;,
#   `Median Debt in Collections, All` &lt;chr&gt;,
#   `Median Debt in Collections, Communities of Color` &lt;chr&gt;, …</code></pre>
</div>
</div>
<p><code>read_excel()</code> has several useful arguments:</p>
<ul>
<li><code>sheet</code> selects the sheet to read.</li>
<li><code>range</code> selects the cells to read and can use Excel-style ranges like “C34:D50”.</li>
<li><code>skip</code> skips the selected number of rows.</li>
<li><code>n_max</code> selects the maximum number of rows to read.</li>
</ul>
<p>Excel encourages bad habits and untidy data, so these arguments are useful for extracting data from messy Excel workbooks.</p>
<p><code>readxl_example()</code> contains a perfect example. The workbook contains two sheets, which we can see with <code>excel_sheets()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">readxl_example</span>(<span class="st">"clippy.xlsx"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">excel_sheets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list-column"    "two-row-header"</code></pre>
</div>
</div>
<p>As is common with many Excel workbooks, the second sheet contains a second row of column names with parenthetical comments about each column.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">readxl_example</span>(<span class="st">"clippy.xlsx"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">read_excel</span>(<span class="at">sheet =</span> <span class="st">"two-row-header"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  name       species              death                 weight    
  &lt;chr&gt;      &lt;chr&gt;                &lt;chr&gt;                 &lt;chr&gt;     
1 (at birth) (office supply type) (date is approximate) (in grams)
2 Clippy     paperclip            39083                 0.9       </code></pre>
</div>
</div>
<p><a href="https://readxl.tidyverse.org/articles/multiple-header-rows.html">This vignette</a> suggests a simple solution to this problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># extract the column names</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>col_names <span class="ot">&lt;-</span> <span class="fu">readxl_example</span>(<span class="st">"clippy.xlsx"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">read_excel</span>(<span class="at">sheet =</span> <span class="st">"two-row-header"</span>, <span class="at">n_max =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">names</span>()</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># load the data and add the column names</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="fu">readxl_example</span>(<span class="st">"clippy.xlsx"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="fu">read_excel</span>(</span>
<span id="cb11-9"><a href="#cb11-9"></a>      <span class="at">sheet =</span> <span class="st">"two-row-header"</span>, </span>
<span id="cb11-10"><a href="#cb11-10"></a>      <span class="at">skip =</span> <span class="dv">2</span>,</span>
<span id="cb11-11"><a href="#cb11-11"></a>      <span class="at">col_names =</span> col_names</span>
<span id="cb11-12"><a href="#cb11-12"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  name   species   death               weight
  &lt;chr&gt;  &lt;chr&gt;     &lt;dttm&gt;               &lt;dbl&gt;
1 Clippy paperclip 2007-01-01 00:00:00    0.9</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <a href="https://www.irs.gov/statistics/soi-tax-stats-statistics-of-income">IRS Statistics of Income Division</a> is one of the US’s 13 principal statistical agencies. They publish rich information derived from tax returns. We will focus on Table 1, <a href="https://www.irs.gov/statistics/soi-tax-stats-adjusted-gross-income-agi-percentile-data-by-state">Adjusted Gross Income (AGI) percentiles by state</a>.</p>
<ol type="1">
<li>Read in the 52 cells in the first column that contain “United States”, all 50 states, and the “District of Columbia”.</li>
<li>Identify the cells containing data for “Adjusted gross income floor on percentiles”. Read in the data with <code>read_excel()</code>. Either programmatically read in the column names (i.e.&nbsp;“Top 1 Percent”, …) or assign them with <code>col_names()</code>.</li>
<li>Use <code>bind_cols()</code> to combine the data from step 1 and step 2.</li>
</ol>
</div>
</div>
<p><a href="https://cran.r-project.org/web/packages/tidyxl/index.html"><code>library(tidyxl)</code></a> contains tools for working with messy Excel workbooks, <a href="https://cran.r-project.org/web/packages/openxlsx/index.html"><code>library(openxlsx)</code></a> contains tools for creating Excel workbooks with R, and <a href="https://cran.r-project.org/web/packages/openxlsx/index.html"><code>library(googlesheets4)</code></a> contains tools for working with Google Sheets.</p>
</section>
</section>
<section id="sec-tidy" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sec-tidy"><span class="header-section-number">1.3</span> Tidy</h2>
<p>The defining opinion of the tidyverse is its wholehearted adoption of tidy data. <a href="https://r4ds.hadley.nz/data-tidy#fig-tidy-structure">Tidy data has three features</a>:</p>
<ol type="1">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a dataframe.</li>
</ol>
<blockquote class="blockquote">
<p>Tidy datasets are all alike, but every messy dataset is messy in its own way. ~ <a href="https://r4ds.had.co.nz/tidy-data.html">Hadley Wickham</a></p>
</blockquote>
<p><code>library(tidyr)</code> is the main package for tidying untidy data. We’ll practice some skills using examples from three workbooks from the <a href="https://www.irs.gov/statistics/soi-tax-stats-adjusted-gross-income-agi-percentile-data-by-state">IRS SOI</a>.</p>
<p><code>pivot_longer()</code> is commonly used for tidying data and for making data longer for <code>library(ggplot2)</code>. <code>pivot_longer()</code> reorients data so that key-value pairs expressed as column name-column value are column value-column value in adjacent columns. <code>pivot_longer()</code> has three essential arguments:</p>
<ol type="1">
<li><code>cols</code> is a vector of columns to pivot (or not pivot).</li>
<li><code>names_to</code> is a string for the name of the column where the old column names will go (i.e.&nbsp;“series” in the figure).</li>
<li><code>values_to</code> is a string for the name of the column where the values will go (i.e.&nbsp;“rate” in the figure).</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<p><img src="images/pivoting.png" class="img-fluid" width="412"></p>
</div>
</div>
<p><code>pivot_wider()</code> is the inverse of <code>pivot_longer()</code>.</p>
<section id="tidying-example-1" class="level4">
<h4 class="anchored" data-anchor-id="tidying-example-1">Tidying Example 1</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Untidy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Cleaned</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p><strong>Why aren’t the data tidy?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi2006, <span class="sc">~</span>agi2016, <span class="sc">~</span>agi2020,</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">95067</span>, <span class="dv">114510</span>, <span class="dv">138244</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">17458</span>, <span class="dv">23645</span>, <span class="dv">26445</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">146307</span>, <span class="dv">181691</span>, <span class="dv">245258</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>)</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  state   agi2006 agi2016 agi2020
  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Alabama   95067  114510  138244
2 Alaska    17458   23645   26445
3 Arizona  146307  181691  245258</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Year is a variable. This data is untidy because year is included in the column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi2006, <span class="sc">~</span>agi2016, <span class="sc">~</span>agi2020,</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">95067</span>, <span class="dv">114510</span>, <span class="dv">138244</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">17458</span>, <span class="dv">23645</span>, <span class="dv">26445</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">146307</span>, <span class="dv">181691</span>, <span class="dv">245258</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>)</span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  state   agi2006 agi2016 agi2020
  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Alabama   95067  114510  138244
2 Alaska    17458   23645   26445
3 Arizona  146307  181691  245258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="at">data =</span> table1, </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="at">cols =</span> <span class="sc">-</span>state, </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="at">names_to =</span> <span class="st">"year"</span>, </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="at">values_to =</span> <span class="st">"agi"</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  state   year       agi
  &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
1 Alabama agi2006  95067
2 Alabama agi2016 114510
3 Alabama agi2020 138244
4 Alaska  agi2006  17458
5 Alaska  agi2016  23645
6 Alaska  agi2020  26445
7 Arizona agi2006 146307
8 Arizona agi2016 181691
9 Arizona agi2020 245258</code></pre>
</div>
</div>
<p>The <code>year</code> column isn’t useful yet. We’ll fix that later.</p>
</div>
</div>
</div>
<p><br></p>
<p><code>library(tidyr)</code> contains several functions to split values into multiple cells.</p>
<ul>
<li><code>separate_wider_delim()</code> separates a value based on a delimeter and creates wider data.</li>
<li><code>separate_wider_position()</code> separates a value based on position and creates wider data.</li>
<li><code>separate_longer_delim()</code> separates a value based on a delimeter and creates longer data.</li>
<li><code>separate_longer_position()</code> separates a value based on position and creates longer data.</li>
</ul>
</section>
<section id="tidying-example-2" class="level4">
<h4 class="anchored" data-anchor-id="tidying-example-2">Tidying Example 2</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Untidy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Cleaned</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><strong>Why aren’t the data tidy?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span><span class="st">`</span><span class="at">agi2006|2016|2020</span><span class="st">`</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"95067|114510|138244"</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"17458|23645|26445"</span>,</span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"146307|181691|245258"</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>)</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   `agi2006|2016|2020` 
  &lt;chr&gt;   &lt;chr&gt;               
1 Alabama 95067|114510|138244 
2 Alaska  17458|23645|26445   
3 Arizona 146307|181691|245258</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>The values for 2006, 2016, and 2020 are all squished into one cell.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span><span class="st">`</span><span class="at">agi2006|2016|2020</span><span class="st">`</span>,</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"95067|114510|138244"</span>,</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"17458|23645|26445"</span>,</span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"146307|181691|245258"</span></span>
<span id="cb21-6"><a href="#cb21-6"></a>)</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   `agi2006|2016|2020` 
  &lt;chr&gt;   &lt;chr&gt;               
1 Alabama 95067|114510|138244 
2 Alaska  17458|23645|26445   
3 Arizona 146307|181691|245258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">separate_wider_delim</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="at">data =</span> table2, </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="at">cols =</span> <span class="st">`</span><span class="at">agi2006|2016|2020</span><span class="st">`</span>, </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="at">delim =</span> <span class="st">"|"</span>,</span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"2006"</span>, <span class="st">"2016"</span>, <span class="st">"2020"</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a>) <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb23-8"><a href="#cb23-8"></a>    <span class="at">cols =</span> <span class="sc">-</span>state,</span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>, </span>
<span id="cb23-10"><a href="#cb23-10"></a>    <span class="at">values_to =</span> <span class="st">"agi"</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  state   year  agi   
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; 
1 Alabama 2006  95067 
2 Alabama 2016  114510
3 Alabama 2020  138244
4 Alaska  2006  17458 
5 Alaska  2016  23645 
6 Alaska  2020  26445 
7 Arizona 2006  146307
8 Arizona 2016  181691
9 Arizona 2020  245258</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<p><code>bind_rows()</code> combines data frames by stacking the rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>one <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="sc">~</span>id, <span class="sc">~</span>var,</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="st">"1"</span>, <span class="fl">3.14</span>,</span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="st">"2"</span>, <span class="fl">3.15</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a>two <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="sc">~</span>id, <span class="sc">~</span>var,</span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="st">"3"</span>, <span class="fl">3.16</span>,</span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="st">"4"</span>, <span class="fl">3.17</span>,</span>
<span id="cb25-11"><a href="#cb25-11"></a>)</span>
<span id="cb25-12"><a href="#cb25-12"></a></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="fu">bind_rows</span>(one, two)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  id      var
  &lt;chr&gt; &lt;dbl&gt;
1 1      3.14
2 2      3.15
3 3      3.16
4 4      3.17</code></pre>
</div>
</div>
<p><code>bind_cols()</code> combines data frames by appending columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>three <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="sc">~</span>id, <span class="sc">~</span>var1,</span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="st">"1"</span>, <span class="fl">3.14</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="st">"2"</span>, <span class="fl">3.15</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>)</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a>four <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="sc">~</span>id, <span class="sc">~</span>var2,</span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="st">"1"</span>, <span class="fl">3.16</span>,</span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="st">"2"</span>, <span class="fl">3.17</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>)</span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="fu">bind_cols</span>(three, four)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `id` -&gt; `id...1`
• `id` -&gt; `id...3`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  id...1  var1 id...3  var2
  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
1 1       3.14 1       3.16
2 2       3.15 2       3.17</code></pre>
</div>
</div>
<p>When possible, we recommend using relational joins like <code>left_join()</code> to combine by columns because it is easy to miss-align rows with <code>bind_cols()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">left_join</span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="at">x =</span> three,</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="at">y =</span> four,</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  id     var1  var2
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 1      3.14  3.16
2 2      3.15  3.17</code></pre>
</div>
</div>
</section>
<section id="tidying-example-3" class="level4">
<h4 class="anchored" data-anchor-id="tidying-example-3">Tidying Example 3</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Untidy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Cleaned</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p><strong>Why aren’t the data tidy?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>table3_2006 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"95067"</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"17458"</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"146307"</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>)</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>table3_2006</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   agi   
  &lt;chr&gt;   &lt;chr&gt; 
1 Alabama 95067 
2 Alaska  17458 
3 Arizona 146307</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>table3_2016 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"114510"</span>,</span>
<span id="cb34-4"><a href="#cb34-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"23645"</span>,</span>
<span id="cb34-5"><a href="#cb34-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"181691"</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>)</span>
<span id="cb34-7"><a href="#cb34-7"></a></span>
<span id="cb34-8"><a href="#cb34-8"></a>table3_2016</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   agi   
  &lt;chr&gt;   &lt;chr&gt; 
1 Alabama 114510
2 Alaska  23645 
3 Arizona 181691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>table3_2020 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span><span class="st">`</span><span class="at">agi</span><span class="st">`</span>,</span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="st">"Alabama"</span>, <span class="st">"138244"</span>,</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="st">"Alaska"</span>, <span class="st">"26445"</span>,</span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="st">"Arizona"</span>, <span class="st">"245258"</span></span>
<span id="cb36-6"><a href="#cb36-6"></a>)</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>table3_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   agi   
  &lt;chr&gt;   &lt;chr&gt; 
1 Alabama 138244
2 Alaska  26445 
3 Arizona 245258</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>The variable year is contained in the data set names. The <code>.id</code> argument in <code>bind_rows()</code> allows us to create the year variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>table3_2006 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb38-3"><a href="#cb38-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">95067</span>,</span>
<span id="cb38-4"><a href="#cb38-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">17458</span>,</span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">146307</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>)</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a>table3_2006</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state      agi
  &lt;chr&gt;    &lt;dbl&gt;
1 Alabama  95067
2 Alaska   17458
3 Arizona 146307</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>table3_2016 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">114510</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">23645</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">181691</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>)</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a>table3_2016</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state      agi
  &lt;chr&gt;    &lt;dbl&gt;
1 Alabama 114510
2 Alaska   23645
3 Arizona 181691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>table3_2020 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span><span class="st">`</span><span class="at">agi</span><span class="st">`</span>,</span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">138244</span>,</span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">26445</span>,</span>
<span id="cb42-5"><a href="#cb42-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">245258</span></span>
<span id="cb42-6"><a href="#cb42-6"></a>)</span>
<span id="cb42-7"><a href="#cb42-7"></a></span>
<span id="cb42-8"><a href="#cb42-8"></a>table3_2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state      agi
  &lt;chr&gt;    &lt;dbl&gt;
1 Alabama 138244
2 Alaska   26445
3 Arizona 245258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="st">`</span><span class="at">2006</span><span class="st">`</span> <span class="ot">=</span> table3_2006,</span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="st">`</span><span class="at">2016</span><span class="st">`</span> <span class="ot">=</span> table3_2016,</span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="st">`</span><span class="at">2020</span><span class="st">`</span> <span class="ot">=</span> table3_2020,</span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="at">.id =</span> <span class="st">"year"</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  year  state      agi
  &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
1 2006  Alabama  95067
2 2006  Alaska   17458
3 2006  Arizona 146307
4 2016  Alabama 114510
5 2016  Alaska   23645
6 2016  Arizona 181691
7 2020  Alabama 138244
8 2020  Alaska   26445
9 2020  Arizona 245258</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br></p>
<p>Relational joins are fundamental to working with tidy data. Tidy data can only contain one unit of observation (e.g.&nbsp;county or state not county and state). When data exist on multiple levels, they must be stored in separate tables that can later be combined.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Mutating Joins
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mutating joins add new variables to a data frame by matching observations from one data frame to observations in another data frame.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Filtering Joins
</div>
</div>
<div class="callout-body-container callout-body">
<p>Filtering joins drop observations based on the presence of their key (identifier) in another data frame.</p>
<p>For example, we may have a list of students in detention and a list of all students. We can use a filtering join to create a list of student not in detention.</p>
</div>
</div>
<p>For now, we will focus on mutating joins. Let their be two data frames <code>x</code> and <code>y</code> and let both data frames have a key variable that uniquely identifies rows.</p>
<ul>
<li><code>left_join(x, y)</code> appends variables from <code>y</code> on to <code>x</code> but only keeps observations from <code>x</code>.</li>
<li><code>full_join(x, y)</code> appends variables from <code>y</code> on to <code>x</code> and keeps all observations from <code>x</code> and <code>y</code>.</li>
<li><code>anti_join(x, y)</code> returns all observations from <code>x</code> without a match in <code>y</code>. <code>anti_join()</code> is traditionally only used for filtering joins, but it is useful for writing tests for mutating joins.</li>
</ul>
<p>To learn more, read the <a href="https://r4ds.hadley.nz/joins.html">Joins chapter of R for Data Science (2e)</a>. <a href="https://github.com/elbersb/tidylog"><code>library(tidylog)</code></a> is a useful function for monitoring the behavior of joins.</p>
</section>
<section id="tidying-example-4" class="level4">
<h4 class="anchored" data-anchor-id="tidying-example-4">Tidying Example 4</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Untidy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Cleaned</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p><strong>Why aren’t the data tidy?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>table4a <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">95067</span>,</span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">17458</span>,</span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">146307</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>)</span>
<span id="cb46-7"><a href="#cb46-7"></a></span>
<span id="cb46-8"><a href="#cb46-8"></a>table4a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state      agi
  &lt;chr&gt;    &lt;dbl&gt;
1 Alabama  95067
2 Alaska   17458
3 Arizona 146307</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>table4b <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb48-2"><a href="#cb48-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>returns,</span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">1929941</span>,</span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">322369</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">2454951</span></span>
<span id="cb48-6"><a href="#cb48-6"></a>)</span>
<span id="cb48-7"><a href="#cb48-7"></a></span>
<span id="cb48-8"><a href="#cb48-8"></a>table4b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   returns
  &lt;chr&gt;     &lt;dbl&gt;
1 Alabama 1929941
2 Alaska   322369
3 Arizona 2454951</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>These data are tidy! But keeping the data in two separate data frames may not make sense. Let’s use <code>full_join()</code> to combine the data and <code>anti_join()</code> to see if there are mismatches.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>table4a <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>agi,</span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">95067</span>,</span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">17458</span>,</span>
<span id="cb50-5"><a href="#cb50-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">146307</span></span>
<span id="cb50-6"><a href="#cb50-6"></a>)</span>
<span id="cb50-7"><a href="#cb50-7"></a></span>
<span id="cb50-8"><a href="#cb50-8"></a>table4a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state      agi
  &lt;chr&gt;    &lt;dbl&gt;
1 Alabama  95067
2 Alaska   17458
3 Arizona 146307</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>table4b <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="sc">~</span>state, <span class="sc">~</span>returns,</span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="st">"Alabama"</span>, <span class="dv">1929941</span>,</span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="st">"Alaska"</span>, <span class="dv">322369</span>,</span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="st">"Arizona"</span>, <span class="dv">2454951</span></span>
<span id="cb52-6"><a href="#cb52-6"></a>)</span>
<span id="cb52-7"><a href="#cb52-7"></a></span>
<span id="cb52-8"><a href="#cb52-8"></a>table4b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  state   returns
  &lt;chr&gt;     &lt;dbl&gt;
1 Alabama 1929941
2 Alaska   322369
3 Arizona 2454951</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">full_join</span>(table4a, table4b, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  state      agi returns
  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1 Alabama  95067 1929941
2 Alaska   17458  322369
3 Arizona 146307 2454951</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">anti_join</span>(table4a, table4b, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: state &lt;chr&gt;, agi &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">anti_join</span>(table4b, table4a, <span class="at">by =</span> <span class="st">"state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 2
# ℹ 2 variables: state &lt;chr&gt;, returns &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use <code>pivot_longer()</code> to make the SOI percentile data from the earlier exercise longer. After the transformation, there should be one row per percentile per state.</li>
</ol>
</div>
</div>
<p>To see more examples, read the <a href="https://r4ds.hadley.nz/data-tidy.html">tidy data section in R for Data Science (2e)</a></p>
</section>
</section>
<section id="sec-transform" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="sec-transform"><span class="header-section-number">1.4</span> Transform</h2>
<section id="strings" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="strings"><span class="header-section-number">1.4.1</span> Strings</h3>
<p>Check out the <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">stringr cheat sheet</a>.</p>
<p><code>library(stringr)</code> contains powerful functions for working with strings in R. In data analysis, we may need to detect matches, subset strings, work with the lengths of strings, modify strings, and join and split strings.</p>
<section id="detecting-matches" class="level4">
<h4 class="anchored" data-anchor-id="detecting-matches">Detecting Matches</h4>
<p><code>str_detect()</code> is useful for <strong>detecting matches</strong> in strings, which can be useful with <code>filter()</code>. Consider the executive orders data set and suppose we want to return executive orders that contain the word <code>"Virginia"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>eos <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"executive-orders.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(text)) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">group_by</span>(executive_order_number) <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="fu">summarize</span>(<span class="at">text =</span> <span class="fu">list</span>(text)) <span class="sc">|&gt;</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">map_chr</span>(text, <span class="sc">~</span><span class="fu">paste</span>(.x, <span class="at">collapse =</span> <span class="st">" "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 196537 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (2): text, president
dbl  (1): executive_order_number
date (1): signing_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>eos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,126 × 2
   executive_order_number text                                                  
                    &lt;dbl&gt; &lt;chr&gt;                                                 
 1                  12890 "Executive Order 12890 of December 30, 1993 Amendment…
 2                  12944 "Executive Order 12944 of December 28, 1994 Adjustmen…
 3                  12945 "Executive Order 12945 of January 20, 1995 Amendment …
 4                  12946 "Executive Order 12946 of January 20, 1995 President'…
 5                  12947 "Executive Order 12947 of January 23, 1995 Prohibitin…
 6                  12948 "Executive Order 12948 of January 30, 1995 Amendment …
 7                  12949 "Executive Order 12949 of February 9, 1995 Foreign In…
 8                  12950 "Executive Order 12950 of February 22, 1995 Establish…
 9                  12951 "Executive Order 12951 of February 22, 1995 Release o…
10                  12952 "Executive Order 12952 of February 24, 1995 Amendment…
# ℹ 1,116 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>eos <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(<span class="at">string =</span> text, <span class="at">pattern =</span> <span class="st">"Virginia"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  executive_order_number text                                                   
                   &lt;dbl&gt; &lt;chr&gt;                                                  
1                  13150 Executive Order 13150 of April 21, 2000 Federal Workfo…
2                  13508 Executive Order 13508 of May 12, 2009 Chesapeake Bay P…
3                  13557 Executive Order 13557 of November 4, 2010 Providing an…
4                  13775 Executive Order 13775 of February 9, 2017 Providing an…
5                  13787 Executive Order 13787 of March 31, 2017 Providing an O…
6                  13934 Executive Order 13934 of July 3, 2020 Building and Reb…</code></pre>
</div>
</div>
</section>
<section id="subsetting-strings" class="level4">
<h4 class="anchored" data-anchor-id="subsetting-strings">Subsetting Strings</h4>
<p><code>str_sub()</code> can <strong>subset strings</strong> based on positions within the string. Consider an example where we want to extract state FIPS codes from county FIPS codes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">tibble</span>(<span class="at">fips =</span> <span class="fu">c</span>(<span class="st">"01001"</span>, <span class="st">"02013"</span>, <span class="st">"04001"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>  <span class="fu">mutate</span>(<span class="at">state_fips =</span> <span class="fu">str_sub</span>(fips, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  fips  state_fips
  &lt;chr&gt; &lt;chr&gt;     
1 01001 01        
2 02013 02        
3 04001 04        </code></pre>
</div>
</div>
</section>
<section id="managing-lengths" class="level4">
<h4 class="anchored" data-anchor-id="managing-lengths">Managing Lengths</h4>
<p><code>str_pad()</code> is useful for <strong>managing lengths</strong>. Consider the common situation when zeros are dropped from the beginning of FIPS codes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">tibble</span>(<span class="at">fips =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2"></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> <span class="fu">str_pad</span>(fips, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>, <span class="at">width =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  fips 
  &lt;chr&gt;
1 01   
2 02   
3 04   </code></pre>
</div>
</div>
</section>
<section id="modifying-strings" class="level4">
<h4 class="anchored" data-anchor-id="modifying-strings">Modifying Strings</h4>
<p><code>str_replace()</code>, <code>str_replace_all()</code>, <code>str_remove()</code>, and <code>str_remove_all()</code> can delete or <strong>modify</strong> parts of strings. Consider an example where we have course names and we want to delete everything except numeric digits.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">tibble</span>(<span class="at">course =</span> <span class="fu">c</span>(<span class="st">"PPOL 670"</span>, <span class="st">"GOVT 8009"</span>, <span class="st">"PPOL 6819"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>  <span class="fu">mutate</span>(<span class="at">course =</span> <span class="fu">str_remove</span>(course, <span class="at">pattern =</span> <span class="st">"[:alpha:]*</span><span class="sc">\\</span><span class="st">s"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  course
  &lt;chr&gt; 
1 670   
2 8009  
3 6819  </code></pre>
</div>
</div>
<p><code>str_c()</code> and <code>str_glue()</code> are useful for <strong>joining</strong> strings. Consider an example where we want to “fill in the blank” with a variable in a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">tibble</span>(<span class="at">fruit =</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cantelope"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>  <span class="fu">mutate</span>(<span class="at">sentence =</span> <span class="fu">str_glue</span>(<span class="st">"my favorite fruit is {fruit}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  fruit     sentence                      
  &lt;chr&gt;     &lt;glue&gt;                        
1 apple     my favorite fruit is apple    
2 banana    my favorite fruit is banana   
3 cantelope my favorite fruit is cantelope</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">tibble</span>(<span class="at">fruit =</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cantelope"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-3"><a href="#cb74-3"></a>    <span class="at">another_sentence =</span> </span>
<span id="cb74-4"><a href="#cb74-4"></a>      <span class="fu">str_c</span>(<span class="st">"Who doesn't like a good "</span>, fruit, <span class="st">"."</span>)</span>
<span id="cb74-5"><a href="#cb74-5"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  fruit     another_sentence                  
  &lt;chr&gt;     &lt;chr&gt;                             
1 apple     Who doesn't like a good apple.    
2 banana    Who doesn't like a good banana.   
3 cantelope Who doesn't like a good cantelope.</code></pre>
</div>
</div>
<p>This workflow is useful for building up URLs when accessing APIs, scraping information from the Internet, and downloading many files.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Use <code>mutate()</code> and <code>library(stringr)</code> to create a variable for <code>year</code> from the earlier SOI exercise. For instance, <code>"agi2006"</code> should be <code>"2006"</code>.</li>
<li>Use <code>as.numeric()</code> to convert the string from step 1 into a numeric value.</li>
<li>Create a data visualization with <code>year</code> on the x-axis.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="factors" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="factors"><span class="header-section-number">1.4.2</span> Factors</h3>
<p>Check out the <a href="https://forcats.tidyverse.org/">forcats cheat sheet</a>.</p>
<p>Much of our work focuses on four of the six types of atomic vectors: logical, integer, double, and character. R also contains <a href="https://r4ds.had.co.nz/vectors.html#augmented-vectors">augmented vectors</a> like factors.</p>
<p>Factors are categorical data stored as integers with a levels attribute. Character vectors often work well for categorical data and many of R’s functions convert character vectors to factors. This happens with <code>lm()</code>.</p>
<p>Factors have many applications:</p>
<ol type="1">
<li>Giving the levels of a categorical variable non-alpha numeric order in a ggplot2 data visualization.</li>
<li>Running calculations on data with empty groups.</li>
<li>Representing categorical outcome variables in classification models.</li>
</ol>
<section id="factor-basics" class="level4">
<h4 class="anchored" data-anchor-id="factor-basics">Factor Basics</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>))</span>
<span id="cb76-2"><a href="#cb76-2"></a></span>
<span id="cb76-3"><a href="#cb76-3"></a>x1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] a a b c
Levels: d c b a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">attributes</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$levels
[1] "d" "c" "b" "a"

$class
[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">levels</span>(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d" "c" "b" "a"</code></pre>
</div>
</div>
<p><code>x1</code> has order but it isn’t ordinal. Sometimes we’ll come across ordinal factor variables, like with the <code>diamonds</code> data set. Unintentional ordinal variables can cause unexpected errors. For example, including ordinal data as predictors in regression models will lead to different estimated coefficients than other variable types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">glimpse</span>(diamonds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 53,940
Columns: 10
$ carat   &lt;dbl&gt; 0.23, 0.21, 0.23, 0.29, 0.31, 0.24, 0.24, 0.26, 0.22, 0.23, 0.…
$ cut     &lt;ord&gt; Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Ver…
$ color   &lt;ord&gt; E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I,…
$ clarity &lt;ord&gt; SI2, SI1, VS1, VS2, SI2, VVS2, VVS1, SI1, VS2, VS1, SI1, VS1, …
$ depth   &lt;dbl&gt; 61.5, 59.8, 56.9, 62.4, 63.3, 62.8, 62.3, 61.9, 65.1, 59.4, 64…
$ table   &lt;dbl&gt; 55, 61, 65, 58, 58, 57, 57, 55, 61, 61, 55, 56, 61, 54, 62, 58…
$ price   &lt;int&gt; 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 34…
$ x       &lt;dbl&gt; 3.95, 3.89, 4.05, 4.20, 4.34, 3.94, 3.95, 4.07, 3.87, 4.00, 4.…
$ y       &lt;dbl&gt; 3.98, 3.84, 4.07, 4.23, 4.35, 3.96, 3.98, 4.11, 3.78, 4.05, 4.…
$ z       &lt;dbl&gt; 2.43, 2.31, 2.31, 2.63, 2.75, 2.48, 2.47, 2.53, 2.49, 2.39, 2.…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb84-2"><a href="#cb84-2"></a>  <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>), </span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>),</span>
<span id="cb84-4"><a href="#cb84-4"></a>  <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb84-5"><a href="#cb84-5"></a>)</span>
<span id="cb84-6"><a href="#cb84-6"></a></span>
<span id="cb84-7"><a href="#cb84-7"></a>x2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] a a b c
Levels: d &lt; c &lt; b &lt; a</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">attributes</span>(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$levels
[1] "d" "c" "b" "a"

$class
[1] "ordered" "factor" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="fu">levels</span>(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d" "c" "b" "a"</code></pre>
</div>
</div>
<p><a href="#fig-factors">Figure&nbsp;<span>1.1</span></a> shows how we can use a factor to give a variable a non-alpha numeric order and preserve empty levels. In this case, February and March have zero tropical depressions, tropical storms, and hurricanes and we want to demonstrate that emptiness.</p>
<div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># use case_match to convert integers into month names</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>storms <span class="ot">&lt;-</span> storms <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-4"><a href="#cb90-4"></a>    <span class="at">month =</span> <span class="fu">case_match</span>(</span>
<span id="cb90-5"><a href="#cb90-5"></a>      month,</span>
<span id="cb90-6"><a href="#cb90-6"></a>      <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Jan"</span>,</span>
<span id="cb90-7"><a href="#cb90-7"></a>      <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Apr"</span>,</span>
<span id="cb90-8"><a href="#cb90-8"></a>      <span class="dv">5</span> <span class="sc">~</span> <span class="st">"May"</span>,</span>
<span id="cb90-9"><a href="#cb90-9"></a>      <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Jun"</span>,</span>
<span id="cb90-10"><a href="#cb90-10"></a>      <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Jul"</span>,</span>
<span id="cb90-11"><a href="#cb90-11"></a>      <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Aug"</span>,</span>
<span id="cb90-12"><a href="#cb90-12"></a>      <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Sep"</span>,</span>
<span id="cb90-13"><a href="#cb90-13"></a>      <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Oct"</span>,</span>
<span id="cb90-14"><a href="#cb90-14"></a>      <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Nov"</span>,</span>
<span id="cb90-15"><a href="#cb90-15"></a>      <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Dec"</span></span>
<span id="cb90-16"><a href="#cb90-16"></a>    )</span>
<span id="cb90-17"><a href="#cb90-17"></a>  )</span>
<span id="cb90-18"><a href="#cb90-18"></a></span>
<span id="cb90-19"><a href="#cb90-19"></a><span class="co"># create data viz without factors</span></span>
<span id="cb90-20"><a href="#cb90-20"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb90-21"><a href="#cb90-21"></a>  <span class="fu">count</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb90-22"><a href="#cb90-22"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb90-23"><a href="#cb90-23"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb90-24"><a href="#cb90-24"></a></span>
<span id="cb90-25"><a href="#cb90-25"></a><span class="co"># add factor variable</span></span>
<span id="cb90-26"><a href="#cb90-26"></a>months <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb90-27"><a href="#cb90-27"></a>            <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)</span>
<span id="cb90-28"><a href="#cb90-28"></a></span>
<span id="cb90-29"><a href="#cb90-29"></a>storms <span class="ot">&lt;-</span> storms <span class="sc">|&gt;</span></span>
<span id="cb90-30"><a href="#cb90-30"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels =</span> months)) </span>
<span id="cb90-31"><a href="#cb90-31"></a></span>
<span id="cb90-32"><a href="#cb90-32"></a><span class="co"># create data viz with factors</span></span>
<span id="cb90-33"><a href="#cb90-33"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb90-34"><a href="#cb90-34"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-35"><a href="#cb90-35"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb90-36"><a href="#cb90-36"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-factors" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-factors-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-factors-1.png" class="img-fluid figure-img" data-ref-parent="fig-factors" width="672"></p>
<figcaption class="figure-caption">(a) Figure without a factor</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-factors-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-factors-2.png" class="img-fluid figure-img" data-ref-parent="fig-factors" width="672"></p>
<figcaption class="figure-caption">(b) Figure with a factor</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.1: Hurricane Season Peaks in Late Summer and Early Fall</figcaption><p></p>
</figure>
</div>
</div>
<p>Factors also change the behavior of summary functions like <code>count()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2"></a>  <span class="fu">count</span>(month)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   month     n
   &lt;fct&gt; &lt;int&gt;
 1 Jan      70
 2 Apr      66
 3 May     201
 4 Jun     779
 5 Jul    1603
 6 Aug    4440
 7 Sep    7509
 8 Oct    3077
 9 Nov    1109
10 Dec     212</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   month     n
   &lt;fct&gt; &lt;int&gt;
 1 Jan      70
 2 Feb       0
 3 Mar       0
 4 Apr      66
 5 May     201
 6 Jun     779
 7 Jul    1603
 8 Aug    4440
 9 Sep    7509
10 Oct    3077
11 Nov    1109
12 Dec     212</code></pre>
</div>
</div>
<p><code>library(forcats)</code> simplifies many common operations on factor vectors.</p>
</section>
<section id="changing-order" class="level4">
<h4 class="anchored" data-anchor-id="changing-order">Changing Order</h4>
<p><code>fct_relevel()</code>, <code>fct_rev()</code>, and <code>fct_reorder()</code> are useful functions for modifying the order of factor variables. <a href="#fig-fct_rev">Figure&nbsp;<span>1.2</span></a> demonstrates using <code>fct_rev()</code> to flip the order of a categorical axis in ggplot2.</p>
<div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a href="#cb95-2"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-3"><a href="#cb95-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb95-5"><a href="#cb95-5"></a></span>
<span id="cb95-6"><a href="#cb95-6"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb95-7"><a href="#cb95-7"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">fct_rev</span>(month)) <span class="sc">|&gt;</span></span>
<span id="cb95-8"><a href="#cb95-8"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb95-9"><a href="#cb95-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb95-10"><a href="#cb95-10"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fct_rev" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_rev-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_rev-1.png" class="img-fluid figure-img" data-ref-parent="fig-fct_rev" width="672"></p>
<figcaption class="figure-caption">(a) Descending</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_rev-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_rev-2.png" class="img-fluid figure-img" data-ref-parent="fig-fct_rev" width="672"></p>
<figcaption class="figure-caption">(b) Ascending</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.2: Hurricane Season Peaks in Late Summer and Early Fall</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-fct_reorder">Figure&nbsp;<span>1.3</span></a> orders the factor variable based on the number of observations in each category using <code>fct_reorder()</code>. <code>fct_reorder()</code> can order variables based on more sophisticated summaries than just magnitude. For example, it can order box-and-whisker plots based on the median or even something as arbitrary at the 60th percentile.</p>
<div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb96-5"><a href="#cb96-5"></a></span>
<span id="cb96-6"><a href="#cb96-6"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb96-7"><a href="#cb96-7"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb96-8"><a href="#cb96-8"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">fct_reorder</span>(<span class="at">.f =</span> month, <span class="at">.x =</span> n, <span class="at">.fun =</span> median)) <span class="sc">|&gt;</span></span>
<span id="cb96-9"><a href="#cb96-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb96-10"><a href="#cb96-10"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fct_reorder" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_reorder-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_reorder-1.png" class="img-fluid figure-img" data-ref-parent="fig-fct_reorder" width="672"></p>
<figcaption class="figure-caption">(a) Alpha-numeric</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_reorder-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_reorder-2.png" class="img-fluid figure-img" data-ref-parent="fig-fct_reorder" width="672"></p>
<figcaption class="figure-caption">(b) Magnitude</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.3: Hurricane Season Peaks in Late Summer and Early Fall</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="changing-values" class="level4">
<h4 class="anchored" data-anchor-id="changing-values">Changing Values</h4>
<p>Functions like <code>fct_recode()</code> and <code>fct_lump_min()</code> are useful for changing factor variables. <a href="#fig-fct_lump_min">Figure&nbsp;<span>1.4</span></a> combines categories with fewer than 1,000 observations into an <code>"Other"</code> group.</p>
<div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>  <span class="fu">geom_col</span>()</span>
<span id="cb97-5"><a href="#cb97-5"></a></span>
<span id="cb97-6"><a href="#cb97-6"></a>storms <span class="sc">|&gt;</span></span>
<span id="cb97-7"><a href="#cb97-7"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">fct_lump_min</span>(month, <span class="at">min =</span> <span class="dv">1000</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb97-8"><a href="#cb97-8"></a>  <span class="fu">count</span>(month, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb97-9"><a href="#cb97-9"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> month)) <span class="sc">+</span></span>
<span id="cb97-10"><a href="#cb97-10"></a>  <span class="fu">geom_col</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fct_lump_min" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_lump_min-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_lump_min-1.png" class="img-fluid figure-img" data-ref-parent="fig-fct_lump_min" width="672"></p>
<figcaption class="figure-caption">(a) All</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fct_lump_min-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03_advanced-data-cleaning_files/figure-html/fig-fct_lump_min-2.png" class="img-fluid figure-img" data-ref-parent="fig-fct_lump_min" width="672"></p>
<figcaption class="figure-caption">(b) Lumped</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1.4: Hurricane Season Peaks in Late Summer and Early Fall</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="dates-and-date-times" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="dates-and-date-times"><span class="header-section-number">1.4.3</span> Dates and Date-Times</h3>
<p>Check out the <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_lubridate.pdf">lubridate cheat sheet</a>.</p>
<p>There are many ways to store dates.</p>
<ul>
<li>March 14, 1992</li>
<li>03/14/1992</li>
<li>14/03/1992</li>
<li>14th of March ’92</li>
</ul>
<p>One way of storing dates is the <strong>best</strong>. The <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> date format is an international standard with appealing properties like fixed lengths and self ordering. The format is <code>YYYY-MM-DD</code>.</p>
<p><code>library(lubridate)</code> has useful functions that will take dates of any format and convert them to the ISO 8601 standard.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb98-2"><a href="#cb98-2"></a></span>
<span id="cb98-3"><a href="#cb98-3"></a><span class="fu">mdy</span>(<span class="st">"March 14, 1992"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1992-03-14"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="fu">mdy</span>(<span class="st">"03/14/1992"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1992-03-14"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="fu">dmy</span>(<span class="st">"14/03/1992"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1992-03-14"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="fu">dmy</span>(<span class="st">"14th of March '92"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1992-03-14"</code></pre>
</div>
</div>
<p>These functions return variables of class <code>"Date"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="fu">class</span>(<span class="fu">mdy</span>(<span class="st">"March 14, 1992"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Date"</code></pre>
</div>
</div>
<p><code>library(lubridate)</code> also contains functions for parsing date times into ISO 8601 standard. Times are slightly trickier because of time zones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="fu">mdy_hms</span>(<span class="st">"12/02/2021 1:00:00"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2021-12-02 01:00:00 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="fu">mdy_hms</span>(<span class="st">"12/02/2021 1:00:00"</span>, <span class="at">tz =</span> <span class="st">"EST"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2021-12-02 01:00:00 EST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a><span class="fu">mdy_hms</span>(<span class="st">"12/02/2021 1:00:00"</span>, <span class="at">tz =</span> <span class="st">"America/Chicago"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2021-12-02 01:00:00 CST"</code></pre>
</div>
</div>
<p>By default, <code>library(lubridate)</code> will put the date times in Coordinated Universal Time (UTC), which is the successor to Greenwich Mean Time (GMT). I recommend carefully reading the data dictionary if time zones are important for your analysis or if your data cross time zones. This is especially important during time changes (e.g.&nbsp;“spring forward” and “fall back”).</p>
<p>Fortunately, if you encode your dates or date-times correctly, then <code>library(lubridate)</code> will automatically account for time changes, time zones, leap years, leap seconds, and all of the quirks of dates and times.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 5</span>
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="sc">~</span>date,</span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="st">"12/01/1987"</span>,</span>
<span id="cb114-4"><a href="#cb114-4"></a>  <span class="st">"12/02/1987"</span>,</span>
<span id="cb114-5"><a href="#cb114-5"></a>  <span class="st">"12/03/1987"</span></span>
<span id="cb114-6"><a href="#cb114-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>Create the <code>dates</code> data from above with <code>tribble()</code>.</li>
<li>Use <code>mutate()</code> to convert the <code>date</code> column to the ISO 8601 standard (YYYY-MM-DD).</li>
</ol>
</div>
</div>
<section id="extracting-components" class="level4">
<h4 class="anchored" data-anchor-id="extracting-components">Extracting Components</h4>
<p><code>library(lubridate)</code> contains functions for extracting components from dates like the year, month, day, and weekday. Conisder the follow data set about <a href="https://www.timeanddate.com/moon/phases/usa/washington-dc">full moons</a> in Washington, DC in 2023.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1"></a>full_moons <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb115-2"><a href="#cb115-2"></a>  <span class="sc">~</span>full_moon,</span>
<span id="cb115-3"><a href="#cb115-3"></a>  <span class="st">"2023-01-06"</span>,</span>
<span id="cb115-4"><a href="#cb115-4"></a>  <span class="st">"2023-02-05"</span>,</span>
<span id="cb115-5"><a href="#cb115-5"></a>  <span class="st">"2023-03-07"</span>,</span>
<span id="cb115-6"><a href="#cb115-6"></a>  <span class="st">"2023-04-06"</span>,</span>
<span id="cb115-7"><a href="#cb115-7"></a>  <span class="st">"2023-05-05"</span>,</span>
<span id="cb115-8"><a href="#cb115-8"></a>  <span class="st">"2023-06-03"</span>,</span>
<span id="cb115-9"><a href="#cb115-9"></a>  <span class="st">"2023-07-03"</span>,</span>
<span id="cb115-10"><a href="#cb115-10"></a>  <span class="st">"2023-08-01"</span>,</span>
<span id="cb115-11"><a href="#cb115-11"></a>  <span class="st">"2023-08-30"</span>,</span>
<span id="cb115-12"><a href="#cb115-12"></a>  <span class="st">"2023-09-29"</span>,</span>
<span id="cb115-13"><a href="#cb115-13"></a>  <span class="st">"2023-10-28"</span>,</span>
<span id="cb115-14"><a href="#cb115-14"></a>  <span class="st">"2023-11-27"</span>,</span>
<span id="cb115-15"><a href="#cb115-15"></a>  <span class="st">"2023-12-26"</span></span>
<span id="cb115-16"><a href="#cb115-16"></a>) <span class="sc">|&gt;</span></span>
<span id="cb115-17"><a href="#cb115-17"></a>  <span class="fu">mutate</span>(<span class="at">full_moon =</span> <span class="fu">as_date</span>(full_moon))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Suppose we want to know the weekday of each full moon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>full_moons <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>  <span class="fu">mutate</span>(<span class="at">week_day =</span> <span class="fu">wday</span>(full_moon, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
   full_moon  week_day
   &lt;date&gt;     &lt;ord&gt;   
 1 2023-01-06 Fri     
 2 2023-02-05 Sun     
 3 2023-03-07 Tue     
 4 2023-04-06 Thu     
 5 2023-05-05 Fri     
 6 2023-06-03 Sat     
 7 2023-07-03 Mon     
 8 2023-08-01 Tue     
 9 2023-08-30 Wed     
10 2023-09-29 Fri     
11 2023-10-28 Sat     
12 2023-11-27 Mon     
13 2023-12-26 Tue     </code></pre>
</div>
</div>
</section>
<section id="math" class="level4">
<h4 class="anchored" data-anchor-id="math">Math</h4>
<p><code>library(lubridate)</code> easily handles math with dates and date-times. Suppose we want to calculate the number of days since American Independence Day:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="fu">today</span>() <span class="sc">-</span> <span class="fu">as_date</span>(<span class="st">"1776-07-04"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 90450 days</code></pre>
</div>
</div>
<p>In this case, subtraction creates an object of class <code>difftime</code> represented in days. We can use the <code>difftimes()</code> function to calculate differences in other units.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="fu">difftime</span>(<span class="fu">today</span>(), <span class="fu">as_date</span>(<span class="st">"1776-07-04"</span>), <span class="at">units =</span> <span class="st">"mins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 130248000 mins</code></pre>
</div>
</div>
</section>
<section id="periods" class="level4">
<h4 class="anchored" data-anchor-id="periods">Periods</h4>
<p><strong>Periods</strong> track clock time or a calendar time. We use periods when we set a recurring meetings on a calendar and when we set an alarm to wake up in the morning.</p>
<p>This can lead to some interesting results. Do we always add 365 days when we add 1 year to a date? With periods, this isn’t true. Sometimes we add 366 days during leap years. For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a>start <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">"1999-03-14"</span>)</span>
<span id="cb122-2"><a href="#cb122-2"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb122-3"><a href="#cb122-3"></a></span>
<span id="cb122-4"><a href="#cb122-4"></a>end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2000-03-14"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a>end <span class="sc">-</span> start</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 366 days</code></pre>
</div>
</div>
</section>
<section id="durations" class="level4">
<h4 class="anchored" data-anchor-id="durations">Durations</h4>
<p><strong>Durations</strong> track the passage of physical time in exact seconds. Durations are like sand falling into an hourglass. Duration functions start with <code>d</code> like <code>dyears()</code> and <code>dminutes()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a>start <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">"1999-03-14"</span>)</span>
<span id="cb126-2"><a href="#cb126-2"></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="fu">dyears</span>(<span class="dv">1</span>)</span>
<span id="cb126-3"><a href="#cb126-3"></a></span>
<span id="cb126-4"><a href="#cb126-4"></a>end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2000-03-13 06:00:00 UTC"</code></pre>
</div>
</div>
<p>Now we always add 365 days, but we see that March 13th is one year after March 14th.</p>
</section>
<section id="intervals" class="level4">
<h4 class="anchored" data-anchor-id="intervals">Intervals</h4>
<p>Until now, we’ve focused on points in time. <strong>Intervals</strong> have length and have a starting point and an ending point.</p>
<p>Suppose classes start on August 23rd and proceed every week for a while. Do any of these dates conflict with Georgetown’s fall break?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a>classes <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="st">"2023-08-23"</span>) <span class="sc">+</span> <span class="fu">weeks</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">15</span>)</span>
<span id="cb128-2"><a href="#cb128-2"></a></span>
<span id="cb128-3"><a href="#cb128-3"></a>fall_break <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">as_date</span>(<span class="st">"2023-11-22"</span>), <span class="fu">as_date</span>(<span class="st">"2023-11-26"</span>))</span>
<span id="cb128-4"><a href="#cb128-4"></a></span>
<span id="cb128-5"><a href="#cb128-5"></a>classes <span class="sc">%within%</span> fall_break</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[13] FALSE  TRUE FALSE FALSE</code></pre>
</div>
</div>
<p>We focused on dates, but many of the same principles hold for date-times.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 6</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Create a date object for your birth date.</li>
<li>Calculate the number of days since your birth date.</li>
<li>Create a vector of your birthdays from your birth date for the next 120 years. <em>Do you use periods or durations?</em></li>
</ol>
</div>
</div>
</section>
</section>
<section id="missing-data" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">1.4.4</span> Missing Data</h3>
<p>Missing data are ever present in data analysis. R stores missing values as <code>NA</code>, which are contagious and are fortunately difficult to ignore.</p>
<p><code>replace_na()</code> is the quickest function to replace missing values. It is a shortcut for a specific instance of <code>if_else()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>, <span class="dv">3</span>)</span>
<span id="cb130-2"><a href="#cb130-2"></a></span>
<span id="cb130-3"><a href="#cb130-3"></a><span class="fu">if_else</span>(<span class="at">condition =</span> <span class="fu">is.na</span>(x), <span class="at">true =</span> <span class="dv">2</span>, <span class="at">false =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="fu">replace_na</span>(x, <span class="at">replace =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>We recommend avoiding arguments like <code>na.rm</code> and using <code>filter()</code> for structurally missing values and <code>replace_na()</code> or imputation for nonresponse.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 7</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s focus on different data shared by SOI. Now we’ll focus on <a href="https://www.irs.gov/statistics/soi-tax-stats-historic-table-2">individual income and tax data by state</a>.</p>
<p>This Excel workbook is a beast. For instance, it isn’t clear how the hierarchy works. I expected all of the rows nested under “Number of returns” to sum up to the number of returns. Unfortunately, the rows are not disjoint. Also, the merged cells for column headers are very difficult to use with programming languages.</p>
<ol type="1">
<li>Start with <code>20in01al.xlsx</code>.</li>
<li>Create a tidy data frame with rows 10 through 12 (“Number of single returns”, “Number of joint returns”, and “Number of head of household returns”) disaggregated by “size of adjusted gross income”.</li>
</ol>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>The instinct to include these comments is good. The execution is poor because it creates big headaches for people using programming languages. I suggest using a data dictionary instead.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This example uses regular expressions (regex). Visit <a href="https://r4ds.hadley.nz/regexps">R4DS (2e)</a> for a review of regex.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Welcome</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07_advanced-quarto.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>