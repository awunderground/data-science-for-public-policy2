<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Public Policy - 11&nbsp; Web Application Programming Interfaces (Web APIs)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13_web-scraping.html" rel="next">
<link href="./10_functions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="www/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10_functions.html">Programming</a></li><li class="breadcrumb-item"><a href="./12_apis.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Public Policy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to the tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_advanced-data-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Data Cleaning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with ggplot2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Reproducible Research</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_reproducible-research-with-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research with Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_advanced-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Advanced Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_reproducible-research-with-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Reproducible Research with Git and GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_advanced-git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Git and Github</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_apis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Statistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_simulation-and-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Simulation and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_microsimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Microsimulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16_nonparametric-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Nonparametric Curve Fitting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17_nonparametric-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Nonparametric Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Supervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19_predictive-modeling-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Predictive Modeling Motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20_predictive-modeling-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Predictive Modeling Concepts and Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_supervised-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_ensembling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Ensembling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23_regularization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regularization</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Unsupervised Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27_advanced-unsupervised-ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Mixture Distributions and Mixture Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Geospatial Analysis with sf</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28_text-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Text Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29_text-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Text Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#api-background" id="toc-api-background" class="nav-link active" data-scroll-target="#api-background"><span class="header-section-number">11.1</span> API Background</a></li>
  <li><a href="#popular-web-apis" id="toc-popular-web-apis" class="nav-link" data-scroll-target="#popular-web-apis"><span class="header-section-number">11.2</span> Popular Web APIs</a></li>
  <li><a href="#why-apis" id="toc-why-apis" class="nav-link" data-scroll-target="#why-apis"><span class="header-section-number">11.3</span> Why APIs?</a>
  <ul class="collapse">
  <li><a href="#why-use-apis" id="toc-why-use-apis" class="nav-link" data-scroll-target="#why-use-apis"><span class="header-section-number">11.3.1</span> Why use APIs?</a></li>
  <li><a href="#why-build-apis" id="toc-why-build-apis" class="nav-link" data-scroll-target="#why-build-apis"><span class="header-section-number">11.3.2</span> Why build APIs?</a></li>
  </ul></li>
  <li><a href="#technical-background-part-i" id="toc-technical-background-part-i" class="nav-link" data-scroll-target="#technical-background-part-i"><span class="header-section-number">11.4</span> Technical Background Part I</a></li>
  <li><a href="#process-without-r-code" id="toc-process-without-r-code" class="nav-link" data-scroll-target="#process-without-r-code"><span class="header-section-number">11.5</span> Process (without R code)</a>
  <ul class="collapse">
  <li><a href="#request-build-up-a-url" id="toc-request-build-up-a-url" class="nav-link" data-scroll-target="#request-build-up-a-url"><span class="header-section-number">11.5.1</span> REQUEST (build up a URL)</a></li>
  <li><a href="#check-for-a-server-error-in-the-response" id="toc-check-for-a-server-error-in-the-response" class="nav-link" data-scroll-target="#check-for-a-server-error-in-the-response"><span class="header-section-number">11.5.2</span> Check for a server error in the response</a></li>
  <li><a href="#parse-the-response" id="toc-parse-the-response" class="nav-link" data-scroll-target="#parse-the-response"><span class="header-section-number">11.5.3</span> Parse the response</a></li>
  </ul></li>
  <li><a href="#technical-background-part-ii" id="toc-technical-background-part-ii" class="nav-link" data-scroll-target="#technical-background-part-ii"><span class="header-section-number">11.6</span> Technical Background Part II</a></li>
  <li><a href="#r-example-1" id="toc-r-example-1" class="nav-link" data-scroll-target="#r-example-1"><span class="header-section-number">11.7</span> R example 1</a>
  <ul class="collapse">
  <li><a href="#request-build-up-a-url-1" id="toc-request-build-up-a-url-1" class="nav-link" data-scroll-target="#request-build-up-a-url-1"><span class="header-section-number">11.7.1</span> REQUEST (build up a URL)</a></li>
  <li><a href="#check-for-a-server-error-in-the-response-1" id="toc-check-for-a-server-error-in-the-response-1" class="nav-link" data-scroll-target="#check-for-a-server-error-in-the-response-1"><span class="header-section-number">11.7.2</span> Check for a server error in the response</a></li>
  </ul></li>
  <li><a href="#parse-the-response-1" id="toc-parse-the-response-1" class="nav-link" data-scroll-target="#parse-the-response-1"><span class="header-section-number">11.8</span> 3. Parse the response</a></li>
  <li><a href="#terms-of-service-of-user-agents" id="toc-terms-of-service-of-user-agents" class="nav-link" data-scroll-target="#terms-of-service-of-user-agents"><span class="header-section-number">11.9</span> Terms of Service of User Agents</a></li>
  <li><a href="#authentication" id="toc-authentication" class="nav-link" data-scroll-target="#authentication"><span class="header-section-number">11.10</span> Authentication</a></li>
  <li><a href="#pagination" id="toc-pagination" class="nav-link" data-scroll-target="#pagination"><span class="header-section-number">11.11</span> Pagination</a></li>
  <li><a href="#rate-limiting" id="toc-rate-limiting" class="nav-link" data-scroll-target="#rate-limiting"><span class="header-section-number">11.12</span> Rate Limiting</a></li>
  <li><a href="#r-example-2-advanced" id="toc-r-example-2-advanced" class="nav-link" data-scroll-target="#r-example-2-advanced"><span class="header-section-number">11.13</span> R example 2 (Advanced)</a>
  <ul class="collapse">
  <li><a href="#write-a-custom-function" id="toc-write-a-custom-function" class="nav-link" data-scroll-target="#write-a-custom-function"><span class="header-section-number">11.13.1</span> Write a custom function</a></li>
  <li><a href="#create-a-vector-of-fips" id="toc-create-a-vector-of-fips" class="nav-link" data-scroll-target="#create-a-vector-of-fips"><span class="header-section-number">11.13.2</span> Create a vector of FIPs</a></li>
  <li><a href="#iterate-the-functions" id="toc-iterate-the-functions" class="nav-link" data-scroll-target="#iterate-the-functions"><span class="header-section-number">11.13.3</span> Iterate the functions</a></li>
  </ul></li>
  <li><a href="#r-packages" id="toc-r-packages" class="nav-link" data-scroll-target="#r-packages"><span class="header-section-number">11.14</span> R Packages</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11.15</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#popular-r-api-packages-and-r-api-packages-developed-by-the-urban-institute" id="toc-popular-r-api-packages-and-r-api-packages-developed-by-the-urban-institute" class="nav-link" data-scroll-target="#popular-r-api-packages-and-r-api-packages-developed-by-the-urban-institute"><span class="header-section-number">11.15.1</span> Popular R API packages and R API packages developed by the Urban Institute</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">11.15.2</span> Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Web Application Programming Interfaces (Web APIs)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    Many data providers allow public access to data through APIs. Understanding how these work and how to use R to call and gather data from APIs is an important skill for a data scientist.
  </div>
</div>

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/header-images/Soemmerring_1810_telegraph_overview.jpg" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Sömmering’s electric telegraph in 1809</figcaption>
</figure>
</div>
<section id="api-background" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="api-background"><span class="header-section-number">11.1</span> API Background</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Application Programming Interface (API)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Application Programming Interface (API)
</div>
</div>
<div class="callout-body-container callout-body">
<p>An <em>Application Programming Interface (API)</em> is a set of functions for programmatically accessing and/or processing data. Packages like <code>library(dplyr)</code> and <code>library(ggplot2)</code> have APIs that were carefully designed to be approachable. The <a href="https://dplyr.tidyverse.org/">dplyr</a> website says, “dplyr is a part of the tidyverse, an ecosystem of packages designed with common APIs and a shared philosophy.”</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Web API">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Web API
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <em>web API</em> is a way to interact with web-based software through code - usually to retrieve data or use a tool. We will only focus on web APIs in this tutorial. To use web APIs, actions between computers and web applications are typically communicated through URLs that are passed between the computers. Manipulating URLs is key to using web APIs.</p>
</div>
</div>
</section>
<section id="popular-web-apis" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="popular-web-apis"><span class="header-section-number">11.2</span> Popular Web APIs</h2>
<ul>
<li><a href="https://developers.google.com/maps/documentation">Google Maps APIs</a></li>
<li><a href="https://developer.twitter.com/en/docs">Twitter API</a></li>
<li><a href="https://developer.github.com/v3/">GitHub API</a></li>
<li><a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-about-the-indicators-api-documentation">World Bank</a></li>
<li><a href="https://www.census.gov/developers/">Census API</a></li>
<li><a href="https://api.open.fec.gov/developers/">OpenFEC</a></li>
<li><a href="https://educationdata.urban.org/data-explorer/">Urban Institute Education Data Portal</a></li>
<li><a href="https://stanfordnlp.github.io/CoreNLP/api.html">Stanford CoreNLP API</a></li>
<li><a href="http://docs.opentripplanner.org/en/latest/">OpenTripPlanner API</a></li>
<li><a href="https://www.who.int/data/gho/info/gho-odata-api">World Health Organization API</a></li>
<li><a href="http://data.un.org/Host.aspx?Content=API">UNdata API</a></li>
</ul>
</section>
<section id="why-apis" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="why-apis"><span class="header-section-number">11.3</span> Why APIs?</h2>
<section id="why-use-apis" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="why-use-apis"><span class="header-section-number">11.3.1</span> Why use APIs?</h3>
<ul>
<li><strong>The data or method is only available through an API:</strong> Census data and IPEDS are available through point-and-click interfaces and APIs, but many data and methods are only available through APIs. For example, data from the <a href="https://developers.google.com/maps/documentation">GoogleMaps API</a> and methods from the <a href="https://stanfordnlp.github.io/CoreNLP/index.html">Stanford CoreNLP</a> software are only available in R through APIs.</li>
<li><strong>APIs promote reproducibility:</strong> Even with good documentation, pointing-and-clicking is tough to reproduce. APIs are useful for writing code to access data in an analysis before processing, modeling, and/or visualizing.</li>
<li><strong>APIs enable scalability:</strong> It’s simple to point-and-click data for one state or one county. It’s much tougher to point-and-click state or county level data if the data are stored in separate files. APIs can be accessed programtically, which means anything can be iterated to scale.</li>
</ul>
</section>
<section id="why-build-apis" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="why-build-apis"><span class="header-section-number">11.3.2</span> Why build APIs?</h3>
<ul>
<li><strong>APIs enable scalability:</strong> APIs enable scalability for data or methods creators. For example, the Urban Institute builds data visualization applications like <a href="https://www.urban.org/features/explore-your-schools-changing-demographics">Explore Your School’s Changing Demographics</a> on top of APIS.</li>
<li><strong>APIs create standardization:</strong> APIs standardize the communication between applications. By creating a protocol for a store of data or a model, it makes it simpler for downstream applications to access the data or methods of upstream applications.</li>
<li><strong>Democratize access to data or methods:</strong> Centralized storage and processing on the cloud are cheaper than personal computing on desktops and laptops. APIs allow users to access subsets of data or summary statistics quicker and cheaper than accessing all data and/or processing that data locally. For example, the new <a href="https://medium.com/@urban_institute/democratizing-big-data-processing-for-the-education-data-portal-394529aceb39">Urban Institute prototype summary API endpoints</a> allow users to create summary statistics in API calls, which saves time and local storage.</li>
</ul>
</section>
</section>
<section id="technical-background-part-i" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="technical-background-part-i"><span class="header-section-number">11.4</span> Technical Background Part I</h2>
<ul>
<li><strong>Server:</strong> Remote computer that stores and processes information for an API. Note: This does not need to be a literal server. Many APIs are serverless and hosted in the cloud.</li>
<li><strong>Client:</strong> Computer requesting information from the API. In our cases, this is your computer.</li>
<li><strong>Hyper-Text Transfer Protocol (HTTP):</strong> Set of rules clients use to communicate with servers via the web (etiquette).</li>
<li><strong>Request:</strong> Contacting a web API with specifics about the information you wish to have returned. In general, this is built up as a URL.</li>
<li><strong>Response:</strong> A formatted set of information servers return to clients after requests.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/client-server.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
<p>Source: <a href="https://zapier.com/learn/apis/chapter-2-protocols/">Zapier</a></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Uniform Resource Locators (URL)">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Uniform Resource Locators (URL)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Uniform Resource Locators (URL):</strong> Text string that specifies a web location, a method for retrieving information from that web location, and additional parameters. We use these every day!</p>
</div>
</div>
</section>
<section id="process-without-r-code" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="process-without-r-code"><span class="header-section-number">11.5</span> Process (without R code)</h2>
<ol type="1">
<li>Client builds up a URL and sends a request to a server</li>
<li>Client receives a response from the server and checks for an error message</li>
<li>Client parses the response into a useful object: data frame</li>
</ol>
<section id="request-build-up-a-url" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="request-build-up-a-url"><span class="header-section-number">11.5.1</span> REQUEST (build up a URL)</h3>
<p>Let’s walk through an example from the <a href="https://www.census.gov/data/developers/guidance/api-user-guide/query-examples.html">Census Bureau</a>.</p>
<ol type="1">
<li>The Census Bureau API contains hundreds of distinct data sets. Copy-and-paste https://api.census.gov/data.html into your web browser to see the list of datasets and documentation. Each one of these data sets is an API resource.</li>
<li>All Census Bureau API datasets are available from the same host name. Copy-and-paste https://api.census.gov/data/ into your browser (the previous link without .html). This contains information about all of the datasets in the previous link, only now the information is stored as JavaScript Object Notation (JSON) instead of HTML.</li>
<li>Each dataset is accessed through a <em>base URL</em> which consists of the host name, the year, and the “dataset name”. Copy-and-paste https://api.census.gov/data/2014/pep/natstprc into your web browser. This returns Vintage 2014 Population Estimates: US, State, and PR Total Population and Components of Change. Each base URL corresponds to an API endpoint.</li>
<li>At this point, we’re still only seeing metadata. We need to add a query string with a method and parameters. Copy-and-paste https://api.census.gov/data/2014/pep/natstprc?get=STNAME,POP&amp;DATE_=7&amp;for=state:* into your browser. Note the query string begins with <code>?</code>, includes the get method, and includes three parameters.</li>
</ol>
</section>
<section id="check-for-a-server-error-in-the-response" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="check-for-a-server-error-in-the-response"><span class="header-section-number">11.5.2</span> Check for a server error in the response</h3>
<ol type="1">
<li>All of the URLs in part 1 were correctly specified and all of them returned results. What happens when incorrect URLs are passed to an API? Open a new browser window and copy-and-paste</li>
</ol>
<pre><code>https://api.census.gov/data/2014/pep/natstprc?get=STNAME,POP&amp;DATE_=7&amp;for=state:57</code></pre>
<p>Note: this call requests information for FIPs 57, which does not exist.</p>
</section>
<section id="parse-the-response" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="parse-the-response"><span class="header-section-number">11.5.3</span> Parse the response</h3>
<p>APIs need to return complicated hierarchical data as text. To do this, most APIs use <strong>JavaScript Object Notation (JSON)</strong>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="JSON">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
JSON
</div>
</div>
<div class="callout-body-container callout-body">
<p>JSON is a plain text hierarchical data structure. JSON is not JavaScript code. Instead, it’s a non-rectangular method for storing data that can be accessed by most web applications and programming languages. Lists are made with <code>[]</code>. Objects are made with <code>{}</code> and contain key-value pairs. JSON is good at representing non-rectangular data and is standard on the web.</p>
<p>Some example JSON could be:</p>
<pre><code>{
  “Class name”: “Intro to Data Science”,
  “Class ID”: “PPOL 670”,
  “Instructors”: [“Aaron R. Williams”, “Alex C. Engler”],
  “Location”: {
    “Building”: “Healy Hall”
    “Room”: “105”
  }
}
</code></pre>
</div>
</div>
<p>Web APIs can also return Extensible Markup Language (XML) and HyperText Markup Language (HTML), but JSON is definitely most popular. We’ll use <code>library(jsonlite)</code> to parse hierarchical data and turn it into tidy data.</p>
</section>
</section>
<section id="technical-background-part-ii" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="technical-background-part-ii"><span class="header-section-number">11.6</span> Technical Background Part II</h2>
<ul>
<li><strong>API Resource</strong> An object in an API. In our case, a resource will almost always be a specific data set.</li>
<li><strong>API endpoint</strong> The point where a client communicates with a web API.</li>
<li><strong>Method/verb:</strong> A verb that specifies the action the client wants to perform on the resource through an API endpoint:
<ul>
<li>GET - Ask an API to send something to you</li>
<li>POST - send something to an API</li>
<li>HEAD, PUT, DELETE, TRACE, OPTIONS, CONNECT, PATCH</li>
</ul></li>
<li><strong>Query string</strong> Part of a URL that assigns values to parameters. Query strings begin with <code>?</code>. The general form is <strong>key=value</strong>.</li>
<li><strong>Parameters:</strong> Arguments that are passed to APIs. Parameters are separated by <code>&amp;</code>.</li>
<li><strong>Headers</strong> Meta-information about GET requests. We will only use the User-Agent HTTP Header.</li>
<li><strong>Body</strong> Additional information sent to the server. This isn’t important for GET requests.</li>
<li><strong>Server response code</strong> (HTTP status code)
<ul>
<li>100s: information responses</li>
<li>200s: success</li>
<li>300s: redirection</li>
<li>400s: client error</li>
<li>500s: server error</li>
</ul></li>
</ul>
</section>
<section id="r-example-1" class="level2" data-number="11.7">
<h2 data-number="11.7" class="anchored" data-anchor-id="r-example-1"><span class="header-section-number">11.7</span> R example 1</h2>
<p>Let’s walk through the example above using R. First install <code>library(httr)</code> and <code>library(jsonlite)</code> with <code>install.packages(c("httr", "jsonlite"))</code>.</p>
<p><a href="https://cran.r-project.org/web/packages/httr/index.html"><code>httr</code></a> contains tools for working with HTTP and URLs. It contains functions for all HTTP methods including <code>GET()</code> and <code>POST()</code>.</p>
<section id="request-build-up-a-url-1" class="level3" data-number="11.7.1">
<h3 data-number="11.7.1" class="anchored" data-anchor-id="request-build-up-a-url-1"><span class="header-section-number">11.7.1</span> REQUEST (build up a URL)</h3>
<p>Using the final URL from the above example, lets query state names and state population in July 2014 for all states, Washington, D.C., and Puerto Rico. Note, it is good practice to create the link outside of <code>GET()</code> because we may need to manipulate the URL string in later examples. Note that <code>*</code> is a wildcard character which requests data for all possible values of the parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(httr)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'jsonlite' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># make the URL</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>url <span class="ot">&lt;-</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="st">"https://api.census.gov/data/2014/pep/natstprc?get=STNAME,POP&amp;DATE_=7&amp;for=state:*"</span></span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># use the URL to make a request from the API</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>pop_json <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-a-server-error-in-the-response-1" class="level3" data-number="11.7.2">
<h3 data-number="11.7.2" class="anchored" data-anchor-id="check-for-a-server-error-in-the-response-1"><span class="header-section-number">11.7.2</span> Check for a server error in the response</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">http_status</span>(pop_json)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$category
[1] "Success"

$reason
[1] "OK"

$message
[1] "Success: (200) OK"</code></pre>
</div>
</div>
</section>
</section>
<section id="parse-the-response-1" class="level2" data-number="11.8">
<h2 data-number="11.8" class="anchored" data-anchor-id="parse-the-response-1"><span class="header-section-number">11.8</span> 3. Parse the response</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># get the contents of the response as a text string</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>pop_json <span class="ot">&lt;-</span> <span class="fu">content</span>(pop_json, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># create a character matrix from the JSON</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>pop_matrix <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(pop_json)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># turn the body of the character matrix into a tibble</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>pop_data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pop_matrix[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(pop_matrix), ],</span>
<span id="cb8-9"><a href="#cb8-9"></a>                      <span class="at">.name_repair =</span> <span class="st">"minimal"</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co"># add variable names to the tibble</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="fu">names</span>(pop_data) <span class="ot">&lt;-</span> pop_matrix[<span class="dv">1</span>, ]</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a>pop_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 4
   STNAME               POP      DATE_ state
   &lt;chr&gt;                &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1 Alabama              4849377  7     01   
 2 Alaska               736732   7     02   
 3 Arizona              6731484  7     04   
 4 Arkansas             2966369  7     05   
 5 California           38802500 7     06   
 6 Colorado             5355866  7     08   
 7 Connecticut          3596677  7     09   
 8 Delaware             935614   7     10   
 9 District of Columbia 658893   7     11   
10 Florida              19893297 7     12   
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>Parsing the response can be trickiest step. Here, the data of interest are rectangular and the JSON object is simple to parse. Sometimes, the returned object will be a complicated hierarchical structure, which will demand writing more R code.</p>
</section>
<section id="terms-of-service-of-user-agents" class="level2" data-number="11.9">
<h2 data-number="11.9" class="anchored" data-anchor-id="terms-of-service-of-user-agents"><span class="header-section-number">11.9</span> Terms of Service of User Agents</h2>
<p>Always read an API’s terms of service to ensure that use of the API conforms to the API’s rules.</p>
<p>Furthermore, it is a good idea to only run one API request at a time and to identify yourself as a user-agent in the header of the HTTP request. This is simple with <code>user_agent()</code> from <code>library(httr)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">GET</span>(url_link, </span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="fu">user_agent</span>(<span class="st">"Georgetown Univ. Student Data Collector (student@georgetown.edu)."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span style="color:#1696d2;">Exercise 1</span>
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Visit the <a href="https://educationdata.urban.org/documentation/">Urban Institute Education Data Portal API</a>.</li>
<li>Read the Terms of Use.</li>
<li>Let’s pull data from IPEDS about full-time equivalent enrollment in graduate schools in 2016 in Washington, DC (FIP = 11). Create a new .R script called get-ed-data.R.</li>
<li>Read the instructions for <a href="https://educationdata.urban.org/documentation/#direct_access">direct API access</a>. Copy-and-paste the generic form of the API call into you .R script.</li>
<li>Navigate to the documentation for <a href="https://educationdata.urban.org/documentation/colleges.html#ipeds-enrollment-full-time-equivalent">Enrollment - Full time equivalent</a>. Note that you may have to click “Full-time equivalent” under “Enrollment” in the menu on the left-hand side of the page to get to the relevant section. The example URL is “/api/v1/college-university/ipeds/enrollment-full-time-equivalent/{year}/{level_of_study}/” <strong>Note:</strong> The Urban Institute created an R package that simplifies this entire process. Let’s build our request from scratch just to prove that we can.</li>
<li>Combine the endpoint URL with the example URL from earlier. This means combining the base URL with the URL and parameters for the endpoint.</li>
<li>Fill in the necessary parameters and filters.</li>
<li>Make a GET request with <code>GET()</code>. Be sure to include the User-Agent.</li>
<li>Check the HTTP status.</li>
<li>Parse the response.</li>
</ol>
</div>
</div>
</section>
<section id="authentication" class="level2" data-number="11.10">
<h2 data-number="11.10" class="anchored" data-anchor-id="authentication"><span class="header-section-number">11.10</span> Authentication</h2>
<p>Many APIs require authentication. For example, the Census API requires a user-specific API key for all API calls. (<a href="https://api.census.gov/data/key_signup.html">You can sign up here</a>) This API key is simply passed as part of the path in the HTTP request.</p>
<pre><code>"https://api.census.gov/data/2014/pep/natstprc
?get=STNAME,POP&amp;DATE_=7&amp;for=state:*&amp;key=your key here" </code></pre>
<p>There are other authentication methods, but this is most common.</p>
<p>It is a bad idea to share API credentials. NEVER post a credential on GitHub. A convenient solution is to use a credentials file with the <code>library(dotenv)</code> package as follows:</p>
<p>First, install the package using <code>install.packages("dotenv")</code> in the console and create a file called <code>.env</code> in the directory where your .Rproj is located. You may get a message that files starting with a “.” are reserved for the system, you should hit “ok” to proceed. You can store as many credentials as you want in this file, with each key-value pair on a new line. Note you need to hit enter after the last key-value pair so the file ends with a blank new line.</p>
<pre><code>census_api_key=&lt;key value&gt;
</code></pre>
<p>Then, you can access and use credentials as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">library</span>(dotenv)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">library</span>(here)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="fu">load_dot_env</span>()</span>
<span id="cb13-5"><a href="#cb13-5"></a>credential <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>url <span class="ot">&lt;-</span> <span class="fu">str_glue</span>(</span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/2014/pep/natstprc"</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>         <span class="st">"?get=STNAME,POP&amp;DATE_=7&amp;for=state:*&amp;key={credential}"</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you may have to restart your R session to load the file. Be sure to add this <code>.env</code> credentials file to your <code>.gitignore</code>!</p>
</section>
<section id="pagination" class="level2" data-number="11.11">
<h2 data-number="11.11" class="anchored" data-anchor-id="pagination"><span class="header-section-number">11.11</span> Pagination</h2>
<p>A single API call could potentially return an unwieldy amount of information. This would be bad for the server, because the organization would need to pay for lots of computing power. This would also be bad for the client because the client could quickly become overwhelmed by data. To solve this issue, many APIs are paginated. Pagination is simply breaking API responses into subsets.</p>
<p>For example, the original example returned information for all states in the United States. When information is requested at the Census tract level, instead of returning information for the entire United States, information can only be requested one state at a time. Getting information for the entire United States will require iterating through each state.</p>
</section>
<section id="rate-limiting" class="level2" data-number="11.12">
<h2 data-number="11.12" class="anchored" data-anchor-id="rate-limiting"><span class="header-section-number">11.12</span> Rate Limiting</h2>
<p>Rate limiting is capping the number of requests by a client to an API in a given period of time. This is most relevant when results are paginated and iterating requests is necessary. It is also relevant when developing code to query an API–because a developer can burden the API with ultimately useless requests.</p>
<p>It is sometimes useful to add <code>Sys.sleep()</code> to R code, to pause the R code to give the API a break from requests between each request. Even 0.5 seconds can be the difference.</p>
</section>
<section id="r-example-2-advanced" class="level2" data-number="11.13">
<h2 data-number="11.13" class="anchored" data-anchor-id="r-example-2-advanced"><span class="header-section-number">11.13</span> R example 2 (Advanced)</h2>
<p>This example pulls information at the Census tract level. Because of pagination, the example requires a custom function and iterates that function using <code>map_df()</code> from <code>library(purrr)</code>. It includes <code>Sys.sleep()</code> to pause the requests between each query.</p>
<p>The example pulls the estimated number of males (B01001_002E) and females (B01001_026E) in the 2018 5-year ACS for each Census tract in Alabama and Alaska.</p>
<p>Here are a few select columns for the 2018 5-year ACS from the Census API <a href="https://api.census.gov/data.html">documentation page</a>:</p>
<table class="table">
<thead>
<tr class="header">
<th>Vintage</th>
<th>Dataset Name</th>
<th>Dataset Type</th>
<th>Geography List</th>
<th>Variable List</th>
<th>Group List</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2018</td>
<td>acs&gt;acs5&gt;profile</td>
<td>Aggregate</td>
<td><a href="https://api.census.gov/data/2018/acs/acs5/geography.html">geographies</a></td>
<td><a href="https://api.census.gov/data/2018/acs/acs5/variables.html">variables</a></td>
<td><a href="https://api.census.gov/data/2018/acs/acs5/groups.html">groups</a></td>
<td><a href="https://api.census.gov/data/2018/acs/acs5/examples.html">examples</a></td>
</tr>
</tbody>
</table>
<section id="write-a-custom-function" class="level3" data-number="11.13.1">
<h3 data-number="11.13.1" class="anchored" data-anchor-id="write-a-custom-function"><span class="header-section-number">11.13.1</span> Write a custom function</h3>
<p>This function 1. builds a URL and requests from the API, 2. checks for a server error, and 3. parses the response</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>get_acs <span class="ot">&lt;-</span> <span class="cf">function</span>(fips, credential) {</span>
<span id="cb14-2"><a href="#cb14-2"></a>  </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="co"># build a URL</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="co"># paste0() is only used because the URL was too wide for the PDF</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  url <span class="ot">&lt;-</span> <span class="fu">str_glue</span>(</span>
<span id="cb14-6"><a href="#cb14-6"></a>    <span class="fu">paste0</span>(</span>
<span id="cb14-7"><a href="#cb14-7"></a>      <span class="st">"https://api.census.gov/data/2018/acs/acs5"</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>      <span class="st">"?get=B01001_002E,B01001_026E&amp;for=tract:*&amp;in=state:{fips}&amp;key={credential}"</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10"></a>  )</span>
<span id="cb14-11"><a href="#cb14-11"></a></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="co"># use the URL to make a request from the API</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>  acs_json <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="at">url =</span> url)</span>
<span id="cb14-14"><a href="#cb14-14"></a>  </span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="co"># get the contents of the response as a text string</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>  acs_json <span class="ot">&lt;-</span> <span class="fu">content</span>(acs_json, <span class="at">as =</span> <span class="st">"text"</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a>  </span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="co"># create a character matrix from the JSON</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  acs_matrix <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(acs_json)</span>
<span id="cb14-20"><a href="#cb14-20"></a>  </span>
<span id="cb14-21"><a href="#cb14-21"></a>  <span class="co"># turn the body of the character matrix into a tibble</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>  acs_data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(acs_matrix[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(acs_matrix), ],</span>
<span id="cb14-23"><a href="#cb14-23"></a>                        <span class="at">.name_repair =</span> <span class="st">"minimal"</span>)</span>
<span id="cb14-24"><a href="#cb14-24"></a>  </span>
<span id="cb14-25"><a href="#cb14-25"></a>  <span class="co"># add variable names to the tibble</span></span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">names</span>(acs_data) <span class="ot">&lt;-</span> acs_matrix[<span class="dv">1</span>, ]</span>
<span id="cb14-27"><a href="#cb14-27"></a>  </span>
<span id="cb14-28"><a href="#cb14-28"></a>  <span class="co"># pause to be polite</span></span>
<span id="cb14-29"><a href="#cb14-29"></a>  <span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb14-30"><a href="#cb14-30"></a>  </span>
<span id="cb14-31"><a href="#cb14-31"></a>  <span class="fu">return</span>(acs_data)</span>
<span id="cb14-32"><a href="#cb14-32"></a></span>
<span id="cb14-33"><a href="#cb14-33"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-vector-of-fips" class="level3" data-number="11.13.2">
<h3 data-number="11.13.2" class="anchored" data-anchor-id="create-a-vector-of-fips"><span class="header-section-number">11.13.2</span> Create a vector of FIPs</h3>
<p>This could be all states, districts, and territories. It’s only Alabama and Alaska for brevity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"01"</span>, <span class="st">"02"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="iterate-the-functions" class="level3" data-number="11.13.3">
<h3 data-number="11.13.3" class="anchored" data-anchor-id="iterate-the-functions"><span class="header-section-number">11.13.3</span> Iterate the functions</h3>
<p><code>map_df()</code> iterates <code>get_acs()</code> along the vector of state FIPs and returns a <code>tibble</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># load credentials</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>credential <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"census_api_key"</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># iterate the function over Alabama and Alaska</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">map_df</span>(fips, <span class="at">.f =</span> get_acs, <span class="at">credential =</span> credential)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,348 × 5
   B01001_002E B01001_026E state county tract 
   &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; 
 1 2409        2800        01    097    006501
 2 5961        6372        01    097    006502
 3 3098        2888        01    097    006701
 4 1837        1993        01    097    006702
 5 1410        1503        01    097    007201
 6 1538        1136        01    097    007202
 7 1586        1311        01    097    007400
 8 680         705         01    097    007500
 9 981         997         01    097    007600
10 537         691         01    097    007700
# ℹ 1,338 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="r-packages" class="level2" data-number="11.14">
<h2 data-number="11.14" class="anchored" data-anchor-id="r-packages"><span class="header-section-number">11.14</span> R Packages</h2>
<p>There are R packages that simplify interacting with many popular APIs. <code>library(tidycensus)</code> (<a href="https://walker-data.com/tidycensus/">tutorial here</a>) and <code>library(censusapi)</code> (<a href="https://cran.r-project.org/web/packages/censusapi/vignettes/getting-started.html">tutorial here</a>) simplifies navigating Census documentation, checking the status code, building URLs for the Census API, and parsing JSON responses. This can save a lot of time and effort! The following code is one iteration of the advanced example from above!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">library</span>(censusapi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'censusapi' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">getCensus</span>(</span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="at">name =</span> <span class="st">"acs/acs5"</span>,</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"B01001_002E"</span>, <span class="st">"B01001_026E"</span>), </span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="at">region =</span> <span class="st">"tract:*"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="at">regionin =</span> <span class="st">"state:01"</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="at">vintage =</span> <span class="dv">2018</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="at">key =</span> credential</span>
<span id="cb20-8"><a href="#cb20-8"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,181 × 5
   state county tract  B01001_002E B01001_026E
   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;int&gt;       &lt;int&gt;
 1 01    097    006501        2409        2800
 2 01    097    006502        5961        6372
 3 01    097    006701        3098        2888
 4 01    097    006702        1837        1993
 5 01    097    007201        1410        1503
 6 01    097    007202        1538        1136
 7 01    097    007400        1586        1311
 8 01    097    007500         680         705
 9 01    097    007600         981         997
10 01    097    007700         537         691
# ℹ 1,171 more rows</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level2" data-number="11.15">
<h2 data-number="11.15" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">11.15</span> Conclusion</h2>
<p>R provides robust tools to call APIs. Many R packages, including some developed by data scientists at the Urban Institute, provide more user-friendly interfaces to APIs. Remember to be polite when calling APIs and not to share API credentials publicly.</p>
<section id="popular-r-api-packages-and-r-api-packages-developed-by-the-urban-institute" class="level3" data-number="11.15.1">
<h3 data-number="11.15.1" class="anchored" data-anchor-id="popular-r-api-packages-and-r-api-packages-developed-by-the-urban-institute"><span class="header-section-number">11.15.1</span> Popular R API packages and R API packages developed by the Urban Institute</h3>
<ul>
<li><a href="https://cran.r-project.org/web/packages/censusapi/index.html">censusapi</a></li>
<li><a href="https://cran.r-project.org/web/packages/tidycensus/index.html">tidycensus</a></li>
<li><a href="https://cran.r-project.org/web/packages/tigris/index.html">tigris</a></li>
<li><a href="https://github.com/UrbanInstitute/education-data-package-r">Urban Institute Education Data Portal</a></li>
<li><a href="https://github.com/UrbanInstitute/sedtR">Urban Institute sedtR package</a></li>
</ul>
</section>
<section id="resources" class="level3" data-number="11.15.2">
<h3 data-number="11.15.2" class="anchored" data-anchor-id="resources"><span class="header-section-number">11.15.2</span> Resources</h3>
<ul>
<li><a href="https://zapier.com/learn/apis/">Zapier Intro to APIs</a></li>
<li><a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">Best practices for API packages</a></li>
<li><a href="https://medium.com/@urban_institute/why-we-built-the-education-data-portal-3cae85048b48">Why we built the Education Data Portal</a></li>
<li><a href="https://medium.com/@urban_institute/why-we-built-an-api-for-urbans-education-data-portal-1dc83468e7b">Why we built an API for Urban’s Education Data Portal</a></li>
<li><a href="https://medium.com/@urban_institute/how-we-built-the-api-for-the-education-data-portal-cabbf4814a45">How we built the API for the Education Data Portal</a></li>
<li><a href="https://medium.com/@urban_institute/democratizing-big-data-processing-for-the-education-data-portal-394529aceb39">Democratizing Big Data Processing for the Education Data Portal</a></li>
<li><a href="https://medium.com/@urban_institute/building-r-and-stata-packages-for-the-education-data-portal-b88760c07233">Building R and Stata packages for the Education Data Portal</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10_functions.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced R Programming</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13_web-scraping.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Web Scraping</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>